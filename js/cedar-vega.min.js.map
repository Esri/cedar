{"version":3,"file":"cedar-vega.min.js","sources":["../../bower_components/vega/vega.js","../../bower_components/underscore/underscore.js","../../src/cedar.js"],"names":["factory","define","amd","tj","topojson","vg","d3","vg_escape_str","x","replace","escape_str_re","vg_truncateOnWord","s","len","rev","cnt","tok","split","vg_truncate_word_re","reverse","filter","w","length","join","trim","slice","vg_write","msg","config","isNode","process","stderr","write","console","log","vg_make_tree","d","__vgtree__","nodes","vg_tree_nodes","this","root","i","c","values","n","push","vg_data_duplicate","isArray","isObject","vg_load_hasProtocol","url","vg_load_protocolRE","test","vg_load_isFile","indexOf","vg_load_fileProtocol","vg_load_xhr","callback","vg_url_check","xhr","err","resp","responseText","error","domainWhiteList","a","document","createElement","href","domain","hostname","toLowerCase","some","lastIndexOf","vg_load_file","file","idx","require","readFile","vg_load_http","req","request","res","pos","data","Buffer","parseInt","headers","on","copy","end","vg_axisSubdivide","scale","ticks","m","subticks","j","v","extent","vg_axisScaleExtent","start","stop","vg_axisScaleRange","rangeExtent","range","vg_axisLabelExtend","orient","labels","oldScale","newScale","size","pad","Math","max","extend","properties","enter","y","value","update","align","baseline","vg_axisBaseline","vg_axisAlign","vg_axisTicksExtend","sign","Infinity","group","mult","y2","exit","x2","vg_axisTitleExtend","title","offset","mid","angle","vg_axisDomainExtend","path","vg_axisUpdate","item","trans","o","mark","def","width","height","scales","interpolate","vg_axisTicks","type","interactive","key","stroke","axis","tickColor","strokeWidth","tickWidth","opacity","vg_axisTickLabels","fill","tickLabelColor","font","tickLabelFont","fontSize","tickLabelFontSize","text","field","vg_axisTitle","titleFont","titleFontSize","fontWeight","titleFontWeight","titleColor","vg_axisDomain","axisColor","axisWidth","vg_legendUpdate","gx","padding","lw","bounds","lh","delta","x1","vg_legendSymbolExtend","shape","e","u","scaleName","vg_legendTitle","cfg","legend","vg_legendSymbols","symbolShape","symbolSize","symbolColor","symbolStrokeWidth","vg_vLegendLabels","labelColor","labelFont","labelFontSize","labelAlign","labelBaseline","vg_legendGradient","gradientWidth","gradientHeight","gradientStrokeColor","gradientStrokeWidth","vg_hLegendLabels","dy","version","toString","Object","prototype","obj","isFunction","call","isString","Array","isNumber","isBoolean","isTree","tree","children","number","boolean","identity","true","name","arguments","duplicate","JSON","parse","stringify","f","map","reduce","b","shift","apply","accessor","comparator","sort","undefined","array","cmp","numcmp","str","keys","unique","results","minIndex","min","maxIndex","truncate","word","ellipsis","l","l1","ceil","l2","floor","alert","exports","safeMode","baseURL","svgNamespace","autopadInset","time","utc","render","lineWidth","lineCap","gridColor","tickSize","titleOffset","labelOffset","color","rgb","lab","hcl","hsl","category10","category20","shapes","Bounds","clear","union","Number","MAX_VALUE","y1","set","add","expand","round","translate","dx","rotate","cos","sin","cx","cy","encloses","intersects","contains","Gradient","gradient","id","vg_gradient_id","stops","canvas","currentPath","chunks","parsed","result","re","chunksParsed","charAt","jlen","parseFloat","isNaN","command","commandLength","cmdLength","k","klen","concat","drawArc","g","coords","t","rx","ry","rot","large","sweep","ex","ey","segs","arcToSegments","bez","segmentToBezier","bezierCurveTo","boundArc","rotateX","ox","oy","argsStr","arcToSegmentsCache","th","PI","sin_th","cos_th","abs","px","py","pl","sqrt","a00","a01","a10","a11","x0","y0","sfactor_sq","sfactor","xc","yc","th0","atan2","th1","th_arc","segments","th2","th3","segmentToBezierCache","cos_th0","sin_th0","cos_th1","sin_th1","th_half","sin_th_h2","x3","y3","current","tempX","tempY","tempControlX","tempControlY","previous","controlX","controlY","beginPath","lineTo","moveTo","quadraticCurveTo","match","closePath","area","items","svg","tension","line","h","q","marks","arcPath","ir","innerRadius","or","outerRadius","sa","startAngle","ea","endAngle","arc","areaPath","p","pathCache","parsePath","renderPath","linePath","pathPath","symbolPath","r","tan30","rect","sqrt3","lineStroke","lc","strokeCap","ruleStroke","drawPathOne","opac","globalAlpha","fillOpacity","fillStyle","strokeOpacity","strokeStyle","vgLineDash","strokeDash","vgLineDashOffset","strokeDashOffset","drawPathAll","scene","drawRect","fillRect","strokeRect","drawRule","drawImage","renderer","image","loadImage","loaded","drawText","fontString","textAlign","textBaseline","radius","theta","save","fillText","strokeText","restore","drawAll","pathFunc","drawOne","drawGroup","axes","legends","gy","axisItems","legendItems","clip","layer","draw","grad","createLinearGradient","addColorStop","pickGroup","subscene","hit","handler","pick","pickAll","hitTests","_ratio","pickArea","pickLine","textHit","tmpBounds","tan","rule","isPointInStroke","isPointInPath","symbol","Renderer","scaleCanvas","ctx","devicePixelRatio","window","backingStoreRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","ratio","setAttribute","style","initializeLineDash","NODASH","setLineDash","dash","off","lineDashOffset","webkitLineDash","webkitLineDashOffset","mozDash","translatedBounds","getBounds","setBounds","bbox","_ctx","_el","_imgload","initialize","el","select","selectAll","append","attr","remove","resize","_width","_height","_padding","left","right","top","bottom","node","getContext","setTransform","context","element","pendingImages","bb2","bb","_scene","clearRect","marktype","renderAsync","_async_id","clearTimeout","setTimeout","uri","load","src","Image","onload","Handler","eventName","model","_active","_handlers","_canvas","_obj","that","events","forEach","addEventListener","evt","_model","handlers","fire","mousemove","target","getBoundingClientRect","clientX","clientY","mouseout","DOMMouseScroll","splice","picker","yh","prop","styleProps","styles","setProperty","removeProperty","_cur","_defs","arc_path","area_path","line_path","symbol_path","setAttributeNS","fontStyle","fontVariant","base","removeAttribute","textContent","clip_id","clipping","group_bg","cssClass","cls","tag","nest","index","drawMark","prefix","evts","grps","childNodes","notG","mark_id","each","_svg","__data__","sel","center","nested","updateDefs","all","dgrad","dclip","defs","empty","insert","grd","cr","renderItems","svgHandler","dom","removeEventListener","ingestAll","ingestTree","ingest","datum","mapper","func","get","read","format","formats","parseValues","types","cols","col","parsers","vg_parseArray","clen","date","Date","json","property","csv","tsv","feature","objects","features","mesh","treejson","list","fields","fieldList","from","as","cross","data2","other","nodiag","output","diagonal","facet","klist","kstr","kv","vals","String","by","expr","flatten","flat","fold","accessors","force","db","layout","links","iterations","tick","linkDistance","linkStrength","charge","params","dataSetName","sz","iter","dependencies","formula","geo","opt","projection","lat","lon","ll","xy","geopath","mercator","geojson","proj","link","source","curve","ix","iy","diagonalX","diagonalY","val","pie","sum","midAngle","one","stack","out_y0","out_y1","out_cy","series","stacks","out","points","point","z","stats","mean","M2","median","count","variance","stdev","assign","bool","treemap","position","wordBreak","limit","wordbreak","win","curr","runs","step","wordcloud","cloud","finish","tags","words","random","alternate","zip","zdata","zlen","withKey","defaultValue","spec","ORIENT","grid","tickValues","tickFormat","tickSubdivide","subdivide","tickPadding","ts","tickSizeMajor","tickSizeMinor","tickSizeEnd","majorTickProperties","majorTicks","minorTickProperties","minorTicks","tickLabelProperties","titleProperties","gridLineProperties","domainProperties","visit","deps","order","flow","sorted","transform","dataflow","dep","names","pop","tx","df","transforms","tdef","CONSTANT","E","LN2","LN10","LOG2E","LOG10E","SQRT1_2","SQRT2","FUNCTION","acos","asin","atan","exp","pow","lexer","sq","dq","tokens","Function","labelProperties","legendProperties","symbolProperties","symbols","gradientProperties","props","delay","parentData","compile","ref","code","vars","valueRef","hasPath","isColor","colorRef","grp","GROUP_VARS","band","xx","yy","zz","mark.group.width","mark.group.height","prev","instance","ORDINAL","ordinal","quantitative","rng","LINEAR","ctor","refs","dataDrivenRange","extract","domainValues","rangePoints","rangeRoundBands","rangeBands","interval","QUANTILE","domainMinMax","rangeRound","exponent","POWER","clamp","nice","TIME","dat","domainMin","domainMax","LOG","zero","GROUP_PROPERTY","rangeMin","rangeMax","viewFactory","viewport","viewConstructor","ViewFactory","GROUP","ENTER","UPDATE","EXIT","DEFAULT_DATA","sentinel","DEFAULT","Item","hasPropertySet","cousin","iidx","midx","sibling","touch","sets","build","reentrant","buildNode","buildItems","buildTrans","buildGroup","keyf","keyFunction","next","status","mlen","groups","duration","ease","gfx","pathBounds","boundPath","halfpi","xmin","xmax","ymin","ymax","angles","noRotate","measureText","includeLegends","itemBounds","methods","bounds_prev","pb","markBounds","encode","main","encodeItems","encodeGroup","encodeLegend","parent","axisDef","leg","legItems","legDef","_data","EMPTY","Transition","updates","elapsed","skip","interp","isFinite","timer","transition","dur","reset","axis_def","rangeBand","gridLines","tickLabels","tickMajorSize","tickMinorSize","tickEndSize","gridLineStyle","majorTickStyle","minorTickStyle","tickLabelStyle","domainStyle","titleStyle","tickFormatString","tickArguments","major","minor","fmt","label","tdata","vg_axisOrients","legendDef","discrete","ordinalDef","fs","o_legend_def","spacing","labelStyle","titles","symbolStyle","legendStyle","quantDef","q_legend_def","gradientStyle","unshift","gp","gh","hh","tp","formatString","vg_legendOrients","Model","_reset","sources","View","view","_build","__width","__height","_autopad","_viewport","_renderer","_handler","_io","parentNode","_strict","autopad","inset","prevHandler","hover","Spec","done","headless","vp","_type","canvasAsync","wait","innerHTML","initSVG","initCanvas","Canvas","tw","Factory","chart","previousUnderscore","_","ArrayProto","ObjProto","FuncProto","hasOwnProperty","nativeIsArray","nativeKeys","nativeBind","bind","_wrapped","module","VERSION","createCallback","argCount","collection","accumulator","iteratee","matches","collect","currentKey","reduceError","foldl","inject","memo","TypeError","reduceRight","foldr","find","detect","predicate","reject","negate","every","any","include","invoke","method","args","isFunc","pluck","where","attrs","findWhere","computed","lastComputed","shuffle","rand","shuffled","sample","guard","sortBy","criteria","behavior","groupBy","has","indexBy","countBy","sortedIndex","low","high","toArray","partition","pass","fail","first","head","take","initial","last","rest","tail","drop","compact","input","shallow","strict","isArguments","without","difference","uniq","isSorted","seen","intersection","argsLength","object","Ctor","bound","self","partial","boundArgs","bindAll","Error","memoize","hasher","cache","address","defer","throttle","options","timeout","later","leading","now","remaining","trailing","debounce","immediate","timestamp","callNow","wrap","wrapper","compose","after","times","before","once","pairs","invert","functions","omit","defaults","clone","tap","interceptor","eq","aStack","bStack","className","aCtor","constructor","bCtor","isEqual","isEmpty","isElement","nodeType","isNull","isUndefined","noConflict","constant","noop","pair","accum","getTime","escapeMap","&","<",">","\"","'","`","unescapeMap","createEscaper","escaper","testRegexp","RegExp","replaceRegexp","string","escape","unescape","idCounter","uniqueId","templateSettings","evaluate","noMatch","escapes","\\","\r","\n"," "," ","escapeChar","template","settings","oldSettings","matcher","variable","argument","chain","_chain","mixin","Cedar","opts","_events","_definition","_defaultDefinition","_view","_methodQueue","_pendingXhr","definition","getJson","_purgeMethodQueue","override","specification","dataset","query","_mixin","_defaultQuery","defineProperty","canDraw","drawable","errs","show","_addToMethodQueue","elementId","_elementId","token","_token","chk","issues","emit","_remove","compiledMappings","_applyDefaultsToMappings","mappings","inputs","queryFromSpec","_supplant","_mergeRecursive","_renderSpec","_createFeatureServiceRequest","cb","dir","chartCtor","_attach","attributes","clearSelection","_validateMappings","missingInputs","required","_validateData","firstRow","fld","_getMappingFieldName","mappingName","fieldName","defn","defaultQuery","returnGeometry","returnDistinctValues","returnIdsOnly","returnCountOnly","outFields","evtName","registeredHandler","action","message","entries","mergedQuery","geometry","bboxArr","inSR","groupByFieldsForStatistics","outStatistics","orderByFields","statisticType","onStatisticField","outStatisticFieldName","_serializeQueryParams","default","tmpl","_getTokenValue","obj1","obj2","tokenName","tmpTokens","tokenNameParts","encodeURIComponent","queryString"],"mappings":"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","sourcesContent":["// Define module using Universal Module Definition pattern\n// https://github.com/umdjs/umd/blob/master/amdWeb.js\n\n(function (factory) {\n  if (typeof define === 'function' && define.amd) {\n    // Support AMD. Register as an anonymous module.\n    // NOTE: List all dependencies in AMD style\n    define(['d3', 'topojson'], factory);\n  } else {\n    // No AMD. Set module as a global variable\n    // NOTE: Pass dependencies to factory function\n    // (assume that both d3 and topojson are also global.)\n    var tj = (typeof topojson === 'undefined') ? null : topojson;\n    vg = factory(d3, tj);\n  }\n}(\n//NOTE: The dependencies are passed to this function\nfunction (d3, topojson) {\n//---------------------------------------------------\n// BEGIN code for this module\n//---------------------------------------------------\n\n  var vg = {\n    version:  \"1.4.2\", // semantic versioning\n    d3:       d3,      // stash d3 for use in property functions\n    topojson: topojson // stash topojson similarly\n  };\n// type checking functions\nvar toString = Object.prototype.toString;\n\nvg.isObject = function(obj) {\n  return obj === Object(obj);\n};\n\nvg.isFunction = function(obj) {\n  return toString.call(obj) == '[object Function]';\n};\n\nvg.isString = function(obj) {\n  return toString.call(obj) == '[object String]';\n};\n  \nvg.isArray = Array.isArray || function(obj) {\n  return toString.call(obj) == '[object Array]';\n};\n\nvg.isNumber = function(obj) {\n  return toString.call(obj) == '[object Number]';\n};\n\nvg.isBoolean = function(obj) {\n  return toString.call(obj) == '[object Boolean]';\n};\n\nvg.isTree = function(obj) {\n  return obj && obj.__vgtree__;\n};\n\nvg.tree = function(obj, children) {\n  var d = [obj];\n  d.__vgtree__ = true;\n  d.children = children || \"children\";\n  return d;\n};\n\nvg.number = function(s) { return +s; };\n\nvg.boolean = function(s) { return !!s; };\n\n// utility functions\n\nvg.identity = function(x) { return x; };\n\nvg.true = function() { return true; };\n\nvg.extend = function(obj) {\n  for (var x, name, i=1, len=arguments.length; i<len; ++i) {\n    x = arguments[i];\n    for (name in x) { obj[name] = x[name]; }\n  }\n  return obj;\n};\n\nvg.duplicate = function(obj) {\n  return JSON.parse(JSON.stringify(obj));\n};\n\nvg.field = function(f) {\n  return f.split(\"\\\\.\")\n    .map(function(d) { return d.split(\".\"); })\n    .reduce(function(a, b) {\n      if (a.length) { a[a.length-1] += \".\" + b.shift(); }\n      a.push.apply(a, b);\n      return a;\n    }, []);\n};\n\nvg.accessor = function(f) {\n  var s;\n  return (vg.isFunction(f) || f==null)\n    ? f : vg.isString(f) && (s=vg.field(f)).length > 1\n    ? function(x) { return s.reduce(function(x,f) { return x[f]; }, x); }\n    : function(x) { return x[f]; };\n};\n\nvg.comparator = function(sort) {\n  var sign = [];\n  if (sort === undefined) sort = [];\n  sort = vg.array(sort).map(function(f) {\n    var s = 1;\n    if      (f[0] === \"-\") { s = -1; f = f.slice(1); }\n    else if (f[0] === \"+\") { s = +1; f = f.slice(1); }\n    sign.push(s);\n    return vg.accessor(f);\n  });\n  return function(a,b) {\n    var i, n, f, x, y;\n    for (i=0, n=sort.length; i<n; ++i) {\n      f = sort[i]; x = f(a); y = f(b);\n      if (x < y) return -1 * sign[i];\n      if (x > y) return sign[i];\n    }\n    return 0;\n  };\n};\n\nvg.cmp = function(a, b) { return a<b ? -1 : a>b ? 1 : 0; };\n\nvg.numcmp = function(a, b) { return a - b; };\n\nvg.array = function(x) {\n  return x != null ? (vg.isArray(x) ? x : [x]) : [];\n};\n\nvg.values = function(x) {\n  return (vg.isObject(x) && !vg.isArray(x) && x.values) ? x.values : x;\n};\n\nvg.str = function(x) {\n  return vg.isArray(x) ? \"[\" + x.map(vg.str) + \"]\"\n    : vg.isObject(x) ? JSON.stringify(x)\n    : vg.isString(x) ? (\"'\"+vg_escape_str(x)+\"'\") : x;\n};\n\nvar escape_str_re = /(^|[^\\\\])'/g;\n\nfunction vg_escape_str(x) {\n  return x.replace(escape_str_re, \"$1\\\\'\");\n}\n\nvg.keys = function(x) {\n  var keys = [];\n  for (var key in x) keys.push(key);\n  return keys;\n};\n\nvg.unique = function(data, f, results) {\n  if (!vg.isArray(data) || data.length==0) return [];\n  f = f || vg.identity;\n  results = results || [];\n  for (var v, i=0, n=data.length; i<n; ++i) {\n    v = f(data[i]);\n    if (results.indexOf(v) < 0) results.push(v);\n  }\n  return results;\n};\n\nvg.minIndex = function(data, f) {\n  if (!vg.isArray(data) || data.length==0) return -1;\n  f = f || vg.identity;\n  var idx = 0, min = f(data[0]), v = min;\n  for (var i=1, n=data.length; i<n; ++i) {\n    v = f(data[i]);\n    if (v < min) { min = v; idx = i; }\n  }\n  return idx;\n};\n\nvg.maxIndex = function(data, f) {\n  if (!vg.isArray(data) || data.length==0) return -1;\n  f = f || vg.identity;\n  var idx = 0, max = f(data[0]), v = max;\n  for (var i=1, n=data.length; i<n; ++i) {\n    v = f(data[i]);\n    if (v > max) { max = v; idx = i; }\n  }\n  return idx;\n};\n\nvg.truncate = function(s, length, pos, word, ellipsis) {\n  var len = s.length;\n  if (len <= length) return s;\n  ellipsis = ellipsis || \"...\";\n  var l = Math.max(0, length - ellipsis.length);\n\n  switch (pos) {\n    case \"left\":\n      return ellipsis + (word ? vg_truncateOnWord(s,l,1) : s.slice(len-l));\n    case \"middle\":\n    case \"center\":\n      var l1 = Math.ceil(l/2), l2 = Math.floor(l/2);\n      return (word ? vg_truncateOnWord(s,l1) : s.slice(0,l1)) + ellipsis\n        + (word ? vg_truncateOnWord(s,l2,1) : s.slice(len-l2));\n    default:\n      return (word ? vg_truncateOnWord(s,l) : s.slice(0,l)) + ellipsis;\n  }\n}\n\nfunction vg_truncateOnWord(s, len, rev) {\n  var cnt = 0, tok = s.split(vg_truncate_word_re);\n  if (rev) {\n    s = (tok = tok.reverse())\n      .filter(function(w) { cnt += w.length; return cnt <= len; })\n      .reverse();\n  } else {\n    s = tok.filter(function(w) { cnt += w.length; return cnt <= len; });\n  }\n  return s.length ? s.join(\"\").trim() : tok[0].slice(0, len);\n}\n\nvar vg_truncate_word_re = /([\\u0009\\u000A\\u000B\\u000C\\u000D\\u0020\\u00A0\\u1680\\u180E\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200A\\u202F\\u205F\\u2028\\u2029\\u3000\\uFEFF])/;\n\n// Logging\n\nfunction vg_write(msg) {\n  vg.config.isNode\n    ? process.stderr.write(msg + \"\\n\")\n    : console.log(msg);\n}\n\nvg.log = function(msg) {\n  vg_write(\"[Vega Log] \" + msg);\n};\n\nvg.error = function(msg) {\n  msg = \"[Vega Err] \" + msg;\n  vg_write(msg);\n  if (typeof alert !== \"undefined\") alert(msg);\n};vg.config = {};\n\n// are we running in node.js?\n// via timetler.com/2012/10/13/environment-detection-in-javascript/\nvg.config.isNode = typeof exports !== 'undefined' && this.exports !== exports;\n\n// Allows domain restriction when using data loading via XHR.\n// To enable, set it to a list of allowed domains\n// e.g., ['wikipedia.org', 'eff.org']\nvg.config.domainWhiteList = false;\n\n// If true, disable potentially unsafe transforms (filter, formula)\n// involving possible JavaScript injection attacks.\nvg.config.safeMode = false;\n\n// base url for loading external data files\n// used only for server-side operation\nvg.config.baseURL = \"\";\n\n// version and namepsaces for exported svg\nvg.config.svgNamespace =\n  'version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" ' +\n  'xmlns:xlink=\"http://www.w3.org/1999/xlink\"';\n\n// inset padding for automatic padding calculation\nvg.config.autopadInset = 5;\n\n// extensible scale lookup table\n// all d3.scale.* instances also supported\nvg.config.scale = {\n  time: d3.time.scale,\n  utc:  d3.time.scale.utc\n};\n\n// default rendering settings\nvg.config.render = {\n  lineWidth: 1,\n  lineCap:   \"butt\",\n  font:      \"sans-serif\",\n  fontSize:  11\n};\n\n// default axis properties\nvg.config.axis = {\n  orient: \"bottom\",\n  ticks: 10,\n  padding: 3,\n  axisColor: \"#000\",\n  gridColor: \"#d8d8d8\",\n  tickColor: \"#000\",\n  tickLabelColor: \"#000\",\n  axisWidth: 1,\n  tickWidth: 1,\n  tickSize: 6,\n  tickLabelFontSize: 11,\n  tickLabelFont: \"sans-serif\",\n  titleColor: \"#000\",\n  titleFont: \"sans-serif\",\n  titleFontSize: 11,\n  titleFontWeight: \"bold\",\n  titleOffset: 35\n};\n\n// default legend properties\nvg.config.legend = {\n  orient: \"right\",\n  offset: 10,\n  padding: 3,\n  gradientStrokeColor: \"#888\",\n  gradientStrokeWidth: 1,\n  gradientHeight: 16,\n  gradientWidth: 100,\n  labelColor: \"#000\",\n  labelFontSize: 10,\n  labelFont: \"sans-serif\",\n  labelAlign: \"left\",\n  labelBaseline: \"middle\",\n  labelOffset: 8,\n  symbolShape: \"circle\",\n  symbolSize: 50,\n  symbolColor: \"#888\",\n  symbolStrokeWidth: 1,\n  titleColor: \"#000\",\n  titleFont: \"sans-serif\",\n  titleFontSize: 11,\n  titleFontWeight: \"bold\"\n};\n\n// default color values\nvg.config.color = {\n  rgb: [128, 128, 128],\n  lab: [50, 0, 0],\n  hcl: [0, 0, 50],\n  hsl: [0, 0, 0.5]\n};\n\n// default scale ranges\nvg.config.range = {\n  category10: [\n    \"#1f77b4\",\n    \"#ff7f0e\",\n    \"#2ca02c\",\n    \"#d62728\",\n    \"#9467bd\",\n    \"#8c564b\",\n    \"#e377c2\",\n    \"#7f7f7f\",\n    \"#bcbd22\",\n    \"#17becf\"\n  ],\n  category20: [\n    \"#1f77b4\",\n    \"#aec7e8\",\n    \"#ff7f0e\",\n    \"#ffbb78\",\n    \"#2ca02c\",\n    \"#98df8a\",\n    \"#d62728\",\n    \"#ff9896\",\n    \"#9467bd\",\n    \"#c5b0d5\",\n    \"#8c564b\",\n    \"#c49c94\",\n    \"#e377c2\",\n    \"#f7b6d2\",\n    \"#7f7f7f\",\n    \"#c7c7c7\",\n    \"#bcbd22\",\n    \"#dbdb8d\",\n    \"#17becf\",\n    \"#9edae5\"\n  ],\n  shapes: [\n    \"circle\",\n    \"cross\",\n    \"diamond\",\n    \"square\",\n    \"triangle-down\",\n    \"triangle-up\"\n  ]\n};vg.Bounds = (function() {\n  var bounds = function(b) {\n    this.clear();\n    if (b) this.union(b);\n  };\n  \n  var prototype = bounds.prototype;\n  \n  prototype.clear = function() {\n    this.x1 = +Number.MAX_VALUE;\n    this.y1 = +Number.MAX_VALUE;\n    this.x2 = -Number.MAX_VALUE;\n    this.y2 = -Number.MAX_VALUE;\n    return this;\n  };\n  \n  prototype.set = function(x1, y1, x2, y2) {\n    this.x1 = x1;\n    this.y1 = y1;\n    this.x2 = x2;\n    this.y2 = y2;\n    return this;\n  };\n\n  prototype.add = function(x, y) {\n    if (x < this.x1) this.x1 = x;\n    if (y < this.y1) this.y1 = y;\n    if (x > this.x2) this.x2 = x;\n    if (y > this.y2) this.y2 = y;\n    return this;\n  };\n\n  prototype.expand = function(d) {\n    this.x1 -= d;\n    this.y1 -= d;\n    this.x2 += d;\n    this.y2 += d;\n    return this;\n  };\n  \n  prototype.round = function() {\n    this.x1 = Math.floor(this.x1);\n    this.y1 = Math.floor(this.y1);\n    this.x2 = Math.ceil(this.x2);\n    this.y2 = Math.ceil(this.y2);\n    return this;\n  };\n\n  prototype.translate = function(dx, dy) {\n    this.x1 += dx;\n    this.x2 += dx;\n    this.y1 += dy;\n    this.y2 += dy;\n    return this;\n  };\n  \n  prototype.rotate = function(angle, x, y) {\n    var cos = Math.cos(angle),\n        sin = Math.sin(angle),\n        cx = x - x*cos + y*sin,\n        cy = y - x*sin - y*cos,\n        x1 = this.x1, x2 = this.x2,\n        y1 = this.y1, y2 = this.y2;\n\n    return this.clear()\n      .add(cos*x1 - sin*y1 + cx,  sin*x1 + cos*y1 + cy)\n      .add(cos*x1 - sin*y2 + cx,  sin*x1 + cos*y2 + cy)\n      .add(cos*x2 - sin*y1 + cx,  sin*x2 + cos*y1 + cy)\n      .add(cos*x2 - sin*y2 + cx,  sin*x2 + cos*y2 + cy);\n  }\n\n  prototype.union = function(b) {\n    if (b.x1 < this.x1) this.x1 = b.x1;\n    if (b.y1 < this.y1) this.y1 = b.y1;\n    if (b.x2 > this.x2) this.x2 = b.x2;\n    if (b.y2 > this.y2) this.y2 = b.y2;\n    return this;\n  };\n\n  prototype.encloses = function(b) {\n    return b && (\n      this.x1 <= b.x1 &&\n      this.x2 >= b.x2 &&\n      this.y1 <= b.y1 &&\n      this.y2 >= b.y2\n    );\n  };\n\n  prototype.intersects = function(b) {\n    return b && !(\n      this.x2 < b.x1 ||\n      this.x1 > b.x2 ||\n      this.y2 < b.y1 ||\n      this.y1 > b.y2\n    );\n  };\n\n  prototype.contains = function(x, y) {\n    return !(\n      x < this.x1 ||\n      x > this.x2 ||\n      y < this.y1 ||\n      y > this.y2\n    );\n  };\n\n  prototype.width = function() {\n    return this.x2 - this.x1;\n  };\n\n  prototype.height = function() {\n    return this.y2 - this.y1;\n  };\n\n  return bounds;\n})();vg.Gradient = (function() {\n\n  function gradient(type) {\n    this.id = \"grad_\" + (vg_gradient_id++);\n    this.type = type || \"linear\";\n    this.stops = [];\n    this.x1 = 0;\n    this.x2 = 1;\n    this.y1 = 0;\n    this.y2 = 0;\n  };\n\n  var prototype = gradient.prototype;\n\n  prototype.stop = function(offset, color) {\n    this.stops.push({\n      offset: offset,\n      color: color\n    });\n    return this;\n  };\n  \n  return gradient;\n})();\n\nvar vg_gradient_id = 0;vg.canvas = {};vg.canvas.path = (function() {\n\n  // Path parsing and rendering code taken from fabric.js -- Thanks!\n  var cmdLength = { m:2, l:2, h:1, v:1, c:6, s:4, q:4, t:2, a:7 },\n      re = [/([MLHVCSQTAZmlhvcsqtaz])/g, /###/, /(\\d)-/g, /\\s|,|###/];\n\n  function parse(path) {\n    var result = [],\n        currentPath,\n        chunks,\n        parsed;\n\n    // First, break path into command sequence\n    path = path.slice().replace(re[0], '###$1').split(re[1]).slice(1);\n\n    // Next, parse each command in turn\n    for (var i=0, j, chunksParsed, len=path.length; i<len; i++) {\n      currentPath = path[i];\n      chunks = currentPath.slice(1).trim().replace(re[2],'$1###-').split(re[3]);\n      chunksParsed = [currentPath.charAt(0)];\n\n      for (var j = 0, jlen = chunks.length; j < jlen; j++) {\n        parsed = parseFloat(chunks[j]);\n        if (!isNaN(parsed)) {\n          chunksParsed.push(parsed);\n        }\n      }\n\n      var command = chunksParsed[0].toLowerCase(),\n          commandLength = cmdLength[command];\n\n      if (chunksParsed.length - 1 > commandLength) {\n        for (var k = 1, klen = chunksParsed.length; k < klen; k += commandLength) {\n          result.push([ chunksParsed[0] ].concat(chunksParsed.slice(k, k + commandLength)));\n        }\n      }\n      else {\n        result.push(chunksParsed);\n      }\n    }\n\n    return result;\n  }\n\n  function drawArc(g, x, y, coords, bounds, l, t) {\n    var rx = coords[0];\n    var ry = coords[1];\n    var rot = coords[2];\n    var large = coords[3];\n    var sweep = coords[4];\n    var ex = coords[5];\n    var ey = coords[6];\n    var segs = arcToSegments(ex, ey, rx, ry, large, sweep, rot, x, y);\n    for (var i=0; i<segs.length; i++) {\n      var bez = segmentToBezier.apply(null, segs[i]);\n      g.bezierCurveTo.apply(g, bez);\n      bounds.add(bez[0]-l, bez[1]-t);\n      bounds.add(bez[2]-l, bez[3]-t);\n      bounds.add(bez[4]-l, bez[5]-t);\n    }\n  }\n\n  function boundArc(x, y, coords, bounds) {\n    var rx = coords[0];\n    var ry = coords[1];\n    var rot = coords[2];\n    var large = coords[3];\n    var sweep = coords[4];\n    var ex = coords[5];\n    var ey = coords[6];\n    var segs = arcToSegments(ex, ey, rx, ry, large, sweep, rot, x, y);\n    for (var i=0; i<segs.length; i++) {\n      var bez = segmentToBezier.apply(null, segs[i]);\n      bounds.add(bez[0], bez[1]);\n      bounds.add(bez[2], bez[3]);\n      bounds.add(bez[4], bez[5]);\n    }\n  }\n\n  var arcToSegmentsCache = { },\n      segmentToBezierCache = { },\n      join = Array.prototype.join,\n      argsStr;\n\n  // Copied from Inkscape svgtopdf, thanks!\n  function arcToSegments(x, y, rx, ry, large, sweep, rotateX, ox, oy) {\n    argsStr = join.call(arguments);\n    if (arcToSegmentsCache[argsStr]) {\n      return arcToSegmentsCache[argsStr];\n    }\n\n    var th = rotateX * (Math.PI/180);\n    var sin_th = Math.sin(th);\n    var cos_th = Math.cos(th);\n    rx = Math.abs(rx);\n    ry = Math.abs(ry);\n    var px = cos_th * (ox - x) * 0.5 + sin_th * (oy - y) * 0.5;\n    var py = cos_th * (oy - y) * 0.5 - sin_th * (ox - x) * 0.5;\n    var pl = (px*px) / (rx*rx) + (py*py) / (ry*ry);\n    if (pl > 1) {\n      pl = Math.sqrt(pl);\n      rx *= pl;\n      ry *= pl;\n    }\n\n    var a00 = cos_th / rx;\n    var a01 = sin_th / rx;\n    var a10 = (-sin_th) / ry;\n    var a11 = (cos_th) / ry;\n    var x0 = a00 * ox + a01 * oy;\n    var y0 = a10 * ox + a11 * oy;\n    var x1 = a00 * x + a01 * y;\n    var y1 = a10 * x + a11 * y;\n\n    var d = (x1-x0) * (x1-x0) + (y1-y0) * (y1-y0);\n    var sfactor_sq = 1 / d - 0.25;\n    if (sfactor_sq < 0) sfactor_sq = 0;\n    var sfactor = Math.sqrt(sfactor_sq);\n    if (sweep == large) sfactor = -sfactor;\n    var xc = 0.5 * (x0 + x1) - sfactor * (y1-y0);\n    var yc = 0.5 * (y0 + y1) + sfactor * (x1-x0);\n\n    var th0 = Math.atan2(y0-yc, x0-xc);\n    var th1 = Math.atan2(y1-yc, x1-xc);\n\n    var th_arc = th1-th0;\n    if (th_arc < 0 && sweep == 1){\n      th_arc += 2*Math.PI;\n    } else if (th_arc > 0 && sweep == 0) {\n      th_arc -= 2 * Math.PI;\n    }\n\n    var segments = Math.ceil(Math.abs(th_arc / (Math.PI * 0.5 + 0.001)));\n    var result = [];\n    for (var i=0; i<segments; i++) {\n      var th2 = th0 + i * th_arc / segments;\n      var th3 = th0 + (i+1) * th_arc / segments;\n      result[i] = [xc, yc, th2, th3, rx, ry, sin_th, cos_th];\n    }\n\n    return (arcToSegmentsCache[argsStr] = result);\n  }\n\n  function segmentToBezier(cx, cy, th0, th1, rx, ry, sin_th, cos_th) {\n    argsStr = join.call(arguments);\n    if (segmentToBezierCache[argsStr]) {\n      return segmentToBezierCache[argsStr];\n    }\n\n    var a00 = cos_th * rx;\n    var a01 = -sin_th * ry;\n    var a10 = sin_th * rx;\n    var a11 = cos_th * ry;\n\n    var cos_th0 = Math.cos(th0);\n    var sin_th0 = Math.sin(th0);\n    var cos_th1 = Math.cos(th1);\n    var sin_th1 = Math.sin(th1);\n\n    var th_half = 0.5 * (th1 - th0);\n    var sin_th_h2 = Math.sin(th_half * 0.5);\n    var t = (8/3) * sin_th_h2 * sin_th_h2 / Math.sin(th_half);\n    var x1 = cx + cos_th0 - t * sin_th0;\n    var y1 = cy + sin_th0 + t * cos_th0;\n    var x3 = cx + cos_th1;\n    var y3 = cy + sin_th1;\n    var x2 = x3 + t * sin_th1;\n    var y2 = y3 - t * cos_th1;\n\n    return (segmentToBezierCache[argsStr] = [\n      a00 * x1 + a01 * y1,  a10 * x1 + a11 * y1,\n      a00 * x2 + a01 * y2,  a10 * x2 + a11 * y2,\n      a00 * x3 + a01 * y3,  a10 * x3 + a11 * y3\n    ]);\n  }\n\n  function render(g, path, l, t) {\n    var current, // current instruction\n        previous = null,\n        x = 0, // current x\n        y = 0, // current y\n        controlX = 0, // current control point x\n        controlY = 0, // current control point y\n        tempX,\n        tempY,\n        tempControlX,\n        tempControlY,\n        bounds = new vg.Bounds();\n    if (l == undefined) l = 0;\n    if (t == undefined) t = 0;\n\n    g.beginPath();\n  \n    for (var i=0, len=path.length; i<len; ++i) {\n      current = path[i];\n\n      switch (current[0]) { // first letter\n\n        case 'l': // lineto, relative\n          x += current[1];\n          y += current[2];\n          g.lineTo(x + l, y + t);\n          bounds.add(x, y);\n          break;\n\n        case 'L': // lineto, absolute\n          x = current[1];\n          y = current[2];\n          g.lineTo(x + l, y + t);\n          bounds.add(x, y);\n          break;\n\n        case 'h': // horizontal lineto, relative\n          x += current[1];\n          g.lineTo(x + l, y + t);\n          bounds.add(x, y);\n          break;\n\n        case 'H': // horizontal lineto, absolute\n          x = current[1];\n          g.lineTo(x + l, y + t);\n          bounds.add(x, y);\n          break;\n\n        case 'v': // vertical lineto, relative\n          y += current[1];\n          g.lineTo(x + l, y + t);\n          bounds.add(x, y);\n          break;\n\n        case 'V': // verical lineto, absolute\n          y = current[1];\n          g.lineTo(x + l, y + t);\n          bounds.add(x, y);\n          break;\n\n        case 'm': // moveTo, relative\n          x += current[1];\n          y += current[2];\n          g.moveTo(x + l, y + t);\n          bounds.add(x, y);\n          break;\n\n        case 'M': // moveTo, absolute\n          x = current[1];\n          y = current[2];\n          g.moveTo(x + l, y + t);\n          bounds.add(x, y);\n          break;\n\n        case 'c': // bezierCurveTo, relative\n          tempX = x + current[5];\n          tempY = y + current[6];\n          controlX = x + current[3];\n          controlY = y + current[4];\n          g.bezierCurveTo(\n            x + current[1] + l, // x1\n            y + current[2] + t, // y1\n            controlX + l, // x2\n            controlY + t, // y2\n            tempX + l,\n            tempY + t\n          );\n          bounds.add(x + current[1], y + current[2]);\n          bounds.add(controlX, controlY);\n          bounds.add(tempX, tempY);\n          x = tempX;\n          y = tempY;\n          break;\n\n        case 'C': // bezierCurveTo, absolute\n          x = current[5];\n          y = current[6];\n          controlX = current[3];\n          controlY = current[4];\n          g.bezierCurveTo(\n            current[1] + l,\n            current[2] + t,\n            controlX + l,\n            controlY + t,\n            x + l,\n            y + t\n          );\n          bounds.add(current[1], current[2]);\n          bounds.add(controlX, controlY);\n          bounds.add(x, y);\n          break;\n\n        case 's': // shorthand cubic bezierCurveTo, relative\n          // transform to absolute x,y\n          tempX = x + current[3];\n          tempY = y + current[4];\n          // calculate reflection of previous control points\n          controlX = 2 * x - controlX;\n          controlY = 2 * y - controlY;\n          g.bezierCurveTo(\n            controlX + l,\n            controlY + t,\n            x + current[1] + l,\n            y + current[2] + t,\n            tempX + l,\n            tempY + t\n          );\n          bounds.add(controlX, controlY);\n          bounds.add(x + current[1], y + current[2]);\n          bounds.add(tempX, tempY);\n\n          // set control point to 2nd one of this command\n          // \"... the first control point is assumed to be the reflection of the second control point on the previous command relative to the current point.\"\n          controlX = x + current[1];\n          controlY = y + current[2];\n\n          x = tempX;\n          y = tempY;\n          break;\n\n        case 'S': // shorthand cubic bezierCurveTo, absolute\n          tempX = current[3];\n          tempY = current[4];\n          // calculate reflection of previous control points\n          controlX = 2*x - controlX;\n          controlY = 2*y - controlY;\n          g.bezierCurveTo(\n            controlX + l,\n            controlY + t,\n            current[1] + l,\n            current[2] + t,\n            tempX + l,\n            tempY + t\n          );\n          x = tempX;\n          y = tempY;\n          bounds.add(current[1], current[2]);\n          bounds.add(controlX, controlY);\n          bounds.add(tempX, tempY);\n          // set control point to 2nd one of this command\n          // \"... the first control point is assumed to be the reflection of the second control point on the previous command relative to the current point.\"\n          controlX = current[1];\n          controlY = current[2];\n\n          break;\n\n        case 'q': // quadraticCurveTo, relative\n          // transform to absolute x,y\n          tempX = x + current[3];\n          tempY = y + current[4];\n\n          controlX = x + current[1];\n          controlY = y + current[2];\n\n          g.quadraticCurveTo(\n            controlX + l,\n            controlY + t,\n            tempX + l,\n            tempY + t\n          );\n          x = tempX;\n          y = tempY;\n          bounds.add(controlX, controlY);\n          bounds.add(tempX, tempY);\n          break;\n\n        case 'Q': // quadraticCurveTo, absolute\n          tempX = current[3];\n          tempY = current[4];\n\n          g.quadraticCurveTo(\n            current[1] + l,\n            current[2] + t,\n            tempX + l,\n            tempY + t\n          );\n          x = tempX;\n          y = tempY;\n          controlX = current[1];\n          controlY = current[2];\n          bounds.add(controlX, controlY);\n          bounds.add(tempX, tempY);\n          break;\n\n        case 't': // shorthand quadraticCurveTo, relative\n\n          // transform to absolute x,y\n          tempX = x + current[1];\n          tempY = y + current[2];\n\n          if (previous[0].match(/[QqTt]/) === null) {\n            // If there is no previous command or if the previous command was not a Q, q, T or t,\n            // assume the control point is coincident with the current point\n            controlX = x;\n            controlY = y;\n          }\n          else if (previous[0] === 't') {\n            // calculate reflection of previous control points for t\n            controlX = 2 * x - tempControlX;\n            controlY = 2 * y - tempControlY;\n          }\n          else if (previous[0] === 'q') {\n            // calculate reflection of previous control points for q\n            controlX = 2 * x - controlX;\n            controlY = 2 * y - controlY;\n          }\n\n          tempControlX = controlX;\n          tempControlY = controlY;\n\n          g.quadraticCurveTo(\n            controlX + l,\n            controlY + t,\n            tempX + l,\n            tempY + t\n          );\n          x = tempX;\n          y = tempY;\n          controlX = x + current[1];\n          controlY = y + current[2];\n          bounds.add(controlX, controlY);\n          bounds.add(tempX, tempY);\n          break;\n\n        case 'T':\n          tempX = current[1];\n          tempY = current[2];\n\n          // calculate reflection of previous control points\n          controlX = 2 * x - controlX;\n          controlY = 2 * y - controlY;\n          g.quadraticCurveTo(\n            controlX + l,\n            controlY + t,\n            tempX + l,\n            tempY + t\n          );\n          x = tempX;\n          y = tempY;\n          bounds.add(controlX, controlY);\n          bounds.add(tempX, tempY);\n          break;\n\n        case 'a':\n          drawArc(g, x + l, y + t, [\n            current[1],\n            current[2],\n            current[3],\n            current[4],\n            current[5],\n            current[6] + x + l,\n            current[7] + y + t\n          ], bounds, l, t);\n          x += current[6];\n          y += current[7];\n          break;\n\n        case 'A':\n          drawArc(g, x + l, y + t, [\n            current[1],\n            current[2],\n            current[3],\n            current[4],\n            current[5],\n            current[6] + l,\n            current[7] + t\n          ], bounds, l, t);\n          x = current[6];\n          y = current[7];\n          break;\n\n        case 'z':\n        case 'Z':\n          g.closePath();\n          break;\n      }\n      previous = current;\n    }\n    return bounds.translate(l, t);\n  }\n\n  function bounds(path, bounds) {\n    var current, // current instruction\n        previous = null,\n        x = 0, // current x\n        y = 0, // current y\n        controlX = 0, // current control point x\n        controlY = 0, // current control point y\n        tempX,\n        tempY,\n        tempControlX,\n        tempControlY;\n\n    for (var i=0, len=path.length; i<len; ++i) {\n      current = path[i];\n\n      switch (current[0]) { // first letter\n\n        case 'l': // lineto, relative\n          x += current[1];\n          y += current[2];\n          bounds.add(x, y);\n          break;\n\n        case 'L': // lineto, absolute\n          x = current[1];\n          y = current[2];\n          bounds.add(x, y);\n          break;\n\n        case 'h': // horizontal lineto, relative\n          x += current[1];\n          bounds.add(x, y);\n          break;\n\n        case 'H': // horizontal lineto, absolute\n          x = current[1];\n          bounds.add(x, y);\n          break;\n\n        case 'v': // vertical lineto, relative\n          y += current[1];\n          bounds.add(x, y);\n          break;\n\n        case 'V': // verical lineto, absolute\n          y = current[1];\n          bounds.add(x, y);\n          break;\n\n        case 'm': // moveTo, relative\n          x += current[1];\n          y += current[2];\n          bounds.add(x, y);\n          break;\n\n        case 'M': // moveTo, absolute\n          x = current[1];\n          y = current[2];\n          bounds.add(x, y);\n          break;\n\n        case 'c': // bezierCurveTo, relative\n          tempX = x + current[5];\n          tempY = y + current[6];\n          controlX = x + current[3];\n          controlY = y + current[4];\n          bounds.add(x + current[1], y + current[2]);\n          bounds.add(controlX, controlY);\n          bounds.add(tempX, tempY);\n          x = tempX;\n          y = tempY;\n          break;\n\n        case 'C': // bezierCurveTo, absolute\n          x = current[5];\n          y = current[6];\n          controlX = current[3];\n          controlY = current[4];\n          bounds.add(current[1], current[2]);\n          bounds.add(controlX, controlY);\n          bounds.add(x, y);\n          break;\n\n        case 's': // shorthand cubic bezierCurveTo, relative\n          // transform to absolute x,y\n          tempX = x + current[3];\n          tempY = y + current[4];\n          // calculate reflection of previous control points\n          controlX = 2 * x - controlX;\n          controlY = 2 * y - controlY;\n          bounds.add(controlX, controlY);\n          bounds.add(x + current[1], y + current[2]);\n          bounds.add(tempX, tempY);\n\n          // set control point to 2nd one of this command\n          // \"... the first control point is assumed to be the reflection of the second control point on the previous command relative to the current point.\"\n          controlX = x + current[1];\n          controlY = y + current[2];\n\n          x = tempX;\n          y = tempY;\n          break;\n\n        case 'S': // shorthand cubic bezierCurveTo, absolute\n          tempX = current[3];\n          tempY = current[4];\n          // calculate reflection of previous control points\n          controlX = 2*x - controlX;\n          controlY = 2*y - controlY;\n          x = tempX;\n          y = tempY;\n          bounds.add(current[1], current[2]);\n          bounds.add(controlX, controlY);\n          bounds.add(tempX, tempY);\n          // set control point to 2nd one of this command\n          // \"... the first control point is assumed to be the reflection of the second control point on the previous command relative to the current point.\"\n          controlX = current[1];\n          controlY = current[2];\n\n          break;\n\n        case 'q': // quadraticCurveTo, relative\n          // transform to absolute x,y\n          tempX = x + current[3];\n          tempY = y + current[4];\n\n          controlX = x + current[1];\n          controlY = y + current[2];\n\n          x = tempX;\n          y = tempY;\n          bounds.add(controlX, controlY);\n          bounds.add(tempX, tempY);\n          break;\n\n        case 'Q': // quadraticCurveTo, absolute\n          tempX = current[3];\n          tempY = current[4];\n\n          x = tempX;\n          y = tempY;\n          controlX = current[1];\n          controlY = current[2];\n          bounds.add(controlX, controlY);\n          bounds.add(tempX, tempY);\n          break;\n\n        case 't': // shorthand quadraticCurveTo, relative\n\n          // transform to absolute x,y\n          tempX = x + current[1];\n          tempY = y + current[2];\n\n          if (previous[0].match(/[QqTt]/) === null) {\n            // If there is no previous command or if the previous command was not a Q, q, T or t,\n            // assume the control point is coincident with the current point\n            controlX = x;\n            controlY = y;\n          }\n          else if (previous[0] === 't') {\n            // calculate reflection of previous control points for t\n            controlX = 2 * x - tempControlX;\n            controlY = 2 * y - tempControlY;\n          }\n          else if (previous[0] === 'q') {\n            // calculate reflection of previous control points for q\n            controlX = 2 * x - controlX;\n            controlY = 2 * y - controlY;\n          }\n\n          tempControlX = controlX;\n          tempControlY = controlY;\n\n          x = tempX;\n          y = tempY;\n          controlX = x + current[1];\n          controlY = y + current[2];\n          bounds.add(controlX, controlY);\n          bounds.add(tempX, tempY);\n          break;\n\n        case 'T':\n          tempX = current[1];\n          tempY = current[2];\n\n          // calculate reflection of previous control points\n          controlX = 2 * x - controlX;\n          controlY = 2 * y - controlY;\n\n          x = tempX;\n          y = tempY;\n          bounds.add(controlX, controlY);\n          bounds.add(tempX, tempY);\n          break;\n\n        case 'a':\n          boundArc(x, y, [\n            current[1],\n            current[2],\n            current[3],\n            current[4],\n            current[5],\n            current[6] + x,\n            current[7] + y\n          ], bounds);\n          x += current[6];\n          y += current[7];\n          break;\n\n        case 'A':\n          boundArc(x, y, [\n            current[1],\n            current[2],\n            current[3],\n            current[4],\n            current[5],\n            current[6],\n            current[7]\n          ], bounds);\n          x = current[6];\n          y = current[7];\n          break;\n\n        case 'z':\n        case 'Z':\n          break;\n      }\n      previous = current;\n    }\n    return bounds;\n  }\n  \n  function area(items) {\n    var o = items[0];\n    var area = d3.svg.area()\n      .x(function(d) { return d.x; })\n      .y1(function(d) { return d.y; })\n      .y0(function(d) { return d.y + d.height; });\n    if (o.interpolate) area.interpolate(o.interpolate);\n    if (o.tension != null) area.tension(o.tension);\n    return area(items);\n  }\n\n  function line(items) {\n    var o = items[0];\n    var line = d3.svg.line()\n     .x(function(d) { return d.x; })\n     .y(function(d) { return d.y; });\n    if (o.interpolate) line.interpolate(o.interpolate);\n    if (o.tension != null) line.tension(o.tension);\n    return line(items);\n  }\n  \n  return {\n    parse:  parse,\n    render: render,\n    bounds: bounds,\n    area:   area,\n    line:   line\n  };\n  \n})();vg.canvas.marks = (function() {\n\n  var parsePath = vg.canvas.path.parse,\n      renderPath = vg.canvas.path.render,\n      halfpi = Math.PI / 2,\n      sqrt3 = Math.sqrt(3),\n      tan30 = Math.tan(30 * Math.PI / 180),\n      tmpBounds = new vg.Bounds();\n\n  // path generators\n\n  function arcPath(g, o) {\n    var x = o.x || 0,\n        y = o.y || 0,\n        ir = o.innerRadius || 0,\n        or = o.outerRadius || 0,\n        sa = (o.startAngle || 0) - Math.PI/2,\n        ea = (o.endAngle || 0) - Math.PI/2;\n    g.beginPath();\n    if (ir === 0) g.moveTo(x, y);\n    else g.arc(x, y, ir, sa, ea, 0);\n    g.arc(x, y, or, ea, sa, 1);\n    g.closePath();\n  }\n\n  function areaPath(g, items) {\n    var o = items[0],\n        m = o.mark,\n        p = m.pathCache || (m.pathCache = parsePath(vg.canvas.path.area(items)));\n    renderPath(g, p);\n  }\n\n  function linePath(g, items) {\n    var o = items[0],\n        m = o.mark,\n        p = m.pathCache || (m.pathCache = parsePath(vg.canvas.path.line(items)));\n    renderPath(g, p);\n  }\n\n  function pathPath(g, o) {\n    if (o.path == null) return;\n    var p = o.pathCache || (o.pathCache = parsePath(o.path));\n    return renderPath(g, p, o.x, o.y);\n  }\n\n  function symbolPath(g, o) {\n    g.beginPath();\n    var size = o.size != null ? o.size : 100,\n        x = o.x, y = o.y, r, t, rx, ry;\n\n    if (o.shape == null || o.shape === \"circle\") {\n      r = Math.sqrt(size/Math.PI);\n      g.arc(x, y, r, 0, 2*Math.PI, 0);\n      g.closePath();\n      return;\n    }\n\n    switch (o.shape) {\n      case \"cross\":\n        r = Math.sqrt(size / 5) / 2;\n        t = 3*r;\n        g.moveTo(x-t, y-r);\n        g.lineTo(x-r, y-r);\n        g.lineTo(x-r, y-t);\n        g.lineTo(x+r, y-t);\n        g.lineTo(x+r, y-r);\n        g.lineTo(x+t, y-r);\n        g.lineTo(x+t, y+r);\n        g.lineTo(x+r, y+r);\n        g.lineTo(x+r, y+t);\n        g.lineTo(x-r, y+t);\n        g.lineTo(x-r, y+r);\n        g.lineTo(x-t, y+r);\n        break;\n\n      case \"diamond\":\n        ry = Math.sqrt(size / (2 * tan30));\n        rx = ry * tan30;\n        g.moveTo(x, y-ry);\n        g.lineTo(x+rx, y);\n        g.lineTo(x, y+ry);\n        g.lineTo(x-rx, y);\n        break;\n\n      case \"square\":\n        t = Math.sqrt(size);\n        r = t / 2;\n        g.rect(x-r, y-r, t, t);\n        break;\n\n      case \"triangle-down\":\n        rx = Math.sqrt(size / sqrt3);\n        ry = rx * sqrt3 / 2;\n        g.moveTo(x, y+ry);\n        g.lineTo(x+rx, y-ry);\n        g.lineTo(x-rx, y-ry);\n        break;\n\n      case \"triangle-up\":\n        rx = Math.sqrt(size / sqrt3);\n        ry = rx * sqrt3 / 2;\n        g.moveTo(x, y-ry);\n        g.lineTo(x+rx, y+ry);\n        g.lineTo(x-rx, y+ry);\n    }\n    g.closePath();\n  }\n\n  function lineStroke(g, items) {\n    var o = items[0],\n        lw = o.strokeWidth,\n        lc = o.strokeCap;\n    g.lineWidth = lw != null ? lw : vg.config.render.lineWidth;\n    g.lineCap   = lc != null ? lc : vg.config.render.lineCap;\n    linePath(g, items);\n  }\n\n  function ruleStroke(g, o) {\n    var x1 = o.x || 0,\n        y1 = o.y || 0,\n        x2 = o.x2 != null ? o.x2 : x1,\n        y2 = o.y2 != null ? o.y2 : y1,\n        lw = o.strokeWidth,\n        lc = o.strokeCap;\n\n    g.lineWidth = lw != null ? lw : vg.config.render.lineWidth;\n    g.lineCap   = lc != null ? lc : vg.config.render.lineCap;\n    g.beginPath();\n    g.moveTo(x1, y1);\n    g.lineTo(x2, y2);\n  }\n\n  // drawing functions\n\n  function drawPathOne(path, g, o, items) {\n    var fill = o.fill, stroke = o.stroke, opac, lc, lw;\n\n    path(g, items);\n\n    opac = o.opacity == null ? 1 : o.opacity;\n    if (opac == 0 || !fill && !stroke) return;\n\n    if (fill) {\n      g.globalAlpha = opac * (o.fillOpacity==null ? 1 : o.fillOpacity);\n      g.fillStyle = color(g, o, fill);\n      g.fill();\n    }\n\n    if (stroke) {\n      lw = (lw = o.strokeWidth) != null ? lw : vg.config.render.lineWidth;\n      if (lw > 0) {\n        g.globalAlpha = opac * (o.strokeOpacity==null ? 1 : o.strokeOpacity);\n        g.strokeStyle = color(g, o, stroke);\n        g.lineWidth = lw;\n        g.lineCap = (lc = o.strokeCap) != null ? lc : vg.config.render.lineCap;\n        g.vgLineDash(o.strokeDash || null);\n        g.vgLineDashOffset(o.strokeDashOffset || 0);\n        g.stroke();\n      }\n    }\n  }\n\n  function drawPathAll(path, g, scene, bounds) {\n    var i, len, item;\n    for (i=0, len=scene.items.length; i<len; ++i) {\n      item = scene.items[i];\n      if (bounds && !bounds.intersects(item.bounds))\n        continue; // bounds check\n      drawPathOne(path, g, item, item);\n    }\n  }\n\n  function drawRect(g, scene, bounds) {\n    if (!scene.items.length) return;\n    var items = scene.items,\n        o, fill, stroke, opac, lc, lw, x, y, w, h;\n\n    for (var i=0, len=items.length; i<len; ++i) {\n      o = items[i];\n      if (bounds && !bounds.intersects(o.bounds))\n        continue; // bounds check\n\n      x = o.x || 0;\n      y = o.y || 0;\n      w = o.width || 0;\n      h = o.height || 0;\n\n      opac = o.opacity == null ? 1 : o.opacity;\n      if (opac == 0) continue;\n\n      if (fill = o.fill) {\n        g.globalAlpha = opac * (o.fillOpacity==null ? 1 : o.fillOpacity);\n        g.fillStyle = color(g, o, fill);\n        g.fillRect(x, y, w, h);\n      }\n\n      if (stroke = o.stroke) {\n        lw = (lw = o.strokeWidth) != null ? lw : vg.config.render.lineWidth;\n        if (lw > 0) {\n          g.globalAlpha = opac * (o.strokeOpacity==null ? 1 : o.strokeOpacity);\n          g.strokeStyle = color(g, o, stroke);\n          g.lineWidth = lw;\n          g.lineCap = (lc = o.strokeCap) != null ? lc : vg.config.render.lineCap;\n          g.vgLineDash(o.strokeDash || null);\n          g.vgLineDashOffset(o.strokeDashOffset || 0);\n          g.strokeRect(x, y, w, h);\n        }\n      }\n    }\n  }\n\n  function drawRule(g, scene, bounds) {\n    if (!scene.items.length) return;\n    var items = scene.items,\n        o, stroke, opac, lc, lw, x1, y1, x2, y2;\n\n    for (var i=0, len=items.length; i<len; ++i) {\n      o = items[i];\n      if (bounds && !bounds.intersects(o.bounds))\n        continue; // bounds check\n\n      x1 = o.x || 0;\n      y1 = o.y || 0;\n      x2 = o.x2 != null ? o.x2 : x1;\n      y2 = o.y2 != null ? o.y2 : y1;\n\n      opac = o.opacity == null ? 1 : o.opacity;\n      if (opac == 0) continue;\n      \n      if (stroke = o.stroke) {\n        lw = (lw = o.strokeWidth) != null ? lw : vg.config.render.lineWidth;\n        if (lw > 0) {\n          g.globalAlpha = opac * (o.strokeOpacity==null ? 1 : o.strokeOpacity);\n          g.strokeStyle = color(g, o, stroke);\n          g.lineWidth = lw;\n          g.lineCap = (lc = o.strokeCap) != null ? lc : vg.config.render.lineCap;\n          g.vgLineDash(o.strokeDash || null);\n          g.vgLineDashOffset(o.strokeDashOffset || 0);\n          g.beginPath();\n          g.moveTo(x1, y1);\n          g.lineTo(x2, y2);\n          g.stroke();\n        }\n      }\n    }\n  }\n\n  function drawImage(g, scene, bounds) {\n    if (!scene.items.length) return;\n    var renderer = this,\n        items = scene.items, o;\n\n    for (var i=0, len=items.length; i<len; ++i) {\n      o = items[i];\n      if (bounds && !bounds.intersects(o.bounds))\n        continue; // bounds check\n\n      if (!(o.image && o.image.url === o.url)) {\n        o.image = renderer.loadImage(o.url);\n        o.image.url = o.url;\n      }\n\n      var x, y, w, h, opac;\n      w = o.width || (o.image && o.image.width) || 0;\n      h = o.height || (o.image && o.image.height) || 0;\n      x = (o.x||0) - (o.align === \"center\"\n        ? w/2 : (o.align === \"right\" ? w : 0));\n      y = (o.y||0) - (o.baseline === \"middle\"\n        ? h/2 : (o.baseline === \"bottom\" ? h : 0));\n\n      if (o.image.loaded) {\n        g.globalAlpha = (opac = o.opacity) != null ? opac : 1;\n        g.drawImage(o.image, x, y, w, h);\n      }\n    }\n  }\n\n  function drawText(g, scene, bounds) {\n    if (!scene.items.length) return;\n    var items = scene.items,\n        o, fill, stroke, opac, lw, x, y, r, t;\n\n    for (var i=0, len=items.length; i<len; ++i) {\n      o = items[i];\n      if (bounds && !bounds.intersects(o.bounds))\n        continue; // bounds check\n\n      g.font = vg.scene.fontString(o);\n      g.textAlign = o.align || \"left\";\n      g.textBaseline = o.baseline || \"alphabetic\";\n\n      opac = o.opacity == null ? 1 : o.opacity;\n      if (opac == 0) continue;\n\n      x = o.x || 0;\n      y = o.y || 0;\n      if (r = o.radius) {\n        t = (o.theta || 0) - Math.PI/2;\n        x += r * Math.cos(t);\n        y += r * Math.sin(t);\n      }\n\n      if (o.angle) {\n        g.save();\n        g.translate(x, y);\n        g.rotate(o.angle * Math.PI/180);\n        x = o.dx || 0;\n        y = o.dy || 0;\n      } else {\n        x += (o.dx || 0);\n        y += (o.dy || 0);\n      }\n\n      if (fill = o.fill) {\n        g.globalAlpha = opac * (o.fillOpacity==null ? 1 : o.fillOpacity);\n        g.fillStyle = color(g, o, fill);\n        g.fillText(o.text, x, y);\n      }\n\n      if (stroke = o.stroke) {\n        lw = (lw = o.strokeWidth) != null ? lw : 1;\n        if (lw > 0) {\n          g.globalAlpha = opac * (o.strokeOpacity==null ? 1 : o.strokeOpacity);\n          g.strokeStyle = color(o, stroke);\n          g.lineWidth = lw;\n          g.strokeText(o.text, x, y);\n        }\n      }\n\n      if (o.angle) g.restore();\n    }\n  }\n\n  function drawAll(pathFunc) {\n    return function(g, scene, bounds) {\n      drawPathAll(pathFunc, g, scene, bounds);\n    }\n  }\n\n  function drawOne(pathFunc) {\n    return function(g, scene, bounds) {\n      if (!scene.items.length) return;\n      if (bounds && !bounds.intersects(scene.items[0].bounds))\n        return; // bounds check\n      drawPathOne(pathFunc, g, scene.items[0], scene.items);\n    }\n  }\n\n  function drawGroup(g, scene, bounds) {\n    if (!scene.items.length) return;\n    var items = scene.items, group, axes, legends,\n        renderer = this, gx, gy, gb, i, n, j, m;\n\n    drawRect(g, scene, bounds);\n\n    for (i=0, n=items.length; i<n; ++i) {\n      group = items[i];\n      axes = group.axisItems || [];\n      legends = group.legendItems || [];\n      gx = group.x || 0;\n      gy = group.y || 0;\n\n      // render group contents\n      g.save();\n      g.translate(gx, gy);\n      if (group.clip) {\n        g.beginPath();\n        g.rect(0, 0, group.width || 0, group.height || 0);\n        g.clip();\n      }\n      \n      if (bounds) bounds.translate(-gx, -gy);\n      \n      for (j=0, m=axes.length; j<m; ++j) {\n        if (axes[j].def.layer === \"back\") {\n          renderer.draw(g, axes[j], bounds);\n        }\n      }\n      for (j=0, m=group.items.length; j<m; ++j) {\n        renderer.draw(g, group.items[j], bounds);\n      }\n      for (j=0, m=axes.length; j<m; ++j) {\n        if (axes[j].def.layer !== \"back\") {\n          renderer.draw(g, axes[j], bounds);\n        }\n      }\n      for (j=0, m=legends.length; j<m; ++j) {\n        renderer.draw(g, legends[j], bounds);\n      }\n      \n      if (bounds) bounds.translate(gx, gy);\n      g.restore();\n    }    \n  }\n\n  function color(g, o, value) {\n    return (value.id)\n      ? gradient(g, value, o.bounds)\n      : value;\n  }\n\n  function gradient(g, p, b) {\n    var w = b.width(),\n        h = b.height(),\n        x1 = b.x1 + p.x1 * w,\n        y1 = b.y1 + p.y1 * h,\n        x2 = b.x1 + p.x2 * w,\n        y2 = b.y1 + p.y2 * h,\n        grad = g.createLinearGradient(x1, y1, x2, y2),\n        stop = p.stops,\n        i, n;\n\n    for (i=0, n=stop.length; i<n; ++i) {\n      grad.addColorStop(stop[i].offset, stop[i].color);\n    }\n    return grad;\n  }\n\n  // hit testing\n\n  function pickGroup(g, scene, x, y, gx, gy) {\n    if (scene.items.length === 0 ||\n        scene.bounds && !scene.bounds.contains(gx, gy)) {\n      return false;\n    }\n    var items = scene.items, subscene, group, hit, dx, dy,\n        handler = this, i, j;\n\n    for (i=items.length; --i>=0;) {\n      group = items[i];\n      dx = group.x || 0;\n      dy = group.y || 0;\n\n      g.save();\n      g.translate(dx, dy);\n      for (j=group.items.length; --j >= 0;) {\n        subscene = group.items[j];\n        if (subscene.interactive === false) continue;\n        hit = handler.pick(subscene, x, y, gx-dx, gy-dy);\n        if (hit) {\n          g.restore();\n          return hit;\n        }\n      }\n      g.restore();\n    }\n\n    return scene.interactive\n      ? pickAll(hitTests.group, g, scene, x, y, gx, gy)\n      : false;\n  }\n\n  function pickAll(test, g, scene, x, y, gx, gy) {\n    if (!scene.items.length) return false;\n    var o, b, i;\n\n    if (g._ratio !== 1) {\n      x *= g._ratio;\n      y *= g._ratio;\n    }\n\n    for (i=scene.items.length; --i >= 0;) {\n      o = scene.items[i]; b = o.bounds;\n      // first hit test against bounding box\n      if ((b && !b.contains(gx, gy)) || !b) continue;\n      // if in bounding box, perform more careful test\n      if (test(g, o, x, y, gx, gy)) return o;\n    }\n    return false;\n  }\n\n  function pickArea(g, scene, x, y, gx, gy) {\n    if (!scene.items.length) return false;\n    var items = scene.items,\n        o, b, i, di, dd, od, dx, dy;\n\n    b = items[0].bounds;\n    if (b && !b.contains(gx, gy)) return false;\n    if (g._ratio !== 1) {\n      x *= g._ratio;\n      y *= g._ratio;\n    }\n    if (!hitTests.area(g, items, x, y)) return false;\n    return items[0];\n  }\n\n  function pickLine(g, scene, x, y, gx, gy) {\n    if (!scene.items.length) return false;\n    var items = scene.items,\n        o, b, i, di, dd, od, dx, dy;\n\n    b = items[0].bounds;\n    if (b && !b.contains(gx, gy)) return false;\n    if (g._ratio !== 1) {\n      x *= g._ratio;\n      y *= g._ratio;\n    }\n    if (!hitTests.line(g, items, x, y)) return false;\n    return items[0];\n  }\n\n  function pick(test) {\n    return function (g, scene, x, y, gx, gy) {\n      return pickAll(test, g, scene, x, y, gx, gy);\n    };\n  }\n\n  function textHit(g, o, x, y, gx, gy) {\n    if (!o.fontSize) return false;\n    if (!o.angle) return true; // bounds sufficient if no rotation\n\n    var b = vg.scene.bounds.text(o, tmpBounds, true),\n        a = -o.angle * Math.PI / 180,\n        cos = Math.cos(a),\n        sin = Math.sin(a),\n        x = o.x,\n        y = o.y,\n        px = cos*gx - sin*gy + (x - x*cos + y*sin),\n        py = sin*gx + cos*gy + (y - x*sin - y*cos);\n\n    return b.contains(px, py);\n  }\n\n  var hitTests = {\n    text:   textHit,\n    rect:   function(g,o,x,y) { return true; }, // bounds test is sufficient\n    image:  function(g,o,x,y) { return true; }, // bounds test is sufficient\n    group:  function(g,o,x,y) { return o.fill || o.stroke; },\n    rule:   function(g,o,x,y) {\n              if (!g.isPointInStroke) return false;\n              ruleStroke(g,o); return g.isPointInStroke(x,y);\n            },\n    line:   function(g,s,x,y) {\n              if (!g.isPointInStroke) return false;\n              lineStroke(g,s); return g.isPointInStroke(x,y);\n            },\n    arc:    function(g,o,x,y) { arcPath(g,o);  return g.isPointInPath(x,y); },\n    area:   function(g,s,x,y) { areaPath(g,s); return g.isPointInPath(x,y); },\n    path:   function(g,o,x,y) { pathPath(g,o); return g.isPointInPath(x,y); },\n    symbol: function(g,o,x,y) { symbolPath(g,o); return g.isPointInPath(x,y); }\n  };\n\n  return {\n    draw: {\n      group:   drawGroup,\n      area:    drawOne(areaPath),\n      line:    drawOne(linePath),\n      arc:     drawAll(arcPath),\n      path:    drawAll(pathPath),\n      symbol:  drawAll(symbolPath),\n      rect:    drawRect,\n      rule:    drawRule,\n      text:    drawText,\n      image:   drawImage,\n      drawOne: drawOne, // expose for extensibility\n      drawAll: drawAll  // expose for extensibility\n    },\n    pick: {\n      group:   pickGroup,\n      area:    pickArea,\n      line:    pickLine,\n      arc:     pick(hitTests.arc),\n      path:    pick(hitTests.path),\n      symbol:  pick(hitTests.symbol),\n      rect:    pick(hitTests.rect),\n      rule:    pick(hitTests.rule),\n      text:    pick(hitTests.text),\n      image:   pick(hitTests.image),\n      pickAll: pickAll  // expose for extensibility\n    }\n  };\n\n})();vg.canvas.Renderer = (function() {  \n  var renderer = function() {\n    this._ctx = null;\n    this._el = null;\n    this._imgload = 0;\n  };\n  \n  var prototype = renderer.prototype;\n  \n  prototype.initialize = function(el, width, height, pad) {\n    this._el = el;\n    \n    if (!el) return this; // early exit if no DOM element\n\n    // select canvas element\n    var canvas = d3.select(el)\n      .selectAll(\"canvas.marks\")\n      .data([1]);\n    \n    // create new canvas element if needed\n    canvas.enter()\n      .append(\"canvas\")\n      .attr(\"class\", \"marks\");\n    \n    // remove extraneous canvas if needed\n    canvas.exit().remove();\n    \n    return this.resize(width, height, pad);\n  };\n  \n  prototype.resize = function(width, height, pad) {\n    this._width = width;\n    this._height = height;\n    this._padding = pad;\n    \n    if (this._el) {\n      var canvas = d3.select(this._el).select(\"canvas.marks\");\n\n      // initialize canvas attributes\n      canvas\n        .attr(\"width\", width + pad.left + pad.right)\n        .attr(\"height\", height + pad.top + pad.bottom);\n\n      // get the canvas graphics context\n      var s;\n      this._ctx = canvas.node().getContext(\"2d\");\n      this._ctx._ratio = (s = scaleCanvas(canvas.node(), this._ctx) || 1);\n      this._ctx.setTransform(s, 0, 0, s, s*pad.left, s*pad.top);\n    }\n    \n    initializeLineDash(this._ctx);\n    return this;\n  };\n  \n  function scaleCanvas(canvas, ctx) {\n    // get canvas pixel data\n    var devicePixelRatio = window.devicePixelRatio || 1,\n        backingStoreRatio = (\n          ctx.webkitBackingStorePixelRatio ||\n          ctx.mozBackingStorePixelRatio ||\n          ctx.msBackingStorePixelRatio ||\n          ctx.oBackingStorePixelRatio ||\n          ctx.backingStorePixelRatio) || 1,\n        ratio = devicePixelRatio / backingStoreRatio;\n\n    if (devicePixelRatio !== backingStoreRatio) {\n      var w = canvas.width, h = canvas.height;\n      // set actual and visible canvas size\n      canvas.setAttribute(\"width\", w * ratio);\n      canvas.setAttribute(\"height\", h * ratio);\n      canvas.style.width = w + 'px';\n      canvas.style.height = h + 'px';\n    }\n    return ratio;\n  }\n\n  function initializeLineDash(ctx) {\n    if (ctx.vgLineDash) return; // already set\n\n    var NODASH = [];\n    if (ctx.setLineDash) {\n      ctx.vgLineDash = function(dash) { this.setLineDash(dash || NODASH); };\n      ctx.vgLineDashOffset = function(off) { this.lineDashOffset = off; };\n    } else if (ctx.webkitLineDash !== undefined) {\n    \tctx.vgLineDash = function(dash) { this.webkitLineDash = dash || NODASH; };\n      ctx.vgLineDashOffset = function(off) { this.webkitLineDashOffset = off; };\n    } else if (ctx.mozDash !== undefined) {\n      ctx.vgLineDash = function(dash) { this.mozDash = dash; };\n      ctx.vgLineDashOffset = function(off) { /* unsupported */ };\n    } else {\n      ctx.vgLineDash = function(dash) { /* unsupported */ };\n      ctx.vgLineDashOffset = function(off) { /* unsupported */ };\n    }\n  }\n  \n  prototype.context = function(ctx) {\n    if (ctx) { this._ctx = ctx; return this; }\n    else return this._ctx;\n  };\n  \n  prototype.element = function() {\n    return this._el;\n  };\n  \n  prototype.pendingImages = function() {\n    return this._imgload;\n  };\n\n  function translatedBounds(item, bounds) {\n    var b = new vg.Bounds(bounds);\n    while ((item = item.mark.group) != null) {\n      b.translate(item.x || 0, item.y || 0);\n    }\n    return b;\n  }\n    \n  function getBounds(items) {\n    return !items ? null :\n      vg.array(items).reduce(function(b, item) {\n        return b.union(translatedBounds(item, item.bounds))\n                .union(translatedBounds(item, item['bounds:prev']));\n      }, new vg.Bounds());  \n  }\n  \n  function setBounds(g, bounds) {\n    var bbox = null;\n    if (bounds) {\n      bbox = (new vg.Bounds(bounds)).round();\n      g.beginPath();\n      g.rect(bbox.x1, bbox.y1, bbox.width(), bbox.height());\n      g.clip();\n    }\n    return bbox;\n  }\n  \n  prototype.render = function(scene, items) {\n    var g = this._ctx,\n        pad = this._padding,\n        w = this._width + pad.left + pad.right,\n        h = this._height + pad.top + pad.bottom,\n        bb = null, bb2;\n\n    // setup\n    this._scene = scene;\n    g.save();\n    bb = setBounds(g, getBounds(items));\n    g.clearRect(-pad.left, -pad.top, w, h);\n\n    // render\n    this.draw(g, scene, bb);\n\n    // render again to handle possible bounds change\n    if (items) {\n      g.restore();\n      g.save();\n      bb2 = setBounds(g, getBounds(items));\n      if (!bb.encloses(bb2)) {\n        g.clearRect(-pad.left, -pad.top, w, h);\n        this.draw(g, scene, bb2);\n      }\n    }\n    \n    // takedown\n    g.restore();\n    this._scene = null;\n  };\n  \n  prototype.draw = function(ctx, scene, bounds) {\n    var marktype = scene.marktype,\n        renderer = vg.canvas.marks.draw[marktype];\n    renderer.call(this, ctx, scene, bounds);\n  };\n  \n  prototype.renderAsync = function(scene) {\n    // TODO make safe for multiple scene rendering?\n    var renderer = this;\n    if (renderer._async_id) {\n      clearTimeout(renderer._async_id);\n    }\n    renderer._async_id = setTimeout(function() {\n      renderer.render(scene);\n      delete renderer._async_id;\n    }, 50);\n  };\n  \n  prototype.loadImage = function(uri) {\n    var renderer = this,\n        scene = renderer._scene,\n        image = null, url;\n\n    renderer._imgload += 1;\n    if (vg.config.isNode) {\n      image = new (require(\"canvas\").Image)();\n      vg.data.load(uri, function(err, data) {\n        if (err) { vg.error(err); return; }\n        image.src = data;\n        image.loaded = true;\n        renderer._imgload -= 1;\n      });\n    } else {\n      image = new Image();\n      url = vg.config.baseURL + uri;\n      image.onload = function() {\n        vg.log(\"LOAD IMAGE: \"+url);\n        image.loaded = true;\n        renderer._imgload -= 1;\n        renderer.renderAsync(scene);\n      };\n      image.src = url;\n    }\n\n    return image;\n  };\n  \n  return renderer;\n})();vg.canvas.Handler = (function() {\n  var handler = function(el, model) {\n    this._active = null;\n    this._handlers = {};\n    if (el) this.initialize(el);\n    if (model) this.model(model);\n  };\n  \n  var prototype = handler.prototype;\n\n  prototype.initialize = function(el, pad, obj) {\n    this._el = d3.select(el).node();\n    this._canvas = d3.select(el).select(\"canvas.marks\").node();\n    this._padding = pad;\n    this._obj = obj || null;\n    \n    // add event listeners\n    var canvas = this._canvas, that = this;\n    events.forEach(function(type) {\n      canvas.addEventListener(type, function(evt) {\n        prototype[type].call(that, evt);\n      });\n    });\n    \n    return this;\n  };\n  \n  prototype.padding = function(pad) {\n    this._padding = pad;\n    return this;\n  };\n  \n  prototype.model = function(model) {\n    if (!arguments.length) return this._model;\n    this._model = model;\n    return this;\n  };\n\n  prototype.handlers = function() {\n    var h = this._handlers;\n    return vg.keys(h).reduce(function(a, k) {\n      return h[k].reduce(function(a, x) { return (a.push(x), a); }, a);\n    }, []);\n  };\n\n  // setup events\n  var events = [\n    \"mousedown\",\n    \"mouseup\",\n    \"click\",\n    \"dblclick\",\n    \"wheel\",\n    \"keydown\",\n    \"keypress\",\n    \"keyup\",\n    \"mousewheel\"\n  ];\n  events.forEach(function(type) {\n    prototype[type] = function(evt) {\n      this.fire(type, evt);\n    };\n  });\n  events.push(\"mousemove\");\n  events.push(\"mouseout\");\n\n  function eventName(name) {\n    var i = name.indexOf(\".\");\n    return i < 0 ? name : name.slice(0,i);\n  }\n\n  prototype.mousemove = function(evt) {\n    var pad = this._padding,\n        b = evt.target.getBoundingClientRect(),\n        x = evt.clientX - b.left,\n        y = evt.clientY - b.top,\n        a = this._active,\n        p = this.pick(this._model.scene(), x, y, x-pad.left, y-pad.top);\n\n    if (p === a) {\n      this.fire(\"mousemove\", evt);\n      return;\n    } else if (a) {\n      this.fire(\"mouseout\", evt);\n    }\n    this._active = p;\n    if (p) {\n      this.fire(\"mouseover\", evt);\n    }\n  };\n  \n  prototype.mouseout = function(evt) {\n    if (this._active) {\n      this.fire(\"mouseout\", evt);\n    }\n    this._active = null;\n  };\n\n  // to keep firefox happy\n  prototype.DOMMouseScroll = function(evt) {\n    this.fire(\"mousewheel\", evt);\n  };\n\n  // fire an event\n  prototype.fire = function(type, evt) {\n    var a = this._active,\n        h = this._handlers[type];\n    if (a && h) {\n      for (var i=0, len=h.length; i<len; ++i) {\n        h[i].handler.call(this._obj, evt, a);\n      }\n    }\n  };\n\n  // add an event handler\n  prototype.on = function(type, handler) {\n    var name = eventName(type),\n        h = this._handlers;\n    h = h[name] || (h[name] = []);\n    h.push({\n      type: type,\n      handler: handler\n    });\n    return this;\n  };\n\n  // remove an event handler\n  prototype.off = function(type, handler) {\n    var name = eventName(type),\n        h = this._handlers[name];\n    if (!h) return;\n    for (var i=h.length; --i>=0;) {\n      if (h[i].type !== type) continue;\n      if (!handler || h[i].handler === handler) h.splice(i, 1);\n    }\n    return this;\n  };\n  \n  // retrieve the current canvas context\n  prototype.context = function() {\n    return this._canvas.getContext(\"2d\");\n  };\n  \n  // find the scenegraph item at the current mouse position\n  // x, y -- the absolute x, y mouse coordinates on the canvas element\n  // gx, gy -- the relative coordinates within the current group\n  prototype.pick = function(scene, x, y, gx, gy) {\n    var g = this.context(),\n        marktype = scene.marktype,\n        picker = vg.canvas.marks.pick[marktype];\n    return picker.call(this, g, scene, x, y, gx, gy);\n  };\n\n  return handler;\n})();vg.svg = {};vg.svg.marks = (function() {\n\n  function x(o)     { return o.x || 0; }\n  function y(o)     { return o.y || 0; }\n  function yh(o)    { return o.y + o.height || 0; }\n  function key(o)   { return o.key; }\n  function size(o)  { return o.size==null ? 100 : o.size; }\n  function shape(o) { return o.shape || \"circle\"; }\n      \n  var arc_path    = d3.svg.arc(),\n      area_path   = d3.svg.area().x(x).y1(y).y0(yh),\n      line_path   = d3.svg.line().x(x).y(y),\n      symbol_path = d3.svg.symbol().type(shape).size(size);\n  \n  var mark_id = 0,\n      clip_id = 0;\n  \n  var textAlign = {\n    \"left\":   \"start\",\n    \"center\": \"middle\",\n    \"right\":  \"end\"\n  };\n  \n  var styles = {\n    \"fill\":             \"fill\",\n    \"fillOpacity\":      \"fill-opacity\",\n    \"stroke\":           \"stroke\",\n    \"strokeWidth\":      \"stroke-width\",\n    \"strokeOpacity\":    \"stroke-opacity\",\n    \"strokeCap\":        \"stroke-linecap\",\n    \"strokeDash\":       \"stroke-dasharray\",\n    \"strokeDashOffset\": \"stroke-dashoffset\",\n    \"opacity\":          \"opacity\"\n  };\n  var styleProps = vg.keys(styles);\n\n  function style(d) {\n    var i, n, prop, name, value,\n        o = d.mark ? d : d.length ? d[0] : null;\n    if (o === null) return;\n\n    for (i=0, n=styleProps.length; i<n; ++i) {\n      prop = styleProps[i];\n      name = styles[prop];\n      value = o[prop];\n\n      if (value == null) {\n        if (name === \"fill\") this.style.setProperty(name, \"none\", null);\n        else this.style.removeProperty(name);\n      } else {\n        if (value.id) {\n          // ensure definition is included\n          vg.svg._cur._defs.gradient[value.id] = value;\n          value = \"url(#\" + value.id + \")\";\n        }\n        this.style.setProperty(name, value+\"\", null);\n      }\n    }\n  }\n  \n  function arc(o) {\n    var x = o.x || 0,\n        y = o.y || 0;\n    this.setAttribute(\"transform\", \"translate(\"+x+\",\"+y+\")\");\n    this.setAttribute(\"d\", arc_path(o));\n  }\n  \n  function area(items) {\n    if (!items.length) return;\n    var o = items[0];\n    area_path\n      .interpolate(o.interpolate || \"linear\")\n      .tension(o.tension == null ? 0.7 : o.tension);\n    this.setAttribute(\"d\", area_path(items));\n  }\n  \n  function line(items) {\n    if (!items.length) return;\n    var o = items[0];\n    line_path\n      .interpolate(o.interpolate || \"linear\")\n      .tension(o.tension == null ? 0.7 : o.tension);\n    this.setAttribute(\"d\", line_path(items));\n  }\n  \n  function path(o) {\n    var x = o.x || 0,\n        y = o.y || 0;\n    this.setAttribute(\"transform\", \"translate(\"+x+\",\"+y+\")\");\n    if (o.path != null) this.setAttribute(\"d\", o.path);\n  }\n\n  function rect(o) {\n    this.setAttribute(\"x\", o.x || 0);\n    this.setAttribute(\"y\", o.y || 0);\n    this.setAttribute(\"width\", o.width || 0);\n    this.setAttribute(\"height\", o.height || 0);\n  }\n\n  function rule(o) {\n    var x1 = o.x || 0,\n        y1 = o.y || 0;\n    this.setAttribute(\"x1\", x1);\n    this.setAttribute(\"y1\", y1);\n    this.setAttribute(\"x2\", o.x2 != null ? o.x2 : x1);\n    this.setAttribute(\"y2\", o.y2 != null ? o.y2 : y1);\n  }\n  \n  function symbol(o) {\n    var x = o.x || 0,\n        y = o.y || 0;\n    this.setAttribute(\"transform\", \"translate(\"+x+\",\"+y+\")\");\n    this.setAttribute(\"d\", symbol_path(o));\n  }\n  \n  function image(o) {\n    var w = o.width || (o.image && o.image.width) || 0,\n        h = o.height || (o.image && o.image.height) || 0,\n        x = o.x - (o.align === \"center\"\n          ? w/2 : (o.align === \"right\" ? w : 0)),\n        y = o.y - (o.baseline === \"middle\"\n          ? h/2 : (o.baseline === \"bottom\" ? h : 0)),\n        url = vg.config.baseURL + o.url;\n    \n    this.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"href\", url);\n    this.setAttribute(\"x\", x);\n    this.setAttribute(\"y\", y);\n    this.setAttribute(\"width\", w);\n    this.setAttribute(\"height\", h);\n  }\n    \n  function fontString(o) {\n    return (o.fontStyle ? o.fontStyle + \" \" : \"\")\n      + (o.fontVariant ? o.fontVariant + \" \" : \"\")\n      + (o.fontWeight ? o.fontWeight + \" \" : \"\")\n      + (o.fontSize != null ? o.fontSize : vg.config.render.fontSize) + \"px \"\n      + (o.font || vg.config.render.font);\n  }\n  \n  function text(o) {\n    var x = o.x || 0,\n        y = o.y || 0,\n        dx = o.dx || 0,\n        dy = o.dy || 0,\n        a = o.angle || 0,\n        r = o.radius || 0,\n        align = textAlign[o.align || \"left\"],\n        base = o.baseline===\"top\" ? \".9em\"\n             : o.baseline===\"middle\" ? \".35em\" : 0;\n\n    if (r) {\n      var t = (o.theta || 0) - Math.PI/2;\n      x += r * Math.cos(t);\n      y += r * Math.sin(t);\n    }\n\n    this.setAttribute(\"x\", x + dx);\n    this.setAttribute(\"y\", y + dy);\n    this.setAttribute(\"text-anchor\", align);\n    \n    if (a) this.setAttribute(\"transform\", \"rotate(\"+a+\" \"+x+\",\"+y+\")\");\n    else this.removeAttribute(\"transform\");\n    \n    if (base) this.setAttribute(\"dy\", base);\n    else this.removeAttribute(\"dy\");\n    \n    this.textContent = o.text;\n    this.style.setProperty(\"font\", fontString(o), null);\n  }\n  \n  function group(o) {\n    var x = o.x || 0,\n        y = o.y || 0;\n    this.setAttribute(\"transform\", \"translate(\"+x+\",\"+y+\")\");\n\n    if (o.clip) {\n      var c = {width: o.width || 0, height: o.height || 0},\n          id = o.clip_id || (o.clip_id = \"clip\" + clip_id++);\n      vg.svg._cur._defs.clipping[id] = c;\n      this.setAttribute(\"clip-path\", \"url(#\"+id+\")\");\n    }\n  }\n\n  function group_bg(o) {\n    var w = o.width || 0,\n        h = o.height || 0;\n    this.setAttribute(\"width\", w);\n    this.setAttribute(\"height\", h);\n  }\n\n  function cssClass(def) {\n    var cls = \"type-\" + def.type;\n    if (def.name) cls += \" \" + def.name;\n    return cls;\n  }\n\n  function draw(tag, attr, nest) {\n    return function(g, scene, index) {\n      drawMark(g, scene, index, \"mark_\", tag, attr, nest);\n    };\n  }\n  \n  function drawMark(g, scene, index, prefix, tag, attr, nest) {\n    var data = nest ? [scene.items] : scene.items,\n        evts = scene.interactive===false ? \"none\" : null,\n        grps = g.node().childNodes,\n        notG = (tag !== \"g\"),\n        p = (p = grps[index+1]) // +1 to skip group background rect\n          ? d3.select(p)\n          : g.append(\"g\")\n             .attr(\"id\", \"g\"+(++mark_id))\n             .attr(\"class\", cssClass(scene.def));\n\n    var id = p.attr(\"id\"),\n        s = \"#\" + id + \" > \" + tag,\n        m = p.selectAll(s).data(data),\n        e = m.enter().append(tag);\n\n    if (notG) {\n      p.style(\"pointer-events\", evts);\n      e.each(function(d) {\n        if (d.mark) d._svg = this;\n        else if (d.length) d[0]._svg = this;\n      });\n    } else {\n      e.append(\"rect\").attr(\"class\",\"background\").style(\"pointer-events\",evts);\n    }\n    \n    m.exit().remove();\n    m.each(attr);\n    if (notG) m.each(style);\n    else p.selectAll(s+\" > rect.background\").each(group_bg).each(style);\n    \n    return p;\n  }\n\n  function drawGroup(g, scene, index, prefix) {    \n    var p = drawMark(g, scene, index, prefix || \"group_\", \"g\", group),\n        c = p.node().childNodes, n = c.length, i, j, m;\n    \n    for (i=0; i<n; ++i) {\n      var items = c[i].__data__.items,\n          legends = c[i].__data__.legendItems || [],\n          axes = c[i].__data__.axisItems || [],\n          sel = d3.select(c[i]),\n          idx = 0;\n\n      for (j=0, m=axes.length; j<m; ++j) {\n        if (axes[j].def.layer === \"back\") {\n          drawGroup.call(this, sel, axes[j], idx++, \"axis_\");\n        }\n      }\n      for (j=0, m=items.length; j<m; ++j) {\n        this.draw(sel, items[j], idx++);\n      }\n      for (j=0, m=axes.length; j<m; ++j) {\n        if (axes[j].def.layer !== \"back\") {\n          drawGroup.call(this, sel, axes[j], idx++, \"axis_\");\n        }\n      }\n      for (j=0, m=legends.length; j<m; ++j) {\n        drawGroup.call(this, sel, legends[j], idx++, \"legend_\");\n      }\n    }\n  }\n\n  return {\n    update: {\n      group:   rect,\n      area:    area,\n      line:    line,\n      arc:     arc,\n      path:    path,\n      symbol:  symbol,\n      rect:    rect,\n      rule:    rule,\n      text:    text,\n      image:   image\n    },\n    nested: {\n      \"area\": true,\n      \"line\": true\n    },\n    style: style,\n    draw: {\n      group:   drawGroup,\n      area:    draw(\"path\", area, true),\n      line:    draw(\"path\", line, true),\n      arc:     draw(\"path\", arc),\n      path:    draw(\"path\", path),\n      symbol:  draw(\"path\", symbol),\n      rect:    draw(\"rect\", rect),\n      rule:    draw(\"line\", rule),\n      text:    draw(\"text\", text),\n      image:   draw(\"image\", image),\n      draw:    draw // expose for extensibility\n    }\n  };\n  \n})();vg.svg.Renderer = (function() {  \n  var renderer = function() {\n    this._svg = null;\n    this._ctx = null;\n    this._el = null;\n    this._defs = {\n      gradient: {},\n      clipping: {}\n    };\n  };\n  \n  var prototype = renderer.prototype;\n  \n  prototype.initialize = function(el, width, height, pad) {\n    this._el = el;\n\n    // remove any existing svg element\n    d3.select(el).select(\"svg.marks\").remove();\n\n    // create svg element and initialize attributes\n    this._svg = d3.select(el)\n      .append(\"svg\")\n      .attr(\"class\", \"marks\");\n    \n    // set the svg root group\n    this._ctx = this._svg.append(\"g\");\n    \n    return this.resize(width, height, pad);\n  };\n  \n  prototype.resize = function(width, height, pad) {\n    this._width = width;\n    this._height = height;\n    this._padding = pad;\n    \n    this._svg\n      .attr(\"width\", width + pad.left + pad.right)\n      .attr(\"height\", height + pad.top + pad.bottom);\n      \n    this._ctx\n      .attr(\"transform\", \"translate(\"+pad.left+\",\"+pad.top+\")\");\n\n    return this;\n  };\n  \n  prototype.context = function() {\n    return this._ctx;\n  };\n  \n  prototype.element = function() {\n    return this._el;\n  };\n\n  prototype.updateDefs = function() {\n    var svg = this._svg,\n        all = this._defs,\n        dgrad = vg.keys(all.gradient),\n        dclip = vg.keys(all.clipping),\n        defs = svg.select(\"defs\"), grad, clip;\n  \n    // get or create svg defs block\n    if (dgrad.length===0 && dclip.length==0) { defs.remove(); return; }\n    if (defs.empty()) defs = svg.insert(\"defs\", \":first-child\");\n    \n    grad = defs.selectAll(\"linearGradient\").data(dgrad, vg.identity);\n    grad.enter().append(\"linearGradient\").attr(\"id\", vg.identity);\n    grad.exit().remove();\n    grad.each(function(id) {\n      var def = all.gradient[id],\n          grd = d3.select(this);\n  \n      // set gradient coordinates\n      grd.attr({x1: def.x1, x2: def.x2, y1: def.y1, y2: def.y2});\n  \n      // set gradient stops\n      stop = grd.selectAll(\"stop\").data(def.stops);\n      stop.enter().append(\"stop\");\n      stop.exit().remove();\n      stop.attr(\"offset\", function(d) { return d.offset; })\n          .attr(\"stop-color\", function(d) { return d.color; });\n    });\n    \n    clip = defs.selectAll(\"clipPath\").data(dclip, vg.identity);\n    clip.enter().append(\"clipPath\").attr(\"id\", vg.identity);\n    clip.exit().remove();\n    clip.each(function(id) {\n      var def = all.clipping[id],\n          cr = d3.select(this).selectAll(\"rect\").data([1]);\n      cr.enter().append(\"rect\");\n      cr.attr(\"x\", 0)\n        .attr(\"y\", 0)\n        .attr(\"width\", def.width)\n        .attr(\"height\", def.height);\n    });\n  };\n  \n  prototype.render = function(scene, items) {\n    vg.svg._cur = this;\n\n    if (items) {\n      this.renderItems(vg.array(items));\n    } else {\n      this.draw(this._ctx, scene, -1);\n    }\n    this.updateDefs();\n\n   delete vg.svg._cur;\n  };\n  \n  prototype.renderItems = function(items) {\n    var item, node, type, nest, i, n,\n        marks = vg.svg.marks;\n\n    for (i=0, n=items.length; i<n; ++i) {\n      item = items[i];\n      node = item._svg;\n      type = item.mark.marktype;\n\n      item = marks.nested[type] ? item.mark.items : item;\n      marks.update[type].call(node, item);\n      marks.style.call(node, item);\n    }\n  }\n  \n  prototype.draw = function(ctx, scene, index) {\n    var marktype = scene.marktype,\n        renderer = vg.svg.marks.draw[marktype];\n    renderer.call(this, ctx, scene, index);\n  };\n  \n  return renderer;\n})();vg.svg.Handler = (function() {\n  var handler = function(el, model) {\n    this._active = null;\n    this._handlers = {};\n    if (el) this.initialize(el);\n    if (model) this.model(model);\n  };\n  \n  function svgHandler(handler) {\n    var that = this;\n    return function(evt) {\n      var target = evt.target,\n          item = target.__data__;\n      if (item) {\n        item = item.mark ? item : item[0];\n        handler.call(that._obj, evt, item);\n      }\n    };\n  }\n  \n  function eventName(name) {\n    var i = name.indexOf(\".\");\n    return i < 0 ? name : name.slice(0,i);\n  }\n  \n  var prototype = handler.prototype;\n\n  prototype.initialize = function(el, pad, obj) {\n    this._el = d3.select(el).node();\n    this._svg = d3.select(el).select(\"svg.marks\").node();\n    this._padding = pad;\n    this._obj = obj || null;\n    return this;\n  };\n  \n  prototype.padding = function(pad) {\n    this._padding = pad;\n    return this;\n  };\n  \n  prototype.model = function(model) {\n    if (!arguments.length) return this._model;\n    this._model = model;\n    return this;\n  };\n  \n  prototype.handlers = function() {\n    var h = this._handlers;\n    return vg.keys(h).reduce(function(a, k) {\n      return h[k].reduce(function(a, x) { return (a.push(x), a); }, a);\n    }, []);\n  };\n\n  // add an event handler\n  prototype.on = function(type, handler) {\n    var name = eventName(type),\n        h = this._handlers,\n        dom = d3.select(this._svg).node();\n        \n    var x = {\n      type: type,\n      handler: handler,\n      svg: svgHandler.call(this, handler)\n    };\n    h = h[name] || (h[name] = []);\n    h.push(x);\n\n    dom.addEventListener(name, x.svg);\n    return this;\n  };\n\n  // remove an event handler\n  prototype.off = function(type, handler) {\n    var name = eventName(type),\n        h = this._handlers[name],\n        dom = d3.select(this._svg).node();\n    if (!h) return;\n    for (var i=h.length; --i>=0;) {\n      if (h[i].type !== type) continue;\n      if (!handler || h[i].handler === handler) {\n        dom.removeEventListener(name, h[i].svg);\n        h.splice(i, 1);\n      }\n    }\n    return this;\n  };\n\n  return handler;\n})();vg.data = {};\n\nvg.data.ingestAll = function(data) {\n  return vg.isTree(data)\n    ? vg_make_tree(vg.data.ingestTree(data[0], data.children))\n    : data.map(vg.data.ingest);\n};\n\nvg.data.ingest = function(datum, index) {\n  return {\n    data: datum,\n    index: index\n  };\n};\n\nvg.data.ingestTree = function(node, children, index) {\n  var d = vg.data.ingest(node, index || 0),\n      c = node[children], n, i;\n  if (c && (n = c.length)) {\n    d.values = Array(n);\n    for (i=0; i<n; ++i) {\n      d.values[i] = vg.data.ingestTree(c[i], children, i);\n    }\n  }\n  return d;\n};\n\nfunction vg_make_tree(d) {\n  d.__vgtree__ = true;\n  d.nodes = function() { return vg_tree_nodes(this, []); };\n  return d;\n}\n\nfunction vg_tree_nodes(root, nodes) {\n  var c = root.values,\n      n = c ? c.length : 0, i;\n  nodes.push(root);\n  for (i=0; i<n; ++i) { vg_tree_nodes(c[i], nodes); }\n  return nodes;\n}\n\nfunction vg_data_duplicate(d) {\n  var x=d, i, n;\n  if (vg.isArray(d)) {\n    x = [];\n    for (i=0, n=d.length; i<n; ++i) {\n      x.push(vg_data_duplicate(d[i]));\n    }\n  } else if (vg.isObject(d)) {\n    x = {};\n    for (i in d) {\n      x[i] = vg_data_duplicate(d[i]);\n    }\n  }\n  return x;\n}\n\nvg.data.mapper = function(func) {\n  return function(data) {\n    data.forEach(func);\n    return data;\n  }\n};\n\nvg.data.size = function(size, group) {\n  size = vg.isArray(size) ? size : [0, size];\n  size = size.map(function(d) {\n    return (typeof d === 'string') ? group[d] : d;\n  });\n  return size;\n};vg.data.load = function(uri, callback) {\n  var url = vg_load_hasProtocol(uri) ? uri : vg.config.baseURL + uri;\n  if (vg.config.isNode) {\n    // in node.js, consult url and select file or http\n    var get = vg_load_isFile(url) ? vg_load_file : vg_load_http;\n    get(url, callback);\n  } else {\n    // in browser, use xhr\n    vg_load_xhr(url, callback);\n  }  \n};\n\nvar vg_load_protocolRE = /^[A-Za-z]+\\:\\/\\//;\nvar vg_load_fileProtocol = \"file://\";\n\nfunction vg_load_hasProtocol(url) {\n  return vg_load_protocolRE.test(url);\n}\n\nfunction vg_load_isFile(url) {\n  return url.indexOf(vg_load_fileProtocol) === 0;\n}\n\nfunction vg_load_xhr(url, callback) {\n  vg.log(\"LOAD: \" + url);\n  if (!vg_url_check(url)) {\n    vg.error(\"URL is not whitelisted: \" + url);\n    return;\n  }\n  d3.xhr(url, function(err, resp) {\n    if (resp) resp = resp.responseText;\n    callback(err, resp);\n  });\n}\n\nfunction vg_url_check(url) {\n  if (!vg.config.domainWhiteList) return true;\n  var a = document.createElement(\"a\");\n  a.href = url;\n  var domain = a.hostname.toLowerCase();\n  return vg.config.domainWhiteList.some(function(d) {\n    return d === domain ||\n      domain.lastIndexOf(\".\"+d) === (domain.length - d.length - 1);\n  });\n}\n\nfunction vg_load_file(file, callback) {\n  vg.log(\"LOAD FILE: \" + file);\n  var idx = file.indexOf(vg_load_fileProtocol);\n  if (idx >= 0) file = file.slice(vg_load_fileProtocol.length);\n  require(\"fs\").readFile(file, callback);\n}\n\nfunction vg_load_http(url, callback) {\n  vg.log(\"LOAD HTTP: \" + url);\n\tvar req = require(\"http\").request(url, function(res) {\n    var pos=0, data = new Buffer(parseInt(res.headers['content-length'],10));\n\t\tres.on(\"error\", function(err) { callback(err, null); });\n\t\tres.on(\"data\", function(x) { x.copy(data, pos); pos += x.length; });\n\t\tres.on(\"end\", function() { callback(null, data); });\n\t});\n\treq.on(\"error\", function(err) { callback(err); });\n\treq.end();\n}vg.data.read = (function() {\n  var formats = {},\n      parsers = {\n        \"number\": vg.number,\n        \"boolean\": vg.boolean,\n        \"date\": Date.parse\n      };\n\n  function read(data, format) {\n    var type = (format && format.type) || \"json\";\n    data = formats[type](data, format);\n    if (format && format.parse) parseValues(data, format.parse);\n    return data;\n  }\n\n  formats.json = function(data, format) {\n    var d = vg.isObject(data) ? data : JSON.parse(data);\n    if (format && format.property) {\n      d = vg.accessor(format.property)(d);\n    }\n    return d;\n  };\n\n  formats.csv = function(data, format) {\n    var d = d3.csv.parse(data);\n    return d;\n  };\n\n  formats.tsv = function(data, format) {\n    var d = d3.tsv.parse(data);\n    return d;\n  };\n  \n  formats.topojson = function(data, format) {\n    if (topojson == null) {\n      vg.error(\"TopoJSON library not loaded.\");\n      return [];\n    }    \n    var t = vg.isObject(data) ? data : JSON.parse(data),\n        obj = [];\n\n    if (format && format.feature) {\n      obj = (obj = t.objects[format.feature])\n        ? topojson.feature(t, obj).features\n        : (vg.error(\"Invalid TopoJSON object: \"+format.feature), []);\n    } else if (format && format.mesh) {\n      obj = (obj = t.objects[format.mesh])\n        ? [topojson.mesh(t, t.objects[format.mesh])]\n        : (vg.error(\"Invalid TopoJSON object: \" + format.mesh), []);\n    }\n    else { vg.error(\"Missing TopoJSON feature or mesh parameter.\"); }\n\n    return obj;\n  };\n  \n  formats.treejson = function(data, format) {\n    data = vg.isObject(data) ? data : JSON.parse(data);\n    return vg.tree(data, format.children);\n  };\n  \n  function parseValues(data, types) {\n    var cols = vg.keys(types),\n        p = cols.map(function(col) { return parsers[types[col]]; }),\n        tree = vg.isTree(data);\n    vg_parseArray(tree ? [data] : data, cols, p, tree);\n  }\n  \n  function vg_parseArray(data, cols, p, tree) {\n    var d, i, j, len, clen;\n    for (i=0, len=data.length; i<len; ++i) {\n      d = data[i];\n      for (j=0, clen=cols.length; j<clen; ++j) {\n        d[cols[j]] = p[j](d[cols[j]]);\n      }\n      if (tree && d.values) parseValues(d, cols, p, true);\n    }\n  }\n\n  read.formats = formats;\n  read.parse = parseValues;\n  return read;\n})();vg.data.array = function() {\n  var fields = [];\n   \n  function array(data) {\n    return data.map(function(d) {      \n      var list = [];\n      for (var i=0, len=fields.length; i<len; ++i) {\n        list.push(fields[i](d));\n      }\n      return list;\n    });\n  }\n  \n  array.fields = function(fieldList) {\n    fields = vg.array(fieldList).map(vg.accessor);\n    return array;\n  };\n  \n  return array;\n};vg.data.copy = function() {\n  var from = vg.accessor(\"data\"),\n      fields = [],\n      as = null;\n  \n  var copy = vg.data.mapper(function(d) {\n    var src = from(d), i, len,\n        source = fields,\n        target = as || fields;\n    for (i=0, len=fields.length; i<len; ++i) {\n      d[target[i]] = src[fields[i]];\n    }\n    return d;\n  });\n\n  copy.from = function(field) {\n    from = vg.accessor(field);\n    return copy;\n  };\n  \n  copy.fields = function(fieldList) {\n    fields = vg.array(fieldList);\n    return copy;\n  };\n  \n  copy.as = function(fieldList) {\n    as = vg.array(fieldList);\n    return copy;\n  };\n\n  return copy;\n};vg.data.cross = function() {\n  var other = null,\n      nodiag = false,\n      output = {left:\"a\", right:\"b\"};\n\n  function cross(data) {\n    var result = [],\n        data2 = other || data,\n        o, i, j, n = data.length;\n\n    for (i=0; i<n; ++i) {\n      for (j=0; j<n; ++j) {\n        if (nodiag && i===j) continue;\n        o = {};\n        o[output.left] = data[i];\n        o[output.right] = data2[j];\n        result.push(o);\n      }\n    }\n    return result;\n  }\n\n  cross[\"with\"] = function(d) {\n    other = d;\n    return cross;\n  };\n  \n  cross.diagonal = function(x) {\n    nodiag = !x;\n    return cross;\n  };\n\n  cross.output = function(map) {\n    vg.keys(output).forEach(function(k) {\n      if (map[k] !== undefined) { output[k] = map[k]; }\n    });\n    return cross;\n  };\n\n  return cross;\n};\nvg.data.facet = function() {\n\n  var keys = [],\n      sort = null;\n\n  function facet(data) {    \n    var result = {\n          key: \"\",\n          keys: [],\n          values: []\n        },\n        map = {}, \n        vals = result.values,\n        obj, klist, kstr, len, i, j, k, kv, cmp;\n\n    if (keys.length === 0) {\n      // if no keys, skip collation step\n      vals.push(obj = {\n        key: \"\", keys: [], index: 0,\n        values: sort ? data.slice() : data\n      });\n      if (sort) sort(obj.values);\n      return result;\n    }\n\n    for (i=0, len=data.length; i<len; ++i) {\n      for (k=0, klist=[], kstr=\"\"; k<keys.length; ++k) {\n        kv = keys[k](data[i]);\n        klist.push(kv);\n        kstr += (k>0 ? \"|\" : \"\") + String(kv);\n      }\n      obj = map[kstr];\n      if (obj === undefined) {\n        vals.push(obj = map[kstr] = {\n          key: kstr,\n          keys: klist,\n          index: vals.length,\n          values: []\n        });\n      }\n      obj.values.push(data[i]);\n    }\n\n    if (sort) {\n      for (i=0, len=vals.length; i<len; ++i) {\n        sort(vals[i].values);\n      }\n    }\n\n    return result;\n  }\n  \n  facet.keys = function(k) {\n    keys = vg.array(k).map(vg.accessor);\n    return facet;\n  };\n  \n  facet.sort = function(s) {\n    sort = vg.data.sort().by(s);\n    return facet;\n  };\n\n  return facet;\n};vg.data.filter = function() {\n\n  var test = null;\n\n  function filter(data) {\n    return test ? data.filter(test) : data;\n  }\n  \n  filter.test = function(func) {\n    test = vg.isFunction(func) ? func : vg.parse.expr(func);\n    return filter;\n  };\n\n  return filter;\n};vg.data.flatten = function() {\n    \n  function flatten(data) {\n    return flat(data, []);\n  }\n  \n  function flat(data, list) {\n    if (data.values) {\n      for (var i=0, n=data.values.length; i<n; ++i) {\n        flat(data.values[i], list);\n      }\n    } else {\n      list.push(data);\n    }\n    return list;\n  }\n  \n  return flatten;\n};vg.data.fold = function() {\n  var fields = [],\n      accessors = [],\n      output = {\n        key: \"key\",\n        value: \"value\"\n      };\n\n  function fold(data) {\n    var values = [],\n        item, i, j, n, m = fields.length;\n\n    for (i=0, n=data.length; i<n; ++i) {\n      item = data[i];\n      for (j=0; j<m; ++j) {\n        var o = {\n          index: values.length,\n          data: item.data\n        };\n        o[output.key] = fields[j];\n        o[output.value] = accessors[j](item);\n        values.push(o);\n      }\n    }\n\n    return values;\n  }  \n\n  fold.fields = function(f) {\n    fields = vg.array(f);\n    accessors = fields.map(vg.accessor);\n    return fold;\n  };\n\n  fold.output = function(map) {\n    vg.keys(output).forEach(function(k) {\n      if (map[k] !== undefined) {\n        output[k] = map[k];\n      }\n    });\n    return fold;\n  };\n\n  return fold;\n};vg.data.force = function() {\n  var layout = d3.layout.force(),\n      links = null,\n      linkDistance = 20,\n      linkStrength = 1,\n      charge = -30,\n      iterations = 500,\n      size = [\"width\", \"height\"],\n      params = [\n        \"friction\",\n        \"theta\",\n        \"gravity\",\n        \"alpha\"\n      ];\n\n  function force(data, db, group) {    \n    layout\n      .size(vg.data.size(size, group))\n      .nodes(data);\n      \n    if (links && db[links]) {\n      layout.links(db[links]);\n    }\n\n    layout.start();      \n    for (var i=0; i<iterations; ++i) {\n      layout.tick();\n    }\n    layout.stop();\n    \n    return data;\n  }\n\n  force.links = function(dataSetName) {\n    links = dataSetName;\n    return force;\n  };\n  \n  force.size = function(sz) {\n    size = sz;\n    return force;\n  };\n       \n  force.linkDistance = function(field) {\n    linkDistance = typeof field === 'number'\n      ? field\n      : vg.accessor(field);\n    layout.linkDistance(linkDistance);\n    return force;\n  };\n\n  force.linkStrength = function(field) {\n    linkStrength = typeof field === 'number'\n      ? field\n      : vg.accessor(field);\n    layout.linkStrength(linkStrength);\n    return force;\n  };\n  \n  force.charge = function(field) {\n    charge = typeof field === 'number'\n      ? field\n      : vg.accessor(field);\n    layout.charge(charge);\n    return force;\n  };\n  \n  force.iterations = function(iter) {\n    iterations = iter;\n    return force;\n  };\n\n  params.forEach(function(name) {\n    force[name] = function(x) {\n      layout[name](x);\n      return force;\n    }\n  });\n\n  return force;\n};\n\nvg.data.force.dependencies = [\"links\"];vg.data.formula = (function() {\n  \n  return function() {\n    var field = null,\n        expr = vg.identity;\n  \n    var formula = vg.data.mapper(function(d, i, list) {\n      if (field) d[field] = expr.call(null, d, i, list);\n      return d;\n    });\n\n    formula.field = function(name) {\n      field = name;\n      return formula;\n    };\n  \n    formula.expr = function(func) {\n      expr = vg.isFunction(func) ? func : vg.parse.expr(func);\n      return formula;\n    };\n\n    return formula;\n  };\n})();vg.data.geo = (function() {\n  var params = [\n    \"center\",\n    \"scale\",\n    \"translate\",\n    \"rotate\",\n    \"precision\",\n    \"clipAngle\"\n  ];\n\n  function geo() {\n    var opt = {},\n        projection = \"mercator\",\n        func = d3.geo[projection](),\n        lat = vg.identity,\n        lon = vg.identity,\n        output = {\n          \"x\": \"x\",\n          \"y\": \"y\"\n        };\n    \n    var map = vg.data.mapper(function(d) {\n      var ll = [lon(d), lat(d)],\n          xy = func(ll);\n      d[output.x] = xy[0];\n      d[output.y] = xy[1];\n      return d;\n    });\n\n    map.func = function() {\n      return func;\n    };\n        \n    map.projection = function(p) {\n      if (projection !== p) {\n        projection = p;\n        func = d3.geo[projection]();\n        for (var name in opt) {\n          func[name](opt[name]);\n        }\n      }\n      return map;\n    };\n\n    params.forEach(function(name) {\n      map[name] = function(x) {\n        opt[name] = x;\n        func[name](x);\n        return map;\n      }\n    });\n    \n    map.lon = function(field) {\n      lon = vg.accessor(field);\n      return map;\n    };\n\n    map.lat = function(field) {\n      lat = vg.accessor(field);\n      return map;\n    };\n    \n    map.output = function(map) {\n      vg.keys(output).forEach(function(k) {\n        if (map[k] !== undefined) {\n          output[k] = map[k];\n        }\n      });\n      return map;\n    };\n    \n    \n    return map;\n  };\n  \n  geo.params = params;\n  return geo;\n})();vg.data.geopath = function() {\n  var geopath = d3.geo.path().projection(d3.geo.mercator()),\n      projection = \"mercator\",\n      geojson = vg.identity,\n      opt = {},\n      output = {\"path\": \"path\"};\n\n  var map = vg.data.mapper(function(d) {\n    d[output.path] = geopath(geojson(d));\n    return d;\n  });\n  \n  map.projection = function(proj) {\n    if (projection !== proj) {\n      projection = proj;\n      var p = d3.geo[projection]();\n      for (var name in opt) {\n        p[name](opt[name]);\n      }\n      geopath.projection(p);\n    }\n    return map;\n  };\n  \n  vg.data.geo.params.forEach(function(name) {\n    map[name] = function(x) {\n      opt[name] = x;\n      (geopath.projection())[name](x);\n      return map;\n    }\n  });\n   \n  map.value = function(field) {\n    geojson = vg.accessor(field);\n    return map;\n  };\n\n  map.output = function(map) {\n    vg.keys(output).forEach(function(k) {\n      if (map[k] !== undefined) {\n        output[k] = map[k];\n      }\n    });\n    return map;\n  };\n\n  return map;\n};vg.data.link = function() {\n  var shape = \"line\",\n      source = vg.accessor(\"source\"),\n      target = vg.accessor(\"target\"),\n      tension = 0.2,\n      output = {\"path\": \"path\"};\n  \n  function line(d) {\n    var s = source(d),\n        t = target(d);\n    return \"M\" + s.x + \",\" + s.y \n         + \"L\" + t.x + \",\" + t.y;\n  }\n\n  function curve(d) {\n    var s = source(d),\n        t = target(d),\n        dx = t.x - s.x,\n        dy = t.y - s.y,\n        ix = tension * (dx + dy),\n        iy = tension * (dy - dx);\n    return \"M\" + s.x + \",\" + s.y\n         + \"C\" + (s.x+ix) + \",\" + (s.y+iy)\n         + \" \" + (t.x+iy) + \",\" + (t.y-ix)\n         + \" \" + t.x + \",\" + t.y;\n  }\n  \n  function diagonalX(d) {\n    var s = source(d),\n        t = target(d),\n        m = (s.x + t.x) / 2;\n    return \"M\" + s.x + \",\" + s.y\n         + \"C\" + m   + \",\" + s.y\n         + \" \" + m   + \",\" + t.y\n         + \" \" + t.x + \",\" + t.y;\n  }\n\n  function diagonalY(d) {\n    var s = source(d),\n        t = target(d),\n        m = (s.y + t.y) / 2;\n    return \"M\" + s.x + \",\" + s.y\n         + \"C\" + s.x + \",\" + m\n         + \" \" + t.x + \",\" + m\n         + \" \" + t.x + \",\" + t.y;\n  }\n\n  var shapes = {\n    line:      line,\n    curve:     curve,\n    diagonal:  diagonalX,\n    diagonalX: diagonalX,\n    diagonalY: diagonalY\n  };\n  \n  function link(data) {\n    var path = shapes[shape];\n        \n    data.forEach(function(d) {\n      d[output.path] = path(d);\n    });\n    \n    return data;\n  }\n\n  link.shape = function(val) {\n    shape = val;\n    return link;\n  };\n\n  link.tension = function(val) {\n    tension = val;\n    return link;\n  };\n  \n  link.source = function(field) {\n    source = vg.accessor(field);\n    return link;\n  };\n  \n  link.target = function(field) {\n    target = vg.accessor(field);\n    return link;\n  };\n  \n  link.output = function(map) {\n    vg.keys(output).forEach(function(k) {\n      if (map[k] !== undefined) {\n        output[k] = map[k];\n      }\n    });\n    return link;\n  };\n  \n  return link;\n};vg.data.pie = function() {\n  var one = function() { return 1; },\n      value = one,\n      start = 0,\n      end = 2 * Math.PI,\n      sort = false,\n      output = {\n        \"startAngle\": \"startAngle\",\n        \"endAngle\": \"endAngle\",\n        \"midAngle\": \"midAngle\"\n      };\n\n  function pie(data) {\n    var values = data.map(function(d, i) { return +value(d); }),\n        a = start,\n        k = (end - start) / d3.sum(values),\n        index = d3.range(data.length);\n    \n    if (sort) {\n      index.sort(function(a, b) {\n        return values[a] - values[b];\n      });\n    }\n    \n    index.forEach(function(i) {\n      var d;\n      data[i].value = (d = values[i]);\n      data[i][output.startAngle] = a;\n      data[i][output.midAngle] = (a + 0.5 * d * k);\n      data[i][output.endAngle] = (a += d * k);\n    });\n    \n    return data;\n  }\n\n  pie.sort = function(b) {\n    sort = b;\n    return pie;\n  };\n       \n  pie.value = function(field) {\n    value = field ? vg.accessor(field) : one;\n    return pie;\n  };\n  \n  pie.startAngle = function(startAngle) {\n    start = Math.PI * startAngle / 180;\n    return pie;\n  };\n  \n  pie.endAngle = function(endAngle) {\n    end = Math.PI * endAngle / 180;\n    return pie;\n  };\n\n  pie.output = function(map) {\n    vg.keys(output).forEach(function(k) {\n      if (map[k] !== undefined) {\n        output[k] = map[k];\n      }\n    });\n    return pie;\n  };\n\n  return pie;\n};vg.data.slice = function() {\n  var by = null,\n      field = vg.accessor(\"data\");\n\n  function slice(data) {\n    data = vg.values(data);\n    \n    if (by === \"min\") {\n      data = [data[vg.minIndex(data, field)]];\n    } else if (by === \"max\") {\n      data = [data[vg.maxIndex(data, field)]];\n    } else if (by === \"median\") {\n      var list = data.slice().sort(function(a,b) {\n        a = field(a); b = field(b);\n        return a < b ? -1 : a > b ? 1 : 0;\n      });\n      data = [data[~~(list.length/2)]];\n    } else {\n      var idx = vg.array(by);\n      data = data.slice(idx[0], idx[1]);\n    }\n    return data;\n  }\n  \n  slice.by = function(x) {\n    by = x;\n    return slice;\n  };\n  \n  slice.field = function(f) {\n    field = vg.accessor(f);\n    return slice;\n  };\n\n  return slice;\n};vg.data.sort = function() {\n  var by = null;\n\n  function sort(data) {\n    data = (vg.isArray(data) ? data : data.values || []);\n    data.sort(by);\n    for (var i=0, n=data.length; i<n; ++i) data[i].index = i; // re-index\n    return data;\n  }\n  \n  sort.by = function(s) {\n    by = vg.comparator(s);\n    return sort;\n  };\n\n  return sort;\n};vg.data.stack = function() {\n  var layout = d3.layout.stack(),\n      point = vg.accessor(\"index\"),\n      height = vg.accessor(\"data\"),\n      params = [\"offset\", \"order\"],\n      output = {\n        \"y0\": \"y2\",\n        \"y1\": \"y\",\n        \"cy\": \"cy\"\n      };\n\n  function stack(data) {\n    var out_y0 = output[\"y0\"],\n        out_y1 = output[\"y1\"],\n        out_cy = output[\"cy\"];\n    \n    var series = stacks(data);\n    if (series.length === 0) return data;\n    \n    layout.out(function(d, y0, y) {\n      if (d.datum) {\n        d.datum[out_y0] = y0;\n        d.datum[out_y1] = y + y0;\n        d.datum[out_cy] = y0 + y/2;\n      }\n    })(series);\n    \n    return data;\n  }\n  \n  function stacks(data) {\n    var values = vg.values(data),\n        points = [], series = [],\n        a, i, n, j, m, k, p, v, x;\n\n    // exit early if no data\n    if (values.length === 0) return series;\n\n    // collect and sort data points\n    for (i=0, n=values.length; i<n; ++i) {\n      a = vg.values(values[i]);\n      for (j=0, m=a.length; j<m; ++j) {\n        points.push({x:point(a[j]), y:height(a[j]), z:i, datum:a[j]});\n      }\n      series.push([]);\n    }\n    points.sort(function(a,b) {\n      return a.x<b.x ? -1 : a.x>b.x ? 1 : (a.z<b.z ? -1 : a.z>b.z ? 1 : 0);\n    });\n\n    // emit data series for stack layout\n    for (x=points[0].x, i=0, j=0, k=0, n=points.length; k<n; ++k) {\n      p = points[k];    \n      if (p.x !== x) {\n        while (i < series.length) series[i++].push({x:j, y:0});\n        x = p.x; i = 0; j += 1;\n      }\n      while (p.z > i) series[i++].push({x:j, y:0});\n      p.x = j;\n      series[i++].push(p);\n    }\n    while (i < series.length) series[i++].push({x:j, y:0});\n\n    return series;\n  }\n       \n  stack.point = function(field) {\n    point = vg.accessor(field);\n    return stack;\n  };\n  \n  stack.height = function(field) {\n    height = vg.accessor(field);\n    return stack;\n  };\n\n  params.forEach(function(name) {\n    stack[name] = function(x) {\n      layout[name](x);\n      return stack;\n    }\n  });\n\n  stack.output = function(map) {\n    d3.keys(output).forEach(function(k) {\n      if (map[k] !== undefined) {\n        output[k] = map[k];\n      }\n    });\n    return stack;\n  };\n\n  return stack;\n};vg.data.stats = function() {\n  var value = vg.accessor(\"data\"),\n      assign = false,\n      median = false,\n      output = {\n        \"count\":    \"count\",\n        \"min\":      \"min\",\n        \"max\":      \"max\",\n        \"sum\":      \"sum\",\n        \"mean\":     \"mean\",\n        \"variance\": \"variance\",\n        \"stdev\":    \"stdev\",\n        \"median\":   \"median\"\n      };\n\n  function reduce(data) {\n    var min = +Infinity,\n        max = -Infinity,\n        sum = 0,\n        mean = 0,\n        M2 = 0,\n        i, len, v, delta;\n\n    var list = (vg.isArray(data) ? data : data.values || []).map(value);\n\n    // compute aggregates\n    for (i=0, len=list.length; i<len; ++i) {\n      v = list[i];\n      if (v < min) min = v;\n      if (v > max) max = v;\n      sum += v;\n      delta = v - mean;\n      mean = mean + delta / (i+1);\n      M2 = M2 + delta * (v - mean);\n    }\n    M2 = M2 / (len - 1);\n\n    var o = vg.isArray(data) ? {} : data;\n    if (median) {\n      list.sort(vg.numcmp);\n      i = list.length >> 1;\n      o[output.median] = list.length % 2\n        ? list[i]\n        : (list[i-1] + list[i])/2;\n    }\n    o[output.count] = len;\n    o[output.min] = min;\n    o[output.max] = max;\n    o[output.sum] = sum;\n    o[output.mean] = mean;\n    o[output.variance] = M2;\n    o[output.stdev] = Math.sqrt(M2);\n\n    if (assign) {\n      list = (vg.isArray(data) ? data : data.values);\n      v = {};\n      v[output.count] = len;\n      v[output.min] = min;\n      v[output.max] = max;\n      v[output.sum] = sum;\n      v[output.mean] = mean;\n      v[output.variance] = M2;\n      v[output.stdev] = Math.sqrt(M2);\n      if (median) v[output.median] = o[output.median];\n      for (i=0, len=list.length; i<len; ++i) {\n        list[i].stats = v;\n      }\n      if (vg.isArray(data)) o = list;\n    }\n\n    return o;\n  }\n\n  function stats(data) {\n    if (vg.isArray(data)) {\n      return reduce(data);\n    } else {\n      return (data.values || []).map(reduce);\n    }\n  }\n\n  stats.median = function(bool) {\n    median = bool || false;\n    return stats;\n  };\n\n  stats.value = function(field) {\n    value = vg.accessor(field);\n    return stats;\n  };\n\n  stats.assign = function(b) {\n    assign = b;\n    return stats;\n  };\n\n  stats.output = function(map) {\n    vg.keys(output).forEach(function(k) {\n      if (map[k] !== undefined) {\n        output[k] = map[k];\n      }\n    });\n    return stats;\n  };\n\n  return stats;\n};vg.data.treemap = function() {\n  var layout = d3.layout.treemap()\n                 .children(function(d) { return d.values; }),\n      value = vg.accessor(\"data\"),\n      size = [\"width\", \"height\"],\n      params = [\"round\", \"sticky\", \"ratio\", \"padding\"],\n      output = {\n        \"x\": \"x\",\n        \"y\": \"y\",\n        \"dx\": \"width\",\n        \"dy\": \"height\"\n      };\n\n  function treemap(data, db, group) {\n    data = layout\n      .size(vg.data.size(size, group))\n      .value(value)\n      .nodes(vg.isTree(data) ? data : {values: data});\n    \n    var keys = vg.keys(output),\n        len = keys.length;\n    data.forEach(function(d) {\n      var key, val;\n      for (var i=0; i<len; ++i) {\n        key = keys[i];\n        if (key !== output[key]) {\n          val = d[key];\n          delete d[key];\n          d[output[key]] = val;\n        }\n      }\n    });\n    \n    return data;\n  }\n\n  treemap.size = function(sz) {\n    size = sz;\n    return treemap;\n  };\n\n  treemap.value = function(field) {\n    value = vg.accessor(field);\n    return treemap;\n  };\n\n  params.forEach(function(name) {\n    treemap[name] = function(x) {\n      layout[name](x);\n      return treemap;\n    }\n  });\n\n  treemap.output = function(map) {\n    vg.keys(output).forEach(function(k) {\n      if (map[k] !== undefined) {\n        output[k] = map[k];\n      }\n    });\n    return treemap;\n  };\n\n  return treemap;\n};vg.data.truncate = function() {\n  var value = vg.accessor(\"data\"),\n      as = \"truncate\",\n      position = \"right\",\n      ellipsis = \"...\",\n      wordBreak = true,\n      limit = 100;\n  \n  var truncate = vg.data.mapper(function(d) {\n    var text = vg.truncate(value(d), limit, position, wordBreak, ellipsis);\n    return (d[as] = text, d);\n  });\n\n  truncate.value = function(field) {\n    value = vg.accessor(field);\n    return truncate;\n  };\n  \n  truncate.output = function(field) {\n    as = field;\n    return truncate;\n  };\n\n  truncate.limit = function(len) {\n    limit = +len;\n    return truncate;\n  };\n  \n  truncate.position = function(pos) {\n    position = pos;\n    return truncate;\n  };\n\n  truncate.ellipsis = function(str) {\n    ellipsis = str+\"\";\n    return truncate;\n  };\n\n  truncate.wordbreak = function(b) {\n    wordBreak = !!b;\n    return truncate;\n  };\n\n  return truncate;\n};vg.data.unique = function() {\n\n  var field = null,\n      as = \"field\";\n\n  function unique(data) {\n    return vg.unique(data, field)\n      .map(function(x) {\n        var o = {};\n        o[as] = x;\n        return o;\n      });\n  }\n  \n  unique.field = function(f) {\n    field = vg.accessor(f);\n    return unique;\n  };\n  \n  unique.as = function(x) {\n    as = x;\n    return unique;\n  };\n\n  return unique;\n};vg.data.window = function() {\n\n  var size = 2,\n      step = 1;\n  \n  function win(data) {\n    data = vg.isArray(data) ? data : data.values || [];\n    var runs = [], i, j, n=data.length-size, curr;\n    for (i=0; i<=n; i+=step) {\n      for (j=0, curr=[]; j<size; ++j) curr.push(data[i+j]);\n      runs.push({key: i, values: curr});\n    }\n    return {values: runs};\n  }\n  \n  win.size = function(n) {\n    size = n;\n    return win;\n  };\n  \n  win.step = function(n) {\n    step = n;\n    return win;\n  };\n\n  return win;\n};vg.data.wordcloud = function() {\n  var layout = d3.layout.cloud().size([900, 500]),\n      text = vg.accessor(\"data\"),\n      size = [\"width\", \"height\"],\n      fontSize = function() { return 14; },\n      rotate = function() { return 0; },\n      params = [\"font\", \"fontStyle\", \"fontWeight\", \"padding\"];\n  \n  var output = {\n    \"x\": \"x\",\n    \"y\": \"y\",\n    \"size\": \"fontSize\",\n    \"font\": \"font\",\n    \"rotate\": \"angle\"\n  };\n  \n  function cloud(data, db, group) {\n    function finish(tags, bounds) {\n      var size = layout.size(),\n          dx = size[0] / 2,\n          dy = size[1] / 2,\n          keys = vg.keys(output),\n          key, d, i, n, k, m = keys.length;\n\n      // sort data to match wordcloud order\n      data.sort(function(a,b) {\n        return fontSize(b) - fontSize(a);\n      });\n\n      for (i=0, n=tags.length; i<n; ++i) {\n        d = data[i];\n        for (k=0; k<m; ++k) {\n          key = keys[k];\n          d[output[key]] = tags[i][key];\n          if (key === \"x\") d[output.x] += dx;\n          if (key === \"y\") d[output.y] += dy;\n        }\n      }\n    }\n    \n    layout\n      .size(vg.data.size(size, group))\n      .text(text)\n      .fontSize(fontSize)\n      .rotate(rotate)\n      .words(data)\n      .on(\"end\", finish)\n      .start();\n    return data;\n  }\n\n  cloud.text = function(field) {\n    text = vg.accessor(field);\n    return cloud;\n  };\n  \n  cloud.size = function(sz) {\n    size = sz;\n    return cloud;\n  };\n         \n  cloud.fontSize = function(field) {\n    fontSize = vg.accessor(field);\n    return cloud;\n  };\n  \n  cloud.rotate = function(x) {\n    var v;\n    if (vg.isObject(x) && !Array.isArray(x)) {\n      if (x.random !== undefined) {\n        v = (v = x.random) ? vg.array(v) : [0];\n        rotate = function() {\n          return v[~~(Math.random()*v.length-0.00001)];\n        };\n      } else if (x.alternate !== undefined) {\n        v = (v = x.alternate) ? vg.array(v) : [0];\n        rotate = function(d, i) {\n          return v[i % v.length];\n        };\n      }\n    } else {\n      rotate = vg.accessor(field);\n    }\n    return cloud;\n  };\n\n  params.forEach(function(name) {\n    cloud[name] = function(x) {\n      layout[name](x);\n      return cloud;\n    }\n  });\n\n  cloud.output = function(map) {\n    vg.keys(output).forEach(function(k) {\n      if (map[k] !== undefined) {\n        output[k] = map[k];\n      }\n    });\n    return cloud;\n  };\n  \n  return cloud;\n};vg.data.zip = function() {\n  var z = null,\n      as = \"zip\",\n      key = vg.accessor(\"data\"),\n      defaultValue = undefined,\n      withKey = null;\n\n  function zip(data, db) {\n    var zdata = db[z], zlen = zdata.length, v, d, i, len, map;\n    \n    if (withKey) {\n      map = {};\n      zdata.forEach(function(s) { map[withKey(s)] = s; });\n    }\n    \n    for (i=0, len=data.length; i<len; ++i) {\n      d = data[i];\n      d[as] = map\n        ? ((v=map[key(d)]) != null ? v : defaultValue)\n        : zdata[i % zlen];\n    }\n    \n    return data;\n  }\n\n  zip[\"with\"] = function(d) {\n    z = d;\n    return zip;\n  };\n  \n  zip[\"default\"] = function(d) {\n    defaultValue = d;\n    return zip;\n  };\n\n  zip.as = function(name) {\n    as = name;\n    return zip;\n  };\n\n  zip.key = function(k) {\n    key = vg.accessor(k);\n    return zip;\n  };\n\n  zip.withKey = function(k) {\n    withKey = vg.accessor(k);\n    return zip;\n  };\n\n  return zip;\n};\n\nvg.data.zip.dependencies = [\"with\"];vg.parse = {};vg.parse.axes = (function() {\n  var ORIENT = {\n    \"x\":      \"bottom\",\n    \"y\":      \"left\",\n    \"top\":    \"top\",\n    \"bottom\": \"bottom\",\n    \"left\":   \"left\",\n    \"right\":  \"right\"\n  };\n\n  function axes(spec, axes, scales) {\n    (spec || []).forEach(function(def, index) {\n      axes[index] = axes[index] || vg.scene.axis();\n      axis(def, index, axes[index], scales);\n    });\n  };\n\n  function axis(def, index, axis, scales) {\n    // axis scale\n    if (def.scale !== undefined) {\n      axis.scale(scales[def.scale]);\n    }\n\n    // axis orientation\n    axis.orient(def.orient || ORIENT[def.type]);\n    // axis offset\n    axis.offset(def.offset || 0);\n    // axis layer\n    axis.layer(def.layer || \"front\");\n    // axis grid lines\n    axis.grid(def.grid || false);\n    // axis title\n    axis.title(def.title || null);\n    // axis title offset\n    axis.titleOffset(def.titleOffset != null\n      ? def.titleOffset : vg.config.axis.titleOffset);\n    // axis values\n    axis.tickValues(def.values || null);\n    // axis label formatting\n    axis.tickFormat(def.format || null);\n    // axis tick subdivision\n    axis.tickSubdivide(def.subdivide || 0);\n    // axis tick padding\n    axis.tickPadding(def.tickPadding || vg.config.axis.padding);\n\n    // axis tick size(s)\n    var size = [];\n    if (def.tickSize !== undefined) {\n      for (var i=0; i<3; ++i) size.push(def.tickSize);\n    } else {\n      var ts = vg.config.axis.tickSize;\n      size = [ts, ts, ts];\n    }\n    if (def.tickSizeMajor != null) size[0] = def.tickSizeMajor;\n    if (def.tickSizeMinor != null) size[1] = def.tickSizeMinor;\n    if (def.tickSizeEnd   != null) size[2] = def.tickSizeEnd;\n    if (size.length) {\n      axis.tickSize.apply(axis, size);\n    }\n\n    // tick arguments\n    if (def.ticks != null) {\n      var ticks = vg.isArray(def.ticks) ? def.ticks : [def.ticks];\n      axis.ticks.apply(axis, ticks);\n    } else {\n      axis.ticks(vg.config.axis.ticks);\n    }\n\n    // style properties\n    var p = def.properties;\n    if (p && p.ticks) {\n      axis.majorTickProperties(p.majorTicks\n        ? vg.extend({}, p.ticks, p.majorTicks) : p.ticks);\n      axis.minorTickProperties(p.minorTicks\n        ? vg.extend({}, p.ticks, p.minorTicks) : p.ticks);\n    } else {\n      axis.majorTickProperties(p && p.majorTicks || {});\n      axis.minorTickProperties(p && p.minorTicks || {});\n    }\n    axis.tickLabelProperties(p && p.labels || {});\n    axis.titleProperties(p && p.title || {});\n    axis.gridLineProperties(p && p.grid || {});\n    axis.domainProperties(p && p.axis || {});\n  }\n\n  return axes;\n})();\nvg.parse.data = function(spec, callback) {\n  var model = {\n    defs: spec,\n    load: {},\n    flow: {},\n    deps: {},\n    source: {},\n    sorted: null\n  };\n\n  var count = 0;\n  \n  function load(d) {\n    return function(error, data) {\n      if (error) {\n        vg.error(\"LOADING FAILED: \" + d.url);\n      } else {\n        model.load[d.name] = vg.data.read(data.toString(), d.format);\n      }\n      if (--count === 0) callback();\n    }\n  }\n  \n  // process each data set definition\n  (spec || []).forEach(function(d) {\n    if (d.url) {\n      count += 1;\n      vg.data.load(d.url, load(d)); \n    } else if (d.values) {\n      model.load[d.name] = vg.data.read(d.values, d.format);\n    } else if (d.source) {\n      (model.source[d.source] || (model.source[d.source] = [])).push(d.name);\n    }\n    \n    if (d.transform) {\n      var flow = vg.parse.dataflow(d);\n      model.flow[d.name] = flow;\n      flow.dependencies.forEach(function(dep) {\n        (model.deps[dep] || (model.deps[dep] = [])).push(d.name);\n      });\n    }\n  });\n  \n  // topological sort by dependencies\n  var names = (spec || []).map(vg.accessor(\"name\")),\n      order = [], v = {}, n;\n  function visit(n) {\n    if (v[n] === 1) return; // not a DAG!\n    if (!v[n]) {\n      v[n] = 1;\n      (model.source[n] || []).forEach(visit);\n      (model.deps[n] || []).forEach(visit);\n      v[n] = 2;\n      order.push(n);\n    }\n  }\n  while (names.length) { if (v[n=names.pop()] !== 2) visit(n); }\n  model.sorted = order.reverse();\n  \n  if (count === 0) setTimeout(callback, 1);\n  return model;\n};vg.parse.dataflow = function(def) {\n  var tx = (def.transform || []).map(vg.parse.transform),\n      df = tx.length\n        ? function(data, db, group) {\n            return tx.reduce(function(d,t) { return t(d,db,group); }, data);\n          }\n        : vg.identity;\n  df.transforms = tx;\n  df.dependencies = vg.keys((def.transform || [])\n    .reduce(function(map, tdef) {\n      var deps = vg.data[tdef.type].dependencies;\n      if (deps) deps.forEach(function(d) {\n        if (tdef[d]) map[tdef[d]] = 1;\n      });\n      return map;\n    }, {}));\n  return df;\n};vg.parse.expr = (function() {\n\n  var CONSTANT = {\n  \t\"E\":       \"Math.E\",\n  \t\"LN2\":     \"Math.LN2\",\n  \t\"LN10\":    \"Math.LN10\",\n  \t\"LOG2E\":   \"Math.LOG2E\",\n  \t\"LOG10E\":  \"Math.LOG10E\",\n  \t\"PI\":      \"Math.PI\",\n  \t\"SQRT1_2\": \"Math.SQRT1_2\",\n  \t\"SQRT2\":   \"Math.SQRT2\"\n  };\n\n  var FUNCTION = {\n  \t\"abs\":    \"Math.abs\",\n  \t\"acos\":   \"Math.acos\",\n  \t\"asin\":   \"Math.asin\",\n  \t\"atan\":   \"Math.atan\",\n  \t\"atan2\":  \"Math.atan2\",\n  \t\"ceil\":   \"Math.ceil\",\n  \t\"cos\":    \"Math.cos\",\n  \t\"exp\":    \"Math.exp\",\n  \t\"floor\":  \"Math.floor\",\n  \t\"log\":    \"Math.log\",\n  \t\"max\":    \"Math.max\",\n  \t\"min\":    \"Math.min\",\n  \t\"pow\":    \"Math.pow\",\n  \t\"random\": \"Math.random\",\n  \t\"round\":  \"Math.round\",\n  \t\"sin\":    \"Math.sin\",\n  \t\"sqrt\":   \"Math.sqrt\",\n  \t\"tan\":    \"Math.tan\"\n  };\n\n  var lexer = /([\\\"\\']|[\\=\\<\\>\\~\\&\\|\\?\\:\\+\\-\\/\\*\\%\\!\\^\\,\\;\\[\\]\\{\\}\\(\\) ]+)/;\n\n  return function(x) {\n    if (vg.config.safeMode) {\n      vg.error(\"Safe mode: Expression parsing disabled.\");\n      return vg.true;\n    }\n\n    var tokens = x.split(lexer),\n        t, v, i, n, sq, dq;\n\n    for (sq=0, dq=0, i=0, n=tokens.length; i<n; ++i) {\n      var t = tokens[i];\n      if (t===\"'\") { if (!dq) sq = !sq; continue; }\n      if (t==='\"') { if (!sq) dq = !dq; continue; }\n      if (dq || sq) continue;\n      if (CONSTANT[t]) {\n        tokens[i] = CONSTANT[t];\n      }\n      if (FUNCTION[t] && (v=tokens[i+1]) && v[0]===\"(\") {\n        tokens[i] = FUNCTION[t];\n      }\n    }\n\n    return Function(\"d\", \"index\", \"data\", \"return (\"+tokens.join(\"\")+\");\");\n  };\n\n})();vg.parse.legends = (function() {\n\n  function legends(spec, legends, scales) {\n    (spec || []).forEach(function(def, index) {\n      legends[index] = legends[index] || vg.scene.legend();\n      legend(def, index, legends[index], scales);\n    });\n  };\n\n  function legend(def, index, legend, scales) {\n    // legend scales\n    legend.size  (def.size   ? scales[def.size]   : null);\n    legend.shape (def.shape  ? scales[def.shape]  : null);\n    legend.fill  (def.fill   ? scales[def.fill]   : null);\n    legend.stroke(def.stroke ? scales[def.stroke] : null);\n\n    // legend orientation\n    if (def.orient) legend.orient(def.orient);\n\n    // legend offset\n    if (def.offset != null) legend.offset(def.offset);\n\n    // legend title\n    legend.title(def.title || null);\n\n    // legend values\n    legend.values(def.values || null);\n\n    // legend label formatting\n    legend.format(def.format !== undefined ? def.format : null);\n\n    // style properties\n    var p = def.properties;\n    legend.titleProperties(p && p.title || {});\n    legend.labelProperties(p && p.labels || {});\n    legend.legendProperties(p && p.legend || {});\n    legend.symbolProperties(p && p.symbols || {});\n    legend.gradientProperties(p && p.gradient || {});\n  }\n  \n  return legends;\n})();vg.parse.mark = function(mark) {\n  var props = mark.properties,\n      group = mark.marks;\n\n  // parse mark property definitions\n  vg.keys(props).forEach(function(k) {\n    props[k] = vg.parse.properties(mark.type, props[k]);\n  });\n\n  // parse delay function\n  if (mark.delay) {\n    mark.delay = vg.parse.properties(mark.type, {delay: mark.delay});\n  }\n\n  // parse mark data definition\n  if (mark.from) {\n    var name = mark.from.data,\n        tx = vg.parse.dataflow(mark.from);\n    mark.from = function(db, group, parentData) {\n      var data = vg.scene.data(name ? db[name] : null, parentData);\n      return tx(data, db, group);\n    };\n  }\n\n  // recurse if group type\n  if (group) {\n    mark.marks = group.map(vg.parse.mark);\n  }\n    \n  return mark;\n};vg.parse.marks = function(spec, width, height) {\n  return {\n    type: \"group\",\n    width: width,\n    height: height,\n    scales: spec.scales || [],\n    axes: spec.axes || [],\n    legends: spec.legends || [],\n    marks: (spec.marks || []).map(vg.parse.mark)\n  };\n};vg.parse.padding = function(pad) {\n  if (pad == null) return \"auto\";\n  else if (vg.isString(pad)) return pad===\"strict\" ? \"strict\" : \"auto\";\n  else if (vg.isObject(pad)) return pad;\n  var p = vg.isNumber(pad) ? pad : 20;\n  return {top:p, left:p, right:p, bottom:p};\n};\nvg.parse.properties = (function() {\n  function compile(mark, spec) {\n    var code = \"\",\n        names = vg.keys(spec),\n        i, len, name, ref, vars = {};\n        \n    code += \"var o = trans ? {} : item;\\n\"\n    \n    for (i=0, len=names.length; i<len; ++i) {\n      ref = spec[name = names[i]];\n      code += (i > 0) ? \"\\n  \" : \"  \";\n      code += \"o.\"+name+\" = \"+valueRef(name, ref)+\";\";\n      vars[name] = true;\n    }\n    \n    if (vars.x2) {\n      if (vars.x) {\n        code += \"\\n  if (o.x > o.x2) { \"\n              + \"var t = o.x; o.x = o.x2; o.x2 = t; };\";\n        code += \"\\n  o.width = (o.x2 - o.x);\";\n      } else if (vars.width) {\n        code += \"\\n  o.x = (o.x2 - o.width);\";\n      } else {\n        code += \"\\n  o.x = o.x2;\"\n      }\n    }\n\n    if (vars.y2) {\n      if (vars.y) {\n        code += \"\\n  if (o.y > o.y2) { \"\n              + \"var t = o.y; o.y = o.y2; o.y2 = t; };\";\n        code += \"\\n  o.height = (o.y2 - o.y);\";\n      } else if (vars.height) {\n        code += \"\\n  o.y = (o.y2 - o.height);\";\n      } else {\n        code += \"\\n  o.y = o.y2;\"\n      }\n    }\n    \n    if (hasPath(mark, vars)) code += \"\\n  item.touch();\";\n    code += \"\\n  if (trans) trans.interpolate(item, o);\";\n\n    try {\n      return Function(\"item\", \"group\", \"trans\", code);\n    } catch (e) {\n      vg.error(e);\n      vg.log(code);\n    }\n  }\n  \n  function hasPath(mark, vars) {\n    return vars.path ||\n      ((mark===\"area\" || mark===\"line\") &&\n        (vars.x || vars.x2 || vars.width ||\n         vars.y || vars.y2 || vars.height ||\n         vars.tension || vars.interpolate));\n  }\n  \n  var GROUP_VARS = {\n    \"width\": 1,\n    \"height\": 1,\n    \"mark.group.width\": 1,\n    \"mark.group.height\": 1\n  };\n\n  function valueRef(name, ref) {\n    if (ref == null) return null;\n    var isColor = name===\"fill\" || name===\"stroke\";\n\n    if (isColor) {\n      if (ref.c) {\n        return colorRef(\"hcl\", ref.h, ref.c, ref.l);\n      } else if (ref.h || ref.s) {\n        return colorRef(\"hsl\", ref.h, ref.s, ref.l);\n      } else if (ref.l || ref.a) {\n        return colorRef(\"lab\", ref.l, ref.a, ref.b);\n      } else if (ref.r || ref.g || ref.b) {\n        return colorRef(\"rgb\", ref.r, ref.g, ref.b);\n      }\n    }\n\n    // initialize value\n    var val = \"item.datum.data\";\n    if (ref.value !== undefined) {\n      val = vg.str(ref.value);\n    }\n\n    // get field reference for enclosing group\n    if (ref.group != null) {\n      var grp = \"group.datum\";\n      if (vg.isString(ref.group)) {\n        grp = GROUP_VARS[ref.group]\n          ? \"group.\" + ref.group\n          : \"group.datum[\"+vg.field(ref.group).map(vg.str).join(\"][\")+\"]\";\n      }\n    }\n\n    // get data field value\n    if (ref.field != null) {\n      if (vg.isString(ref.field)) {\n        val = \"item.datum[\"+vg.field(ref.field).map(vg.str).join(\"][\")+\"]\";\n        if (ref.group != null) { val = \"this.accessor(\"+val+\")(\"+grp+\")\"; }\n      } else {\n        val = \"this.accessor(group.datum[\"\n            + vg.field(ref.field.group).map(vg.str).join(\"][\")\n            + \"])(item.datum.data)\";\n      }\n    } else if (ref.group != null) {\n      val = grp;\n    }\n\n    // run through scale function\n    if (ref.scale != null) {\n      var scale = vg.isString(ref.scale)\n        ? vg.str(ref.scale)\n        : (ref.scale.group ? \"group\" : \"item\")\n          + \".datum[\" + vg.str(ref.scale.group || ref.scale.field) + \"]\";\n      scale = \"group.scales[\" + scale + \"]\";\n      val = scale + (ref.band ? \".rangeBand()\" : \"(\"+val+\")\");\n    }\n    \n    // multiply, offset, return value\n    val = \"(\" + (ref.mult?(vg.number(ref.mult)+\" * \"):\"\") + val + \")\"\n      + (ref.offset ? \" + \" + vg.number(ref.offset) : \"\");\n    return val;\n  }\n  \n  function colorRef(type, x, y, z) {\n    var xx = x ? valueRef(\"\", x) : vg.config.color[type][0],\n        yy = y ? valueRef(\"\", y) : vg.config.color[type][1],\n        zz = z ? valueRef(\"\", z) : vg.config.color[type][2];\n    return \"(this.d3.\" + type + \"(\" + [xx,yy,zz].join(\",\") + ') + \"\")';\n  }\n  \n  return compile;\n})();vg.parse.scales = (function() {\n  var LINEAR = \"linear\",\n      ORDINAL = \"ordinal\",\n      LOG = \"log\",\n      POWER = \"pow\",\n      TIME = \"time\",\n      QUANTILE = \"quantile\",\n      GROUP_PROPERTY = {width: 1, height: 1};\n\n  function scales(spec, scales, db, group) {\n    return (spec || []).reduce(function(o, def) {\n      var name = def.name, prev = name + \":prev\";\n      o[name] = scale(def, o[name], db, group);\n      o[prev] = o[prev] || o[name];\n      return o;\n    }, scales || {});\n  }\n\n  function scale(def, scale, db, group) {\n    var s = instance(def, scale),\n        m = s.type===ORDINAL ? ordinal : quantitative,\n        rng = range(def, group),\n        data = vg.values(group.datum);\n\n    m(def, s, rng, db, data);\n    return s;\n  }\n\n  function instance(def, scale) {\n    var type = def.type || LINEAR;\n    if (!scale || type !== scale.type) {\n      var ctor = vg.config.scale[type] || d3.scale[type];\n      if (!ctor) vg.error(\"Unrecognized scale type: \" + type);\n      (scale = ctor()).type = scale.type || type;\n      scale.scaleName = def.name;\n    }\n    return scale;\n  }\n\n  function ordinal(def, scale, rng, db, data) {\n    var domain, sort, str, refs, dataDrivenRange = false;\n    \n    // range pre-processing for data-driven ranges\n    if (vg.isObject(def.range) && !vg.isArray(def.range)) {\n      dataDrivenRange = true;\n      refs = def.range.fields || vg.array(def.range);\n      rng = extract(refs, db, data);\n    }\n    \n    // domain\n    sort = def.sort && !dataDrivenRange;\n    domain = domainValues(def, db, data, sort);\n    if (domain) scale.domain(domain);\n\n    // range\n    str = typeof rng[0] === 'string';\n    if (str || rng.length > 2 || rng.length===1 || dataDrivenRange) {\n      scale.range(rng); // color or shape values\n    } else if (def.points) {\n      scale.rangePoints(rng, def.padding||0);\n    } else if (def.round || def.round===undefined) {\n      scale.rangeRoundBands(rng, def.padding||0);\n    } else {\n      scale.rangeBands(rng, def.padding||0);\n    }\n  }\n\n  function quantitative(def, scale, rng, db, data) {\n    var domain, interval;\n\n    // domain\n    domain = (def.type === QUANTILE)\n      ? domainValues(def, db, data, false)\n      : domainMinMax(def, db, data);\n    scale.domain(domain);\n\n    // range\n    // vertical scales should flip by default, so use XOR here\n    if (def.range === \"height\") rng = rng.reverse();\n    scale[def.round && scale.rangeRound ? \"rangeRound\" : \"range\"](rng);\n\n    if (def.exponent && def.type===POWER) scale.exponent(def.exponent);\n    if (def.clamp) scale.clamp(true);\n    if (def.nice) {\n      if (def.type === TIME) {\n        interval = d3.time[def.nice];\n        if (!interval) vg.error(\"Unrecognized interval: \" + interval);\n        scale.nice(interval);\n      } else {\n        scale.nice();\n      }\n    }\n  }\n  \n  function extract(refs, db, data) {\n    return refs.reduce(function(values, r) {        \n      var dat = vg.values(db[r.data] || data),\n          get = vg.accessor(vg.isString(r.field)\n              ? r.field : \"data.\" + vg.accessor(r.field.group)(data));\n      return vg.unique(dat, get, values);\n    }, []);\n  }\n  \n  function domainValues(def, db, data, sort) {\n    var domain = def.domain, values, refs;\n    if (vg.isArray(domain)) {\n      values = sort ? domain.slice() : domain;\n    } else if (vg.isObject(domain)) {\n      refs = domain.fields || vg.array(domain);\n      values = extract(refs, db, data);\n    }\n    if (values && sort) values.sort(vg.cmp);\n    return values;\n  }\n  \n  function domainMinMax(def, db, data) {\n    var domain = [null, null], refs, z;\n    \n    function extract(ref, min, max, z) {\n      var dat = vg.values(db[ref.data] || data);\n      var fields = vg.array(ref.field).map(function(f) {\n        return vg.isString(f) ? f\n          : \"data.\" + vg.accessor(f.group)(data);\n      });\n      \n      fields.forEach(function(f,i) {\n        f = vg.accessor(f);\n        if (min) domain[0] = d3.min([domain[0], d3.min(dat, f)]);\n        if (max) domain[z] = d3.max([domain[z], d3.max(dat, f)]);\n      });\n    }\n\n    if (def.domain !== undefined) {\n      if (vg.isArray(def.domain)) {\n        domain = def.domain.slice();\n      } else if (vg.isObject(def.domain)) {\n        refs = def.domain.fields || vg.array(def.domain);\n        refs.forEach(function(r) { extract(r,1,1,1); });\n      } else {\n        domain = def.domain;\n      }\n    }\n    z = domain.length - 1;\n    if (def.domainMin !== undefined) {\n      if (vg.isObject(def.domainMin)) {\n        domain[0] = null;\n        refs = def.domainMin.fields || vg.array(def.domainMin);\n        refs.forEach(function(r) { extract(r,1,0,z); });\n      } else {\n        domain[0] = def.domainMin;\n      }\n    }\n    if (def.domainMax !== undefined) {\n      if (vg.isObject(def.domainMax)) {\n        domain[z] = null;\n        refs = def.domainMax.fields || vg.array(def.domainMax);\n        refs.forEach(function(r) { extract(r,0,1,z); });\n      } else {\n        domain[z] = def.domainMax;\n      }\n    }\n    if (def.type !== LOG && def.type !== TIME && (def.zero || def.zero===undefined)) {\n      domain[0] = Math.min(0, domain[0]);\n      domain[z] = Math.max(0, domain[z]);\n    }\n    return domain;\n  }\n\n  function range(def, group) {\n    var rng = [null, null];\n\n    if (def.range !== undefined) {\n      if (typeof def.range === 'string') {\n        if (GROUP_PROPERTY[def.range]) {\n          rng = [0, group[def.range]];\n        } else if (vg.config.range[def.range]) {\n          rng = vg.config.range[def.range];\n        } else {\n          vg.error(\"Unrecogized range: \"+def.range);\n          return rng;\n        }\n      } else if (vg.isArray(def.range)) {\n        rng = def.range;\n      } else if (vg.isObject(def.range)) {\n        return null; // early exit\n      } else {\n        rng = [0, def.range];\n      }\n    }\n    if (def.rangeMin !== undefined) {\n      rng[0] = def.rangeMin;\n    }\n    if (def.rangeMax !== undefined) {\n      rng[rng.length-1] = def.rangeMax;\n    }\n    \n    if (def.reverse !== undefined) {\n      var rev = def.reverse;\n      if (vg.isObject(rev)) {\n        rev = vg.accessor(rev.field)(group.datum);\n      }\n      if (rev) rng = rng.reverse();\n    }\n    \n    return rng;\n  }\n\n  return scales;\n})();\nvg.parse.spec = function(spec, callback, viewFactory) {\n  \n  viewFactory = viewFactory || vg.ViewFactory;\n  \n  function parse(spec) {\n    // protect against subsequent spec modification\n    spec = vg.duplicate(spec);\n    \n    var width = spec.width || 500,\n        height = spec.height || 500,\n        viewport = spec.viewport || null;\n    \n    var defs = {\n      width: width,\n      height: height,\n      viewport: viewport,\n      padding: vg.parse.padding(spec.padding),\n      marks: vg.parse.marks(spec, width, height),\n      data: vg.parse.data(spec.data, function() { callback(viewConstructor); })\n    };\n    \n    var viewConstructor = viewFactory(defs);\n  }\n  \n  vg.isObject(spec) ? parse(spec) :\n    d3.json(spec, function(error, json) {\n      error ? vg.error(error) : parse(json);\n    });\n};vg.parse.transform = function(def) {\n  var tx = vg.data[def.type]();\n      \n  vg.keys(def).forEach(function(k) {\n    if (k === 'type') return;\n    (tx[k])(def[k]);\n  });\n  \n  return tx;\n};vg.scene = {};\n\nvg.scene.GROUP  = \"group\",\nvg.scene.ENTER  = 0,\nvg.scene.UPDATE = 1,\nvg.scene.EXIT   = 2;\n\nvg.scene.DEFAULT_DATA = {\"sentinel\":1}\n\nvg.scene.data = function(data, parentData) {\n  var DEFAULT = vg.scene.DEFAULT_DATA;\n\n  // if data is undefined, inherit or use default\n  data = vg.values(data || parentData || [DEFAULT]);\n\n  // if inheriting default data, ensure its in an array\n  if (data === DEFAULT) data = [DEFAULT];\n  \n  return data;\n};\n\nvg.scene.fontString = function(o) {\n  return (o.fontStyle ? o.fontStyle + \" \" : \"\")\n    + (o.fontVariant ? o.fontVariant + \" \" : \"\")\n    + (o.fontWeight ? o.fontWeight + \" \" : \"\")\n    + (o.fontSize != null ? o.fontSize : vg.config.render.fontSize) + \"px \"\n    + (o.font || vg.config.render.font);\n};vg.scene.Item = (function() {\n  function item(mark) {\n    this.mark = mark;\n  }\n  \n  var prototype = item.prototype;\n\n  prototype.hasPropertySet = function(name) {\n    var props = this.mark.def.properties;\n    return props && props[name] != null;\n  };\n\n  prototype.cousin = function(offset, index) {\n    if (offset === 0) return this;\n    offset = offset || -1;\n    var mark = this.mark,\n        group = mark.group,\n        iidx = index==null ? mark.items.indexOf(this) : index,\n        midx = group.items.indexOf(mark) + offset;\n    return group.items[midx].items[iidx];\n  };\n  \n  prototype.sibling = function(offset) {\n    if (offset === 0) return this;\n    offset = offset || -1;\n    var mark = this.mark,\n        iidx = mark.items.indexOf(this) + offset;\n    return mark.items[iidx];\n  };\n  \n  prototype.remove = function() {\n    var item = this,\n        list = item.mark.items,\n        i = list.indexOf(item);\n    if (i >= 0) (i===list.length-1) ? list.pop() : list.splice(i, 1);\n    return item;\n  };\n  \n  prototype.touch = function() {\n    if (this.pathCache) this.pathCache = null;\n    if (this.mark.pathCache) this.mark.pathCache = null;\n  };\n  \n  return item;\n})();\n\nvg.scene.item = function(mark) {\n  return new vg.scene.Item(mark);\n};vg.scene.visit = function(node, func) {\n  var i, n, s, m, items;\n  if (func(node)) return true;\n\n  var sets = [\"items\", \"axisItems\", \"legendItems\"];\n  for (s=0, m=sets.length; s<m; ++s) {\n    if (items = node[sets[s]]) {\n      for (i=0, n=items.length; i<n; ++i) {\n        if (vg.scene.visit(items[i], func)) return true;\n      }\n    }\n  }\n};vg.scene.build = (function() {\n  var GROUP  = vg.scene.GROUP,\n      ENTER  = vg.scene.ENTER,\n      UPDATE = vg.scene.UPDATE,\n      EXIT   = vg.scene.EXIT,\n      DEFAULT= {\"sentinel\":1};\n  \n  function build(def, db, node, parentData, reentrant) {\n    var data = vg.scene.data(\n      def.from ? def.from(db, node, parentData) : null,\n      parentData);\n    \n    // build node and items\n    node = buildNode(def, node);\n    node.items = buildItems(def, data, node);\n    buildTrans(def, node);\n    \n    // recurse if group\n    if (def.type === GROUP) {\n      buildGroup(def, db, node, reentrant);\n    }\n    \n    return node;\n  };\n  \n  function buildNode(def, node) {\n    node = node || {};\n    node.def = def;\n    node.marktype = def.type;\n    node.interactive = !(def.interactive === false);\n    return node;\n  }\n  \n  function buildItems(def, data, node) {\n    var keyf = keyFunction(def.key),\n        prev = node.items || [],\n        next = [],\n        map = {},\n        i, key, len, item, datum, enter;\n\n    for (i=0, len=prev.length; i<len; ++i) {\n      item = prev[i];\n      item.status = EXIT;\n      if (keyf) map[item.key] = item;\n    }\n    \n    for (i=0, len=data.length; i<len; ++i) {\n      datum = data[i];\n      key = i;\n      item = keyf ? map[key = keyf(datum)] : prev[i];\n      enter = item ? false : (item = vg.scene.item(node), true);\n      item.status = enter ? ENTER : UPDATE;\n      item.datum = datum;\n      item.key = key;\n      next.push(item);\n    }\n\n    for (i=0, len=prev.length; i<len; ++i) {\n      item = prev[i];\n      if (item.status === EXIT) {\n        item.key = keyf ? item.key : next.length;\n        next.splice(item.index, 0, item);\n      }\n    }\n    \n    return next;\n  }\n  \n  function buildGroup(def, db, node, reentrant) {\n    var groups = node.items,\n        marks = def.marks,\n        i, len, m, mlen, name, group;\n\n    for (i=0, len=groups.length; i<len; ++i) {\n      group = groups[i];\n      \n      // update scales\n      if (!reentrant && group.scales) for (name in group.scales) {\n        if (name.indexOf(\":prev\") < 0) {\n          group.scales[name+\":prev\"] = group.scales[name].copy();\n        }\n      }\n\n      // build items\n      group.items = group.items || [];\n      for (m=0, mlen=marks.length; m<mlen; ++m) {\n        group.items[m] = build(marks[m], db, group.items[m], group.datum);\n        group.items[m].group = group;\n      }\n    }\n  }\n\n  function buildTrans(def, node) {\n    if (def.duration) node.duration = def.duration;\n    if (def.ease) node.ease = d3.ease(def.ease)\n    if (def.delay) {\n      var items = node.items, group = node.group, n = items.length, i;\n      for (i=0; i<n; ++i) def.delay.call(this, items[i], group);\n    }\n  }\n  \n  function keyFunction(key) {\n    if (key == null) return null;\n    var f = vg.array(key).map(vg.accessor);\n    return function(d) {\n      for (var s=\"\", i=0, n=f.length; i<n; ++i) {\n        if (i>0) s += \"|\";\n        s += String(f[i](d));\n      }\n      return s;\n    }\n  }\n  \n  return build;\n})();vg.scene.bounds = (function() {\n\n  var parse = vg.canvas.path.parse,\n      boundPath = vg.canvas.path.bounds,\n      areaPath = vg.canvas.path.area,\n      linePath = vg.canvas.path.line,\n      halfpi = Math.PI / 2,\n      sqrt3 = Math.sqrt(3),\n      tan30 = Math.tan(30 * Math.PI / 180),\n      gfx = null;\n\n  function context() {\n    return gfx || (gfx = (vg.config.isNode\n      ? new (require(\"canvas\"))(1,1)\n      : d3.select(\"body\").append(\"canvas\")\n          .attr(\"class\", \"vega_hidden\")\n          .attr(\"width\", 1)\n          .attr(\"height\", 1)\n          .style(\"display\", \"none\")\n          .node())\n      .getContext(\"2d\"));\n  }\n\n  function pathBounds(o, path, bounds) {\n    if (path == null) {\n      bounds.set(0, 0, 0, 0);\n    } else {\n      boundPath(path, bounds);\n      if (o.stroke && o.opacity !== 0 && o.strokeWidth > 0) {\n        bounds.expand(o.strokeWidth);\n      }\n    }\n    return bounds;\n  }\n\n  function path(o, bounds) {\n    var p = o.path\n      ? o.pathCache || (o.pathCache = parse(o.path))\n      : null;\n    return pathBounds(o, p, bounds);\n  }\n  \n  function area(o, bounds) {\n    var items = o.mark.items, o = items[0];\n    var p = o.pathCache || (o.pathCache = parse(areaPath(items)));\n    return pathBounds(items[0], p, bounds);\n  }\n\n  function line(o, bounds) {\n    var items = o.mark.items, o = items[0];\n    var p = o.pathCache || (o.pathCache = parse(linePath(items)));\n    return pathBounds(items[0], p, bounds);\n  }\n\n  function rect(o, bounds) {\n    var x = o.x || 0,\n        y = o.y || 0,\n        w = (x + o.width) || 0,\n        h = (y + o.height) || 0;\n    bounds.set(x, y, w, h);\n    if (o.stroke && o.opacity !== 0 && o.strokeWidth > 0) {\n      bounds.expand(o.strokeWidth);\n    }\n    return bounds;\n  }\n\n  function image(o, bounds) {\n    var w = o.width || 0,\n        h = o.height || 0,\n        x = (o.x||0) - (o.align === \"center\"\n            ? w/2 : (o.align === \"right\" ? w : 0)),\n        y = (o.y||0) - (o.baseline === \"middle\"\n            ? h/2 : (o.baseline === \"bottom\" ? h : 0));\n    return bounds.set(x, y, x+w, y+h);\n  }\n\n  function rule(o, bounds) {\n    var x1, y1;\n    bounds.set(\n      x1 = o.x || 0,\n      y1 = o.y || 0,\n      o.x2 != null ? o.x2 : x1,\n      o.y2 != null ? o.y2 : y1\n    );\n    if (o.stroke && o.opacity !== 0 && o.strokeWidth > 0) {\n      bounds.expand(o.strokeWidth);\n    }\n    return bounds;\n  }\n  \n  function arc(o, bounds) {\n    var cx = o.x || 0,\n        cy = o.y || 0,\n        ir = o.innerRadius || 0,\n        or = o.outerRadius || 0,\n        sa = (o.startAngle || 0) - halfpi,\n        ea = (o.endAngle || 0) - halfpi,\n        xmin = Infinity, xmax = -Infinity,\n        ymin = Infinity, ymax = -Infinity,\n        a, i, n, x, y, ix, iy, ox, oy;\n\n    var angles = [sa, ea],\n        s = sa - (sa%halfpi);\n    for (i=0; i<4 && s<ea; ++i, s+=halfpi) {\n      angles.push(s);\n    }\n\n    for (i=0, n=angles.length; i<n; ++i) {\n      a = angles[i];\n      x = Math.cos(a); ix = ir*x; ox = or*x;\n      y = Math.sin(a); iy = ir*y; oy = or*y;\n      xmin = Math.min(xmin, ix, ox);\n      xmax = Math.max(xmax, ix, ox);\n      ymin = Math.min(ymin, iy, oy);\n      ymax = Math.max(ymax, iy, oy);\n    }\n\n    bounds.set(cx+xmin, cy+ymin, cx+xmax, cy+ymax);\n    if (o.stroke && o.opacity !== 0 && o.strokeWidth > 0) {\n      bounds.expand(o.strokeWidth);\n    }\n    return bounds;\n  }\n\n  function symbol(o, bounds) {\n    var size = o.size != null ? o.size : 100,\n        x = o.x || 0,\n        y = o.y || 0,\n        r, t, rx, ry;\n\n    switch (o.shape) {\n      case \"cross\":\n        r = Math.sqrt(size / 5) / 2;\n        t = 3*r;\n        bounds.set(x-t, y-r, x+t, y+r);\n        break;\n\n      case \"diamond\":\n        ry = Math.sqrt(size / (2 * tan30));\n        rx = ry * tan30;\n        bounds.set(x-rx, y-ry, x+rx, y+ry);\n        break;\n\n      case \"square\":\n        t = Math.sqrt(size);\n        r = t / 2;\n        bounds.set(x-r, y-r, x+r, y+r);\n        break;\n\n      case \"triangle-down\":\n        rx = Math.sqrt(size / sqrt3);\n        ry = rx * sqrt3 / 2;\n        bounds.set(x-rx, y-ry, x+rx, y+ry);\n        break;\n\n      case \"triangle-up\":\n        rx = Math.sqrt(size / sqrt3);\n        ry = rx * sqrt3 / 2;\n        bounds.set(x-rx, y-ry, x+rx, y+ry);\n        break;\n\n      default:\n        r = Math.sqrt(size/Math.PI);\n        bounds.set(x-r, y-r, x+r, y+r);\n    }\n    if (o.stroke && o.opacity !== 0 && o.strokeWidth > 0) {\n      bounds.expand(o.strokeWidth);\n    }\n    return bounds;\n  }\n\n  function text(o, bounds, noRotate) {\n    var x = (o.x || 0) + (o.dx || 0),\n        y = (o.y || 0) + (o.dy || 0),\n        h = o.fontSize || vg.config.render.fontSize,\n        a = o.align,\n        b = o.baseline,\n        r = o.radius || 0,\n        g = context(), w, t;\n\n    g.font = vg.scene.fontString(o);\n    g.textAlign = a || \"left\";\n    g.textBaseline = b || \"alphabetic\";\n    w = g.measureText(o.text || \"\").width;\n\n    if (r) {\n      t = (o.theta || 0) - Math.PI/2;\n      x += r * Math.cos(t);\n      y += r * Math.sin(t);\n    }\n\n    // horizontal\n    if (a === \"center\") {\n      x = x - (w / 2);\n    } else if (a === \"right\") {\n      x = x - w;\n    } else {\n      // left by default, do nothing\n    }\n\n    /// TODO find a robust solution for heights.\n    /// These offsets work for some but not all fonts.\n\n    // vertical\n    if (b === \"top\") {\n      y = y + (h/5);\n    } else if (b === \"bottom\") {\n      y = y - h;\n    } else if (b === \"middle\") {\n      y = y - (h/2) + (h/10);\n    } else {\n      y = y - 4*h/5; // alphabetic by default\n    }\n    \n    bounds.set(x, y, x+w, y+h);\n    if (o.angle && !noRotate) {\n      bounds.rotate(o.angle*Math.PI/180, o.x||0, o.y||0);\n    }\n    return bounds.expand(noRotate ? 0 : 1);\n  }\n\n  function group(g, bounds, includeLegends) {\n    var axes = g.axisItems || [],\n        legends = g.legendItems || [], j, m;\n\n    for (j=0, m=axes.length; j<m; ++j) {\n      bounds.union(axes[j].bounds);\n    }\n    for (j=0, m=g.items.length; j<m; ++j) {\n      bounds.union(g.items[j].bounds);\n    }\n    if (includeLegends) {\n      for (j=0, m=legends.length; j<m; ++j) {\n        bounds.union(legends[j].bounds);\n      }\n      if (g.width != null && g.height != null) {\n        bounds.add(g.width, g.height);\n      }\n      if (g.x != null && g.y != null) {\n        bounds.add(0, 0);\n      }\n    }\n    bounds.translate(g.x||0, g.y||0);\n    return bounds;\n  }\n\n  var methods = {\n    group:  group,\n    symbol: symbol,\n    image:  image,\n    rect:   rect,\n    rule:   rule,\n    arc:    arc,\n    text:   text,\n    path:   path,\n    area:   area,\n    line:   line\n  };\n\n  function itemBounds(item, func, opt) {\n    func = func || methods[item.mark.marktype];\n    if (!item.bounds_prev) item['bounds:prev'] = new vg.Bounds();\n    var b = item.bounds, pb = item['bounds:prev'];\n    if (b) pb.clear().union(b);\n    item.bounds = func(item, b ? b.clear() : new vg.Bounds(), opt);\n    if (!b) pb.clear().union(item.bounds);\n    return item.bounds;\n  }\n\n  function markBounds(mark, bounds, opt) {\n    bounds = bounds || mark.bounds && mark.bounds.clear() || new vg.Bounds();\n    var type  = mark.marktype,\n        func  = methods[type],\n        items = mark.items,\n        item, i, len;\n        \n    if (type===\"area\" || type===\"line\") {\n      if (items.length) {\n        items[0].bounds = func(items[0], bounds);\n      }\n    } else {\n      for (i=0, len=items.length; i<len; ++i) {\n        bounds.union(itemBounds(items[i], func, opt));\n      }\n    }\n    mark.bounds = bounds;\n  }\n  \n  return {\n    mark:  markBounds,\n    item:  itemBounds,\n    text:  text,\n    group: group\n  };\n\n})();vg.scene.encode = (function() {\n  var GROUP  = vg.scene.GROUP,\n      ENTER  = vg.scene.ENTER,\n      UPDATE = vg.scene.UPDATE,\n      EXIT   = vg.scene.EXIT,\n      EMPTY  = {};\n\n  function main(scene, def, trans, request, items) {\n    (request && items)\n      ? update.call(this, scene, def, trans, request, items)\n      : encode.call(this, scene, scene, def, trans, request);\n    return scene;\n  }\n  \n  function update(scene, def, trans, request, items) {\n    items = vg.array(items);\n    var i, len, item, group, props, prop;\n    for (i=0, len=items.length; i<len; ++i) {\n      item = items[i];\n      group = item.mark.group || null;\n      props = item.mark.def.properties;\n      prop = props && props[request];\n      if (prop) {\n        prop.call(vg, item, group, trans);\n        vg.scene.bounds.item(item);\n      }\n    }\n  }\n  \n  function encode(group, scene, def, trans, request) {\n    encodeItems.call(this, group, scene.items, def, trans, request);\n    if (scene.marktype === GROUP) {\n      encodeGroup.call(this, scene, def, group, trans, request);\n    } else {\n      vg.scene.bounds.mark(scene);\n    }\n  }\n  \n  function encodeLegend(group, scene, def, trans, request) {\n    encodeGroup.call(this, scene, def, group, trans, request);\n    encodeItems.call(this, group, scene.items, def, trans, request);\n    vg.scene.bounds.mark(scene, null, true);\n  }\n  \n  function encodeGroup(scene, def, parent, trans, request) {\n    var i, len, m, mlen, group, scales,\n        axes, axisItems, axisDef, leg, legItems, legDef;\n\n    for (i=0, len=scene.items.length; i<len; ++i) {\n      group = scene.items[i];\n\n      // cascade scales recursively\n      // use parent scales if there are no group-level scale defs\n      scales = group.scales || (group.scales =\n        def.scales ? vg.extend({}, parent.scales) : parent.scales);\n      \n      // update group-level scales\n      if (def.scales) {\n        vg.parse.scales(def.scales, scales, this._data, group);\n      }\n      \n      // update group-level axes\n      if (def.axes) {\n        axes = group.axes || (group.axes = []);\n        axisItems = group.axisItems || (group.axisItems = []);\n        vg.parse.axes(def.axes, axes, group.scales);\n        axes.forEach(function(a, i) {\n          axisDef = a.def();\n          axisItems[i] = vg.scene.build(axisDef, this._data, axisItems[i], null, 1);\n          axisItems[i].group = group;\n          encode.call(this, group, group.axisItems[i], axisDef, trans);\n        });\n      }\n      \n      // encode children marks\n      for (m=0, mlen=group.items.length; m<mlen; ++m) {\n        encode.call(this, group, group.items[m], def.marks[m], trans, request);\n      }\n    }\n    \n    // compute bounds (without legend)\n    vg.scene.bounds.mark(scene, null, !def.legends);\n    \n    // update legends\n    if (def.legends) {\n      for (i=0, len=scene.items.length; i<len; ++i) {\n        group = scene.items[i];\n        leg = group.legends || (group.legends = []);\n        legItems = group.legendItems || (group.legendItems = []);\n        vg.parse.legends(def.legends, leg, group.scales);\n        leg.forEach(function(l, i) {\n          legDef = l.def();\n          legItems[i] = vg.scene.build(legDef, this._data, legItems[i], null, 1);\n          legItems[i].group = group;\n          encodeLegend.call(this, group, group.legendItems[i], legDef, trans);\n        });\n      }\n      vg.scene.bounds.mark(scene, null, true);\n    }\n  }\n  \n  function encodeItems(group, items, def, trans, request) {    \n    var props  = def.properties || EMPTY,\n        enter  = props.enter,\n        update = props.update,\n        exit   = props.exit,\n        i, len, item, prop;\n\n    if (request) {\n      if (prop = props[request]) {\n        for (i=0, len=items.length; i<len; ++i) {\n          prop.call(vg, items[i], group, trans);\n        }\n      }\n      return; // exit early if given request\n    }\n\n    for (i=0; i<items.length; ++i) {\n      item = items[i];\n\n      // enter set\n      if (item.status === ENTER) {\n        if (enter) enter.call(vg, item, group);\n        item.status = UPDATE;\n      }\n\n      // update set      \n      if (item.status !== EXIT && update) {\n        update.call(vg, item, group, trans);\n      }\n      \n      // exit set\n      if (item.status === EXIT) {\n        if (exit) exit.call(vg, item, group, trans);\n        if (trans && !exit) trans.interpolate(item, EMPTY);\n        else if (!trans) items[i--].remove();\n      }\n    }\n  }\n  \n  return main;\n})();vg.scene.Transition = (function() {\n  function trans(duration, ease) {\n    this.duration = duration || 500;\n    this.ease = ease && d3.ease(ease) || d3.ease(\"cubic-in-out\");\n    this.updates = {next: null};\n  }\n  \n  var prototype = trans.prototype;\n  \n  var skip = {\n    \"text\": 1,\n    \"url\":  1\n  };\n  \n  prototype.interpolate = function(item, values) {\n    var key, curr, next, interp, list = null;\n\n    for (key in values) {\n      curr = item[key];\n      next = values[key];      \n      if (curr !== next) {\n        if (skip[key] || curr === undefined) {\n          // skip interpolation for specific keys or undefined start values\n          item[key] = next;\n        } else if (typeof curr === \"number\" && !isFinite(curr)) {\n          // for NaN or infinite numeric values, skip to final value\n          item[key] = next;\n        } else {\n          // otherwise lookup interpolator\n          interp = d3.interpolate(curr, next);\n          interp.property = key;\n          (list || (list=[])).push(interp);\n        }\n      }\n    }\n\n    if (list === null && item.status === vg.scene.EXIT) {\n      list = []; // ensure exiting items are included\n    }\n\n    if (list != null) {\n      list.item = item;\n      list.ease = item.mark.ease || this.ease;\n      list.next = this.updates.next;\n      this.updates.next = list;\n    }\n    return this;\n  };\n  \n  prototype.start = function(callback) {\n    var t = this, prev = t.updates, curr = prev.next;\n    for (; curr!=null; prev=curr, curr=prev.next) {\n      if (curr.item.status === vg.scene.EXIT) curr.remove = true;\n    }\n    t.callback = callback;\n    d3.timer(function(elapsed) { return step.call(t, elapsed); });\n  };\n\n  function step(elapsed) {\n    var list = this.updates, prev = list, curr = prev.next,\n        duration = this.duration,\n        item, delay, f, e, i, n, stop = true;\n\n    for (; curr!=null; prev=curr, curr=prev.next) {\n      item = curr.item;\n      delay = item.delay || 0;\n\n      f = (elapsed - delay) / duration;\n      if (f < 0) { stop = false; continue; }\n      if (f > 1) f = 1;\n      e = curr.ease(f);\n\n      for (i=0, n=curr.length; i<n; ++i) {\n        item[curr[i].property] = curr[i](e);\n      }\n      item.touch();\n      vg.scene.bounds.item(item);\n\n      if (f === 1) {\n        if (curr.remove) item.remove();\n        prev.next = curr.next;\n        curr = prev;\n      } else {\n        stop = false;\n      }\n    }\n\n    this.callback();\n    return stop;\n  };\n  \n  return trans;\n  \n})();\n\nvg.scene.transition = function(dur, ease) {\n  return new vg.scene.Transition(dur, ease);\n};vg.scene.axis = function() {\n  var scale,\n      orient = vg.config.axis.orient,\n      offset = 0,\n      titleOffset = vg.config.axis.titleOffset,\n      axisDef = null,\n      layer = \"front\",\n      grid = false,\n      title = null,\n      tickMajorSize = vg.config.axis.tickSize,\n      tickMinorSize = vg.config.axis.tickSize,\n      tickEndSize = vg.config.axis.tickSize,\n      tickPadding = vg.config.axis.padding,\n      tickValues = null,\n      tickFormatString = null,\n      tickFormat = null,\n      tickSubdivide = 0,\n      tickArguments = [vg.config.axis.ticks],\n      gridLineStyle = {},\n      tickLabelStyle = {},\n      majorTickStyle = {},\n      minorTickStyle = {},\n      titleStyle = {},\n      domainStyle = {};\n\n  var axis = {};\n\n  function reset() {\n    axisDef = null;\n  }\n\n  axis.def = function() {\n    var def = axisDef ? axisDef : (axisDef = axis_def(scale));\n\n    // tick format\n    tickFormat = !tickFormatString ? null : ((scale.type === 'time')\n      ? d3.time.format(tickFormatString)\n      : d3.format(tickFormatString));\n\n    // generate data\n    var major = tickValues == null\n      ? (scale.ticks ? scale.ticks.apply(scale, tickArguments) : scale.domain())\n      : tickValues;\n    var minor = vg_axisSubdivide(scale, major, tickSubdivide).map(vg.data.ingest);\n    major = major.map(vg.data.ingest);\n    var fmt = tickFormat==null ? (scale.tickFormat ? scale.tickFormat.apply(scale, tickArguments) : String) : tickFormat;\n    major.forEach(function(d) { d.label = fmt(d.data); });\n    var tdata = title ? [title].map(vg.data.ingest) : [];\n    \n    // update axis def\n    def.marks[0].from = function() { return grid ? major : []; };\n    def.marks[1].from = function() { return major; };\n    def.marks[2].from = function() { return minor; };\n    def.marks[3].from = def.marks[1].from;\n    def.marks[4].from = function() { return [1]; };\n    def.marks[5].from = function() { return tdata; };\n    def.offset = offset;\n    def.orient = orient;\n    def.layer = layer;\n    return def;\n  };\n\n  function axis_def(scale) {\n    // setup scale mapping\n    var newScale, oldScale, range;\n    if (scale.type === \"ordinal\") {\n      newScale = {scale: scale.scaleName, offset: 0.5 + scale.rangeBand()/2};\n      oldScale = newScale;\n    } else {\n      newScale = {scale: scale.scaleName, offset: 0.5};\n      oldScale = {scale: scale.scaleName+\":prev\", offset: 0.5};\n    }\n    range = vg_axisScaleRange(scale);\n\n    // setup axis marks\n    var gridLines = vg_axisTicks();\n    var majorTicks = vg_axisTicks();\n    var minorTicks = vg_axisTicks();\n    var tickLabels = vg_axisTickLabels();\n    var domain = vg_axisDomain();\n    var title = vg_axisTitle();\n    gridLines.properties.enter.stroke = {value: vg.config.axis.gridColor};\n\n    // extend axis marks based on axis orientation\n    vg_axisTicksExtend(orient, gridLines, oldScale, newScale, Infinity);\n    vg_axisTicksExtend(orient, majorTicks, oldScale, newScale, tickMajorSize);\n    vg_axisTicksExtend(orient, minorTicks, oldScale, newScale, tickMinorSize);\n    vg_axisLabelExtend(orient, tickLabels, oldScale, newScale, tickMajorSize, tickPadding);\n\n    vg_axisDomainExtend(orient, domain, range, tickEndSize);\n    vg_axisTitleExtend(orient, title, range, titleOffset); // TODO get offset\n    \n    // add / override custom style properties\n    vg.extend(gridLines.properties.update, gridLineStyle);\n    vg.extend(majorTicks.properties.update, majorTickStyle);\n    vg.extend(minorTicks.properties.update, minorTickStyle);\n    vg.extend(tickLabels.properties.update, tickLabelStyle);\n    vg.extend(domain.properties.update, domainStyle);\n    vg.extend(title.properties.update, titleStyle);\n\n    var marks = [gridLines, majorTicks, minorTicks, tickLabels, domain, title];\n    return {\n      type: \"group\",\n      interactive: false,\n      properties: { enter: vg_axisUpdate, update: vg_axisUpdate },\n      marks: marks.map(vg.parse.mark)\n    };\n  }\n\n  axis.scale = function(x) {\n    if (!arguments.length) return scale;\n    if (scale !== x) { scale = x; reset(); }\n    return axis;\n  };\n\n  axis.orient = function(x) {\n    if (!arguments.length) return orient;\n    if (orient !== x) {\n      orient = x in vg_axisOrients ? x + \"\" : vg.config.axis.orient;\n      reset();\n    }\n    return axis;\n  };\n\n  axis.title = function(x) {\n    if (!arguments.length) return title;\n    if (title !== x) { title = x; reset(); }\n    return axis;\n  };\n\n  axis.ticks = function() {\n    if (!arguments.length) return tickArguments;\n    tickArguments = arguments;\n    return axis;\n  };\n\n  axis.tickValues = function(x) {\n    if (!arguments.length) return tickValues;\n    tickValues = x;\n    return axis;\n  };\n\n  axis.tickFormat = function(x) {\n    if (!arguments.length) return tickFormatString;\n    if (tickFormatString !== x) {\n      tickFormatString = x;\n      reset();\n    }\n    return axis;\n  };\n  \n  axis.tickSize = function(x, y) {\n    if (!arguments.length) return tickMajorSize;\n    var n = arguments.length - 1,\n        major = +x,\n        minor = n > 1 ? +y : tickMajorSize,\n        end   = n > 0 ? +arguments[n] : tickMajorSize;\n\n    if (tickMajorSize !== major ||\n        tickMinorSize !== minor ||\n        tickEndSize !== end) {\n      reset();\n    }\n\n    tickMajorSize = major;\n    tickMinorSize = minor;\n    tickEndSize = end;\n    return axis;\n  };\n\n  axis.tickSubdivide = function(x) {\n    if (!arguments.length) return tickSubdivide;\n    tickSubdivide = +x;\n    return axis;\n  };\n  \n  axis.offset = function(x) {\n    if (!arguments.length) return offset;\n    offset = vg.isObject(x) ? x : +x;\n    return axis;\n  };\n\n  axis.tickPadding = function(x) {\n    if (!arguments.length) return tickPadding;\n    if (tickPadding !== +x) { tickPadding = +x; reset(); }\n    return axis;\n  };\n\n  axis.titleOffset = function(x) {\n    if (!arguments.length) return titleOffset;\n    if (titleOffset !== +x) { titleOffset = +x; reset(); }\n    return axis;\n  };\n\n  axis.layer = function(x) {\n    if (!arguments.length) return layer;\n    if (layer !== x) { layer = x; reset(); }\n    return axis;\n  };\n\n  axis.grid = function(x) {\n    if (!arguments.length) return grid;\n    if (grid !== x) { grid = x; reset(); }\n    return axis;\n  };\n\n  axis.gridLineProperties = function(x) {\n    if (!arguments.length) return gridLineStyle;\n    if (gridLineStyle !== x) { gridLineStyle = x; }\n    return axis;\n  };\n\n  axis.majorTickProperties = function(x) {\n    if (!arguments.length) return majorTickStyle;\n    if (majorTickStyle !== x) { majorTickStyle = x; }\n    return axis;\n  };\n\n  axis.minorTickProperties = function(x) {\n    if (!arguments.length) return minorTickStyle;\n    if (minorTickStyle !== x) { minorTickStyle = x; }\n    return axis;\n  };\n\n  axis.tickLabelProperties = function(x) {\n    if (!arguments.length) return tickLabelStyle;\n    if (tickLabelStyle !== x) { tickLabelStyle = x; }\n    return axis;\n  };\n\n  axis.titleProperties = function(x) {\n    if (!arguments.length) return titleStyle;\n    if (titleStyle !== x) { titleStyle = x; }\n    return axis;\n  };\n\n  axis.domainProperties = function(x) {\n    if (!arguments.length) return domainStyle;\n    if (domainStyle !== x) { domainStyle = x; }\n    return axis;\n  };\n  \n  axis.reset = function() { reset(); };\n\n  return axis;\n};\n\nvar vg_axisOrients = {top: 1, right: 1, bottom: 1, left: 1};\n\nfunction vg_axisSubdivide(scale, ticks, m) {\n  subticks = [];\n  if (m && ticks.length > 1) {\n    var extent = vg_axisScaleExtent(scale.domain()),\n        subticks,\n        i = -1,\n        n = ticks.length,\n        d = (ticks[1] - ticks[0]) / ++m,\n        j,\n        v;\n    while (++i < n) {\n      for (j = m; --j > 0;) {\n        if ((v = +ticks[i] - j * d) >= extent[0]) {\n          subticks.push(v);\n        }\n      }\n    }\n    for (--i, j = 0; ++j < m && (v = +ticks[i] + j * d) < extent[1];) {\n      subticks.push(v);\n    }\n  }\n  return subticks;\n}\n\nfunction vg_axisScaleExtent(domain) {\n  var start = domain[0], stop = domain[domain.length - 1];\n  return start < stop ? [start, stop] : [stop, start];\n}\n\nfunction vg_axisScaleRange(scale) {\n  return scale.rangeExtent\n    ? scale.rangeExtent()\n    : vg_axisScaleExtent(scale.range());\n}\n\nvar vg_axisAlign = {\n  bottom: \"center\",\n  top: \"center\",\n  left: \"right\",\n  right: \"left\"\n};\n\nvar vg_axisBaseline = {\n  bottom: \"top\",\n  top: \"bottom\",\n  left: \"middle\",\n  right: \"middle\"\n};\n\nfunction vg_axisLabelExtend(orient, labels, oldScale, newScale, size, pad) {\n  size = Math.max(size, 0) + pad;\n  if (orient === \"left\" || orient === \"top\") {\n    size *= -1;\n  }  \n  if (orient === \"top\" || orient === \"bottom\") {\n    vg.extend(labels.properties.enter, {\n      x: oldScale,\n      y: {value: size},\n    });\n    vg.extend(labels.properties.update, {\n      x: newScale,\n      y: {value: size},\n      align: {value: \"center\"},\n      baseline: {value: vg_axisBaseline[orient]}\n    });\n  } else {\n    vg.extend(labels.properties.enter, {\n      x: {value: size},\n      y: oldScale,\n    });\n    vg.extend(labels.properties.update, {\n      x: {value: size},\n      y: newScale,\n      align: {value: vg_axisAlign[orient]},\n      baseline: {value: \"middle\"}\n    });\n  }\n}\n\nfunction vg_axisTicksExtend(orient, ticks, oldScale, newScale, size) {\n  var sign = (orient === \"left\" || orient === \"top\") ? -1 : 1;\n  if (size === Infinity) {\n    size = (orient === \"top\" || orient === \"bottom\")\n      ? {group: \"mark.group.height\", mult: -sign}\n      : {group: \"mark.group.width\", mult: -sign};\n  } else {\n    size = {value: sign * size};\n  }\n  if (orient === \"top\" || orient === \"bottom\") {\n    vg.extend(ticks.properties.enter, {\n      x:  oldScale,\n      y:  {value: 0},\n      y2: size\n    });\n    vg.extend(ticks.properties.update, {\n      x:  newScale,\n      y:  {value: 0},\n      y2: size\n    });\n    vg.extend(ticks.properties.exit, {\n      x:  newScale,\n    });        \n  } else {\n    vg.extend(ticks.properties.enter, {\n      x:  {value: 0},\n      x2: size,\n      y:  oldScale\n    });\n    vg.extend(ticks.properties.update, {\n      x:  {value: 0},\n      x2: size,\n      y:  newScale\n    });\n    vg.extend(ticks.properties.exit, {\n      y:  newScale,\n    });\n  }\n}\n\nfunction vg_axisTitleExtend(orient, title, range, offset) {\n  var mid = ~~((range[0] + range[1]) / 2),\n      sign = (orient === \"top\" || orient === \"left\") ? -1 : 1;\n  \n  if (orient === \"bottom\" || orient === \"top\") {\n    vg.extend(title.properties.update, {\n      x: {value: mid},\n      y: {value: sign*offset},\n      angle: {value: 0}\n    });\n  } else {\n    vg.extend(title.properties.update, {\n      x: {value: sign*offset},\n      y: {value: mid},\n      angle: {value: -90}\n    });\n  }\n}\n\nfunction vg_axisDomainExtend(orient, domain, range, size) {\n  var path;\n  if (orient === \"top\" || orient === \"left\") {\n    size = -1 * size;\n  }\n  if (orient === \"bottom\" || orient === \"top\") {\n    path = \"M\" + range[0] + \",\" + size + \"V0H\" + range[1] + \"V\" + size;\n  } else {\n    path = \"M\" + size + \",\" + range[0] + \"H0V\" + range[1] + \"H\" + size;\n  }\n  domain.properties.update.path = {value: path};\n}\n\nfunction vg_axisUpdate(item, group, trans) {\n  var o = trans ? {} : item,\n      offset = item.mark.def.offset,\n      orient = item.mark.def.orient,\n      width  = group.width,\n      height = group.height; // TODO fallback to global w,h?\n\n  if (vg.isObject(offset)) {\n    offset = -group.scales[offset.scale](offset.value);\n  }\n\n  switch (orient) {\n    case \"left\":   { o.x = -offset; o.y = 0; break; }\n    case \"right\":  { o.x = width + offset; o.y = 0; break; }\n    case \"bottom\": { o.x = 0; o.y = height + offset; break; }\n    case \"top\":    { o.x = 0; o.y = -offset; break; }\n    default:       { o.x = 0; o.y = 0; }\n  }\n\n  if (trans) trans.interpolate(item, o);\n}\n\nfunction vg_axisTicks() {\n  return {\n    type: \"rule\",\n    interactive: false,\n    key: \"data\",\n    properties: {\n      enter: {\n        stroke: {value: vg.config.axis.tickColor},\n        strokeWidth: {value: vg.config.axis.tickWidth},\n        opacity: {value: 1e-6}\n      },\n      exit: { opacity: {value: 1e-6} },\n      update: { opacity: {value: 1} }\n    }\n  };\n}\n\nfunction vg_axisTickLabels() {\n  return {\n    type: \"text\",\n    interactive: true,\n    key: \"data\",\n    properties: {\n      enter: {\n        fill: {value: vg.config.axis.tickLabelColor},\n        font: {value: vg.config.axis.tickLabelFont},\n        fontSize: {value: vg.config.axis.tickLabelFontSize},\n        opacity: {value: 1e-6},\n        text: {field: \"label\"}\n      },\n      exit: { opacity: {value: 1e-6} },\n      update: { opacity: {value: 1} }\n    }\n  };\n}\n\nfunction vg_axisTitle() {\n  return {\n    type: \"text\",\n    interactive: true,\n    properties: {\n      enter: {\n        font: {value: vg.config.axis.titleFont},\n        fontSize: {value: vg.config.axis.titleFontSize},\n        fontWeight: {value: vg.config.axis.titleFontWeight},\n        fill: {value: vg.config.axis.titleColor},\n        align: {value: \"center\"},\n        baseline: {value: \"middle\"},\n        text: {field: \"data\"}\n      },\n      update: {}\n    }\n  };\n}\n\nfunction vg_axisDomain() {\n  return {\n    type: \"path\",\n    interactive: false,\n    properties: {\n      enter: {\n        x: {value: 0.5},\n        y: {value: 0.5},\n        stroke: {value: vg.config.axis.axisColor},\n        strokeWidth: {value: vg.config.axis.axisWidth}\n      },\n      update: {}\n    }\n  };\n}\nvg.scene.legend = function() {\n  var size = null,\n      shape = null,\n      fill = null,\n      stroke = null,\n      spacing = null,\n      values = null,\n      format = null,\n      formatString = null,\n      title = undefined,\n      orient = \"right\",\n      offset = vg.config.legend.offset,\n      padding = vg.config.legend.padding,\n      legendDef,\n      tickArguments = [5],\n      legendStyle = {},\n      symbolStyle = {},\n      gradientStyle = {},\n      titleStyle = {},\n      labelStyle = {};\n\n  var legend = {},\n      legendDef = null;\n\n  function reset() { legendDef = null; }\n\n  legend.def = function() {\n    var scale = size || shape || fill || stroke;\n    \n    format = !formatString ? null : ((scale.type === 'time')\n      ? d3.time.format(formatString)\n      : d3.format(formatString));\n    \n    if (!legendDef) {\n      legendDef = (scale===fill || scale===stroke) && !discrete(scale.type)\n        ? quantDef(scale)\n        : ordinalDef(scale);      \n    }\n    legendDef.orient = orient;\n    legendDef.offset = offset;\n    legendDef.padding = padding;\n    return legendDef;\n  };\n\n  function discrete(type) {\n    return type===\"ordinal\" || type===\"quantize\"\n      || type===\"quantile\" || type===\"threshold\";\n  }\n\n  function ordinalDef(scale) {\n    var def = o_legend_def(size, shape, fill, stroke);\n\n    // generate data\n    var data = (values == null\n      ? (scale.ticks ? scale.ticks.apply(scale, tickArguments) : scale.domain())\n      : values).map(vg.data.ingest);\n    var fmt = format==null ? (scale.tickFormat ? scale.tickFormat.apply(scale, tickArguments) : String) : format;\n    \n    // determine spacing between legend entries\n    var fs, range, offset, pad=5, domain = d3.range(data.length);\n    if (size) {\n      range = data.map(function(x) { return Math.sqrt(size(x.data)); });\n      offset = d3.max(range);\n      range = range.reduce(function(a,b,i,z) {\n          if (i > 0) a[i] = a[i-1] + z[i-1]/2 + pad;\n          return (a[i] += b/2, a); }, [0]).map(Math.round);\n    } else {\n      offset = Math.round(Math.sqrt(vg.config.legend.symbolSize));\n      range = spacing\n        || (fs = labelStyle.fontSize) && (fs.value + pad)\n        || (vg.config.legend.labelFontSize + pad);\n      range = domain.map(function(d,i) {\n        return Math.round(offset/2 + i*range);\n      });\n    }\n\n    // account for padding and title size\n    var sz = padding, ts;\n    if (title) {\n      ts = titleStyle.fontSize;\n      sz += 5 + ((ts && ts.value) || vg.config.legend.titleFontSize);\n    }\n    for (var i=0, n=range.length; i<n; ++i) range[i] += sz;\n    \n    // build scale for label layout\n    var scale = {\n      name: \"legend\",\n      type: \"ordinal\",\n      points: true,\n      domain: domain,\n      range: range\n    };\n    \n    // update legend def\n    var tdata = (title ? [title] : []).map(vg.data.ingest);\n    data.forEach(function(d) {\n      d.label = fmt(d.data);\n      d.offset = offset;\n    });\n    def.scales = [ scale ];\n    def.marks[0].from = function() { return tdata; };\n    def.marks[1].from = function() { return data; };\n    def.marks[2].from = def.marks[1].from;\n    return def;\n  }\n\n  function o_legend_def(size, shape, fill, stroke) {\n    // setup legend marks\n    var titles = vg_legendTitle(),\n        symbols = vg_legendSymbols(),\n        labels = vg_vLegendLabels();\n\n    // extend legend marks\n    vg_legendSymbolExtend(symbols, size, shape, fill, stroke);\n    \n    // add / override custom style properties\n    vg.extend(titles.properties.update, titleStyle);\n    vg.extend(symbols.properties.update, symbolStyle);\n    vg.extend(labels.properties.update, labelStyle);\n\n    // padding from legend border\n    titles.properties.enter.x.value += padding;\n    titles.properties.enter.y.value += padding;\n    labels.properties.enter.x.offset += padding + 1;\n    symbols.properties.enter.x.offset = padding + 1;\n    labels.properties.update.x.offset += padding + 1;\n    symbols.properties.update.x.offset = padding + 1;\n\n    return {\n      type: \"group\",\n      interactive: false,\n      properties: {\n        enter: vg.parse.properties(\"group\", legendStyle),\n        update: vg_legendUpdate\n      },\n      marks: [titles, symbols, labels].map(vg.parse.mark)\n    };\n  }\n\n  function quantDef(scale) {\n    var def = q_legend_def(scale),\n        dom = scale.domain(),\n        data = dom.map(vg.data.ingest),\n        width = (gradientStyle.width && gradientStyle.width.value) || vg.config.legend.gradientWidth,\n        fmt = format==null ? (scale.tickFormat ? scale.tickFormat.apply(scale, tickArguments) : String) : format;\n\n    // build scale for label layout\n    var layout = {\n      name: \"legend\",\n      type: scale.type,\n      round: true,\n      zero: false,\n      domain: [dom[0], dom[dom.length-1]],\n      range: [padding, width+padding]\n    };\n    if (scale.type===\"pow\") layout.exponent = scale.exponent();\n    \n    // update legend def\n    var tdata = (title ? [title] : []).map(vg.data.ingest);\n    data.forEach(function(d,i) {\n      d.label = fmt(d.data);\n      d.align = i==(data.length-1) ? \"right\" : i==0 ? \"left\" : \"center\";\n    });\n    def.scales = [ layout ];\n    def.marks[0].from = function() { return tdata; };\n    def.marks[1].from = function() { return [1]; };\n    def.marks[2].from = function() { return data; };\n    return def;\n  }\n  \n  function q_legend_def(scale) {\n    // setup legend marks\n    var titles = vg_legendTitle(),\n        gradient = vg_legendGradient(),\n        labels = vg_hLegendLabels(),\n        grad = new vg.Gradient();\n\n    // setup color gradient\n    var dom = scale.domain(),\n        min = dom[0],\n        max = dom[dom.length-1],\n        f = scale.copy().domain([min, max]).range([0,1]);\n        \n    var stops = (scale.type !== \"linear\" && scale.ticks)\n      ? scale.ticks.call(scale, 15) : dom;\n    if (min !== stops[0]) stops.unshift(min);\n    if (max !== stops[stops.length-1]) stops.push(max);\n\n    for (var i=0, n=stops.length; i<n; ++i) {\n      grad.stop(f(stops[i]), scale(stops[i]));\n    }\n    gradient.properties.enter.fill = {value: grad};\n\n    // add / override custom style properties\n    vg.extend(titles.properties.update, titleStyle);\n    vg.extend(gradient.properties.update, gradientStyle);\n    vg.extend(labels.properties.update, labelStyle);\n\n    // account for gradient size\n    var gp = gradient.properties, gh = gradientStyle.height,\n        hh = (gh && gh.value) || gp.enter.height.value;\n    labels.properties.enter.y.value = hh;\n    labels.properties.update.y.value = hh;\n\n    // account for title size as needed\n    if (title) {\n      var tp = titles.properties, fs = titleStyle.fontSize,\n          sz = 4 + ((fs && fs.value) || tp.enter.fontSize.value);\n      gradient.properties.enter.y.value += sz;\n      labels.properties.enter.y.value += sz;\n      gradient.properties.update.y.value += sz;\n      labels.properties.update.y.value += sz;\n    }\n    \n    // padding from legend border\n    titles.properties.enter.x.value += padding;\n    titles.properties.enter.y.value += padding;\n    gradient.properties.enter.x.value += padding;\n    gradient.properties.enter.y.value += padding;\n    labels.properties.enter.y.value += padding;\n    gradient.properties.update.x.value += padding;\n    gradient.properties.update.y.value += padding;\n    labels.properties.update.y.value += padding;\n\n    return {\n      type: \"group\",\n      interactive: false,\n      properties: {\n        enter: vg.parse.properties(\"group\", legendStyle),\n        update: vg_legendUpdate\n      },\n      marks: [titles, gradient, labels].map(vg.parse.mark)\n    };\n  }\n\n  legend.size = function(x) {\n    if (!arguments.length) return size;\n    if (size !== x) { size = x; reset(); }\n    return legend;\n  };\n\n  legend.shape = function(x) {\n    if (!arguments.length) return shape;\n    if (shape !== x) { shape = x; reset(); }\n    return legend;\n  };\n\n  legend.fill = function(x) {\n    if (!arguments.length) return fill;\n    if (fill !== x) { fill = x; reset(); }\n    return legend;\n  };\n  \n  legend.stroke = function(x) {\n    if (!arguments.length) return stroke;\n    if (stroke !== x) { stroke = x; reset(); }\n    return legend;\n  };\n\n  legend.title = function(x) {\n    if (!arguments.length) return title;\n    if (title !== x) { title = x; reset(); }\n    return legend;\n  };\n\n  legend.format = function(x) {\n    if (!arguments.length) return formatString;\n    if (formatString !== x) {\n      formatString = x;\n      reset();\n    }\n    return legend;\n  };\n\n  legend.spacing = function(x) {\n    if (!arguments.length) return spacing;\n    if (spacing !== +x) { spacing = +x; reset(); }\n    return legend;\n  };\n\n  legend.orient = function(x) {\n    if (!arguments.length) return orient;\n    orient = x in vg_legendOrients ? x + \"\" : vg.config.legend.orient;\n    return legend;\n  };\n\n  legend.offset = function(x) {\n    if (!arguments.length) return offset;\n    offset = +x;\n    return legend;\n  };\n\n  legend.values = function(x) {\n    if (!arguments.length) return values;\n    values = x;\n    return legend;\n  };\n\n  legend.legendProperties = function(x) {\n    if (!arguments.length) return legendStyle;\n    legendStyle = x;\n    return legend;\n  };\n\n  legend.symbolProperties = function(x) {\n    if (!arguments.length) return symbolStyle;\n    symbolStyle = x;\n    return legend;\n  };\n\n  legend.gradientProperties = function(x) {\n    if (!arguments.length) return gradientStyle;\n    gradientStyle = x;\n    return legend;\n  };\n\n  legend.labelProperties = function(x) {\n    if (!arguments.length) return labelStyle;\n    labelStyle = x;\n    return legend;\n  };\n  \n  legend.titleProperties = function(x) {\n    if (!arguments.length) return titleStyle;\n    titleStyle = x;\n    return legend;\n  };\n\n  legend.reset = function() { reset(); };\n\n  return legend;\n};\n\nvar vg_legendOrients = {right: 1, left: 1};\n\nfunction vg_legendUpdate(item, group, trans) {\n  var o = trans ? {} : item, gx,\n      offset = item.mark.def.offset,\n      orient = item.mark.def.orient,\n      pad    = item.mark.def.padding * 2,\n      lw     = ~~item.bounds.width() + (item.width ? 0 : pad),\n      lh     = ~~item.bounds.height() + (item.height ? 0 : pad);\n\n  o.x = 0.5;\n  o.y = 0.5;\n  o.width = lw;\n  o.height = lh;\n\n  // HACK: use to estimate group bounds during animated transition\n  if (!trans && group.bounds) {\n    group.bounds.delta = group.bounds.x2 - group.width;\n  }\n\n  switch (orient) {\n    case \"left\":  {\n      gx = group.bounds ? group.bounds.x1 : 0;\n      o.x += gx - offset - lw;\n      break;\n    };\n    case \"right\": {\n      gx = group.width;\n      if (group.bounds) gx = trans\n        ? group.width + group.bounds.delta\n        : group.bounds.x2;\n      o.x += gx + offset;\n      break;\n    };\n  }\n  \n  if (trans) trans.interpolate(item, o);\n  item.mark.def.properties.enter(item, group, trans);\n}\n\nfunction vg_legendSymbolExtend(mark, size, shape, fill, stroke) {\n  var e = mark.properties.enter,\n      u = mark.properties.update;\n  if (size)   e.size   = u.size   = {scale: size.scaleName,   field: \"data\"};\n  if (shape)  e.shape  = u.shape  = {scale: shape.scaleName,  field: \"data\"};\n  if (fill)   e.fill   = u.fill   = {scale: fill.scaleName,   field: \"data\"};\n  if (stroke) e.stroke = u.stroke = {scale: stroke.scaleName, field: \"data\"};\n}\n\nfunction vg_legendTitle() {\n  var cfg = vg.config.legend;\n  return {\n    type: \"text\",\n    interactive: false,\n    key: \"data\",\n    properties: {\n      enter: {\n        x: {value: 0},\n        y: {value: 0},\n        fill: {value: cfg.titleColor},\n        font: {value: cfg.titleFont},\n        fontSize: {value: cfg.titleFontSize},\n        fontWeight: {value: cfg.titleFontWeight},\n        baseline: {value: \"top\"},\n        text: {field: \"data\"},\n        opacity: {value: 1e-6}\n      },\n      exit: { opacity: {value: 1e-6} },\n      update: { opacity: {value: 1} }\n    }\n  };\n}\n\nfunction vg_legendSymbols() {\n  var cfg = vg.config.legend;\n  return {\n    type: \"symbol\",\n    interactive: false,\n    key: \"data\",\n    properties: {\n      enter: {\n        x: {field: \"offset\", mult: 0.5},\n        y: {scale: \"legend\", field: \"index\"},\n        shape: {value: cfg.symbolShape},\n        size: {value: cfg.symbolSize},\n        stroke: {value: cfg.symbolColor},\n        strokeWidth: {value: cfg.symbolStrokeWidth},\n        opacity: {value: 1e-6}\n      },\n      exit: { opacity: {value: 1e-6} },\n      update: {\n        x: {field: \"offset\", mult: 0.5},\n        y: {scale: \"legend\", field: \"index\"},\n        opacity: {value: 1}\n      }\n    }\n  };\n}\n\nfunction vg_vLegendLabels() {\n  var cfg = vg.config.legend;\n  return {\n    type: \"text\",\n    interactive: false,\n    key: \"data\",\n    properties: {\n      enter: {\n        x: {field: \"offset\", offset: 5},\n        y: {scale: \"legend\", field: \"index\"},\n        fill: {value: cfg.labelColor},\n        font: {value: cfg.labelFont},\n        fontSize: {value: cfg.labelFontSize},\n        align: {value: cfg.labelAlign},\n        baseline: {value: cfg.labelBaseline},\n        text: {field: \"label\"},\n        opacity: {value: 1e-6}\n      },\n      exit: { opacity: {value: 1e-6} },\n      update: {\n        opacity: {value: 1},\n        x: {field: \"offset\", offset: 5},\n        y: {scale: \"legend\", field: \"index\"},\n      }\n    }\n  };\n}\n\nfunction vg_legendGradient() {\n  var cfg = vg.config.legend;\n  return {\n    type: \"rect\",\n    interactive: false,\n    properties: {\n      enter: {\n        x: {value: 0},\n        y: {value: 0},\n        width: {value: cfg.gradientWidth},\n        height: {value: cfg.gradientHeight},\n        stroke: {value: cfg.gradientStrokeColor},\n        strokeWidth: {value: cfg.gradientStrokeWidth},\n        opacity: {value: 1e-6}\n      },\n      exit: { opacity: {value: 1e-6} },\n      update: {\n        x: {value: 0},\n        y: {value: 0},\n        opacity: {value: 1}\n      }\n    }\n  };\n}\n\nfunction vg_hLegendLabels() {\n  var cfg = vg.config.legend;\n  return {\n    type: \"text\",\n    interactive: false,\n    key: \"data\",\n    properties: {\n      enter: {\n        x: {scale: \"legend\", field: \"data\"},\n        y: {value: 20},\n        dy: {value: 2},\n        fill: {value: cfg.labelColor},\n        font: {value: cfg.labelFont},\n        fontSize: {value: cfg.labelFontSize},\n        align: {field: \"align\"},\n        baseline: {value: \"top\"},\n        text: {field: \"label\"},\n        opacity: {value: 1e-6}\n      },\n      exit: { opacity: {value: 1e-6} },\n      update: {\n        x: {scale: \"legend\", field: \"data\"},\n        y: {value: 20},\n        opacity: {value: 1}\n      }\n    }\n  };\n}vg.Model = (function() {\n  function model() {\n    this._defs = null;\n    this._data = {};\n    this._scene = null;\n    this._reset = {axes: false, legends: false};\n  }\n\n  var prototype = model.prototype;\n\n  prototype.defs = function(defs) {\n    if (!arguments.length) return this._defs;\n    this._defs = defs;\n    return this;\n  };\n\n  prototype.data = function(data) {\n    if (!arguments.length) return this._data;\n\n    var deps = {},\n        defs = this._defs,\n        src  = defs.data.source,\n        tx   = defs.data.flow || {},\n        keys = defs.data.sorted,\n        len  = keys.length, i, k, x;\n\n    // collect source data set dependencies\n    function sources(k) {\n      (src[k] || []).forEach(function(s) { deps[s] = k; sources(s); });\n    }\n    vg.keys(data).forEach(sources);\n    \n    // update data sets in dependency-aware order\n    for (i=0; i<len; ++i) {\n      if (data[k=keys[i]]) {\n        x = data[k];\n      } else if (deps[k]) {\n        x = vg_data_duplicate(data[deps[k]]);\n        if (vg.isTree(data)) vg_make_tree(x);\n      } else continue;\n      this._data[k] = tx[k] ? tx[k](x, this._data, defs.marks) : x;\n    }\n\n    this._reset.legends = true;\n    return this;\n  };\n\n  prototype.width = function(width) {\n    if (this._defs) this._defs.width = width;\n    if (this._defs && this._defs.marks) this._defs.marks.width = width;\n    if (this._scene) this._scene.items[0].width = width;\n    this._reset.axes = true;\n    return this;\n  };\n\n  prototype.height = function(height) {\n    if (this._defs) this._defs.height = height;\n    if (this._defs && this._defs.marks) this._defs.marks.height = height;\n    if (this._scene) this._scene.items[0].height = height;\n    this._reset.axes = true;\n    return this;\n  };\n\n  prototype.scene = function(node) {\n    if (!arguments.length) return this._scene;\n    this._scene = node;\n    return this;\n  };\n\n  prototype.build = function() {\n    var m = this, data = m._data, marks = m._defs.marks;\n    m._scene = vg.scene.build.call(m, marks, data, m._scene);\n    m._scene.items[0].width = marks.width;\n    m._scene.items[0].height = marks.height;\n    m._scene.interactive = false;\n    return this;\n  };\n\n  prototype.encode = function(trans, request, item) {\n    this.reset();\n    var m = this, scene = m._scene, defs = m._defs;\n    vg.scene.encode.call(m, scene, defs.marks, trans, request, item);\n    return this;\n  };\n\n  prototype.reset = function() {\n    if (this._scene && this._reset.axes) {\n      vg.scene.visit(this._scene, function(item) {\n        if (item.axes) item.axes.forEach(function(axis) { axis.reset(); });\n      });\n      this._reset.axes = false;\n    }\n    if (this._scene && this._reset.legends) {\n      vg.scene.visit(this._scene, function(item) {\n        if (item.legends) item.legends.forEach(function(l) { l.reset(); });\n      });\n      this._reset.legends = false;\n    }\n    return this;\n  };\n\n  return model;\n})();vg.View = (function() {\n  var view = function(el, width, height) {\n    this._el = null;\n    this._build = false;\n    this._model = new vg.Model();\n    this._width = this.__width = width || 500;\n    this._height = this.__height = height || 500;\n    this._autopad = 1;\n    this._padding = {top:0, left:0, bottom:0, right:0};\n    this._viewport = null;\n    this._renderer = null;\n    this._handler = null;\n    this._io = vg.canvas;\n    if (el) this.initialize(el);\n  };\n  \n  var prototype = view.prototype;\n  \n  prototype.width = function(width) {\n    if (!arguments.length) return this.__width;\n    if (this.__width !== width) {\n      this._width = this.__width = width;\n      if (this._el) this.initialize(this._el.parentNode);\n      this._model.width(width);\n      if (this._strict) this._autopad = 1;\n    }\n    return this;\n  };\n\n  prototype.height = function(height) {\n    if (!arguments.length) return this.__height;\n    if (this.__height !== height) {\n      this._height = this.__height = height;\n      if (this._el) this.initialize(this._el.parentNode);\n      this._model.height(this._height);\n      if (this._strict) this._autopad = 1;\n    }\n    return this;\n  };\n\n  prototype.padding = function(pad) {\n    if (!arguments.length) return this._padding;\n    if (this._padding !== pad) {\n      if (vg.isString(pad)) {\n        this._autopad = 1;\n        this._padding = {top:0, left:0, bottom:0, right:0};\n        this._strict = (pad === \"strict\");\n      } else {\n        this._autopad = 0;\n        this._padding = pad;\n        this._strict = false;\n      }\n      if (this._el) {\n        this._renderer.resize(this._width, this._height, pad);\n        this._handler.padding(pad);\n      }\n    }\n    return this;\n  };\n  \n  prototype.autopad = function(opt) {\n    if (this._autopad < 1) return this;\n    else this._autopad = 0;\n\n    var pad = this._padding,\n        b = this.model().scene().bounds,\n        inset = vg.config.autopadInset,\n        l = b.x1 < 0 ? Math.ceil(-b.x1) + inset : 0,\n        t = b.y1 < 0 ? Math.ceil(-b.y1) + inset : 0,\n        r = b.x2 > this._width  ? Math.ceil(+b.x2 - this._width) + inset : 0,\n        b = b.y2 > this._height ? Math.ceil(+b.y2 - this._height) + inset : 0;\n    pad = {left:l, top:t, right:r, bottom:b};\n\n    if (this._strict) {\n      this._autopad = 0;\n      this._padding = pad;\n      this._width = Math.max(0, this.__width - (l+r));\n      this._height = Math.max(0, this.__height - (t+b));\n      this._model.width(this._width);\n      this._model.height(this._height);\n      if (this._el) this.initialize(this._el.parentNode);\n      this.update({props:\"enter\"}).update({props:\"update\"});\n    } else {\n      this.padding(pad).update(opt);\n    }\n    return this;\n  };\n\n  prototype.viewport = function(size) {\n    if (!arguments.length) return this._viewport;\n    if (this._viewport !== size) {\n      this._viewport = size;\n      if (this._el) this.initialize(this._el.parentNode);\n    }\n    return this;\n  };\n  \n  prototype.renderer = function(type) {\n    if (!arguments.length) return this._io;\n    if (type === \"canvas\") type = vg.canvas;\n    if (type === \"svg\") type = vg.svg;\n    if (this._io !== type) {\n      this._io = type;\n      this._renderer = null;\n      if (this._el) this.initialize(this._el.parentNode);\n      if (this._build) this.render();\n    }\n    return this;\n  };\n\n  prototype.defs = function(defs) {\n    if (!arguments.length) return this._model.defs();\n    this._model.defs(defs);\n    return this;\n  };\n\n  prototype.data = function(data) {\n    if (!arguments.length) return this._model.data();\n    var ingest = vg.keys(data).reduce(function(d, k) {\n      return (d[k] = vg.data.ingestAll(data[k]), d);\n    }, {});\n    this._model.data(ingest);\n    this._build = false;\n    return this;\n  };\n\n  prototype.model = function(model) {\n    if (!arguments.length) return this._model;\n    if (this._model !== model) {\n      this._model = model;\n      if (this._handler) this._handler.model(model);\n    }\n    return this;\n  };\n\n  prototype.initialize = function(el) {\n    var v = this, prevHandler,\n        w = v._width, h = v._height, pad = v._padding;\n    \n    // clear pre-existing container\n    d3.select(el).select(\"div.vega\").remove();\n    \n    // add div container\n    this._el = el = d3.select(el)\n      .append(\"div\")\n      .attr(\"class\", \"vega\")\n      .style(\"position\", \"relative\")\n      .node();\n    if (v._viewport) {\n      d3.select(el)\n        .style(\"width\",  (v._viewport[0] || w)+\"px\")\n        .style(\"height\", (v._viewport[1] || h)+\"px\")\n        .style(\"overflow\", \"auto\");\n    }\n    \n    // renderer\n    v._renderer = (v._renderer || new this._io.Renderer())\n      .initialize(el, w, h, pad);\n    \n    // input handler\n    prevHandler = v._handler;\n    v._handler = new this._io.Handler()\n      .initialize(el, pad, v)\n      .model(v._model);\n\n    if (prevHandler) {\n      prevHandler.handlers().forEach(function(h) {\n        v._handler.on(h.type, h.handler);\n      });\n    }\n    \n    return this;\n  };\n  \n  prototype.render = function(items) {\n    this._renderer.render(this._model.scene(), items);\n    return this;\n  };\n  \n  prototype.on = function() {\n    this._handler.on.apply(this._handler, arguments);\n    return this;\n  };\n  \n  prototype.off = function() {\n    this._handler.off.apply(this._handler, arguments);\n    return this;\n  };\n  \n  prototype.update = function(opt) {    \n    opt = opt || {};\n    var view = this,\n        trans = opt.duration\n          ? vg.scene.transition(opt.duration, opt.ease)\n          : null;\n\n    view._build = view._build || (view._model.build(), true);\n    view._model.encode(trans, opt.props, opt.items);\n    \n    if (trans) {\n      trans.start(function(items) {\n        view._renderer.render(view._model.scene(), items);\n      });\n    }\n    else view.render(opt.items);\n\n    return view.autopad(opt);\n  };\n      \n  return view;\n})();\n\n// view constructor factory\n// takes definitions from parsed specification as input\n// returns a view constructor\nvg.ViewFactory = function(defs) {\n  return function(opt) {\n    opt = opt || {};\n    var v = new vg.View()\n      .width(defs.width)\n      .height(defs.height)\n      .padding(defs.padding)\n      .viewport(defs.viewport)\n      .renderer(opt.renderer || \"canvas\")\n      .defs(defs);\n\n    if (defs.data.load) v.data(defs.data.load);\n    if (opt.data) v.data(opt.data);\n    if (opt.el) v.initialize(opt.el);\n\n    if (opt.hover !== false) {\n      v.on(\"mouseover\", function(evt, item) {\n        if (item.hasPropertySet(\"hover\")) {\n          this.update({props:\"hover\", items:item});\n        }\n      })\n      .on(\"mouseout\", function(evt, item) {\n        if (item.hasPropertySet(\"hover\")) {\n          this.update({props:\"update\", items:item});\n        }\n      });\n    }\n  \n    return v;\n  };\n};\nvg.Spec = (function() {\n  var spec = function(s) {\n    this.spec = {\n      width: 500,\n      height: 500,\n      padding: 0,\n      data: [],\n      scales: [],\n      axes: [],\n      marks: []\n    };\n    if (s) vg.extend(this.spec, s);\n  };\n  \n  var prototype = spec.prototype;\n\n  prototype.width = function(w) {\n    this.spec.width = w;\n    return this;\n  };\n  \n  prototype.height = function(h) {\n    this.spec.height = h;\n    return this;\n  };\n  \n  prototype.padding = function(p) {\n    this.spec.padding = p;\n    return this;\n  };\n  \n  prototype.viewport = function(v) {\n    this.spec.viewport = v;\n    return this;\n  };\n\n  prototype.data = function(name, params) {\n    if (!params) params = vg.isString(name) ? {name: name} : name;\n    else params.name = name;\n    this.spec.data.push(params);\n    return this;\n  };\n  \n  prototype.scale = function(name, params) {\n    if (!params) params = vg.isString(name) ? {name: name} : name;\n    else params.name = name;\n    this.spec.scales.push(params);\n    return this;\n  };\n  \n  prototype.axis = function(params) {\n    this.spec.axes.push(params);\n    return this;\n  };\n  \n  prototype.mark = function(type, mark) {\n    if (!mark) mark = {type: type};\n    else mark.type = type;\n    mark.properties = {};\n    this.spec.marks.push(mark);\n    \n    var that = this;\n    return {\n      from: function(name, obj) {\n              mark.from = obj\n                ? (obj.data = name, obj)\n                : vg.isString(name) ? {data: name} : name;\n              return this;\n            },\n      prop: function(name, obj) {\n              mark.properties[name] = vg.keys(obj).reduce(function(o,k) {\n                var v = obj[k];\n                return (o[k] = vg.isObject(v) ? v : {value: v}, o);\n              }, {});\n              return this;\n            },\n      done: function() { return that; }\n    };\n  };\n\n  prototype.parse = function(callback) {\n    vg.parse.spec(this.spec, callback);\n  };\n\n  prototype.json = function() {\n    return this.spec;\n  };\n\n  return spec;\n})();\n\nvg.spec = function(s) {\n  return new vg.Spec(s);\n};\nvg.headless = {};vg.headless.View = (function() {\n  \n  var view = function(width, height, pad, type, vp) {\n    this._canvas = null;\n    this._type = type;\n    this._el = \"body\";\n    this._build = false;\n    this._model = new vg.Model();\n    this._width = this.__width = width || 500;\n    this._height = this.__height = height || 500;\n    this._padding = pad || {top:0, left:0, bottom:0, right:0};\n    this._autopad = vg.isString(this._padding) ? 1 : 0;\n    this._renderer = new vg[type].Renderer();\n    this._viewport = vp || null;\n    this.initialize();\n  };\n  \n  var prototype = view.prototype;\n\n  prototype.el = function(el) {\n    if (!arguments.length) return this._el;\n    if (this._el !== el) {\n      this._el = el;\n      this.initialize();\n    }\n    return this;\n  };\n\n  prototype.width = function(width) {\n    if (!arguments.length) return this._width;\n    if (this._width !== width) {\n      this._width = width;\n      this.initialize();\n      this._model.width(width);\n    }\n    return this;\n  };\n\n  prototype.height = function(height) {\n    if (!arguments.length) return this._height;\n    if (this._height !== height) {\n      this._height = height;\n      this.initialize();\n      this._model.height(this._height);\n    }\n    return this;\n  };\n\n  prototype.padding = function(pad) {\n    if (!arguments.length) return this._padding;\n    if (this._padding !== pad) {\n      if (vg.isString(pad)) {\n        this._autopad = 1;\n        this._padding = {top:0, left:0, bottom:0, right:0};\n        this._strict = (pad === \"strict\");\n      } else {\n        this._autopad = 0;\n        this._padding = pad;\n        this._strict = false;\n      }\n      this.initialize();\n    }\n    return this;\n  };\n\n  prototype.autopad = function(opt) {\n    if (this._autopad < 1) return this;\n    else this._autopad = 0;\n\n    var pad = this._padding,\n        b = this._model.scene().bounds,\n        inset = vg.config.autopadInset,\n        l = b.x1 < 0 ? Math.ceil(-b.x1) + inset : 0,\n        t = b.y1 < 0 ? Math.ceil(-b.y1) + inset : 0,\n        r = b.x2 > this._width  ? Math.ceil(+b.x2 - this._width) + inset : 0,\n        b = b.y2 > this._height ? Math.ceil(+b.y2 - this._height) + inset : 0;\n    pad = {left:l, top:t, right:r, bottom:b};\n\n    if (this._strict) {\n      this._autopad = 0;\n      this._padding = pad;\n      this._width = Math.max(0, this.__width - (l+r));\n      this._height = Math.max(0, this.__height - (t+b));\n      this._model.width(this._width);\n      this._model.height(this._height);\n      if (this._el) this.initialize();\n      this.update({props:\"enter\"}).update({props:\"update\"});\n    } else {\n      this.padding(pad).update(opt);\n    }\n    return this;\n  };\n\n  prototype.viewport = function(vp) {\n    if (!arguments.length) return _viewport;\n    this._viewport = vp;\n    this.initialize();\n    return this;\n  };\n\n  prototype.defs = function(defs) {\n    if (!arguments.length) return this._model.defs();\n    this._model.defs(defs);\n    return this;\n  };\n\n  prototype.data = function(data) {\n    if (!arguments.length) return this._model.data();\n    var ingest = vg.keys(data).reduce(function(d, k) {\n      return (d[k] = vg.data.ingestAll(data[k]), d);\n    }, {});\n    this._model.data(ingest);\n    this._build = false;\n    return this;\n  };\n\n  prototype.renderer = function() {\n    return this._renderer;\n  };\n\n  prototype.canvas = function() {\n    return this._canvas;\n  };\n  \n  prototype.canvasAsync = function(callback) {\n    var r = this._renderer, view = this;\n    \n    function wait() {\n      if (r.pendingImages() === 0) {\n        view.render(); // re-render with all images\n        callback(view._canvas);\n      } else {\n        setTimeout(wait, 10);\n      }\n    }\n\n    // if images loading, poll until ready\n    (r.pendingImages() > 0) ? wait() : callback(this._canvas);\n  };\n  \n  prototype.svg = function() {\n    if (this._type !== \"svg\") return null;\n\n    var p = this._padding,\n        w = this._width  + (p ? p.left + p.right : 0),\n        h = this._height + (p ? p.top + p.bottom : 0);\n\n    if (this._viewport) {\n      w = this._viewport[0] - (p ? p.left + p.right : 0);\n      h = this._viewport[1] - (p ? p.top + p.bottom : 0);\n    }\n\n      // build svg text\n    var svg = d3.select(this._el)\n      .select(\"svg\").node().innerHTML\n      .replace(/ href=/g, \" xlink:href=\"); // ns hack. sigh.\n\n    return '<svg '\n      + 'width=\"' + w + '\" '\n      + 'height=\"' + h + '\" '\n      + vg.config.svgNamespace + '>' + svg + '</svg>'\n  };\n\n  prototype.initialize = function() {    \n    var w = this._width,\n        h = this._height,\n        pad = this._padding;\n\n    if (this._viewport) {\n      w = this._viewport[0] - (pad ? pad.left + pad.right : 0);\n      h = this._viewport[1] - (pad ? pad.top + pad.bottom : 0);\n    }\n    \n    if (this._type === \"svg\") {\n      this.initSVG(w, h, pad);\n    } else {\n      this.initCanvas(w, h, pad);\n    }\n    \n    return this;\n  };\n  \n  prototype.initCanvas = function(w, h, pad) {\n    var Canvas = require(\"canvas\"),\n        tw = w + pad.left + pad.right,\n        th = h + pad.top + pad.bottom,\n        canvas = this._canvas = new Canvas(tw, th),\n        ctx = canvas.getContext(\"2d\");\n    \n    // setup canvas context\n    ctx.setTransform(1, 0, 0, 1, pad.left, pad.top);\n\n    // configure renderer\n    this._renderer.context(ctx);\n    this._renderer.resize(w, h, pad);\n  };\n  \n  prototype.initSVG = function(w, h, pad) {\n    var tw = w + pad.left + pad.right,\n        th = h + pad.top + pad.bottom;\n\n    // configure renderer\n    this._renderer.initialize(this._el, w, h, pad);\n  }\n  \n  prototype.render = function(items) {\n    this._renderer.render(this._model.scene(), items);\n    return this;\n  };\n  \n  prototype.update = function(opt) {\n    opt = opt || {};\n    var view = this;\n    view._build = view._build || (view._model.build(), true);\n    view._model.encode(null, opt.props, opt.items);\n    view.render(opt.items);\n    return view.autopad(opt);\n  };\n    \n  return view;\n})();\n\n// headless view constructor factory\n// takes definitions from parsed specification as input\n// returns a view constructor\nvg.headless.View.Factory = function(defs) {\n  return function(opt) {\n    opt = opt || {};\n    var w = defs.width,\n        h = defs.height,\n        p = defs.padding,\n        vp = defs.viewport,\n        r = opt.renderer || \"canvas\",\n        v = new vg.headless.View(w, h, p, r, vp).defs(defs);\n    if (defs.data.load) v.data(defs.data.load);\n    if (opt.data) v.data(opt.data);\n    return v;\n  };\n};vg.headless.render = function(opt, callback) {\n  function draw(chart) {\n    try {\n      // create and render view\n      var view = chart({\n        data: opt.data,\n        renderer: opt.renderer\n      }).update();\n\n      if (opt.renderer === \"svg\") {\n        // extract rendered svg\n        callback(null, {svg: view.svg()});\n      } else {\n        // extract rendered canvas, waiting for any images to load\n        view.canvasAsync(function(canvas) {\n          callback(null, {canvas: canvas});\n        });\n      }\n    } catch (err) {\n      callback(err, null);\n    }\n  }\n\n  vg.parse.spec(opt.spec, draw, vg.headless.View.Factory);\n};  // return module\n  return vg;\n\n//---------------------------------------------------\n// END code for this module\n//---------------------------------------------------\n}));","//     Underscore.js 1.7.0\n//     http://underscorejs.org\n//     (c) 2009-2014 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n//     Underscore may be freely distributed under the MIT license.\n\n(function() {\n\n  // Baseline setup\n  // --------------\n\n  // Establish the root object, `window` in the browser, or `exports` on the server.\n  var root = this;\n\n  // Save the previous value of the `_` variable.\n  var previousUnderscore = root._;\n\n  // Save bytes in the minified (but not gzipped) version:\n  var ArrayProto = Array.prototype, ObjProto = Object.prototype, FuncProto = Function.prototype;\n\n  // Create quick reference variables for speed access to core prototypes.\n  var\n    push             = ArrayProto.push,\n    slice            = ArrayProto.slice,\n    concat           = ArrayProto.concat,\n    toString         = ObjProto.toString,\n    hasOwnProperty   = ObjProto.hasOwnProperty;\n\n  // All **ECMAScript 5** native function implementations that we hope to use\n  // are declared here.\n  var\n    nativeIsArray      = Array.isArray,\n    nativeKeys         = Object.keys,\n    nativeBind         = FuncProto.bind;\n\n  // Create a safe reference to the Underscore object for use below.\n  var _ = function(obj) {\n    if (obj instanceof _) return obj;\n    if (!(this instanceof _)) return new _(obj);\n    this._wrapped = obj;\n  };\n\n  // Export the Underscore object for **Node.js**, with\n  // backwards-compatibility for the old `require()` API. If we're in\n  // the browser, add `_` as a global object.\n  if (typeof exports !== 'undefined') {\n    if (typeof module !== 'undefined' && module.exports) {\n      exports = module.exports = _;\n    }\n    exports._ = _;\n  } else {\n    root._ = _;\n  }\n\n  // Current version.\n  _.VERSION = '1.7.0';\n\n  // Internal function that returns an efficient (for current engines) version\n  // of the passed-in callback, to be repeatedly applied in other Underscore\n  // functions.\n  var createCallback = function(func, context, argCount) {\n    if (context === void 0) return func;\n    switch (argCount == null ? 3 : argCount) {\n      case 1: return function(value) {\n        return func.call(context, value);\n      };\n      case 2: return function(value, other) {\n        return func.call(context, value, other);\n      };\n      case 3: return function(value, index, collection) {\n        return func.call(context, value, index, collection);\n      };\n      case 4: return function(accumulator, value, index, collection) {\n        return func.call(context, accumulator, value, index, collection);\n      };\n    }\n    return function() {\n      return func.apply(context, arguments);\n    };\n  };\n\n  // A mostly-internal function to generate callbacks that can be applied\n  // to each element in a collection, returning the desired result — either\n  // identity, an arbitrary callback, a property matcher, or a property accessor.\n  _.iteratee = function(value, context, argCount) {\n    if (value == null) return _.identity;\n    if (_.isFunction(value)) return createCallback(value, context, argCount);\n    if (_.isObject(value)) return _.matches(value);\n    return _.property(value);\n  };\n\n  // Collection Functions\n  // --------------------\n\n  // The cornerstone, an `each` implementation, aka `forEach`.\n  // Handles raw objects in addition to array-likes. Treats all\n  // sparse array-likes as if they were dense.\n  _.each = _.forEach = function(obj, iteratee, context) {\n    if (obj == null) return obj;\n    iteratee = createCallback(iteratee, context);\n    var i, length = obj.length;\n    if (length === +length) {\n      for (i = 0; i < length; i++) {\n        iteratee(obj[i], i, obj);\n      }\n    } else {\n      var keys = _.keys(obj);\n      for (i = 0, length = keys.length; i < length; i++) {\n        iteratee(obj[keys[i]], keys[i], obj);\n      }\n    }\n    return obj;\n  };\n\n  // Return the results of applying the iteratee to each element.\n  _.map = _.collect = function(obj, iteratee, context) {\n    if (obj == null) return [];\n    iteratee = _.iteratee(iteratee, context);\n    var keys = obj.length !== +obj.length && _.keys(obj),\n        length = (keys || obj).length,\n        results = Array(length),\n        currentKey;\n    for (var index = 0; index < length; index++) {\n      currentKey = keys ? keys[index] : index;\n      results[index] = iteratee(obj[currentKey], currentKey, obj);\n    }\n    return results;\n  };\n\n  var reduceError = 'Reduce of empty array with no initial value';\n\n  // **Reduce** builds up a single result from a list of values, aka `inject`,\n  // or `foldl`.\n  _.reduce = _.foldl = _.inject = function(obj, iteratee, memo, context) {\n    if (obj == null) obj = [];\n    iteratee = createCallback(iteratee, context, 4);\n    var keys = obj.length !== +obj.length && _.keys(obj),\n        length = (keys || obj).length,\n        index = 0, currentKey;\n    if (arguments.length < 3) {\n      if (!length) throw new TypeError(reduceError);\n      memo = obj[keys ? keys[index++] : index++];\n    }\n    for (; index < length; index++) {\n      currentKey = keys ? keys[index] : index;\n      memo = iteratee(memo, obj[currentKey], currentKey, obj);\n    }\n    return memo;\n  };\n\n  // The right-associative version of reduce, also known as `foldr`.\n  _.reduceRight = _.foldr = function(obj, iteratee, memo, context) {\n    if (obj == null) obj = [];\n    iteratee = createCallback(iteratee, context, 4);\n    var keys = obj.length !== + obj.length && _.keys(obj),\n        index = (keys || obj).length,\n        currentKey;\n    if (arguments.length < 3) {\n      if (!index) throw new TypeError(reduceError);\n      memo = obj[keys ? keys[--index] : --index];\n    }\n    while (index--) {\n      currentKey = keys ? keys[index] : index;\n      memo = iteratee(memo, obj[currentKey], currentKey, obj);\n    }\n    return memo;\n  };\n\n  // Return the first value which passes a truth test. Aliased as `detect`.\n  _.find = _.detect = function(obj, predicate, context) {\n    var result;\n    predicate = _.iteratee(predicate, context);\n    _.some(obj, function(value, index, list) {\n      if (predicate(value, index, list)) {\n        result = value;\n        return true;\n      }\n    });\n    return result;\n  };\n\n  // Return all the elements that pass a truth test.\n  // Aliased as `select`.\n  _.filter = _.select = function(obj, predicate, context) {\n    var results = [];\n    if (obj == null) return results;\n    predicate = _.iteratee(predicate, context);\n    _.each(obj, function(value, index, list) {\n      if (predicate(value, index, list)) results.push(value);\n    });\n    return results;\n  };\n\n  // Return all the elements for which a truth test fails.\n  _.reject = function(obj, predicate, context) {\n    return _.filter(obj, _.negate(_.iteratee(predicate)), context);\n  };\n\n  // Determine whether all of the elements match a truth test.\n  // Aliased as `all`.\n  _.every = _.all = function(obj, predicate, context) {\n    if (obj == null) return true;\n    predicate = _.iteratee(predicate, context);\n    var keys = obj.length !== +obj.length && _.keys(obj),\n        length = (keys || obj).length,\n        index, currentKey;\n    for (index = 0; index < length; index++) {\n      currentKey = keys ? keys[index] : index;\n      if (!predicate(obj[currentKey], currentKey, obj)) return false;\n    }\n    return true;\n  };\n\n  // Determine if at least one element in the object matches a truth test.\n  // Aliased as `any`.\n  _.some = _.any = function(obj, predicate, context) {\n    if (obj == null) return false;\n    predicate = _.iteratee(predicate, context);\n    var keys = obj.length !== +obj.length && _.keys(obj),\n        length = (keys || obj).length,\n        index, currentKey;\n    for (index = 0; index < length; index++) {\n      currentKey = keys ? keys[index] : index;\n      if (predicate(obj[currentKey], currentKey, obj)) return true;\n    }\n    return false;\n  };\n\n  // Determine if the array or object contains a given value (using `===`).\n  // Aliased as `include`.\n  _.contains = _.include = function(obj, target) {\n    if (obj == null) return false;\n    if (obj.length !== +obj.length) obj = _.values(obj);\n    return _.indexOf(obj, target) >= 0;\n  };\n\n  // Invoke a method (with arguments) on every item in a collection.\n  _.invoke = function(obj, method) {\n    var args = slice.call(arguments, 2);\n    var isFunc = _.isFunction(method);\n    return _.map(obj, function(value) {\n      return (isFunc ? method : value[method]).apply(value, args);\n    });\n  };\n\n  // Convenience version of a common use case of `map`: fetching a property.\n  _.pluck = function(obj, key) {\n    return _.map(obj, _.property(key));\n  };\n\n  // Convenience version of a common use case of `filter`: selecting only objects\n  // containing specific `key:value` pairs.\n  _.where = function(obj, attrs) {\n    return _.filter(obj, _.matches(attrs));\n  };\n\n  // Convenience version of a common use case of `find`: getting the first object\n  // containing specific `key:value` pairs.\n  _.findWhere = function(obj, attrs) {\n    return _.find(obj, _.matches(attrs));\n  };\n\n  // Return the maximum element (or element-based computation).\n  _.max = function(obj, iteratee, context) {\n    var result = -Infinity, lastComputed = -Infinity,\n        value, computed;\n    if (iteratee == null && obj != null) {\n      obj = obj.length === +obj.length ? obj : _.values(obj);\n      for (var i = 0, length = obj.length; i < length; i++) {\n        value = obj[i];\n        if (value > result) {\n          result = value;\n        }\n      }\n    } else {\n      iteratee = _.iteratee(iteratee, context);\n      _.each(obj, function(value, index, list) {\n        computed = iteratee(value, index, list);\n        if (computed > lastComputed || computed === -Infinity && result === -Infinity) {\n          result = value;\n          lastComputed = computed;\n        }\n      });\n    }\n    return result;\n  };\n\n  // Return the minimum element (or element-based computation).\n  _.min = function(obj, iteratee, context) {\n    var result = Infinity, lastComputed = Infinity,\n        value, computed;\n    if (iteratee == null && obj != null) {\n      obj = obj.length === +obj.length ? obj : _.values(obj);\n      for (var i = 0, length = obj.length; i < length; i++) {\n        value = obj[i];\n        if (value < result) {\n          result = value;\n        }\n      }\n    } else {\n      iteratee = _.iteratee(iteratee, context);\n      _.each(obj, function(value, index, list) {\n        computed = iteratee(value, index, list);\n        if (computed < lastComputed || computed === Infinity && result === Infinity) {\n          result = value;\n          lastComputed = computed;\n        }\n      });\n    }\n    return result;\n  };\n\n  // Shuffle a collection, using the modern version of the\n  // [Fisher-Yates shuffle](http://en.wikipedia.org/wiki/Fisher–Yates_shuffle).\n  _.shuffle = function(obj) {\n    var set = obj && obj.length === +obj.length ? obj : _.values(obj);\n    var length = set.length;\n    var shuffled = Array(length);\n    for (var index = 0, rand; index < length; index++) {\n      rand = _.random(0, index);\n      if (rand !== index) shuffled[index] = shuffled[rand];\n      shuffled[rand] = set[index];\n    }\n    return shuffled;\n  };\n\n  // Sample **n** random values from a collection.\n  // If **n** is not specified, returns a single random element.\n  // The internal `guard` argument allows it to work with `map`.\n  _.sample = function(obj, n, guard) {\n    if (n == null || guard) {\n      if (obj.length !== +obj.length) obj = _.values(obj);\n      return obj[_.random(obj.length - 1)];\n    }\n    return _.shuffle(obj).slice(0, Math.max(0, n));\n  };\n\n  // Sort the object's values by a criterion produced by an iteratee.\n  _.sortBy = function(obj, iteratee, context) {\n    iteratee = _.iteratee(iteratee, context);\n    return _.pluck(_.map(obj, function(value, index, list) {\n      return {\n        value: value,\n        index: index,\n        criteria: iteratee(value, index, list)\n      };\n    }).sort(function(left, right) {\n      var a = left.criteria;\n      var b = right.criteria;\n      if (a !== b) {\n        if (a > b || a === void 0) return 1;\n        if (a < b || b === void 0) return -1;\n      }\n      return left.index - right.index;\n    }), 'value');\n  };\n\n  // An internal function used for aggregate \"group by\" operations.\n  var group = function(behavior) {\n    return function(obj, iteratee, context) {\n      var result = {};\n      iteratee = _.iteratee(iteratee, context);\n      _.each(obj, function(value, index) {\n        var key = iteratee(value, index, obj);\n        behavior(result, value, key);\n      });\n      return result;\n    };\n  };\n\n  // Groups the object's values by a criterion. Pass either a string attribute\n  // to group by, or a function that returns the criterion.\n  _.groupBy = group(function(result, value, key) {\n    if (_.has(result, key)) result[key].push(value); else result[key] = [value];\n  });\n\n  // Indexes the object's values by a criterion, similar to `groupBy`, but for\n  // when you know that your index values will be unique.\n  _.indexBy = group(function(result, value, key) {\n    result[key] = value;\n  });\n\n  // Counts instances of an object that group by a certain criterion. Pass\n  // either a string attribute to count by, or a function that returns the\n  // criterion.\n  _.countBy = group(function(result, value, key) {\n    if (_.has(result, key)) result[key]++; else result[key] = 1;\n  });\n\n  // Use a comparator function to figure out the smallest index at which\n  // an object should be inserted so as to maintain order. Uses binary search.\n  _.sortedIndex = function(array, obj, iteratee, context) {\n    iteratee = _.iteratee(iteratee, context, 1);\n    var value = iteratee(obj);\n    var low = 0, high = array.length;\n    while (low < high) {\n      var mid = low + high >>> 1;\n      if (iteratee(array[mid]) < value) low = mid + 1; else high = mid;\n    }\n    return low;\n  };\n\n  // Safely create a real, live array from anything iterable.\n  _.toArray = function(obj) {\n    if (!obj) return [];\n    if (_.isArray(obj)) return slice.call(obj);\n    if (obj.length === +obj.length) return _.map(obj, _.identity);\n    return _.values(obj);\n  };\n\n  // Return the number of elements in an object.\n  _.size = function(obj) {\n    if (obj == null) return 0;\n    return obj.length === +obj.length ? obj.length : _.keys(obj).length;\n  };\n\n  // Split a collection into two arrays: one whose elements all satisfy the given\n  // predicate, and one whose elements all do not satisfy the predicate.\n  _.partition = function(obj, predicate, context) {\n    predicate = _.iteratee(predicate, context);\n    var pass = [], fail = [];\n    _.each(obj, function(value, key, obj) {\n      (predicate(value, key, obj) ? pass : fail).push(value);\n    });\n    return [pass, fail];\n  };\n\n  // Array Functions\n  // ---------------\n\n  // Get the first element of an array. Passing **n** will return the first N\n  // values in the array. Aliased as `head` and `take`. The **guard** check\n  // allows it to work with `_.map`.\n  _.first = _.head = _.take = function(array, n, guard) {\n    if (array == null) return void 0;\n    if (n == null || guard) return array[0];\n    if (n < 0) return [];\n    return slice.call(array, 0, n);\n  };\n\n  // Returns everything but the last entry of the array. Especially useful on\n  // the arguments object. Passing **n** will return all the values in\n  // the array, excluding the last N. The **guard** check allows it to work with\n  // `_.map`.\n  _.initial = function(array, n, guard) {\n    return slice.call(array, 0, Math.max(0, array.length - (n == null || guard ? 1 : n)));\n  };\n\n  // Get the last element of an array. Passing **n** will return the last N\n  // values in the array. The **guard** check allows it to work with `_.map`.\n  _.last = function(array, n, guard) {\n    if (array == null) return void 0;\n    if (n == null || guard) return array[array.length - 1];\n    return slice.call(array, Math.max(array.length - n, 0));\n  };\n\n  // Returns everything but the first entry of the array. Aliased as `tail` and `drop`.\n  // Especially useful on the arguments object. Passing an **n** will return\n  // the rest N values in the array. The **guard**\n  // check allows it to work with `_.map`.\n  _.rest = _.tail = _.drop = function(array, n, guard) {\n    return slice.call(array, n == null || guard ? 1 : n);\n  };\n\n  // Trim out all falsy values from an array.\n  _.compact = function(array) {\n    return _.filter(array, _.identity);\n  };\n\n  // Internal implementation of a recursive `flatten` function.\n  var flatten = function(input, shallow, strict, output) {\n    if (shallow && _.every(input, _.isArray)) {\n      return concat.apply(output, input);\n    }\n    for (var i = 0, length = input.length; i < length; i++) {\n      var value = input[i];\n      if (!_.isArray(value) && !_.isArguments(value)) {\n        if (!strict) output.push(value);\n      } else if (shallow) {\n        push.apply(output, value);\n      } else {\n        flatten(value, shallow, strict, output);\n      }\n    }\n    return output;\n  };\n\n  // Flatten out an array, either recursively (by default), or just one level.\n  _.flatten = function(array, shallow) {\n    return flatten(array, shallow, false, []);\n  };\n\n  // Return a version of the array that does not contain the specified value(s).\n  _.without = function(array) {\n    return _.difference(array, slice.call(arguments, 1));\n  };\n\n  // Produce a duplicate-free version of the array. If the array has already\n  // been sorted, you have the option of using a faster algorithm.\n  // Aliased as `unique`.\n  _.uniq = _.unique = function(array, isSorted, iteratee, context) {\n    if (array == null) return [];\n    if (!_.isBoolean(isSorted)) {\n      context = iteratee;\n      iteratee = isSorted;\n      isSorted = false;\n    }\n    if (iteratee != null) iteratee = _.iteratee(iteratee, context);\n    var result = [];\n    var seen = [];\n    for (var i = 0, length = array.length; i < length; i++) {\n      var value = array[i];\n      if (isSorted) {\n        if (!i || seen !== value) result.push(value);\n        seen = value;\n      } else if (iteratee) {\n        var computed = iteratee(value, i, array);\n        if (_.indexOf(seen, computed) < 0) {\n          seen.push(computed);\n          result.push(value);\n        }\n      } else if (_.indexOf(result, value) < 0) {\n        result.push(value);\n      }\n    }\n    return result;\n  };\n\n  // Produce an array that contains the union: each distinct element from all of\n  // the passed-in arrays.\n  _.union = function() {\n    return _.uniq(flatten(arguments, true, true, []));\n  };\n\n  // Produce an array that contains every item shared between all the\n  // passed-in arrays.\n  _.intersection = function(array) {\n    if (array == null) return [];\n    var result = [];\n    var argsLength = arguments.length;\n    for (var i = 0, length = array.length; i < length; i++) {\n      var item = array[i];\n      if (_.contains(result, item)) continue;\n      for (var j = 1; j < argsLength; j++) {\n        if (!_.contains(arguments[j], item)) break;\n      }\n      if (j === argsLength) result.push(item);\n    }\n    return result;\n  };\n\n  // Take the difference between one array and a number of other arrays.\n  // Only the elements present in just the first array will remain.\n  _.difference = function(array) {\n    var rest = flatten(slice.call(arguments, 1), true, true, []);\n    return _.filter(array, function(value){\n      return !_.contains(rest, value);\n    });\n  };\n\n  // Zip together multiple lists into a single array -- elements that share\n  // an index go together.\n  _.zip = function(array) {\n    if (array == null) return [];\n    var length = _.max(arguments, 'length').length;\n    var results = Array(length);\n    for (var i = 0; i < length; i++) {\n      results[i] = _.pluck(arguments, i);\n    }\n    return results;\n  };\n\n  // Converts lists into objects. Pass either a single array of `[key, value]`\n  // pairs, or two parallel arrays of the same length -- one of keys, and one of\n  // the corresponding values.\n  _.object = function(list, values) {\n    if (list == null) return {};\n    var result = {};\n    for (var i = 0, length = list.length; i < length; i++) {\n      if (values) {\n        result[list[i]] = values[i];\n      } else {\n        result[list[i][0]] = list[i][1];\n      }\n    }\n    return result;\n  };\n\n  // Return the position of the first occurrence of an item in an array,\n  // or -1 if the item is not included in the array.\n  // If the array is large and already in sort order, pass `true`\n  // for **isSorted** to use binary search.\n  _.indexOf = function(array, item, isSorted) {\n    if (array == null) return -1;\n    var i = 0, length = array.length;\n    if (isSorted) {\n      if (typeof isSorted == 'number') {\n        i = isSorted < 0 ? Math.max(0, length + isSorted) : isSorted;\n      } else {\n        i = _.sortedIndex(array, item);\n        return array[i] === item ? i : -1;\n      }\n    }\n    for (; i < length; i++) if (array[i] === item) return i;\n    return -1;\n  };\n\n  _.lastIndexOf = function(array, item, from) {\n    if (array == null) return -1;\n    var idx = array.length;\n    if (typeof from == 'number') {\n      idx = from < 0 ? idx + from + 1 : Math.min(idx, from + 1);\n    }\n    while (--idx >= 0) if (array[idx] === item) return idx;\n    return -1;\n  };\n\n  // Generate an integer Array containing an arithmetic progression. A port of\n  // the native Python `range()` function. See\n  // [the Python documentation](http://docs.python.org/library/functions.html#range).\n  _.range = function(start, stop, step) {\n    if (arguments.length <= 1) {\n      stop = start || 0;\n      start = 0;\n    }\n    step = step || 1;\n\n    var length = Math.max(Math.ceil((stop - start) / step), 0);\n    var range = Array(length);\n\n    for (var idx = 0; idx < length; idx++, start += step) {\n      range[idx] = start;\n    }\n\n    return range;\n  };\n\n  // Function (ahem) Functions\n  // ------------------\n\n  // Reusable constructor function for prototype setting.\n  var Ctor = function(){};\n\n  // Create a function bound to a given object (assigning `this`, and arguments,\n  // optionally). Delegates to **ECMAScript 5**'s native `Function.bind` if\n  // available.\n  _.bind = function(func, context) {\n    var args, bound;\n    if (nativeBind && func.bind === nativeBind) return nativeBind.apply(func, slice.call(arguments, 1));\n    if (!_.isFunction(func)) throw new TypeError('Bind must be called on a function');\n    args = slice.call(arguments, 2);\n    bound = function() {\n      if (!(this instanceof bound)) return func.apply(context, args.concat(slice.call(arguments)));\n      Ctor.prototype = func.prototype;\n      var self = new Ctor;\n      Ctor.prototype = null;\n      var result = func.apply(self, args.concat(slice.call(arguments)));\n      if (_.isObject(result)) return result;\n      return self;\n    };\n    return bound;\n  };\n\n  // Partially apply a function by creating a version that has had some of its\n  // arguments pre-filled, without changing its dynamic `this` context. _ acts\n  // as a placeholder, allowing any combination of arguments to be pre-filled.\n  _.partial = function(func) {\n    var boundArgs = slice.call(arguments, 1);\n    return function() {\n      var position = 0;\n      var args = boundArgs.slice();\n      for (var i = 0, length = args.length; i < length; i++) {\n        if (args[i] === _) args[i] = arguments[position++];\n      }\n      while (position < arguments.length) args.push(arguments[position++]);\n      return func.apply(this, args);\n    };\n  };\n\n  // Bind a number of an object's methods to that object. Remaining arguments\n  // are the method names to be bound. Useful for ensuring that all callbacks\n  // defined on an object belong to it.\n  _.bindAll = function(obj) {\n    var i, length = arguments.length, key;\n    if (length <= 1) throw new Error('bindAll must be passed function names');\n    for (i = 1; i < length; i++) {\n      key = arguments[i];\n      obj[key] = _.bind(obj[key], obj);\n    }\n    return obj;\n  };\n\n  // Memoize an expensive function by storing its results.\n  _.memoize = function(func, hasher) {\n    var memoize = function(key) {\n      var cache = memoize.cache;\n      var address = hasher ? hasher.apply(this, arguments) : key;\n      if (!_.has(cache, address)) cache[address] = func.apply(this, arguments);\n      return cache[address];\n    };\n    memoize.cache = {};\n    return memoize;\n  };\n\n  // Delays a function for the given number of milliseconds, and then calls\n  // it with the arguments supplied.\n  _.delay = function(func, wait) {\n    var args = slice.call(arguments, 2);\n    return setTimeout(function(){\n      return func.apply(null, args);\n    }, wait);\n  };\n\n  // Defers a function, scheduling it to run after the current call stack has\n  // cleared.\n  _.defer = function(func) {\n    return _.delay.apply(_, [func, 1].concat(slice.call(arguments, 1)));\n  };\n\n  // Returns a function, that, when invoked, will only be triggered at most once\n  // during a given window of time. Normally, the throttled function will run\n  // as much as it can, without ever going more than once per `wait` duration;\n  // but if you'd like to disable the execution on the leading edge, pass\n  // `{leading: false}`. To disable execution on the trailing edge, ditto.\n  _.throttle = function(func, wait, options) {\n    var context, args, result;\n    var timeout = null;\n    var previous = 0;\n    if (!options) options = {};\n    var later = function() {\n      previous = options.leading === false ? 0 : _.now();\n      timeout = null;\n      result = func.apply(context, args);\n      if (!timeout) context = args = null;\n    };\n    return function() {\n      var now = _.now();\n      if (!previous && options.leading === false) previous = now;\n      var remaining = wait - (now - previous);\n      context = this;\n      args = arguments;\n      if (remaining <= 0 || remaining > wait) {\n        clearTimeout(timeout);\n        timeout = null;\n        previous = now;\n        result = func.apply(context, args);\n        if (!timeout) context = args = null;\n      } else if (!timeout && options.trailing !== false) {\n        timeout = setTimeout(later, remaining);\n      }\n      return result;\n    };\n  };\n\n  // Returns a function, that, as long as it continues to be invoked, will not\n  // be triggered. The function will be called after it stops being called for\n  // N milliseconds. If `immediate` is passed, trigger the function on the\n  // leading edge, instead of the trailing.\n  _.debounce = function(func, wait, immediate) {\n    var timeout, args, context, timestamp, result;\n\n    var later = function() {\n      var last = _.now() - timestamp;\n\n      if (last < wait && last > 0) {\n        timeout = setTimeout(later, wait - last);\n      } else {\n        timeout = null;\n        if (!immediate) {\n          result = func.apply(context, args);\n          if (!timeout) context = args = null;\n        }\n      }\n    };\n\n    return function() {\n      context = this;\n      args = arguments;\n      timestamp = _.now();\n      var callNow = immediate && !timeout;\n      if (!timeout) timeout = setTimeout(later, wait);\n      if (callNow) {\n        result = func.apply(context, args);\n        context = args = null;\n      }\n\n      return result;\n    };\n  };\n\n  // Returns the first function passed as an argument to the second,\n  // allowing you to adjust arguments, run code before and after, and\n  // conditionally execute the original function.\n  _.wrap = function(func, wrapper) {\n    return _.partial(wrapper, func);\n  };\n\n  // Returns a negated version of the passed-in predicate.\n  _.negate = function(predicate) {\n    return function() {\n      return !predicate.apply(this, arguments);\n    };\n  };\n\n  // Returns a function that is the composition of a list of functions, each\n  // consuming the return value of the function that follows.\n  _.compose = function() {\n    var args = arguments;\n    var start = args.length - 1;\n    return function() {\n      var i = start;\n      var result = args[start].apply(this, arguments);\n      while (i--) result = args[i].call(this, result);\n      return result;\n    };\n  };\n\n  // Returns a function that will only be executed after being called N times.\n  _.after = function(times, func) {\n    return function() {\n      if (--times < 1) {\n        return func.apply(this, arguments);\n      }\n    };\n  };\n\n  // Returns a function that will only be executed before being called N times.\n  _.before = function(times, func) {\n    var memo;\n    return function() {\n      if (--times > 0) {\n        memo = func.apply(this, arguments);\n      } else {\n        func = null;\n      }\n      return memo;\n    };\n  };\n\n  // Returns a function that will be executed at most one time, no matter how\n  // often you call it. Useful for lazy initialization.\n  _.once = _.partial(_.before, 2);\n\n  // Object Functions\n  // ----------------\n\n  // Retrieve the names of an object's properties.\n  // Delegates to **ECMAScript 5**'s native `Object.keys`\n  _.keys = function(obj) {\n    if (!_.isObject(obj)) return [];\n    if (nativeKeys) return nativeKeys(obj);\n    var keys = [];\n    for (var key in obj) if (_.has(obj, key)) keys.push(key);\n    return keys;\n  };\n\n  // Retrieve the values of an object's properties.\n  _.values = function(obj) {\n    var keys = _.keys(obj);\n    var length = keys.length;\n    var values = Array(length);\n    for (var i = 0; i < length; i++) {\n      values[i] = obj[keys[i]];\n    }\n    return values;\n  };\n\n  // Convert an object into a list of `[key, value]` pairs.\n  _.pairs = function(obj) {\n    var keys = _.keys(obj);\n    var length = keys.length;\n    var pairs = Array(length);\n    for (var i = 0; i < length; i++) {\n      pairs[i] = [keys[i], obj[keys[i]]];\n    }\n    return pairs;\n  };\n\n  // Invert the keys and values of an object. The values must be serializable.\n  _.invert = function(obj) {\n    var result = {};\n    var keys = _.keys(obj);\n    for (var i = 0, length = keys.length; i < length; i++) {\n      result[obj[keys[i]]] = keys[i];\n    }\n    return result;\n  };\n\n  // Return a sorted list of the function names available on the object.\n  // Aliased as `methods`\n  _.functions = _.methods = function(obj) {\n    var names = [];\n    for (var key in obj) {\n      if (_.isFunction(obj[key])) names.push(key);\n    }\n    return names.sort();\n  };\n\n  // Extend a given object with all the properties in passed-in object(s).\n  _.extend = function(obj) {\n    if (!_.isObject(obj)) return obj;\n    var source, prop;\n    for (var i = 1, length = arguments.length; i < length; i++) {\n      source = arguments[i];\n      for (prop in source) {\n        if (hasOwnProperty.call(source, prop)) {\n            obj[prop] = source[prop];\n        }\n      }\n    }\n    return obj;\n  };\n\n  // Return a copy of the object only containing the whitelisted properties.\n  _.pick = function(obj, iteratee, context) {\n    var result = {}, key;\n    if (obj == null) return result;\n    if (_.isFunction(iteratee)) {\n      iteratee = createCallback(iteratee, context);\n      for (key in obj) {\n        var value = obj[key];\n        if (iteratee(value, key, obj)) result[key] = value;\n      }\n    } else {\n      var keys = concat.apply([], slice.call(arguments, 1));\n      obj = new Object(obj);\n      for (var i = 0, length = keys.length; i < length; i++) {\n        key = keys[i];\n        if (key in obj) result[key] = obj[key];\n      }\n    }\n    return result;\n  };\n\n   // Return a copy of the object without the blacklisted properties.\n  _.omit = function(obj, iteratee, context) {\n    if (_.isFunction(iteratee)) {\n      iteratee = _.negate(iteratee);\n    } else {\n      var keys = _.map(concat.apply([], slice.call(arguments, 1)), String);\n      iteratee = function(value, key) {\n        return !_.contains(keys, key);\n      };\n    }\n    return _.pick(obj, iteratee, context);\n  };\n\n  // Fill in a given object with default properties.\n  _.defaults = function(obj) {\n    if (!_.isObject(obj)) return obj;\n    for (var i = 1, length = arguments.length; i < length; i++) {\n      var source = arguments[i];\n      for (var prop in source) {\n        if (obj[prop] === void 0) obj[prop] = source[prop];\n      }\n    }\n    return obj;\n  };\n\n  // Create a (shallow-cloned) duplicate of an object.\n  _.clone = function(obj) {\n    if (!_.isObject(obj)) return obj;\n    return _.isArray(obj) ? obj.slice() : _.extend({}, obj);\n  };\n\n  // Invokes interceptor with the obj, and then returns obj.\n  // The primary purpose of this method is to \"tap into\" a method chain, in\n  // order to perform operations on intermediate results within the chain.\n  _.tap = function(obj, interceptor) {\n    interceptor(obj);\n    return obj;\n  };\n\n  // Internal recursive comparison function for `isEqual`.\n  var eq = function(a, b, aStack, bStack) {\n    // Identical objects are equal. `0 === -0`, but they aren't identical.\n    // See the [Harmony `egal` proposal](http://wiki.ecmascript.org/doku.php?id=harmony:egal).\n    if (a === b) return a !== 0 || 1 / a === 1 / b;\n    // A strict comparison is necessary because `null == undefined`.\n    if (a == null || b == null) return a === b;\n    // Unwrap any wrapped objects.\n    if (a instanceof _) a = a._wrapped;\n    if (b instanceof _) b = b._wrapped;\n    // Compare `[[Class]]` names.\n    var className = toString.call(a);\n    if (className !== toString.call(b)) return false;\n    switch (className) {\n      // Strings, numbers, regular expressions, dates, and booleans are compared by value.\n      case '[object RegExp]':\n      // RegExps are coerced to strings for comparison (Note: '' + /a/i === '/a/i')\n      case '[object String]':\n        // Primitives and their corresponding object wrappers are equivalent; thus, `\"5\"` is\n        // equivalent to `new String(\"5\")`.\n        return '' + a === '' + b;\n      case '[object Number]':\n        // `NaN`s are equivalent, but non-reflexive.\n        // Object(NaN) is equivalent to NaN\n        if (+a !== +a) return +b !== +b;\n        // An `egal` comparison is performed for other numeric values.\n        return +a === 0 ? 1 / +a === 1 / b : +a === +b;\n      case '[object Date]':\n      case '[object Boolean]':\n        // Coerce dates and booleans to numeric primitive values. Dates are compared by their\n        // millisecond representations. Note that invalid dates with millisecond representations\n        // of `NaN` are not equivalent.\n        return +a === +b;\n    }\n    if (typeof a != 'object' || typeof b != 'object') return false;\n    // Assume equality for cyclic structures. The algorithm for detecting cyclic\n    // structures is adapted from ES 5.1 section 15.12.3, abstract operation `JO`.\n    var length = aStack.length;\n    while (length--) {\n      // Linear search. Performance is inversely proportional to the number of\n      // unique nested structures.\n      if (aStack[length] === a) return bStack[length] === b;\n    }\n    // Objects with different constructors are not equivalent, but `Object`s\n    // from different frames are.\n    var aCtor = a.constructor, bCtor = b.constructor;\n    if (\n      aCtor !== bCtor &&\n      // Handle Object.create(x) cases\n      'constructor' in a && 'constructor' in b &&\n      !(_.isFunction(aCtor) && aCtor instanceof aCtor &&\n        _.isFunction(bCtor) && bCtor instanceof bCtor)\n    ) {\n      return false;\n    }\n    // Add the first object to the stack of traversed objects.\n    aStack.push(a);\n    bStack.push(b);\n    var size, result;\n    // Recursively compare objects and arrays.\n    if (className === '[object Array]') {\n      // Compare array lengths to determine if a deep comparison is necessary.\n      size = a.length;\n      result = size === b.length;\n      if (result) {\n        // Deep compare the contents, ignoring non-numeric properties.\n        while (size--) {\n          if (!(result = eq(a[size], b[size], aStack, bStack))) break;\n        }\n      }\n    } else {\n      // Deep compare objects.\n      var keys = _.keys(a), key;\n      size = keys.length;\n      // Ensure that both objects contain the same number of properties before comparing deep equality.\n      result = _.keys(b).length === size;\n      if (result) {\n        while (size--) {\n          // Deep compare each member\n          key = keys[size];\n          if (!(result = _.has(b, key) && eq(a[key], b[key], aStack, bStack))) break;\n        }\n      }\n    }\n    // Remove the first object from the stack of traversed objects.\n    aStack.pop();\n    bStack.pop();\n    return result;\n  };\n\n  // Perform a deep comparison to check if two objects are equal.\n  _.isEqual = function(a, b) {\n    return eq(a, b, [], []);\n  };\n\n  // Is a given array, string, or object empty?\n  // An \"empty\" object has no enumerable own-properties.\n  _.isEmpty = function(obj) {\n    if (obj == null) return true;\n    if (_.isArray(obj) || _.isString(obj) || _.isArguments(obj)) return obj.length === 0;\n    for (var key in obj) if (_.has(obj, key)) return false;\n    return true;\n  };\n\n  // Is a given value a DOM element?\n  _.isElement = function(obj) {\n    return !!(obj && obj.nodeType === 1);\n  };\n\n  // Is a given value an array?\n  // Delegates to ECMA5's native Array.isArray\n  _.isArray = nativeIsArray || function(obj) {\n    return toString.call(obj) === '[object Array]';\n  };\n\n  // Is a given variable an object?\n  _.isObject = function(obj) {\n    var type = typeof obj;\n    return type === 'function' || type === 'object' && !!obj;\n  };\n\n  // Add some isType methods: isArguments, isFunction, isString, isNumber, isDate, isRegExp.\n  _.each(['Arguments', 'Function', 'String', 'Number', 'Date', 'RegExp'], function(name) {\n    _['is' + name] = function(obj) {\n      return toString.call(obj) === '[object ' + name + ']';\n    };\n  });\n\n  // Define a fallback version of the method in browsers (ahem, IE), where\n  // there isn't any inspectable \"Arguments\" type.\n  if (!_.isArguments(arguments)) {\n    _.isArguments = function(obj) {\n      return _.has(obj, 'callee');\n    };\n  }\n\n  // Optimize `isFunction` if appropriate. Work around an IE 11 bug.\n  if (typeof /./ !== 'function') {\n    _.isFunction = function(obj) {\n      return typeof obj == 'function' || false;\n    };\n  }\n\n  // Is a given object a finite number?\n  _.isFinite = function(obj) {\n    return isFinite(obj) && !isNaN(parseFloat(obj));\n  };\n\n  // Is the given value `NaN`? (NaN is the only number which does not equal itself).\n  _.isNaN = function(obj) {\n    return _.isNumber(obj) && obj !== +obj;\n  };\n\n  // Is a given value a boolean?\n  _.isBoolean = function(obj) {\n    return obj === true || obj === false || toString.call(obj) === '[object Boolean]';\n  };\n\n  // Is a given value equal to null?\n  _.isNull = function(obj) {\n    return obj === null;\n  };\n\n  // Is a given variable undefined?\n  _.isUndefined = function(obj) {\n    return obj === void 0;\n  };\n\n  // Shortcut function for checking if an object has a given property directly\n  // on itself (in other words, not on a prototype).\n  _.has = function(obj, key) {\n    return obj != null && hasOwnProperty.call(obj, key);\n  };\n\n  // Utility Functions\n  // -----------------\n\n  // Run Underscore.js in *noConflict* mode, returning the `_` variable to its\n  // previous owner. Returns a reference to the Underscore object.\n  _.noConflict = function() {\n    root._ = previousUnderscore;\n    return this;\n  };\n\n  // Keep the identity function around for default iteratees.\n  _.identity = function(value) {\n    return value;\n  };\n\n  _.constant = function(value) {\n    return function() {\n      return value;\n    };\n  };\n\n  _.noop = function(){};\n\n  _.property = function(key) {\n    return function(obj) {\n      return obj[key];\n    };\n  };\n\n  // Returns a predicate for checking whether an object has a given set of `key:value` pairs.\n  _.matches = function(attrs) {\n    var pairs = _.pairs(attrs), length = pairs.length;\n    return function(obj) {\n      if (obj == null) return !length;\n      obj = new Object(obj);\n      for (var i = 0; i < length; i++) {\n        var pair = pairs[i], key = pair[0];\n        if (pair[1] !== obj[key] || !(key in obj)) return false;\n      }\n      return true;\n    };\n  };\n\n  // Run a function **n** times.\n  _.times = function(n, iteratee, context) {\n    var accum = Array(Math.max(0, n));\n    iteratee = createCallback(iteratee, context, 1);\n    for (var i = 0; i < n; i++) accum[i] = iteratee(i);\n    return accum;\n  };\n\n  // Return a random integer between min and max (inclusive).\n  _.random = function(min, max) {\n    if (max == null) {\n      max = min;\n      min = 0;\n    }\n    return min + Math.floor(Math.random() * (max - min + 1));\n  };\n\n  // A (possibly faster) way to get the current timestamp as an integer.\n  _.now = Date.now || function() {\n    return new Date().getTime();\n  };\n\n   // List of HTML entities for escaping.\n  var escapeMap = {\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;',\n    '\"': '&quot;',\n    \"'\": '&#x27;',\n    '`': '&#x60;'\n  };\n  var unescapeMap = _.invert(escapeMap);\n\n  // Functions for escaping and unescaping strings to/from HTML interpolation.\n  var createEscaper = function(map) {\n    var escaper = function(match) {\n      return map[match];\n    };\n    // Regexes for identifying a key that needs to be escaped\n    var source = '(?:' + _.keys(map).join('|') + ')';\n    var testRegexp = RegExp(source);\n    var replaceRegexp = RegExp(source, 'g');\n    return function(string) {\n      string = string == null ? '' : '' + string;\n      return testRegexp.test(string) ? string.replace(replaceRegexp, escaper) : string;\n    };\n  };\n  _.escape = createEscaper(escapeMap);\n  _.unescape = createEscaper(unescapeMap);\n\n  // If the value of the named `property` is a function then invoke it with the\n  // `object` as context; otherwise, return it.\n  _.result = function(object, property) {\n    if (object == null) return void 0;\n    var value = object[property];\n    return _.isFunction(value) ? object[property]() : value;\n  };\n\n  // Generate a unique integer id (unique within the entire client session).\n  // Useful for temporary DOM ids.\n  var idCounter = 0;\n  _.uniqueId = function(prefix) {\n    var id = ++idCounter + '';\n    return prefix ? prefix + id : id;\n  };\n\n  // By default, Underscore uses ERB-style template delimiters, change the\n  // following template settings to use alternative delimiters.\n  _.templateSettings = {\n    evaluate    : /<%([\\s\\S]+?)%>/g,\n    interpolate : /<%=([\\s\\S]+?)%>/g,\n    escape      : /<%-([\\s\\S]+?)%>/g\n  };\n\n  // When customizing `templateSettings`, if you don't want to define an\n  // interpolation, evaluation or escaping regex, we need one that is\n  // guaranteed not to match.\n  var noMatch = /(.)^/;\n\n  // Certain characters need to be escaped so that they can be put into a\n  // string literal.\n  var escapes = {\n    \"'\":      \"'\",\n    '\\\\':     '\\\\',\n    '\\r':     'r',\n    '\\n':     'n',\n    '\\u2028': 'u2028',\n    '\\u2029': 'u2029'\n  };\n\n  var escaper = /\\\\|'|\\r|\\n|\\u2028|\\u2029/g;\n\n  var escapeChar = function(match) {\n    return '\\\\' + escapes[match];\n  };\n\n  // JavaScript micro-templating, similar to John Resig's implementation.\n  // Underscore templating handles arbitrary delimiters, preserves whitespace,\n  // and correctly escapes quotes within interpolated code.\n  // NB: `oldSettings` only exists for backwards compatibility.\n  _.template = function(text, settings, oldSettings) {\n    if (!settings && oldSettings) settings = oldSettings;\n    settings = _.defaults({}, settings, _.templateSettings);\n\n    // Combine delimiters into one regular expression via alternation.\n    var matcher = RegExp([\n      (settings.escape || noMatch).source,\n      (settings.interpolate || noMatch).source,\n      (settings.evaluate || noMatch).source\n    ].join('|') + '|$', 'g');\n\n    // Compile the template source, escaping string literals appropriately.\n    var index = 0;\n    var source = \"__p+='\";\n    text.replace(matcher, function(match, escape, interpolate, evaluate, offset) {\n      source += text.slice(index, offset).replace(escaper, escapeChar);\n      index = offset + match.length;\n\n      if (escape) {\n        source += \"'+\\n((__t=(\" + escape + \"))==null?'':_.escape(__t))+\\n'\";\n      } else if (interpolate) {\n        source += \"'+\\n((__t=(\" + interpolate + \"))==null?'':__t)+\\n'\";\n      } else if (evaluate) {\n        source += \"';\\n\" + evaluate + \"\\n__p+='\";\n      }\n\n      // Adobe VMs need the match returned to produce the correct offest.\n      return match;\n    });\n    source += \"';\\n\";\n\n    // If a variable is not specified, place data values in local scope.\n    if (!settings.variable) source = 'with(obj||{}){\\n' + source + '}\\n';\n\n    source = \"var __t,__p='',__j=Array.prototype.join,\" +\n      \"print=function(){__p+=__j.call(arguments,'');};\\n\" +\n      source + 'return __p;\\n';\n\n    try {\n      var render = new Function(settings.variable || 'obj', '_', source);\n    } catch (e) {\n      e.source = source;\n      throw e;\n    }\n\n    var template = function(data) {\n      return render.call(this, data, _);\n    };\n\n    // Provide the compiled source as a convenience for precompilation.\n    var argument = settings.variable || 'obj';\n    template.source = 'function(' + argument + '){\\n' + source + '}';\n\n    return template;\n  };\n\n  // Add a \"chain\" function. Start chaining a wrapped Underscore object.\n  _.chain = function(obj) {\n    var instance = _(obj);\n    instance._chain = true;\n    return instance;\n  };\n\n  // OOP\n  // ---------------\n  // If Underscore is called as a function, it returns a wrapped object that\n  // can be used OO-style. This wrapper holds altered versions of all the\n  // underscore functions. Wrapped objects may be chained.\n\n  // Helper function to continue chaining intermediate results.\n  var result = function(obj) {\n    return this._chain ? _(obj).chain() : obj;\n  };\n\n  // Add your own custom functions to the Underscore object.\n  _.mixin = function(obj) {\n    _.each(_.functions(obj), function(name) {\n      var func = _[name] = obj[name];\n      _.prototype[name] = function() {\n        var args = [this._wrapped];\n        push.apply(args, arguments);\n        return result.call(this, func.apply(_, args));\n      };\n    });\n  };\n\n  // Add all of the Underscore functions to the wrapper object.\n  _.mixin(_);\n\n  // Add all mutator Array functions to the wrapper.\n  _.each(['pop', 'push', 'reverse', 'shift', 'sort', 'splice', 'unshift'], function(name) {\n    var method = ArrayProto[name];\n    _.prototype[name] = function() {\n      var obj = this._wrapped;\n      method.apply(obj, arguments);\n      if ((name === 'shift' || name === 'splice') && obj.length === 0) delete obj[0];\n      return result.call(this, obj);\n    };\n  });\n\n  // Add all accessor Array functions to the wrapper.\n  _.each(['concat', 'join', 'slice'], function(name) {\n    var method = ArrayProto[name];\n    _.prototype[name] = function() {\n      return result.call(this, method.apply(this._wrapped, arguments));\n    };\n  });\n\n  // Extracts the result from a wrapped and chained object.\n  _.prototype.value = function() {\n    return this._wrapped;\n  };\n\n  // AMD registration happens at the end for compatibility with AMD loaders\n  // that may not enforce next-turn semantics on modules. Even though general\n  // practice for AMD registration is to be anonymous, underscore registers\n  // as a named module because, like jQuery, it is a base library that is\n  // popular enough to be bundled in a third party lib, but not be part of\n  // an AMD load request. Those cases could generate an error when an\n  // anonymous define() is called outside of a loader request.\n  if (typeof define === 'function' && define.amd) {\n    define('underscore', [], function() {\n      return _;\n    });\n  }\n}.call(this));\n","/**\n * Cedar\n *\n * Generic charting / visualization library for the ArcGIS Platform\n * that leverages vega + d3 internally.\n */\n\n(function(window){\n  'use strict';\n\n/**\n * Constructor\n * @param {object} options Cedar options\n */\nvar Cedar = function Cedar(options){\n  //close over this for use in callbacks\n  var self = this;\n\n  //ensure an opts object\n  var opts = options || {};\n\n  /**\n   * Internals for holding state\n   */\n  \n\n  // Array to hold event handlers\n  this._events = [];\n\n  //initialize the internal definition hash\n  this._definition = Cedar._defaultDefinition();\n\n  //the vega view aka the chart\n  this._view = undefined;\n\n  //queue to hold methods called while\n  //xhrs are in progress\n  this._methodQueue=[];\n\n  /**\n   * Flag used to determine if the library is\n   * waiting for an xhr to return. \n   */\n  this._pendingXhr = false;\n\n  //defintion \n  if(opts.definition){\n    //is it an object or string(assumed to be url)\n    if(typeof opts.definition === 'object'){\n      //hold onto the definition\n      this._definition = opts.definition;\n    }else if(typeof opts.definition === 'string' ){ \n      //assume it's a url (relative or abs) and fetch the definition object\n      this._pendingXhr = true;\n      Cedar.getJson(opts.definition, function(err,data){\n        self._pendingXhr = false;\n        self._definition = data; \n        self._purgeMethodQueue();\n      });\n    }else{\n      throw new Error('parameter definition must be an object or string (url)');\n    }\n  }\n\n  if(opts.override) {\n    this._definition.override = opts.override;\n  }\n\n  //template\n  if(opts.specification){\n    //is it an object or string(assumed to be url)\n    if(typeof opts.specification === 'object'){\n      //hold onto the template\n      this._definition.specification = opts.specification;\n\n    }else if(typeof opts.specification === 'string' ){ \n      //assume it's a url (relative or abs) and fetch the template object\n      this._pendingXhr = true;\n      Cedar.getJson(opts.specification, function(err,data){\n        self._pendingXhr = false;\n        self._definition.specification = data; \n        self._purgeMethodQueue();\n      });\n    }else{\n      throw new Error('parameter template must be an object or string (url)');\n    }\n  }\n\n  //allow a dataset to be passed in...\n  if(opts.dataset && typeof opts.dataset === 'object'){\n    opts.dataset.query = Cedar._mixin({}, Cedar._defaultQuery(), opts.dataset.query);\n    //assign it\n    this._definition.dataset = opts.dataset;\n  }\n\n  /**\n   * Properties\n   *\n   * ES 5.1 syntax, so IE 8 & lower won't work\n   * \n   * If the val is a url, should we expect\n   * cedar to fetch the object? \n   * \n   * I'd say no... as that violates the principal \n   * of least suprise. Also - cedar has a .getJSON\n   * helper method the dev should use.\n   * \n   */\n      \n  Object.defineProperty(this, 'dataset', {\n    get: function() {\n        return this._definition.dataset;\n    },\n    set: function(val) {\n       this._definition.dataset = val;\n    }\n  });\n\n  Object.defineProperty(this, 'specification', {\n    get: function() {\n        return this._definition.specification;\n    },\n    set: function(val) {\n      this._definition.specification = val;\n    }\n  });\n\n  Object.defineProperty(this, 'override', {\n    get: function() {\n        return this._definition.override;\n    },\n    set: function(val) {\n      this._definition.override = val;\n    }\n  });  \n\n};\n\n\n/**\n * Inspect the current state of the object\n * and determine if we have sufficient information\n * to render the chart\n * @return {object} Hash of the draw state + any missing requirements\n */\nCedar.prototype.canDraw = function(){\n\n  //dataset?\n  //dataset.url || dataset.data?\n  //dataset.mappings?\n  //specification?\n  //specification.template?\n  //specification.inputs?\n  //specification.inputs ~ dataset.mappings?\n  \n  return {drawable:true, errs:[]};\n\n};\n\n/**\n * Render a chart in the specified element\n * @param  {object} options \n * \n * options.elementId [required] Id of the Dom element into which the chart will be rendered\n * options.token     [optional] Token to be used if the data or spec are on a secured server\n */\nCedar.prototype.show = function(options){\n  if(this._pendingXhr){\n    \n    this._addToMethodQueue('show', [options]);\n\n  }else{\n\n    var err;\n    //ensure we got an elementId\n    if( !options.elementId ){\n      err= \"Cedar.show requires options.elementId\";\n    }\n    //check if element exists in the page\n    if(d3.select(options.elementId)[0][0] === null){\n      err = \"Element \" + options.elementId + \" is not present in the DOM\";\n     }\n  \n    //hold onto the id\n    this._elementId = options.elementId;\n    this._renderer = options.renderer || \"canvas\"; //default to canvas\n\n    //hold onto the token\n    if(options.token){\n      this._token = options.token;\n    }\n\n    if( err ){\n      throw new Error( err );\n    }\n    var chk = this.canDraw();\n    if(chk.drawable){\n      //update centralizes the spec compilation & drawing\n      this.update();  \n    }else{\n      //report the issues\n      var errs = chk.issues.join(',');\n      throw new Error('Chart can not be drawn because: ' + errs);  \n    }\n    \n  }\n};\n\n/**\n * Render the chart using the internal state\n * Should be called after a user modifies the \n * of the dataset, query, mappings or template\n */\nCedar.prototype.update = function(){\n  var self = this;\n  \n  if ( this._view ) { \n    this.emit('update-start');\n  }\n\n  if(this._pendingXhr){\n    \n    this._addToMethodQueue('update');\n\n  }else{\n\n    if(this._view){\n      //remove handlers\n      //TODO Remove existing handlers\n      this._remove(this._view);\n    }\n    try{\n      //ensure we have required inputs or defaults \n      var compiledMappings = Cedar._applyDefaultsToMappings(this._definition.dataset.mappings, this._definition.specification.inputs); //Cedar._compileMappings(this._definition.dataset, this._definition.specification.inputs);\n\n      var queryFromSpec = Cedar._mixin({}, this._definition.specification.query, this._definition.dataset.query);\n      queryFromSpec = JSON.parse(Cedar._supplant(JSON.stringify(queryFromSpec), compiledMappings));\n\n      //allow binding to query properties\n      compiledMappings.query = queryFromSpec;\n\n      //compile the template + mappings --> vega spec\n      var spec = JSON.parse(Cedar._supplant(JSON.stringify(this._definition.specification.template), compiledMappings)); \n\n      // merge in user specified style overrides\n      spec = Cedar._mergeRecursive(spec, this._definition.override);\n\n      //if the spec has a url in the data node, delete it\n      if(spec.data[0].url){\n        delete spec.data[0].url;\n      }\n\n      if(this._definition.dataset.data){\n\n        //create the data node using the passed in data\n        spec.data[0].values = this._definition.dataset.data;\n        \n        //send to vega\n        this._renderSpec(spec);\n      \n      }else{\n      \n        //we need to fetch the data so\n        var url = Cedar._createFeatureServiceRequest(this._definition.dataset, queryFromSpec);\n      \n        //create a callback closure to carry the spec\n        var cb = function(err,data){\n      \n          //todo add error handlers for xhr and ags errors\n          spec.data[0].values = data;\n          console.dir(spec);\n          //send to vega\n          self._renderSpec(spec);\n\n        };\n\n        //fetch the data from the service\n        Cedar.getJson(url, cb);\n      }\n    }\n    catch(ex){\n      throw(ex);\n    }\n  }\n};\n\n/**\n * Render a fully cooked spec\n */\nCedar.prototype._renderSpec = function(spec){\n  var self = this;\n  try{\n    //use vega to parse the spec \n    //it will handle the spec as an object or url\n    vg.parse.spec(spec, function(chartCtor) { \n\n      //create the view\n      self._view = chartCtor({\n        el: self._elementId,\n        renderer: self._renderer\n      });\n\n      \n      //render into the element\n      self._view.update(); \n\n      //attach event proxies\n      self._attach(self._view);\n\n      if ( self._view ) { \n        self.emit('update-end');\n      }\n\n    });\n  }\n  catch(ex){\n    throw(ex);\n  }\n};\n\n/**\n * highlight marker based on attribute value\n */\nCedar.prototype.select = function( opt ) {\n  var self = this;\n  var view = this._view;\n  var items = view.model().scene().items[0].items[0].items;\n\n  items.forEach(function(item) {\n    if ( item.datum.data.attributes[opt.key] === opt.value ) {\n      if ( item.hasPropertySet(\"hover\") ) {\n        self._view.update({props:\"hover\", items:item});\n      }\n    }\n  });\n\n};\n\n\n/**\n * highlight marker based on attribute value\n */\nCedar.prototype.clearSelection = function( opt ) {\n  var self = this;\n  var view = this._view;\n  var items = view.model().scene().items[0].items[0].items;\n\n  if ( opt && opt.key ) {\n    items.forEach(function(item) {\n      if ( item.datum.data.attributes[opt.key] === opt.value ) {\n        self._view.update({props:\"update\", items:item});\n      }\n    });\n  } else {\n    //clear all \n    self._view.update();\n  }\n\n};\n\n\n// trigger callback \nCedar.prototype.emit = function(eventName) {\n  if (this._view._handler._handlers[ eventName ]){\n    this._view._handler._handlers[ eventName ][0].handler();\n  }\n};\n\n/**\n * Attach the generic proxy handlers to the chart view\n */\nCedar.prototype._attach = function(view){\n  \n  view.on('mouseover', this._handler('mouseover'));\n  view.on('mouseout', this._handler('mouseout'));\n  view.on('click', this._handler(\"click\"));\n  view.on('update-start', this._handler('update-start'));\n  view.on('update-end', this._handler('update-end'));\n  \n};\n\n/**\n * Remove all event handlers from the view\n */\nCedar.prototype._remove = function(view){\n\n  view.off('mouseover');\n  view.off('mouseout');\n  view.off('click');\n  view.off('update-start');\n  view.off('update-end');\n  \n};\n\n/**\n * Helper function that validates that the \n * mappings hash contains values for all\n * the inputs\n * @param  {array} inputs   Array of inputs\n * @param  {object} mappings Hash of mappings\n * @return {array}          Missing mappings\n */\nCedar._validateMappings = function(inputs, mappings){\n  var missingInputs = [], input;\n  for(var i=0;i<inputs.length;i++){\n    input = inputs[i];\n    if(input.required){\n      if(!mappings[input.name]){\n        missingInputs.push(input.name);\n      }\n    }\n  }\n  return missingInputs;\n};\n\n/**\n * Validate that the incoming data has the fields expected\n * in the mappings\n */\nCedar._validateData = function(data, mappings){\n  var missingInputs = [];\n  if(!data.features || !Array.isArray(data.features)){\n    throw new Error('Data is expected to have features array!');\n  }\n  var firstRow = data.features[0].attributes;\n  for(var key in mappings){\n    var fld = Cedar._getMappingFieldName(key, mappings[key].field);\n    if(!firstRow.hasOwnProperty(fld)){\n      missingInputs.push(fld);\n    }\n  }\n  return missingInputs;\n};\n\n/**\n * Centralize and abstract the computation of\n * expected field names, based on the mapping name\n */\nCedar._getMappingFieldName = function(mappingName, fieldName){\n  var name = fieldName;\n  //if(mappingName.toLowerCase() === 'count'){\n  //  name = fieldName + '_SUM';\n  //}\n  return name;\n};\n\n/**\n * Return a default definition object\n */\nCedar._defaultDefinition = function(){\n  var defn = {\n    \"dataset\": {\n      \"query\": this._defaultQuery()\n    },\n    \"template\":{}\n  };\n\n  defn.dataset.query = Cedar._defaultQuery();\n\n  return defn;\n};\n\n/**\n * Default Query Object\n */\nCedar._defaultQuery = function(){\n  var defaultQuery = {\n    \"where\": \"1=1\",\n    \"returnGeometry\": false,\n    \"returnDistinctValues\": false,\n    \"returnIdsOnly\": false,\n    \"returnCountOnly\": false,\n    \"outFields\": \"*\",\n    \"f\": \"json\"\n  };\n  return defaultQuery;\n};\n\n\n\n/**\n * Generic event handler proxy\n */\nCedar.prototype._handler = function(evtName) {\n  var self = this;\n  \n  //return a handler function w/ the events hash closed over\n  var handler = function(evt, item){\n    self._events.forEach( function(registeredHandler){\n      if(registeredHandler.type === evtName){\n        //invoke the callback with the data\n        if ( item ) {\n          registeredHandler.callback(item.datum.data.attributes);\n        } else {\n          registeredHandler.callback();\n        }\n      }\n    });\n  };\n  return handler;\n};\n\n/**\n * Add a handler for the named event\n */\nCedar.prototype.on = function(evtName, callback){\n  this._events.push({\"type\":evtName, \"callback\":callback});\n};\n\n/**\n * Remove a handler for the named event\n */\nCedar.prototype.off = function(evtName /*, callback */){\n  console.log('Handler for ' + evtName +' removed...');\n};\n\n\n/**\n * Creates an entry in the method queue, excuted \n * once a pending xhr is completed \n */\nCedar.prototype._addToMethodQueue = function(name, args){\n  this._methodQueue.push({ method: name, args: args });\n};\n\n/**\n * empties the method queue by calling the queued methods\n * This helps build a more syncronous api, while still\n * doing async things in the code\n */\nCedar.prototype._purgeMethodQueue = function(){\n  var self = this;\n  if(self._methodQueue.length > 0){\n\n    for(var i=0;i<self._methodQueue.length;i++){\n      var action = self._methodQueue[i];\n      self[action.method].apply(self, action.args);  \n    }\n  }\n};\n\n/**\n * fetch json from a url\n * @param  {string}   url      Url to json file\n * @param  {Function} callback node-style callback function (err, data)\n */\nCedar.getJson = function( url, callback ){\n  d3.json(url, function(err,data) {\n    if(err){\n      callback('Error loading ' + url + ' ' + err.message);\n    }\n    callback(null, data);\n  });\n};\n\n\nCedar._mixin = function(source) {\n    for (var i = 1; i < arguments.length; i++) {\n        d3.entries(arguments[i]).forEach(function(p) {\n            source[p.key] = p.value;\n        });\n    }\n    return source;\n};\n\n/**\n * Given a dataset hash, create the feature service\n * query string\n */\nCedar._createFeatureServiceRequest = function( dataset, queryFromSpec ) {\n  var mergedQuery = Cedar._mixin({}, Cedar._defaultQuery(), queryFromSpec);\n\n  //Handle bbox\n  if(mergedQuery.bbox){\n    //make sure a geometry was not also passed in\n    if(mergedQuery.geometry){\n      throw new Error('Dataset.query can not have both a geometry and a bbox specified');\n    }\n    //get the bbox (W,S,E,N)\n    var bboxArr = mergedQuery.bbox.split(',');\n\n    //remove it so it's not serialized as-is\n    delete mergedQuery.bbox;\n\n    //cook it into a json string \n    mergedQuery.geometry = JSON.stringify({\"xmin\": bboxArr[0], \"ymin\": bboxArr[2],\"xmax\": bboxArr[1], \"ymax\": bboxArr[3] });\n    //set the spatial ref as geographic\n    mergedQuery.inSR = '4326';\n  }\n  if(!mergedQuery.groupByFieldsForStatistics && dataset.mappings.group) {\n      mergedQuery.groupByFieldsForStatistics = dataset.mappings.group.field;\n  }\n  if(!mergedQuery.outStatistics && dataset.mappings.count) {\n    mergedQuery.orderByFields = dataset.mappings.count.field + \"_SUM\";\n    mergedQuery.outStatistics = JSON.stringify([{\"statisticType\": \"sum\", \"onStatisticField\": dataset.mappings.count.field, \"outStatisticFieldName\": dataset.mappings.count.field + \"_SUM\"}]);\n  }\n\n\n\n  //iterate the mappings keys to check for sort\n  //-----------------------------------------------------------------\n  //This approach would seem 'clean' but if there are multiple fields\n  //to sort by, the order would be determined by how javascript decides to\n  //iterate the mappings property hash.\n  //Thus, using mappings.sort gives the developer explicit control\n  //-----------------------------------------------------------------\n  // var sort = [];\n  // for (var property in dataset.mappings) {\n  //   if (dataset.mappings.hasOwnProperty(property)) {\n  //     if(dataset.mappings[property].sort){\n  //       //ok - build up the sort\n  //       sort.push(dataset.mappings[property].field + ' ' + dataset.mappings[property].sort);\n  //     }\n  //   }\n  // }\n  // if(sort.length > 0){\n  //   mergedQuery.orderByFields = sort.join(',');\n  // }\n  //-----------------------------------------------------------------\n  //check for a sort passed directly in\n  if(dataset.mappings.sort){\n    mergedQuery.orderByFields = dataset.mappings.sort;\n  }\n\n  var url = dataset.url + \"/query?\" + this._serializeQueryParams(mergedQuery);\n  \n  if(dataset.token){\n    url = url + '&token=' + dataset.token;\n  }\n  \n  return url;\n};\n\nCedar._applyDefaultsToMappings = function(mappings, inputs){\n  var errs = [];\n  //loop over the inputs\n  for(var i =0; i < inputs.length; i++){\n    //get the input\n    var input = inputs[i];\n\n    //if it's required and not in the mappings, add an exception\n    if(input.required && !mappings[input.name] ){\n      errs.push(input.name);\n    }\n    \n    //if it's not required, has a default and not in the mappings\n    if(!input.required && !mappings[input.name] && input.default){\n      //add the default\n      mappings[input.name] = input.default;\n    }\n  }\n\n  if(errs.length > 0){\n    throw new Error('Required Mappings Missing: ' + errs.join(','));\n  }else{\n    return mappings;\n  }\n};\n\n\n/**\n * Token Replacement on a string\n * @param  {string} template string template\n * @param  {object} params   object hash that maps to the tokens to be replaced\n * @return {string}          string with values replaced\n */\nCedar._supplant = function( tmpl, params ){\n  return tmpl.replace(/{([^{}]*)}/g,\n    function (a, b) {\n      var r = Cedar._getTokenValue(params, b);\n      return typeof r === 'string' || typeof r === 'number' ? r : a;\n    }\n  );\n};\n\n/*\n* Recursively merge properties of two objects \n*/\nCedar._mergeRecursive = function(obj1, obj2) {\n  for (var p in obj2) {\n    try {\n      // Property in destination object set; update its value.\n      if ( obj2[p].constructor===Object || obj2[p].constructor===Array) {\n        obj1[p] = Cedar._mergeRecursive(obj1[p], obj2[p]);\n\n      } else {\n        obj1[p] = obj2[p];\n\n      }\n\n    } catch(e) {\n      // Property in destination object not set; create it and set its value.\n      obj1[p] = obj2[p];\n\n    }\n  }\n\n  return obj1;\n};\n\n/**\n * Get the value of a token from a hash\n * @param  {[type]} tokens    [description]\n * @param  {[type]} tokenName [description]\n * @return {[type]}           [description]\n * Pulled from gulp-token-replace (MIT license)\n * https://github.com/Pictela/gulp-token-replace/blob/master/index.js\n * \n */\nCedar._getTokenValue = function(tokens, tokenName) {\n  var tmpTokens = tokens;\n  var tokenNameParts = tokenName.split('.');\n  for (var i = 0; i < tokenNameParts.length; i++) {\n    if (tmpTokens.hasOwnProperty(tokenNameParts[i])) {\n      tmpTokens = tmpTokens[tokenNameParts[i]];\n    } else {\n      return null;\n    }\n  }\n  return tmpTokens;\n};\n\n/**\n * Serilize an object into a query string\n * @param  {object} params Params for the query string\n * @return {string}        query string\n */\nCedar._serializeQueryParams = function(params) {\n  var str = [];\n  for(var p in params){\n    if (params.hasOwnProperty(p)) {\n      var val = params[p];\n      if (typeof val !== \"string\") {\n          val = JSON.stringify(val);\n      }\n      str.push(encodeURIComponent(p) + \"=\" + encodeURIComponent(val));\n    }\n  }\n  var queryString = str.join(\"&\");\n  return queryString;\n};\n\nwindow.Cedar = Cedar;\n\n})(window);"]}