!function(a){if("function"==typeof define&&define.amd)define(["d3","topojson"],a);else{var b="undefined"==typeof topojson?null:topojson;vg=a(d3,b)}}(function(a,b){function c(a){return a.replace(J,"$1\\'")}function d(a,b,c){var d=0,e=a.split(K);return a=c?(e=e.reverse()).filter(function(a){return d+=a.length,b>=d}).reverse():e.filter(function(a){return d+=a.length,b>=d}),a.length?a.join("").trim():e[0].slice(0,b)}function e(a){H.config.isNode?process.stderr.write(a+"\n"):console.log(a)}function f(a){return a.__vgtree__=!0,a.nodes=function(){return g(this,[])},a}function g(a,b){var c,d=a.values,e=d?d.length:0;for(b.push(a),c=0;e>c;++c)g(d[c],b);return b}function h(a){var b,c,d=a;if(H.isArray(a))for(d=[],b=0,c=a.length;c>b;++b)d.push(h(a[b]));else if(H.isObject(a)){d={};for(b in a)d[b]=h(a[b])}return d}function i(a){return M.test(a)}function j(a){return 0===a.indexOf(N)}function k(b,c){return H.log("LOAD: "+b),l(b)?void a.xhr(b,function(a,b){b&&(b=b.responseText),c(a,b)}):void H.error("URL is not whitelisted: "+b)}function l(a){if(!H.config.domainWhiteList)return!0;var b=document.createElement("a");b.href=a;var c=b.hostname.toLowerCase();return H.config.domainWhiteList.some(function(a){return a===c||c.lastIndexOf("."+a)===c.length-a.length-1})}function m(a,b){H.log("LOAD FILE: "+a);var c=a.indexOf(N);c>=0&&(a=a.slice(N.length)),require("fs").readFile(a,b)}function n(a,b){H.log("LOAD HTTP: "+a);var c=require("http").request(a,function(a){var c=0,d=new Buffer(parseInt(a.headers["content-length"],10));a.on("error",function(a){b(a,null)}),a.on("data",function(a){a.copy(d,c),c+=a.length}),a.on("end",function(){b(null,d)})});c.on("error",function(a){b(a)}),c.end()}function o(a,b,c){if(d=[],c&&b.length>1){for(var d,e,f,g=p(a.domain()),h=-1,i=b.length,j=(b[1]-b[0])/++c;++h<i;)for(e=c;--e>0;)(f=+b[h]-e*j)>=g[0]&&d.push(f);for(--h,e=0;++e<c&&(f=+b[h]+e*j)<g[1];)d.push(f)}return d}function p(a){var b=a[0],c=a[a.length-1];return c>b?[b,c]:[c,b]}function q(a){return a.rangeExtent?a.rangeExtent():p(a.range())}function r(a,b,c,d,e,f){e=Math.max(e,0)+f,("left"===a||"top"===a)&&(e*=-1),"top"===a||"bottom"===a?(H.extend(b.properties.enter,{x:c,y:{value:e}}),H.extend(b.properties.update,{x:d,y:{value:e},align:{value:"center"},baseline:{value:Q[a]}})):(H.extend(b.properties.enter,{x:{value:e},y:c}),H.extend(b.properties.update,{x:{value:e},y:d,align:{value:P[a]},baseline:{value:"middle"}}))}function s(a,b,c,d,e){var f="left"===a||"top"===a?-1:1;e=1/0===e?"top"===a||"bottom"===a?{group:"mark.group.height",mult:-f}:{group:"mark.group.width",mult:-f}:{value:f*e},"top"===a||"bottom"===a?(H.extend(b.properties.enter,{x:c,y:{value:0},y2:e}),H.extend(b.properties.update,{x:d,y:{value:0},y2:e}),H.extend(b.properties.exit,{x:d})):(H.extend(b.properties.enter,{x:{value:0},x2:e,y:c}),H.extend(b.properties.update,{x:{value:0},x2:e,y:d}),H.extend(b.properties.exit,{y:d}))}function t(a,b,c,d){var e=~~((c[0]+c[1])/2),f="top"===a||"left"===a?-1:1;"bottom"===a||"top"===a?H.extend(b.properties.update,{x:{value:e},y:{value:f*d},angle:{value:0}}):H.extend(b.properties.update,{x:{value:f*d},y:{value:e},angle:{value:-90}})}function u(a,b,c,d){var e;("top"===a||"left"===a)&&(d=-1*d),e="bottom"===a||"top"===a?"M"+c[0]+","+d+"V0H"+c[1]+"V"+d:"M"+d+","+c[0]+"H0V"+c[1]+"H"+d,b.properties.update.path={value:e}}function v(a,b,c){var d=c?{}:a,e=a.mark.def.offset,f=a.mark.def.orient,g=b.width,h=b.height;switch(H.isObject(e)&&(e=-b.scales[e.scale](e.value)),f){case"left":d.x=-e,d.y=0;break;case"right":d.x=g+e,d.y=0;break;case"bottom":d.x=0,d.y=h+e;break;case"top":d.x=0,d.y=-e;break;default:d.x=0,d.y=0}c&&c.interpolate(a,d)}function w(){return{type:"rule",interactive:!1,key:"data",properties:{enter:{stroke:{value:H.config.axis.tickColor},strokeWidth:{value:H.config.axis.tickWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function x(){return{type:"text",interactive:!0,key:"data",properties:{enter:{fill:{value:H.config.axis.tickLabelColor},font:{value:H.config.axis.tickLabelFont},fontSize:{value:H.config.axis.tickLabelFontSize},opacity:{value:1e-6},text:{field:"label"}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function y(){return{type:"text",interactive:!0,properties:{enter:{font:{value:H.config.axis.titleFont},fontSize:{value:H.config.axis.titleFontSize},fontWeight:{value:H.config.axis.titleFontWeight},fill:{value:H.config.axis.titleColor},align:{value:"center"},baseline:{value:"middle"},text:{field:"data"}},update:{}}}}function z(){return{type:"path",interactive:!1,properties:{enter:{x:{value:.5},y:{value:.5},stroke:{value:H.config.axis.axisColor},strokeWidth:{value:H.config.axis.axisWidth}},update:{}}}}function A(a,b,c){var d,e=c?{}:a,f=a.mark.def.offset,g=a.mark.def.orient,h=2*a.mark.def.padding,i=~~a.bounds.width()+(a.width?0:h),j=~~a.bounds.height()+(a.height?0:h);switch(e.x=.5,e.y=.5,e.width=i,e.height=j,!c&&b.bounds&&(b.bounds.delta=b.bounds.x2-b.width),g){case"left":d=b.bounds?b.bounds.x1:0,e.x+=d-f-i;break;case"right":d=b.width,b.bounds&&(d=c?b.width+b.bounds.delta:b.bounds.x2),e.x+=d+f}c&&c.interpolate(a,e),a.mark.def.properties.enter(a,b,c)}function B(a,b,c,d,e){var f=a.properties.enter,g=a.properties.update;b&&(f.size=g.size={scale:b.scaleName,field:"data"}),c&&(f.shape=g.shape={scale:c.scaleName,field:"data"}),d&&(f.fill=g.fill={scale:d.scaleName,field:"data"}),e&&(f.stroke=g.stroke={scale:e.scaleName,field:"data"})}function C(){var a=H.config.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{value:0},y:{value:0},fill:{value:a.titleColor},font:{value:a.titleFont},fontSize:{value:a.titleFontSize},fontWeight:{value:a.titleFontWeight},baseline:{value:"top"},text:{field:"data"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function D(){var a=H.config.legend;return{type:"symbol",interactive:!1,key:"data",properties:{enter:{x:{field:"offset",mult:.5},y:{scale:"legend",field:"index"},shape:{value:a.symbolShape},size:{value:a.symbolSize},stroke:{value:a.symbolColor},strokeWidth:{value:a.symbolStrokeWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{x:{field:"offset",mult:.5},y:{scale:"legend",field:"index"},opacity:{value:1}}}}}function E(){var a=H.config.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{field:"offset",offset:5},y:{scale:"legend",field:"index"},fill:{value:a.labelColor},font:{value:a.labelFont},fontSize:{value:a.labelFontSize},align:{value:a.labelAlign},baseline:{value:a.labelBaseline},text:{field:"label"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1},x:{field:"offset",offset:5},y:{scale:"legend",field:"index"}}}}}function F(){var a=H.config.legend;return{type:"rect",interactive:!1,properties:{enter:{x:{value:0},y:{value:0},width:{value:a.gradientWidth},height:{value:a.gradientHeight},stroke:{value:a.gradientStrokeColor},strokeWidth:{value:a.gradientStrokeWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{x:{value:0},y:{value:0},opacity:{value:1}}}}}function G(){var a=H.config.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{scale:"legend",field:"data"},y:{value:20},dy:{value:2},fill:{value:a.labelColor},font:{value:a.labelFont},fontSize:{value:a.labelFontSize},align:{field:"align"},baseline:{value:"top"},text:{field:"label"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{x:{scale:"legend",field:"data"},y:{value:20},opacity:{value:1}}}}}var H={version:"1.4.2",d3:a,topojson:b},I=Object.prototype.toString;H.isObject=function(a){return a===Object(a)},H.isFunction=function(a){return"[object Function]"==I.call(a)},H.isString=function(a){return"[object String]"==I.call(a)},H.isArray=Array.isArray||function(a){return"[object Array]"==I.call(a)},H.isNumber=function(a){return"[object Number]"==I.call(a)},H.isBoolean=function(a){return"[object Boolean]"==I.call(a)},H.isTree=function(a){return a&&a.__vgtree__},H.tree=function(a,b){var c=[a];return c.__vgtree__=!0,c.children=b||"children",c},H.number=function(a){return+a},H.boolean=function(a){return!!a},H.identity=function(a){return a},H.true=function(){return!0},H.extend=function(a){for(var b,c,d=1,e=arguments.length;e>d;++d){b=arguments[d];for(c in b)a[c]=b[c]}return a},H.duplicate=function(a){return JSON.parse(JSON.stringify(a))},H.field=function(a){return a.split("\\.").map(function(a){return a.split(".")}).reduce(function(a,b){return a.length&&(a[a.length-1]+="."+b.shift()),a.push.apply(a,b),a},[])},H.accessor=function(a){var b;return H.isFunction(a)||null==a?a:H.isString(a)&&(b=H.field(a)).length>1?function(a){return b.reduce(function(a,b){return a[b]},a)}:function(b){return b[a]}},H.comparator=function(a){var b=[];return void 0===a&&(a=[]),a=H.array(a).map(function(a){var c=1;return"-"===a[0]?(c=-1,a=a.slice(1)):"+"===a[0]&&(c=1,a=a.slice(1)),b.push(c),H.accessor(a)}),function(c,d){var e,f,g,h,i;for(e=0,f=a.length;f>e;++e){if(g=a[e],h=g(c),i=g(d),i>h)return-1*b[e];if(h>i)return b[e]}return 0}},H.cmp=function(a,b){return b>a?-1:a>b?1:0},H.numcmp=function(a,b){return a-b},H.array=function(a){return null!=a?H.isArray(a)?a:[a]:[]},H.values=function(a){return H.isObject(a)&&!H.isArray(a)&&a.values?a.values:a},H.str=function(a){return H.isArray(a)?"["+a.map(H.str)+"]":H.isObject(a)?JSON.stringify(a):H.isString(a)?"'"+c(a)+"'":a};var J=/(^|[^\\])'/g;H.keys=function(a){var b=[];for(var c in a)b.push(c);return b},H.unique=function(a,b,c){if(!H.isArray(a)||0==a.length)return[];b=b||H.identity,c=c||[];for(var d,e=0,f=a.length;f>e;++e)d=b(a[e]),c.indexOf(d)<0&&c.push(d);return c},H.minIndex=function(a,b){if(!H.isArray(a)||0==a.length)return-1;b=b||H.identity;for(var c=0,d=b(a[0]),e=d,f=1,g=a.length;g>f;++f)e=b(a[f]),d>e&&(d=e,c=f);return c},H.maxIndex=function(a,b){if(!H.isArray(a)||0==a.length)return-1;b=b||H.identity;for(var c=0,d=b(a[0]),e=d,f=1,g=a.length;g>f;++f)e=b(a[f]),e>d&&(d=e,c=f);return c},H.truncate=function(a,b,c,e,f){var g=a.length;if(b>=g)return a;f=f||"...";var h=Math.max(0,b-f.length);switch(c){case"left":return f+(e?d(a,h,1):a.slice(g-h));case"middle":case"center":var i=Math.ceil(h/2),j=Math.floor(h/2);return(e?d(a,i):a.slice(0,i))+f+(e?d(a,j,1):a.slice(g-j));default:return(e?d(a,h):a.slice(0,h))+f}};var K=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/;H.log=function(a){e("[Vega Log] "+a)},H.error=function(a){a="[Vega Err] "+a,e(a),"undefined"!=typeof alert&&alert(a)},H.config={},H.config.isNode="undefined"!=typeof exports&&this.exports!==exports,H.config.domainWhiteList=!1,H.config.safeMode=!1,H.config.baseURL="",H.config.svgNamespace='version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"',H.config.autopadInset=5,H.config.scale={time:a.time.scale,utc:a.time.scale.utc},H.config.render={lineWidth:1,lineCap:"butt",font:"sans-serif",fontSize:11},H.config.axis={orient:"bottom",ticks:10,padding:3,axisColor:"#000",gridColor:"#d8d8d8",tickColor:"#000",tickLabelColor:"#000",axisWidth:1,tickWidth:1,tickSize:6,tickLabelFontSize:11,tickLabelFont:"sans-serif",titleColor:"#000",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold",titleOffset:35},H.config.legend={orient:"right",offset:10,padding:3,gradientStrokeColor:"#888",gradientStrokeWidth:1,gradientHeight:16,gradientWidth:100,labelColor:"#000",labelFontSize:10,labelFont:"sans-serif",labelAlign:"left",labelBaseline:"middle",labelOffset:8,symbolShape:"circle",symbolSize:50,symbolColor:"#888",symbolStrokeWidth:1,titleColor:"#000",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold"},H.config.color={rgb:[128,128,128],lab:[50,0,0],hcl:[0,0,50],hsl:[0,0,.5]},H.config.range={category10:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],category20:["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],shapes:["circle","cross","diamond","square","triangle-down","triangle-up"]},H.Bounds=function(){var a=function(a){this.clear(),a&&this.union(a)},b=a.prototype;return b.clear=function(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},b.set=function(a,b,c,d){return this.x1=a,this.y1=b,this.x2=c,this.y2=d,this},b.add=function(a,b){return a<this.x1&&(this.x1=a),b<this.y1&&(this.y1=b),a>this.x2&&(this.x2=a),b>this.y2&&(this.y2=b),this},b.expand=function(a){return this.x1-=a,this.y1-=a,this.x2+=a,this.y2+=a,this},b.round=function(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},b.translate=function(a,b){return this.x1+=a,this.x2+=a,this.y1+=b,this.y2+=b,this},b.rotate=function(a,b,c){var d=Math.cos(a),e=Math.sin(a),f=b-b*d+c*e,g=c-b*e-c*d,h=this.x1,i=this.x2,j=this.y1,k=this.y2;return this.clear().add(d*h-e*j+f,e*h+d*j+g).add(d*h-e*k+f,e*h+d*k+g).add(d*i-e*j+f,e*i+d*j+g).add(d*i-e*k+f,e*i+d*k+g)},b.union=function(a){return a.x1<this.x1&&(this.x1=a.x1),a.y1<this.y1&&(this.y1=a.y1),a.x2>this.x2&&(this.x2=a.x2),a.y2>this.y2&&(this.y2=a.y2),this},b.encloses=function(a){return a&&this.x1<=a.x1&&this.x2>=a.x2&&this.y1<=a.y1&&this.y2>=a.y2},b.intersects=function(a){return a&&!(this.x2<a.x1||this.x1>a.x2||this.y2<a.y1||this.y1>a.y2)},b.contains=function(a,b){return!(a<this.x1||a>this.x2||b<this.y1||b>this.y2)},b.width=function(){return this.x2-this.x1},b.height=function(){return this.y2-this.y1},a}(),H.Gradient=function(){function a(a){this.id="grad_"+L++,this.type=a||"linear",this.stops=[],this.x1=0,this.x2=1,this.y1=0,this.y2=0}var b=a.prototype;return b.stop=function(a,b){return this.stops.push({offset:a,color:b}),this},a}();var L=0;H.canvas={},H.canvas.path=function(){function b(a){var b,c,d,e=[];a=a.slice().replace(m[0],"###$1").split(m[1]).slice(1);for(var f,g,h=0,i=a.length;i>h;h++){b=a[h],c=b.slice(1).trim().replace(m[2],"$1###-").split(m[3]),g=[b.charAt(0)];for(var f=0,j=c.length;j>f;f++)d=parseFloat(c[f]),isNaN(d)||g.push(d);var k=g[0].toLowerCase(),n=l[k];if(g.length-1>n)for(var o=1,p=g.length;p>o;o+=n)e.push([g[0]].concat(g.slice(o,o+n)));else e.push(g)}return e}function c(a,b,c,d,g,h,i){for(var j=d[0],k=d[1],l=d[2],m=d[3],n=d[4],o=d[5],p=d[6],q=e(o,p,j,k,m,n,l,b,c),r=0;r<q.length;r++){var s=f.apply(null,q[r]);a.bezierCurveTo.apply(a,s),g.add(s[0]-h,s[1]-i),g.add(s[2]-h,s[3]-i),g.add(s[4]-h,s[5]-i)}}function d(a,b,c,d){for(var g=c[0],h=c[1],i=c[2],j=c[3],k=c[4],l=c[5],m=c[6],n=e(l,m,g,h,j,k,i,a,b),o=0;o<n.length;o++){var p=f.apply(null,n[o]);d.add(p[0],p[1]),d.add(p[2],p[3]),d.add(p[4],p[5])}}function e(a,b,c,d,e,f,g,h,i){if(k=p.call(arguments),n[k])return n[k];var j=g*(Math.PI/180),l=Math.sin(j),m=Math.cos(j);c=Math.abs(c),d=Math.abs(d);var o=m*(h-a)*.5+l*(i-b)*.5,q=m*(i-b)*.5-l*(h-a)*.5,r=o*o/(c*c)+q*q/(d*d);r>1&&(r=Math.sqrt(r),c*=r,d*=r);var s=m/c,t=l/c,u=-l/d,v=m/d,w=s*h+t*i,x=u*h+v*i,y=s*a+t*b,z=u*a+v*b,A=(y-w)*(y-w)+(z-x)*(z-x),B=1/A-.25;0>B&&(B=0);var C=Math.sqrt(B);f==e&&(C=-C);var D=.5*(w+y)-C*(z-x),E=.5*(x+z)+C*(y-w),F=Math.atan2(x-E,w-D),G=Math.atan2(z-E,y-D),H=G-F;0>H&&1==f?H+=2*Math.PI:H>0&&0==f&&(H-=2*Math.PI);for(var I=Math.ceil(Math.abs(H/(.5*Math.PI+.001))),J=[],K=0;I>K;K++){var L=F+K*H/I,M=F+(K+1)*H/I;J[K]=[D,E,L,M,c,d,l,m]}return n[k]=J}function f(a,b,c,d,e,f,g,h){if(k=p.call(arguments),o[k])return o[k];var i=h*e,j=-g*f,l=g*e,m=h*f,n=Math.cos(c),q=Math.sin(c),r=Math.cos(d),s=Math.sin(d),t=.5*(d-c),u=Math.sin(.5*t),v=8/3*u*u/Math.sin(t),w=a+n-v*q,x=b+q+v*n,y=a+r,z=b+s,A=y+v*s,B=z-v*r;return o[k]=[i*w+j*x,l*w+m*x,i*A+j*B,l*A+m*B,i*y+j*z,l*y+m*z]}function g(a,b,d,e){var f,g,h,i,j,k=null,l=0,m=0,n=0,o=0,p=new H.Bounds;void 0==d&&(d=0),void 0==e&&(e=0),a.beginPath();for(var q=0,r=b.length;r>q;++q){switch(f=b[q],f[0]){case"l":l+=f[1],m+=f[2],a.lineTo(l+d,m+e),p.add(l,m);break;case"L":l=f[1],m=f[2],a.lineTo(l+d,m+e),p.add(l,m);break;case"h":l+=f[1],a.lineTo(l+d,m+e),p.add(l,m);break;case"H":l=f[1],a.lineTo(l+d,m+e),p.add(l,m);break;case"v":m+=f[1],a.lineTo(l+d,m+e),p.add(l,m);break;case"V":m=f[1],a.lineTo(l+d,m+e),p.add(l,m);break;case"m":l+=f[1],m+=f[2],a.moveTo(l+d,m+e),p.add(l,m);break;case"M":l=f[1],m=f[2],a.moveTo(l+d,m+e),p.add(l,m);break;case"c":g=l+f[5],h=m+f[6],n=l+f[3],o=m+f[4],a.bezierCurveTo(l+f[1]+d,m+f[2]+e,n+d,o+e,g+d,h+e),p.add(l+f[1],m+f[2]),p.add(n,o),p.add(g,h),l=g,m=h;break;case"C":l=f[5],m=f[6],n=f[3],o=f[4],a.bezierCurveTo(f[1]+d,f[2]+e,n+d,o+e,l+d,m+e),p.add(f[1],f[2]),p.add(n,o),p.add(l,m);break;case"s":g=l+f[3],h=m+f[4],n=2*l-n,o=2*m-o,a.bezierCurveTo(n+d,o+e,l+f[1]+d,m+f[2]+e,g+d,h+e),p.add(n,o),p.add(l+f[1],m+f[2]),p.add(g,h),n=l+f[1],o=m+f[2],l=g,m=h;break;case"S":g=f[3],h=f[4],n=2*l-n,o=2*m-o,a.bezierCurveTo(n+d,o+e,f[1]+d,f[2]+e,g+d,h+e),l=g,m=h,p.add(f[1],f[2]),p.add(n,o),p.add(g,h),n=f[1],o=f[2];break;case"q":g=l+f[3],h=m+f[4],n=l+f[1],o=m+f[2],a.quadraticCurveTo(n+d,o+e,g+d,h+e),l=g,m=h,p.add(n,o),p.add(g,h);break;case"Q":g=f[3],h=f[4],a.quadraticCurveTo(f[1]+d,f[2]+e,g+d,h+e),l=g,m=h,n=f[1],o=f[2],p.add(n,o),p.add(g,h);break;case"t":g=l+f[1],h=m+f[2],null===k[0].match(/[QqTt]/)?(n=l,o=m):"t"===k[0]?(n=2*l-i,o=2*m-j):"q"===k[0]&&(n=2*l-n,o=2*m-o),i=n,j=o,a.quadraticCurveTo(n+d,o+e,g+d,h+e),l=g,m=h,n=l+f[1],o=m+f[2],p.add(n,o),p.add(g,h);break;case"T":g=f[1],h=f[2],n=2*l-n,o=2*m-o,a.quadraticCurveTo(n+d,o+e,g+d,h+e),l=g,m=h,p.add(n,o),p.add(g,h);break;case"a":c(a,l+d,m+e,[f[1],f[2],f[3],f[4],f[5],f[6]+l+d,f[7]+m+e],p,d,e),l+=f[6],m+=f[7];break;case"A":c(a,l+d,m+e,[f[1],f[2],f[3],f[4],f[5],f[6]+d,f[7]+e],p,d,e),l=f[6],m=f[7];break;case"z":case"Z":a.closePath()}k=f}return p.translate(d,e)}function h(a,b){for(var c,e,f,g,h,i=null,j=0,k=0,l=0,m=0,n=0,o=a.length;o>n;++n){switch(c=a[n],c[0]){case"l":j+=c[1],k+=c[2],b.add(j,k);break;case"L":j=c[1],k=c[2],b.add(j,k);break;case"h":j+=c[1],b.add(j,k);break;case"H":j=c[1],b.add(j,k);break;case"v":k+=c[1],b.add(j,k);break;case"V":k=c[1],b.add(j,k);break;case"m":j+=c[1],k+=c[2],b.add(j,k);break;case"M":j=c[1],k=c[2],b.add(j,k);break;case"c":e=j+c[5],f=k+c[6],l=j+c[3],m=k+c[4],b.add(j+c[1],k+c[2]),b.add(l,m),b.add(e,f),j=e,k=f;break;case"C":j=c[5],k=c[6],l=c[3],m=c[4],b.add(c[1],c[2]),b.add(l,m),b.add(j,k);break;case"s":e=j+c[3],f=k+c[4],l=2*j-l,m=2*k-m,b.add(l,m),b.add(j+c[1],k+c[2]),b.add(e,f),l=j+c[1],m=k+c[2],j=e,k=f;break;case"S":e=c[3],f=c[4],l=2*j-l,m=2*k-m,j=e,k=f,b.add(c[1],c[2]),b.add(l,m),b.add(e,f),l=c[1],m=c[2];break;case"q":e=j+c[3],f=k+c[4],l=j+c[1],m=k+c[2],j=e,k=f,b.add(l,m),b.add(e,f);break;case"Q":e=c[3],f=c[4],j=e,k=f,l=c[1],m=c[2],b.add(l,m),b.add(e,f);break;case"t":e=j+c[1],f=k+c[2],null===i[0].match(/[QqTt]/)?(l=j,m=k):"t"===i[0]?(l=2*j-g,m=2*k-h):"q"===i[0]&&(l=2*j-l,m=2*k-m),g=l,h=m,j=e,k=f,l=j+c[1],m=k+c[2],b.add(l,m),b.add(e,f);break;case"T":e=c[1],f=c[2],l=2*j-l,m=2*k-m,j=e,k=f,b.add(l,m),b.add(e,f);break;case"a":d(j,k,[c[1],c[2],c[3],c[4],c[5],c[6]+j,c[7]+k],b),j+=c[6],k+=c[7];break;case"A":d(j,k,[c[1],c[2],c[3],c[4],c[5],c[6],c[7]],b),j=c[6],k=c[7];break;case"z":case"Z":}i=c}return b}function i(b){var c=b[0],d=a.svg.area().x(function(a){return a.x}).y1(function(a){return a.y}).y0(function(a){return a.y+a.height});return c.interpolate&&d.interpolate(c.interpolate),null!=c.tension&&d.tension(c.tension),d(b)}function j(b){var c=b[0],d=a.svg.line().x(function(a){return a.x}).y(function(a){return a.y});return c.interpolate&&d.interpolate(c.interpolate),null!=c.tension&&d.tension(c.tension),d(b)}var k,l={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},m=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)-/g,/\s|,|###/],n={},o={},p=Array.prototype.join;return{parse:b,render:g,bounds:h,area:i,line:j}}(),H.canvas.marks=function(){function a(a,b){var c=b.x||0,d=b.y||0,e=b.innerRadius||0,f=b.outerRadius||0,g=(b.startAngle||0)-Math.PI/2,h=(b.endAngle||0)-Math.PI/2;a.beginPath(),0===e?a.moveTo(c,d):a.arc(c,d,e,g,h,0),a.arc(c,d,f,h,g,1),a.closePath()}function b(a,b){var c=b[0],d=c.mark,e=d.pathCache||(d.pathCache=y(H.canvas.path.area(b)));z(a,e)}function c(a,b){var c=b[0],d=c.mark,e=d.pathCache||(d.pathCache=y(H.canvas.path.line(b)));z(a,e)}function d(a,b){if(null!=b.path){var c=b.pathCache||(b.pathCache=y(b.path));return z(a,c,b.x,b.y)}}function e(a,b){a.beginPath();var c,d,e,f,g=null!=b.size?b.size:100,h=b.x,i=b.y;if(null==b.shape||"circle"===b.shape)return c=Math.sqrt(g/Math.PI),a.arc(h,i,c,0,2*Math.PI,0),void a.closePath();switch(b.shape){case"cross":c=Math.sqrt(g/5)/2,d=3*c,a.moveTo(h-d,i-c),a.lineTo(h-c,i-c),a.lineTo(h-c,i-d),a.lineTo(h+c,i-d),a.lineTo(h+c,i-c),a.lineTo(h+d,i-c),a.lineTo(h+d,i+c),a.lineTo(h+c,i+c),a.lineTo(h+c,i+d),a.lineTo(h-c,i+d),a.lineTo(h-c,i+c),a.lineTo(h-d,i+c);break;case"diamond":f=Math.sqrt(g/(2*B)),e=f*B,a.moveTo(h,i-f),a.lineTo(h+e,i),a.lineTo(h,i+f),a.lineTo(h-e,i);break;case"square":d=Math.sqrt(g),c=d/2,a.rect(h-c,i-c,d,d);break;case"triangle-down":e=Math.sqrt(g/A),f=e*A/2,a.moveTo(h,i+f),a.lineTo(h+e,i-f),a.lineTo(h-e,i-f);break;case"triangle-up":e=Math.sqrt(g/A),f=e*A/2,a.moveTo(h,i-f),a.lineTo(h+e,i+f),a.lineTo(h-e,i+f)}a.closePath()}function f(a,b){var d=b[0],e=d.strokeWidth,f=d.strokeCap;a.lineWidth=null!=e?e:H.config.render.lineWidth,a.lineCap=null!=f?f:H.config.render.lineCap,c(a,b)}function g(a,b){var c=b.x||0,d=b.y||0,e=null!=b.x2?b.x2:c,f=null!=b.y2?b.y2:d,g=b.strokeWidth,h=b.strokeCap;a.lineWidth=null!=g?g:H.config.render.lineWidth,a.lineCap=null!=h?h:H.config.render.lineCap,a.beginPath(),a.moveTo(c,d),a.lineTo(e,f)}function h(a,b,c,d){var e,f,g,h=c.fill,i=c.stroke;a(b,d),e=null==c.opacity?1:c.opacity,0!=e&&(h||i)&&(h&&(b.globalAlpha=e*(null==c.fillOpacity?1:c.fillOpacity),b.fillStyle=q(b,c,h),b.fill()),i&&(g=null!=(g=c.strokeWidth)?g:H.config.render.lineWidth,g>0&&(b.globalAlpha=e*(null==c.strokeOpacity?1:c.strokeOpacity),b.strokeStyle=q(b,c,i),b.lineWidth=g,b.lineCap=null!=(f=c.strokeCap)?f:H.config.render.lineCap,b.vgLineDash(c.strokeDash||null),b.vgLineDashOffset(c.strokeDashOffset||0),b.stroke())))}function i(a,b,c,d){var e,f,g;for(e=0,f=c.items.length;f>e;++e)g=c.items[e],(!d||d.intersects(g.bounds))&&h(a,b,g,g)}function j(a,b,c){if(b.items.length)for(var d,e,f,g,h,i,j,k,l,m,n=b.items,o=0,p=n.length;p>o;++o)d=n[o],(!c||c.intersects(d.bounds))&&(j=d.x||0,k=d.y||0,l=d.width||0,m=d.height||0,g=null==d.opacity?1:d.opacity,0!=g&&((e=d.fill)&&(a.globalAlpha=g*(null==d.fillOpacity?1:d.fillOpacity),a.fillStyle=q(a,d,e),a.fillRect(j,k,l,m)),(f=d.stroke)&&(i=null!=(i=d.strokeWidth)?i:H.config.render.lineWidth,i>0&&(a.globalAlpha=g*(null==d.strokeOpacity?1:d.strokeOpacity),a.strokeStyle=q(a,d,f),a.lineWidth=i,a.lineCap=null!=(h=d.strokeCap)?h:H.config.render.lineCap,a.vgLineDash(d.strokeDash||null),a.vgLineDashOffset(d.strokeDashOffset||0),a.strokeRect(j,k,l,m)))))}function k(a,b,c){if(b.items.length)for(var d,e,f,g,h,i,j,k,l,m=b.items,n=0,o=m.length;o>n;++n)d=m[n],(!c||c.intersects(d.bounds))&&(i=d.x||0,j=d.y||0,k=null!=d.x2?d.x2:i,l=null!=d.y2?d.y2:j,f=null==d.opacity?1:d.opacity,0!=f&&(e=d.stroke)&&(h=null!=(h=d.strokeWidth)?h:H.config.render.lineWidth,h>0&&(a.globalAlpha=f*(null==d.strokeOpacity?1:d.strokeOpacity),a.strokeStyle=q(a,d,e),a.lineWidth=h,a.lineCap=null!=(g=d.strokeCap)?g:H.config.render.lineCap,a.vgLineDash(d.strokeDash||null),a.vgLineDashOffset(d.strokeDashOffset||0),a.beginPath(),a.moveTo(i,j),a.lineTo(k,l),a.stroke())))}function l(a,b,c){if(b.items.length)for(var d,e=this,f=b.items,g=0,h=f.length;h>g;++g)if(d=f[g],!c||c.intersects(d.bounds)){d.image&&d.image.url===d.url||(d.image=e.loadImage(d.url),d.image.url=d.url);var i,j,k,l,m;k=d.width||d.image&&d.image.width||0,l=d.height||d.image&&d.image.height||0,i=(d.x||0)-("center"===d.align?k/2:"right"===d.align?k:0),j=(d.y||0)-("middle"===d.baseline?l/2:"bottom"===d.baseline?l:0),d.image.loaded&&(a.globalAlpha=null!=(m=d.opacity)?m:1,a.drawImage(d.image,i,j,k,l))}}function m(a,b,c){if(b.items.length)for(var d,e,f,g,h,i,j,k,l,m=b.items,n=0,o=m.length;o>n;++n)d=m[n],(!c||c.intersects(d.bounds))&&(a.font=H.scene.fontString(d),a.textAlign=d.align||"left",a.textBaseline=d.baseline||"alphabetic",g=null==d.opacity?1:d.opacity,0!=g&&(i=d.x||0,j=d.y||0,(k=d.radius)&&(l=(d.theta||0)-Math.PI/2,i+=k*Math.cos(l),j+=k*Math.sin(l)),d.angle?(a.save(),a.translate(i,j),a.rotate(d.angle*Math.PI/180),i=d.dx||0,j=d.dy||0):(i+=d.dx||0,j+=d.dy||0),(e=d.fill)&&(a.globalAlpha=g*(null==d.fillOpacity?1:d.fillOpacity),a.fillStyle=q(a,d,e),a.fillText(d.text,i,j)),(f=d.stroke)&&(h=null!=(h=d.strokeWidth)?h:1,h>0&&(a.globalAlpha=g*(null==d.strokeOpacity?1:d.strokeOpacity),a.strokeStyle=q(d,f),a.lineWidth=h,a.strokeText(d.text,i,j))),d.angle&&a.restore()))}function n(a){return function(b,c,d){i(a,b,c,d)}}function o(a){return function(b,c,d){c.items.length&&(!d||d.intersects(c.items[0].bounds))&&h(a,b,c.items[0],c.items)}}function p(a,b,c){if(b.items.length){var d,e,f,g,h,i,k,l,m,n=b.items,o=this;for(j(a,b,c),i=0,k=n.length;k>i;++i){for(d=n[i],e=d.axisItems||[],f=d.legendItems||[],g=d.x||0,h=d.y||0,a.save(),a.translate(g,h),d.clip&&(a.beginPath(),a.rect(0,0,d.width||0,d.height||0),a.clip()),c&&c.translate(-g,-h),l=0,m=e.length;m>l;++l)"back"===e[l].def.layer&&o.draw(a,e[l],c);for(l=0,m=d.items.length;m>l;++l)o.draw(a,d.items[l],c);for(l=0,m=e.length;m>l;++l)"back"!==e[l].def.layer&&o.draw(a,e[l],c);for(l=0,m=f.length;m>l;++l)o.draw(a,f[l],c);c&&c.translate(g,h),a.restore()}}}function q(a,b,c){return c.id?r(a,c,b.bounds):c}function r(a,b,c){var d,e,f=c.width(),g=c.height(),h=c.x1+b.x1*f,i=c.y1+b.y1*g,j=c.x1+b.x2*f,k=c.y1+b.y2*g,l=a.createLinearGradient(h,i,j,k),m=b.stops;for(d=0,e=m.length;e>d;++d)l.addColorStop(m[d].offset,m[d].color);return l}function s(a,b,c,d,e,f){if(0===b.items.length||b.bounds&&!b.bounds.contains(e,f))return!1;var g,h,i,j,k,l,m,n=b.items,o=this;for(l=n.length;--l>=0;){for(h=n[l],j=h.x||0,k=h.y||0,a.save(),a.translate(j,k),m=h.items.length;--m>=0;)if(g=h.items[m],g.interactive!==!1&&(i=o.pick(g,c,d,e-j,f-k)))return a.restore(),i;a.restore()}return b.interactive?t(D.group,a,b,c,d,e,f):!1}function t(a,b,c,d,e,f,g){if(!c.items.length)return!1;var h,i,j;for(1!==b._ratio&&(d*=b._ratio,e*=b._ratio),j=c.items.length;--j>=0;)if(h=c.items[j],i=h.bounds,(!i||i.contains(f,g))&&i&&a(b,h,d,e,f,g))return h;return!1}function u(a,b,c,d,e,f){if(!b.items.length)return!1;var g,h=b.items;return g=h[0].bounds,g&&!g.contains(e,f)?!1:(1!==a._ratio&&(c*=a._ratio,d*=a._ratio),D.area(a,h,c,d)?h[0]:!1)}function v(a,b,c,d,e,f){if(!b.items.length)return!1;var g,h=b.items;return g=h[0].bounds,g&&!g.contains(e,f)?!1:(1!==a._ratio&&(c*=a._ratio,d*=a._ratio),D.line(a,h,c,d)?h[0]:!1)}function w(a){return function(b,c,d,e,f,g){return t(a,b,c,d,e,f,g)}}function x(a,b,c,d,e,f){if(!b.fontSize)return!1;if(!b.angle)return!0;var g=H.scene.bounds.text(b,C,!0),h=-b.angle*Math.PI/180,i=Math.cos(h),j=Math.sin(h),c=b.x,d=b.y,k=i*e-j*f+(c-c*i+d*j),l=j*e+i*f+(d-c*j-d*i);return g.contains(k,l)}var y=H.canvas.path.parse,z=H.canvas.path.render,A=(Math.PI/2,Math.sqrt(3)),B=Math.tan(30*Math.PI/180),C=new H.Bounds,D={text:x,rect:function(){return!0},image:function(){return!0},group:function(a,b){return b.fill||b.stroke},rule:function(a,b,c,d){return a.isPointInStroke?(g(a,b),a.isPointInStroke(c,d)):!1},line:function(a,b,c,d){return a.isPointInStroke?(f(a,b),a.isPointInStroke(c,d)):!1},arc:function(b,c,d,e){return a(b,c),b.isPointInPath(d,e)},area:function(a,c,d,e){return b(a,c),a.isPointInPath(d,e)},path:function(a,b,c,e){return d(a,b),a.isPointInPath(c,e)},symbol:function(a,b,c,d){return e(a,b),a.isPointInPath(c,d)}};return{draw:{group:p,area:o(b),line:o(c),arc:n(a),path:n(d),symbol:n(e),rect:j,rule:k,text:m,image:l,drawOne:o,drawAll:n},pick:{group:s,area:u,line:v,arc:w(D.arc),path:w(D.path),symbol:w(D.symbol),rect:w(D.rect),rule:w(D.rule),text:w(D.text),image:w(D.image),pickAll:t}}}(),H.canvas.Renderer=function(){function b(a,b){var c=window.devicePixelRatio||1,d=b.webkitBackingStorePixelRatio||b.mozBackingStorePixelRatio||b.msBackingStorePixelRatio||b.oBackingStorePixelRatio||b.backingStorePixelRatio||1,e=c/d;if(c!==d){var f=a.width,g=a.height;a.setAttribute("width",f*e),a.setAttribute("height",g*e),a.style.width=f+"px",a.style.height=g+"px"}return e}function c(a){if(!a.vgLineDash){var b=[];a.setLineDash?(a.vgLineDash=function(a){this.setLineDash(a||b)},a.vgLineDashOffset=function(a){this.lineDashOffset=a}):void 0!==a.webkitLineDash?(a.vgLineDash=function(a){this.webkitLineDash=a||b},a.vgLineDashOffset=function(a){this.webkitLineDashOffset=a}):void 0!==a.mozDash?(a.vgLineDash=function(a){this.mozDash=a},a.vgLineDashOffset=function(){}):(a.vgLineDash=function(){},a.vgLineDashOffset=function(){})}}function d(a,b){for(var c=new H.Bounds(b);null!=(a=a.mark.group);)c.translate(a.x||0,a.y||0);return c}function e(a){return a?H.array(a).reduce(function(a,b){return a.union(d(b,b.bounds)).union(d(b,b["bounds:prev"]))},new H.Bounds):null}function f(a,b){var c=null;return b&&(c=new H.Bounds(b).round(),a.beginPath(),a.rect(c.x1,c.y1,c.width(),c.height()),a.clip()),c}var g=function(){this._ctx=null,this._el=null,this._imgload=0},h=g.prototype;return h.initialize=function(b,c,d,e){if(this._el=b,!b)return this;var f=a.select(b).selectAll("canvas.marks").data([1]);return f.enter().append("canvas").attr("class","marks"),f.exit().remove(),this.resize(c,d,e)},h.resize=function(d,e,f){if(this._width=d,this._height=e,this._padding=f,this._el){var g=a.select(this._el).select("canvas.marks");g.attr("width",d+f.left+f.right).attr("height",e+f.top+f.bottom);var h;this._ctx=g.node().getContext("2d"),this._ctx._ratio=h=b(g.node(),this._ctx)||1,this._ctx.setTransform(h,0,0,h,h*f.left,h*f.top)}return c(this._ctx),this},h.context=function(a){return a?(this._ctx=a,this):this._ctx},h.element=function(){return this._el},h.pendingImages=function(){return this._imgload},h.render=function(a,b){var c,d=this._ctx,g=this._padding,h=this._width+g.left+g.right,i=this._height+g.top+g.bottom,j=null;this._scene=a,d.save(),j=f(d,e(b)),d.clearRect(-g.left,-g.top,h,i),this.draw(d,a,j),b&&(d.restore(),d.save(),c=f(d,e(b)),j.encloses(c)||(d.clearRect(-g.left,-g.top,h,i),this.draw(d,a,c))),d.restore(),this._scene=null},h.draw=function(a,b,c){var d=b.marktype,e=H.canvas.marks.draw[d];e.call(this,a,b,c)},h.renderAsync=function(a){var b=this;b._async_id&&clearTimeout(b._async_id),b._async_id=setTimeout(function(){b.render(a),delete b._async_id},50)},h.loadImage=function(a){var b,c=this,d=c._scene,e=null;return c._imgload+=1,H.config.isNode?(e=new(require("canvas").Image),H.data.load(a,function(a,b){return a?void H.error(a):(e.src=b,e.loaded=!0,void(c._imgload-=1))})):(e=new Image,b=H.config.baseURL+a,e.onload=function(){H.log("LOAD IMAGE: "+b),e.loaded=!0,c._imgload-=1,c.renderAsync(d)},e.src=b),e},g}(),H.canvas.Handler=function(){function b(a){var b=a.indexOf(".");return 0>b?a:a.slice(0,b)}var c=function(a,b){this._active=null,this._handlers={},a&&this.initialize(a),b&&this.model(b)},d=c.prototype;d.initialize=function(b,c,f){this._el=a.select(b).node(),this._canvas=a.select(b).select("canvas.marks").node(),this._padding=c,this._obj=f||null;var g=this._canvas,h=this;return e.forEach(function(a){g.addEventListener(a,function(b){d[a].call(h,b)})}),this},d.padding=function(a){return this._padding=a,this},d.model=function(a){return arguments.length?(this._model=a,this):this._model},d.handlers=function(){var a=this._handlers;return H.keys(a).reduce(function(b,c){return a[c].reduce(function(a,b){return a.push(b),a},b)},[])};var e=["mousedown","mouseup","click","dblclick","wheel","keydown","keypress","keyup","mousewheel"];return e.forEach(function(a){d[a]=function(b){this.fire(a,b)}}),e.push("mousemove"),e.push("mouseout"),d.mousemove=function(a){var b=this._padding,c=a.target.getBoundingClientRect(),d=a.clientX-c.left,e=a.clientY-c.top,f=this._active,g=this.pick(this._model.scene(),d,e,d-b.left,e-b.top);return g===f?void this.fire("mousemove",a):(f&&this.fire("mouseout",a),this._active=g,void(g&&this.fire("mouseover",a)))},d.mouseout=function(a){this._active&&this.fire("mouseout",a),this._active=null
},d.DOMMouseScroll=function(a){this.fire("mousewheel",a)},d.fire=function(a,b){var c=this._active,d=this._handlers[a];if(c&&d)for(var e=0,f=d.length;f>e;++e)d[e].handler.call(this._obj,b,c)},d.on=function(a,c){var d=b(a),e=this._handlers;return e=e[d]||(e[d]=[]),e.push({type:a,handler:c}),this},d.off=function(a,c){var d=b(a),e=this._handlers[d];if(e){for(var f=e.length;--f>=0;)e[f].type===a&&(c&&e[f].handler!==c||e.splice(f,1));return this}},d.context=function(){return this._canvas.getContext("2d")},d.pick=function(a,b,c,d,e){var f=this.context(),g=a.marktype,h=H.canvas.marks.pick[g];return h.call(this,f,a,b,c,d,e)},c}(),H.svg={},H.svg.marks=function(){function b(a){return a.x||0}function c(a){return a.y||0}function d(a){return a.y+a.height||0}function e(a){return null==a.size?100:a.size}function f(a){return a.shape||"circle"}function g(a){var b,c,d,e,f,g=a.mark?a:a.length?a[0]:null;if(null!==g)for(b=0,c=F.length;c>b;++b)d=F[b],e=E[d],f=g[d],null==f?"fill"===e?this.style.setProperty(e,"none",null):this.style.removeProperty(e):(f.id&&(H.svg._cur._defs.gradient[f.id]=f,f="url(#"+f.id+")"),this.style.setProperty(e,f+"",null))}function h(a){var b=a.x||0,c=a.y||0;this.setAttribute("transform","translate("+b+","+c+")"),this.setAttribute("d",x(a))}function i(a){if(a.length){var b=a[0];y.interpolate(b.interpolate||"linear").tension(null==b.tension?.7:b.tension),this.setAttribute("d",y(a))}}function j(a){if(a.length){var b=a[0];z.interpolate(b.interpolate||"linear").tension(null==b.tension?.7:b.tension),this.setAttribute("d",z(a))}}function k(a){var b=a.x||0,c=a.y||0;this.setAttribute("transform","translate("+b+","+c+")"),null!=a.path&&this.setAttribute("d",a.path)}function l(a){this.setAttribute("x",a.x||0),this.setAttribute("y",a.y||0),this.setAttribute("width",a.width||0),this.setAttribute("height",a.height||0)}function m(a){var b=a.x||0,c=a.y||0;this.setAttribute("x1",b),this.setAttribute("y1",c),this.setAttribute("x2",null!=a.x2?a.x2:b),this.setAttribute("y2",null!=a.y2?a.y2:c)}function n(a){var b=a.x||0,c=a.y||0;this.setAttribute("transform","translate("+b+","+c+")"),this.setAttribute("d",A(a))}function o(a){var b=a.width||a.image&&a.image.width||0,c=a.height||a.image&&a.image.height||0,d=a.x-("center"===a.align?b/2:"right"===a.align?b:0),e=a.y-("middle"===a.baseline?c/2:"bottom"===a.baseline?c:0),f=H.config.baseURL+a.url;this.setAttributeNS("http://www.w3.org/1999/xlink","href",f),this.setAttribute("x",d),this.setAttribute("y",e),this.setAttribute("width",b),this.setAttribute("height",c)}function p(a){return(a.fontStyle?a.fontStyle+" ":"")+(a.fontVariant?a.fontVariant+" ":"")+(a.fontWeight?a.fontWeight+" ":"")+(null!=a.fontSize?a.fontSize:H.config.render.fontSize)+"px "+(a.font||H.config.render.font)}function q(a){var b=a.x||0,c=a.y||0,d=a.dx||0,e=a.dy||0,f=a.angle||0,g=a.radius||0,h=D[a.align||"left"],i="top"===a.baseline?".9em":"middle"===a.baseline?".35em":0;if(g){var j=(a.theta||0)-Math.PI/2;b+=g*Math.cos(j),c+=g*Math.sin(j)}this.setAttribute("x",b+d),this.setAttribute("y",c+e),this.setAttribute("text-anchor",h),f?this.setAttribute("transform","rotate("+f+" "+b+","+c+")"):this.removeAttribute("transform"),i?this.setAttribute("dy",i):this.removeAttribute("dy"),this.textContent=a.text,this.style.setProperty("font",p(a),null)}function r(a){var b=a.x||0,c=a.y||0;if(this.setAttribute("transform","translate("+b+","+c+")"),a.clip){var d={width:a.width||0,height:a.height||0},e=a.clip_id||(a.clip_id="clip"+C++);H.svg._cur._defs.clipping[e]=d,this.setAttribute("clip-path","url(#"+e+")")}}function s(a){var b=a.width||0,c=a.height||0;this.setAttribute("width",b),this.setAttribute("height",c)}function t(a){var b="type-"+a.type;return a.name&&(b+=" "+a.name),b}function u(a,b,c){return function(d,e,f){v(d,e,f,"mark_",a,b,c)}}function v(b,c,d,e,f,h,i){var j=i?[c.items]:c.items,k=c.interactive===!1?"none":null,l=b.node().childNodes,m="g"!==f,n=(n=l[d+1])?a.select(n):b.append("g").attr("id","g"+ ++B).attr("class",t(c.def)),o=n.attr("id"),p="#"+o+" > "+f,q=n.selectAll(p).data(j),r=q.enter().append(f);return m?(n.style("pointer-events",k),r.each(function(a){a.mark?a._svg=this:a.length&&(a[0]._svg=this)})):r.append("rect").attr("class","background").style("pointer-events",k),q.exit().remove(),q.each(h),m?q.each(g):n.selectAll(p+" > rect.background").each(s).each(g),n}function w(b,c,d,e){var f,g,h,i=v(b,c,d,e||"group_","g",r),j=i.node().childNodes,k=j.length;for(f=0;k>f;++f){var l=j[f].__data__.items,m=j[f].__data__.legendItems||[],n=j[f].__data__.axisItems||[],o=a.select(j[f]),p=0;for(g=0,h=n.length;h>g;++g)"back"===n[g].def.layer&&w.call(this,o,n[g],p++,"axis_");for(g=0,h=l.length;h>g;++g)this.draw(o,l[g],p++);for(g=0,h=n.length;h>g;++g)"back"!==n[g].def.layer&&w.call(this,o,n[g],p++,"axis_");for(g=0,h=m.length;h>g;++g)w.call(this,o,m[g],p++,"legend_")}}var x=a.svg.arc(),y=a.svg.area().x(b).y1(c).y0(d),z=a.svg.line().x(b).y(c),A=a.svg.symbol().type(f).size(e),B=0,C=0,D={left:"start",center:"middle",right:"end"},E={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeWidth:"stroke-width",strokeOpacity:"stroke-opacity",strokeCap:"stroke-linecap",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",opacity:"opacity"},F=H.keys(E);return{update:{group:l,area:i,line:j,arc:h,path:k,symbol:n,rect:l,rule:m,text:q,image:o},nested:{area:!0,line:!0},style:g,draw:{group:w,area:u("path",i,!0),line:u("path",j,!0),arc:u("path",h),path:u("path",k),symbol:u("path",n),rect:u("rect",l),rule:u("line",m),text:u("text",q),image:u("image",o),draw:u}}}(),H.svg.Renderer=function(){var b=function(){this._svg=null,this._ctx=null,this._el=null,this._defs={gradient:{},clipping:{}}},c=b.prototype;return c.initialize=function(b,c,d,e){return this._el=b,a.select(b).select("svg.marks").remove(),this._svg=a.select(b).append("svg").attr("class","marks"),this._ctx=this._svg.append("g"),this.resize(c,d,e)},c.resize=function(a,b,c){return this._width=a,this._height=b,this._padding=c,this._svg.attr("width",a+c.left+c.right).attr("height",b+c.top+c.bottom),this._ctx.attr("transform","translate("+c.left+","+c.top+")"),this},c.context=function(){return this._ctx},c.element=function(){return this._el},c.updateDefs=function(){var b,c,d=this._svg,e=this._defs,f=H.keys(e.gradient),g=H.keys(e.clipping),h=d.select("defs");return 0===f.length&&0==g.length?void h.remove():(h.empty()&&(h=d.insert("defs",":first-child")),b=h.selectAll("linearGradient").data(f,H.identity),b.enter().append("linearGradient").attr("id",H.identity),b.exit().remove(),b.each(function(b){var c=e.gradient[b],d=a.select(this);d.attr({x1:c.x1,x2:c.x2,y1:c.y1,y2:c.y2}),stop=d.selectAll("stop").data(c.stops),stop.enter().append("stop"),stop.exit().remove(),stop.attr("offset",function(a){return a.offset}).attr("stop-color",function(a){return a.color})}),c=h.selectAll("clipPath").data(g,H.identity),c.enter().append("clipPath").attr("id",H.identity),c.exit().remove(),void c.each(function(b){var c=e.clipping[b],d=a.select(this).selectAll("rect").data([1]);d.enter().append("rect"),d.attr("x",0).attr("y",0).attr("width",c.width).attr("height",c.height)}))},c.render=function(a,b){H.svg._cur=this,b?this.renderItems(H.array(b)):this.draw(this._ctx,a,-1),this.updateDefs(),delete H.svg._cur},c.renderItems=function(a){var b,c,d,e,f,g=H.svg.marks;for(e=0,f=a.length;f>e;++e)b=a[e],c=b._svg,d=b.mark.marktype,b=g.nested[d]?b.mark.items:b,g.update[d].call(c,b),g.style.call(c,b)},c.draw=function(a,b,c){var d=b.marktype,e=H.svg.marks.draw[d];e.call(this,a,b,c)},b}(),H.svg.Handler=function(){function b(a){var b=this;return function(c){var d=c.target,e=d.__data__;e&&(e=e.mark?e:e[0],a.call(b._obj,c,e))}}function c(a){var b=a.indexOf(".");return 0>b?a:a.slice(0,b)}var d=function(a,b){this._active=null,this._handlers={},a&&this.initialize(a),b&&this.model(b)},e=d.prototype;return e.initialize=function(b,c,d){return this._el=a.select(b).node(),this._svg=a.select(b).select("svg.marks").node(),this._padding=c,this._obj=d||null,this},e.padding=function(a){return this._padding=a,this},e.model=function(a){return arguments.length?(this._model=a,this):this._model},e.handlers=function(){var a=this._handlers;return H.keys(a).reduce(function(b,c){return a[c].reduce(function(a,b){return a.push(b),a},b)},[])},e.on=function(d,e){var f=c(d),g=this._handlers,h=a.select(this._svg).node(),i={type:d,handler:e,svg:b.call(this,e)};return g=g[f]||(g[f]=[]),g.push(i),h.addEventListener(f,i.svg),this},e.off=function(b,d){var e=c(b),f=this._handlers[e],g=a.select(this._svg).node();if(f){for(var h=f.length;--h>=0;)f[h].type===b&&(d&&f[h].handler!==d||(g.removeEventListener(e,f[h].svg),f.splice(h,1)));return this}},d}(),H.data={},H.data.ingestAll=function(a){return H.isTree(a)?f(H.data.ingestTree(a[0],a.children)):a.map(H.data.ingest)},H.data.ingest=function(a,b){return{data:a,index:b}},H.data.ingestTree=function(a,b,c){var d,e,f=H.data.ingest(a,c||0),g=a[b];if(g&&(d=g.length))for(f.values=Array(d),e=0;d>e;++e)f.values[e]=H.data.ingestTree(g[e],b,e);return f},H.data.mapper=function(a){return function(b){return b.forEach(a),b}},H.data.size=function(a,b){return a=H.isArray(a)?a:[0,a],a=a.map(function(a){return"string"==typeof a?b[a]:a})},H.data.load=function(a,b){var c=i(a)?a:H.config.baseURL+a;if(H.config.isNode){var d=j(c)?m:n;d(c,b)}else k(c,b)};var M=/^[A-Za-z]+\:\/\//,N="file://";H.data.read=function(){function c(a,b){var c=b&&b.type||"json";return a=f[c](a,b),b&&b.parse&&d(a,b.parse),a}function d(a,b){var c=H.keys(b),d=c.map(function(a){return g[b[a]]}),f=H.isTree(a);e(f?[a]:a,c,d,f)}function e(a,b,c,e){var f,g,h,i,j;for(g=0,i=a.length;i>g;++g){for(f=a[g],h=0,j=b.length;j>h;++h)f[b[h]]=c[h](f[b[h]]);e&&f.values&&d(f,b,c,!0)}}var f={},g={number:H.number,"boolean":H.boolean,date:Date.parse};return f.json=function(a,b){var c=H.isObject(a)?a:JSON.parse(a);return b&&b.property&&(c=H.accessor(b.property)(c)),c},f.csv=function(b){var c=a.csv.parse(b);return c},f.tsv=function(b){var c=a.tsv.parse(b);return c},f.topojson=function(a,c){if(null==b)return H.error("TopoJSON library not loaded."),[];var d=H.isObject(a)?a:JSON.parse(a),e=[];return c&&c.feature?e=(e=d.objects[c.feature])?b.feature(d,e).features:(H.error("Invalid TopoJSON object: "+c.feature),[]):c&&c.mesh?e=(e=d.objects[c.mesh])?[b.mesh(d,d.objects[c.mesh])]:(H.error("Invalid TopoJSON object: "+c.mesh),[]):H.error("Missing TopoJSON feature or mesh parameter."),e},f.treejson=function(a,b){return a=H.isObject(a)?a:JSON.parse(a),H.tree(a,b.children)},c.formats=f,c.parse=d,c}(),H.data.array=function(){function a(a){return a.map(function(a){for(var c=[],d=0,e=b.length;e>d;++d)c.push(b[d](a));return c})}var b=[];return a.fields=function(c){return b=H.array(c).map(H.accessor),a},a},H.data.copy=function(){var a=H.accessor("data"),b=[],c=null,d=H.data.mapper(function(d){var e,f,g=a(d),h=c||b;for(e=0,f=b.length;f>e;++e)d[h[e]]=g[b[e]];return d});return d.from=function(b){return a=H.accessor(b),d},d.fields=function(a){return b=H.array(a),d},d.as=function(a){return c=H.array(a),d},d},H.data.cross=function(){function a(a){var e,f,g,h=[],i=b||a,j=a.length;for(f=0;j>f;++f)for(g=0;j>g;++g)c&&f===g||(e={},e[d.left]=a[f],e[d.right]=i[g],h.push(e));return h}var b=null,c=!1,d={left:"a",right:"b"};return a["with"]=function(c){return b=c,a},a.diagonal=function(b){return c=!b,a},a.output=function(b){return H.keys(d).forEach(function(a){void 0!==b[a]&&(d[a]=b[a])}),a},a},H.data.facet=function(){function a(a){var d,e,f,g,h,i,j,k={key:"",keys:[],values:[]},l={},m=k.values;if(0===b.length)return m.push(d={key:"",keys:[],index:0,values:c?a.slice():a}),c&&c(d.values),k;for(h=0,g=a.length;g>h;++h){for(i=0,e=[],f="";i<b.length;++i)j=b[i](a[h]),e.push(j),f+=(i>0?"|":"")+String(j);d=l[f],void 0===d&&m.push(d=l[f]={key:f,keys:e,index:m.length,values:[]}),d.values.push(a[h])}if(c)for(h=0,g=m.length;g>h;++h)c(m[h].values);return k}var b=[],c=null;return a.keys=function(c){return b=H.array(c).map(H.accessor),a},a.sort=function(b){return c=H.data.sort().by(b),a},a},H.data.filter=function(){function a(a){return b?a.filter(b):a}var b=null;return a.test=function(c){return b=H.isFunction(c)?c:H.parse.expr(c),a},a},H.data.flatten=function(){function a(a){return b(a,[])}function b(a,c){if(a.values)for(var d=0,e=a.values.length;e>d;++d)b(a.values[d],c);else c.push(a);return c}return a},H.data.fold=function(){function a(a){var e,f,g,h,i=[],j=b.length;for(f=0,h=a.length;h>f;++f)for(e=a[f],g=0;j>g;++g){var k={index:i.length,data:e.data};k[d.key]=b[g],k[d.value]=c[g](e),i.push(k)}return i}var b=[],c=[],d={key:"key",value:"value"};return a.fields=function(d){return b=H.array(d),c=b.map(H.accessor),a},a.output=function(b){return H.keys(d).forEach(function(a){void 0!==b[a]&&(d[a]=b[a])}),a},a},H.data.force=function(){function b(a,b,e){c.size(H.data.size(i,e)).nodes(a),d&&b[d]&&c.links(b[d]),c.start();for(var f=0;h>f;++f)c.tick();return c.stop(),a}var c=a.layout.force(),d=null,e=20,f=1,g=-30,h=500,i=["width","height"],j=["friction","theta","gravity","alpha"];return b.links=function(a){return d=a,b},b.size=function(a){return i=a,b},b.linkDistance=function(a){return e="number"==typeof a?a:H.accessor(a),c.linkDistance(e),b},b.linkStrength=function(a){return f="number"==typeof a?a:H.accessor(a),c.linkStrength(f),b},b.charge=function(a){return g="number"==typeof a?a:H.accessor(a),c.charge(g),b},b.iterations=function(a){return h=a,b},j.forEach(function(a){b[a]=function(d){return c[a](d),b}}),b},H.data.force.dependencies=["links"],H.data.formula=function(){return function(){var a=null,b=H.identity,c=H.data.mapper(function(c,d,e){return a&&(c[a]=b.call(null,c,d,e)),c});return c.field=function(b){return a=b,c},c.expr=function(a){return b=H.isFunction(a)?a:H.parse.expr(a),c},c}}(),H.data.geo=function(){function b(){var b={},d="mercator",e=a.geo[d](),f=H.identity,g=H.identity,h={x:"x",y:"y"},i=H.data.mapper(function(a){var b=[g(a),f(a)],c=e(b);return a[h.x]=c[0],a[h.y]=c[1],a});return i.func=function(){return e},i.projection=function(c){if(d!==c){d=c,e=a.geo[d]();for(var f in b)e[f](b[f])}return i},c.forEach(function(a){i[a]=function(c){return b[a]=c,e[a](c),i}}),i.lon=function(a){return g=H.accessor(a),i},i.lat=function(a){return f=H.accessor(a),i},i.output=function(a){return H.keys(h).forEach(function(b){void 0!==a[b]&&(h[b]=a[b])}),a},i}var c=["center","scale","translate","rotate","precision","clipAngle"];return b.params=c,b}(),H.data.geopath=function(){var b=a.geo.path().projection(a.geo.mercator()),c="mercator",d=H.identity,e={},f={path:"path"},g=H.data.mapper(function(a){return a[f.path]=b(d(a)),a});return g.projection=function(d){if(c!==d){c=d;var f=a.geo[c]();for(var h in e)f[h](e[h]);b.projection(f)}return g},H.data.geo.params.forEach(function(a){g[a]=function(c){return e[a]=c,b.projection()[a](c),g}}),g.value=function(a){return d=H.accessor(a),g},g.output=function(a){return H.keys(f).forEach(function(b){void 0!==a[b]&&(f[b]=a[b])}),a},g},H.data.link=function(){function a(a){var b=g(a),c=h(a);return"M"+b.x+","+b.y+"L"+c.x+","+c.y}function b(a){var b=g(a),c=h(a),d=c.x-b.x,e=c.y-b.y,f=i*(d+e),j=i*(e-d);return"M"+b.x+","+b.y+"C"+(b.x+f)+","+(b.y+j)+" "+(c.x+j)+","+(c.y-f)+" "+c.x+","+c.y}function c(a){var b=g(a),c=h(a),d=(b.x+c.x)/2;return"M"+b.x+","+b.y+"C"+d+","+b.y+" "+d+","+c.y+" "+c.x+","+c.y}function d(a){var b=g(a),c=h(a),d=(b.y+c.y)/2;return"M"+b.x+","+b.y+"C"+b.x+","+d+" "+c.x+","+d+" "+c.x+","+c.y}function e(a){var b=k[f];return a.forEach(function(a){a[j.path]=b(a)}),a}var f="line",g=H.accessor("source"),h=H.accessor("target"),i=.2,j={path:"path"},k={line:a,curve:b,diagonal:c,diagonalX:c,diagonalY:d};return e.shape=function(a){return f=a,e},e.tension=function(a){return i=a,e},e.source=function(a){return g=H.accessor(a),e},e.target=function(a){return h=H.accessor(a),e},e.output=function(a){return H.keys(j).forEach(function(b){void 0!==a[b]&&(j[b]=a[b])}),e},e},H.data.pie=function(){function b(b){var c=b.map(function(a){return+d(a)}),i=e,j=(f-e)/a.sum(c),k=a.range(b.length);return g&&k.sort(function(a,b){return c[a]-c[b]}),k.forEach(function(a){var d;b[a].value=d=c[a],b[a][h.startAngle]=i,b[a][h.midAngle]=i+.5*d*j,b[a][h.endAngle]=i+=d*j}),b}var c=function(){return 1},d=c,e=0,f=2*Math.PI,g=!1,h={startAngle:"startAngle",endAngle:"endAngle",midAngle:"midAngle"};return b.sort=function(a){return g=a,b},b.value=function(a){return d=a?H.accessor(a):c,b},b.startAngle=function(a){return e=Math.PI*a/180,b},b.endAngle=function(a){return f=Math.PI*a/180,b},b.output=function(a){return H.keys(h).forEach(function(b){void 0!==a[b]&&(h[b]=a[b])}),b},b},H.data.slice=function(){function a(a){if(a=H.values(a),"min"===b)a=[a[H.minIndex(a,c)]];else if("max"===b)a=[a[H.maxIndex(a,c)]];else if("median"===b){var d=a.slice().sort(function(a,b){return a=c(a),b=c(b),b>a?-1:a>b?1:0});a=[a[~~(d.length/2)]]}else{var e=H.array(b);a=a.slice(e[0],e[1])}return a}var b=null,c=H.accessor("data");return a.by=function(c){return b=c,a},a.field=function(b){return c=H.accessor(b),a},a},H.data.sort=function(){function a(a){a=H.isArray(a)?a:a.values||[],a.sort(b);for(var c=0,d=a.length;d>c;++c)a[c].index=c;return a}var b=null;return a.by=function(c){return b=H.comparator(c),a},a},H.data.stack=function(){function b(a){var b=h.y0,e=h.y1,f=h.cy,g=c(a);return 0===g.length?a:(d.out(function(a,c,d){a.datum&&(a.datum[b]=c,a.datum[e]=d+c,a.datum[f]=c+d/2)})(g),a)}function c(a){var b,c,d,g,h,i,j,k,l=H.values(a),m=[],n=[];if(0===l.length)return n;for(c=0,d=l.length;d>c;++c){for(b=H.values(l[c]),g=0,h=b.length;h>g;++g)m.push({x:e(b[g]),y:f(b[g]),z:c,datum:b[g]});n.push([])}for(m.sort(function(a,b){return a.x<b.x?-1:a.x>b.x?1:a.z<b.z?-1:a.z>b.z?1:0}),k=m[0].x,c=0,g=0,i=0,d=m.length;d>i;++i){if(j=m[i],j.x!==k){for(;c<n.length;)n[c++].push({x:g,y:0});k=j.x,c=0,g+=1}for(;j.z>c;)n[c++].push({x:g,y:0});j.x=g,n[c++].push(j)}for(;c<n.length;)n[c++].push({x:g,y:0});return n}var d=a.layout.stack(),e=H.accessor("index"),f=H.accessor("data"),g=["offset","order"],h={y0:"y2",y1:"y",cy:"cy"};return b.point=function(a){return e=H.accessor(a),b},b.height=function(a){return f=H.accessor(a),b},g.forEach(function(a){b[a]=function(c){return d[a](c),b}}),b.output=function(c){return a.keys(h).forEach(function(a){void 0!==c[a]&&(h[a]=c[a])}),b},b},H.data.stats=function(){function a(a){var b,g,h,i,j=+1/0,k=-1/0,l=0,m=0,n=0,o=(H.isArray(a)?a:a.values||[]).map(c);for(b=0,g=o.length;g>b;++b)h=o[b],j>h&&(j=h),h>k&&(k=h),l+=h,i=h-m,m+=i/(b+1),n+=i*(h-m);n/=g-1;var p=H.isArray(a)?{}:a;if(e&&(o.sort(H.numcmp),b=o.length>>1,p[f.median]=o.length%2?o[b]:(o[b-1]+o[b])/2),p[f.count]=g,p[f.min]=j,p[f.max]=k,p[f.sum]=l,p[f.mean]=m,p[f.variance]=n,p[f.stdev]=Math.sqrt(n),d){for(o=H.isArray(a)?a:a.values,h={},h[f.count]=g,h[f.min]=j,h[f.max]=k,h[f.sum]=l,h[f.mean]=m,h[f.variance]=n,h[f.stdev]=Math.sqrt(n),e&&(h[f.median]=p[f.median]),b=0,g=o.length;g>b;++b)o[b].stats=h;H.isArray(a)&&(p=o)}return p}function b(b){return H.isArray(b)?a(b):(b.values||[]).map(a)}var c=H.accessor("data"),d=!1,e=!1,f={count:"count",min:"min",max:"max",sum:"sum",mean:"mean",variance:"variance",stdev:"stdev",median:"median"};return b.median=function(a){return e=a||!1,b},b.value=function(a){return c=H.accessor(a),b},b.assign=function(a){return d=a,b},b.output=function(a){return H.keys(f).forEach(function(b){void 0!==a[b]&&(f[b]=a[b])}),b},b},H.data.treemap=function(){function b(a,b,f){a=c.size(H.data.size(e,f)).value(d).nodes(H.isTree(a)?a:{values:a});var h=H.keys(g),i=h.length;return a.forEach(function(a){for(var b,c,d=0;i>d;++d)b=h[d],b!==g[b]&&(c=a[b],delete a[b],a[g[b]]=c)}),a}var c=a.layout.treemap().children(function(a){return a.values}),d=H.accessor("data"),e=["width","height"],f=["round","sticky","ratio","padding"],g={x:"x",y:"y",dx:"width",dy:"height"};return b.size=function(a){return e=a,b},b.value=function(a){return d=H.accessor(a),b},f.forEach(function(a){b[a]=function(d){return c[a](d),b}}),b.output=function(a){return H.keys(g).forEach(function(b){void 0!==a[b]&&(g[b]=a[b])}),b},b},H.data.truncate=function(){var a=H.accessor("data"),b="truncate",c="right",d="...",e=!0,f=100,g=H.data.mapper(function(g){var h=H.truncate(a(g),f,c,e,d);return g[b]=h,g});return g.value=function(b){return a=H.accessor(b),g},g.output=function(a){return b=a,g},g.limit=function(a){return f=+a,g},g.position=function(a){return c=a,g},g.ellipsis=function(a){return d=a+"",g},g.wordbreak=function(a){return e=!!a,g},g},H.data.unique=function(){function a(a){return H.unique(a,b).map(function(a){var b={};return b[c]=a,b})}var b=null,c="field";return a.field=function(c){return b=H.accessor(c),a},a.as=function(b){return c=b,a},a},H.data.window=function(){function a(a){a=H.isArray(a)?a:a.values||[];var d,e,f,g=[],h=a.length-b;for(d=0;h>=d;d+=c){for(e=0,f=[];b>e;++e)f.push(a[d+e]);g.push({key:d,values:f})}return{values:g}}var b=2,c=1;return a.size=function(c){return b=c,a},a.step=function(b){return c=b,a},a},H.data.wordcloud=function(){function b(a,b,h){function j(b){var d,e,g,h,j,k=c.size(),l=k[0]/2,m=k[1]/2,n=H.keys(i),o=n.length;for(a.sort(function(a,b){return f(b)-f(a)}),g=0,h=b.length;h>g;++g)for(e=a[g],j=0;o>j;++j)d=n[j],e[i[d]]=b[g][d],"x"===d&&(e[i.x]+=l),"y"===d&&(e[i.y]+=m)}return c.size(H.data.size(e,h)).text(d).fontSize(f).rotate(g).words(a).on("end",j).start(),a}var c=a.layout.cloud().size([900,500]),d=H.accessor("data"),e=["width","height"],f=function(){return 14},g=function(){return 0},h=["font","fontStyle","fontWeight","padding"],i={x:"x",y:"y",size:"fontSize",font:"font",rotate:"angle"};return b.text=function(a){return d=H.accessor(a),b},b.size=function(a){return e=a,b},b.fontSize=function(a){return f=H.accessor(a),b},b.rotate=function(a){var c;return H.isObject(a)&&!Array.isArray(a)?void 0!==a.random?(c=(c=a.random)?H.array(c):[0],g=function(){return c[~~(Math.random()*c.length-1e-5)]}):void 0!==a.alternate&&(c=(c=a.alternate)?H.array(c):[0],g=function(a,b){return c[b%c.length]}):g=H.accessor(field),b},h.forEach(function(a){b[a]=function(d){return c[a](d),b}}),b.output=function(a){return H.keys(i).forEach(function(b){void 0!==a[b]&&(i[b]=a[b])}),b},b},H.data.zip=function(){function a(a,g){var h,i,j,k,l,m=g[b],n=m.length;for(f&&(l={},m.forEach(function(a){l[f(a)]=a})),j=0,k=a.length;k>j;++j)i=a[j],i[c]=l?null!=(h=l[d(i)])?h:e:m[j%n];return a}var b=null,c="zip",d=H.accessor("data"),e=void 0,f=null;return a["with"]=function(c){return b=c,a},a["default"]=function(b){return e=b,a},a.as=function(b){return c=b,a},a.key=function(b){return d=H.accessor(b),a},a.withKey=function(b){return f=H.accessor(b),a},a},H.data.zip.dependencies=["with"],H.parse={},H.parse.axes=function(){function a(a,c,d){(a||[]).forEach(function(a,e){c[e]=c[e]||H.scene.axis(),b(a,e,c[e],d)})}function b(a,b,d,e){void 0!==a.scale&&d.scale(e[a.scale]),d.orient(a.orient||c[a.type]),d.offset(a.offset||0),d.layer(a.layer||"front"),d.grid(a.grid||!1),d.title(a.title||null),d.titleOffset(null!=a.titleOffset?a.titleOffset:H.config.axis.titleOffset),d.tickValues(a.values||null),d.tickFormat(a.format||null),d.tickSubdivide(a.subdivide||0),d.tickPadding(a.tickPadding||H.config.axis.padding);var f=[];if(void 0!==a.tickSize)for(var g=0;3>g;++g)f.push(a.tickSize);else{var h=H.config.axis.tickSize;f=[h,h,h]}if(null!=a.tickSizeMajor&&(f[0]=a.tickSizeMajor),null!=a.tickSizeMinor&&(f[1]=a.tickSizeMinor),null!=a.tickSizeEnd&&(f[2]=a.tickSizeEnd),f.length&&d.tickSize.apply(d,f),null!=a.ticks){var i=H.isArray(a.ticks)?a.ticks:[a.ticks];d.ticks.apply(d,i)}else d.ticks(H.config.axis.ticks);var j=a.properties;j&&j.ticks?(d.majorTickProperties(j.majorTicks?H.extend({},j.ticks,j.majorTicks):j.ticks),d.minorTickProperties(j.minorTicks?H.extend({},j.ticks,j.minorTicks):j.ticks)):(d.majorTickProperties(j&&j.majorTicks||{}),d.minorTickProperties(j&&j.minorTicks||{})),d.tickLabelProperties(j&&j.labels||{}),d.titleProperties(j&&j.title||{}),d.gridLineProperties(j&&j.grid||{}),d.domainProperties(j&&j.axis||{})}var c={x:"bottom",y:"left",top:"top",bottom:"bottom",left:"left",right:"right"};return a}(),H.parse.data=function(a,b){function c(a){return function(c,d){c?H.error("LOADING FAILED: "+a.url):e.load[a.name]=H.data.read(d.toString(),a.format),0===--f&&b()}}function d(a){1!==j[a]&&(j[a]||(j[a]=1,(e.source[a]||[]).forEach(d),(e.deps[a]||[]).forEach(d),j[a]=2,i.push(a)))}var e={defs:a,load:{},flow:{},deps:{},source:{},sorted:null},f=0;(a||[]).forEach(function(a){if(a.url?(f+=1,H.data.load(a.url,c(a))):a.values?e.load[a.name]=H.data.read(a.values,a.format):a.source&&(e.source[a.source]||(e.source[a.source]=[])).push(a.name),a.transform){var b=H.parse.dataflow(a);e.flow[a.name]=b,b.dependencies.forEach(function(b){(e.deps[b]||(e.deps[b]=[])).push(a.name)})}});for(var g,h=(a||[]).map(H.accessor("name")),i=[],j={};h.length;)2!==j[g=h.pop()]&&d(g);return e.sorted=i.reverse(),0===f&&setTimeout(b,1),e},H.parse.dataflow=function(a){var b=(a.transform||[]).map(H.parse.transform),c=b.length?function(a,c,d){return b.reduce(function(a,b){return b(a,c,d)},a)}:H.identity;return c.transforms=b,c.dependencies=H.keys((a.transform||[]).reduce(function(a,b){var c=H.data[b.type].dependencies;return c&&c.forEach(function(c){b[c]&&(a[b[c]]=1)}),a},{})),c},H.parse.expr=function(){var a={E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2"},b={abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan"},c=/([\"\']|[\=\<\>\~\&\|\?\:\+\-\/\*\%\!\^\,\;\[\]\{\}\(\) ]+)/;return function(d){if(H.config.safeMode)return H.error("Safe mode: Expression parsing disabled."),H.true;var e,f,g,h,i,j,k=d.split(c);for(i=0,j=0,g=0,h=k.length;h>g;++g){var e=k[g];"'"!==e?'"'!==e?j||i||(a[e]&&(k[g]=a[e]),b[e]&&(f=k[g+1])&&"("===f[0]&&(k[g]=b[e])):i||(j=!j):j||(i=!i)}return Function("d","index","data","return ("+k.join("")+");")}}(),H.parse.legends=function(){function a(a,c,d){(a||[]).forEach(function(a,e){c[e]=c[e]||H.scene.legend(),b(a,e,c[e],d)})}function b(a,b,c,d){c.size(a.size?d[a.size]:null),c.shape(a.shape?d[a.shape]:null),c.fill(a.fill?d[a.fill]:null),c.stroke(a.stroke?d[a.stroke]:null),a.orient&&c.orient(a.orient),null!=a.offset&&c.offset(a.offset),c.title(a.title||null),c.values(a.values||null),c.format(void 0!==a.format?a.format:null);var e=a.properties;c.titleProperties(e&&e.title||{}),c.labelProperties(e&&e.labels||{}),c.legendProperties(e&&e.legend||{}),c.symbolProperties(e&&e.symbols||{}),c.gradientProperties(e&&e.gradient||{})}return a}(),H.parse.mark=function(a){var b=a.properties,c=a.marks;if(H.keys(b).forEach(function(c){b[c]=H.parse.properties(a.type,b[c])}),a.delay&&(a.delay=H.parse.properties(a.type,{delay:a.delay})),a.from){var d=a.from.data,e=H.parse.dataflow(a.from);a.from=function(a,b,c){var f=H.scene.data(d?a[d]:null,c);return e(f,a,b)}}return c&&(a.marks=c.map(H.parse.mark)),a},H.parse.marks=function(a,b,c){return{type:"group",width:b,height:c,scales:a.scales||[],axes:a.axes||[],legends:a.legends||[],marks:(a.marks||[]).map(H.parse.mark)}},H.parse.padding=function(a){if(null==a)return"auto";if(H.isString(a))return"strict"===a?"strict":"auto";if(H.isObject(a))return a;var b=H.isNumber(a)?a:20;return{top:b,left:b,right:b,bottom:b}},H.parse.properties=function(){function a(a,d){var e,f,g,h,i="",j=H.keys(d),k={};for(i+="var o = trans ? {} : item;\n",e=0,f=j.length;f>e;++e)h=d[g=j[e]],i+=e>0?"\n  ":"  ",i+="o."+g+" = "+c(g,h)+";",k[g]=!0;k.x2&&(k.x?(i+="\n  if (o.x > o.x2) { var t = o.x; o.x = o.x2; o.x2 = t; };",i+="\n  o.width = (o.x2 - o.x);"):i+=k.width?"\n  o.x = (o.x2 - o.width);":"\n  o.x = o.x2;"),k.y2&&(k.y?(i+="\n  if (o.y > o.y2) { var t = o.y; o.y = o.y2; o.y2 = t; };",i+="\n  o.height = (o.y2 - o.y);"):i+=k.height?"\n  o.y = (o.y2 - o.height);":"\n  o.y = o.y2;"),b(a,k)&&(i+="\n  item.touch();"),i+="\n  if (trans) trans.interpolate(item, o);";try{return Function("item","group","trans",i)}catch(l){H.error(l),H.log(i)}}function b(a,b){return b.path||("area"===a||"line"===a)&&(b.x||b.x2||b.width||b.y||b.y2||b.height||b.tension||b.interpolate)}function c(a,b){if(null==b)return null;var c="fill"===a||"stroke"===a;if(c){if(b.c)return d("hcl",b.h,b.c,b.l);if(b.h||b.s)return d("hsl",b.h,b.s,b.l);if(b.l||b.a)return d("lab",b.l,b.a,b.b);if(b.r||b.g||b.b)return d("rgb",b.r,b.g,b.b)}var f="item.datum.data";if(void 0!==b.value&&(f=H.str(b.value)),null!=b.group){var g="group.datum";H.isString(b.group)&&(g=e[b.group]?"group."+b.group:"group.datum["+H.field(b.group).map(H.str).join("][")+"]")}if(null!=b.field?H.isString(b.field)?(f="item.datum["+H.field(b.field).map(H.str).join("][")+"]",null!=b.group&&(f="this.accessor("+f+")("+g+")")):f="this.accessor(group.datum["+H.field(b.field.group).map(H.str).join("][")+"])(item.datum.data)":null!=b.group&&(f=g),null!=b.scale){var h=H.isString(b.scale)?H.str(b.scale):(b.scale.group?"group":"item")+".datum["+H.str(b.scale.group||b.scale.field)+"]";h="group.scales["+h+"]",f=h+(b.band?".rangeBand()":"("+f+")")}return f="("+(b.mult?H.number(b.mult)+" * ":"")+f+")"+(b.offset?" + "+H.number(b.offset):"")}function d(a,b,d,e){var f=b?c("",b):H.config.color[a][0],g=d?c("",d):H.config.color[a][1],h=e?c("",e):H.config.color[a][2];return"(this.d3."+a+"("+[f,g,h].join(",")+') + "")'}var e={width:1,height:1,"mark.group.width":1,"mark.group.height":1};return a}(),H.parse.scales=function(){function b(a,b,d,e){return(a||[]).reduce(function(a,b){var f=b.name,g=f+":prev";return a[f]=c(b,a[f],d,e),a[g]=a[g]||a[f],a},b||{})}function c(a,b,c,g){var h=d(a,b),i=h.type===l?e:f,k=j(a,g),m=H.values(g.datum);return i(a,h,k,c,m),h}function d(b,c){var d=b.type||k;if(!c||d!==c.type){var e=H.config.scale[d]||a.scale[d];e||H.error("Unrecognized scale type: "+d),(c=e()).type=c.type||d,c.scaleName=b.name}return c}function e(a,b,c,d,e){var f,i,j,k,l=!1;H.isObject(a.range)&&!H.isArray(a.range)&&(l=!0,k=a.range.fields||H.array(a.range),c=g(k,d,e)),i=a.sort&&!l,f=h(a,d,e,i),f&&b.domain(f),j="string"==typeof c[0],j||c.length>2||1===c.length||l?b.range(c):a.points?b.rangePoints(c,a.padding||0):a.round||void 0===a.round?b.rangeRoundBands(c,a.padding||0):b.rangeBands(c,a.padding||0)}function f(b,c,d,e,f){var g,j;g=b.type===p?h(b,e,f,!1):i(b,e,f),c.domain(g),"height"===b.range&&(d=d.reverse()),c[b.round&&c.rangeRound?"rangeRound":"range"](d),b.exponent&&b.type===n&&c.exponent(b.exponent),b.clamp&&c.clamp(!0),b.nice&&(b.type===o?(j=a.time[b.nice],j||H.error("Unrecognized interval: "+j),c.nice(j)):c.nice())}function g(a,b,c){return a.reduce(function(a,d){var e=H.values(b[d.data]||c),f=H.accessor(H.isString(d.field)?d.field:"data."+H.accessor(d.field.group)(c));return H.unique(e,f,a)},[])}function h(a,b,c,d){var e,f,h=a.domain;return H.isArray(h)?e=d?h.slice():h:H.isObject(h)&&(f=h.fields||H.array(h),e=g(f,b,c)),e&&d&&e.sort(H.cmp),e}function i(b,c,d){function e(b,e,f,g){var i=H.values(c[b.data]||d),j=H.array(b.field).map(function(a){return H.isString(a)?a:"data."+H.accessor(a.group)(d)});j.forEach(function(b){b=H.accessor(b),e&&(h[0]=a.min([h[0],a.min(i,b)])),f&&(h[g]=a.max([h[g],a.max(i,b)]))})}var f,g,h=[null,null];return void 0!==b.domain&&(H.isArray(b.domain)?h=b.domain.slice():H.isObject(b.domain)?(f=b.domain.fields||H.array(b.domain),f.forEach(function(a){e(a,1,1,1)})):h=b.domain),g=h.length-1,void 0!==b.domainMin&&(H.isObject(b.domainMin)?(h[0]=null,f=b.domainMin.fields||H.array(b.domainMin),f.forEach(function(a){e(a,1,0,g)})):h[0]=b.domainMin),void 0!==b.domainMax&&(H.isObject(b.domainMax)?(h[g]=null,f=b.domainMax.fields||H.array(b.domainMax),f.forEach(function(a){e(a,0,1,g)})):h[g]=b.domainMax),b.type===m||b.type===o||!b.zero&&void 0!==b.zero||(h[0]=Math.min(0,h[0]),h[g]=Math.max(0,h[g])),h}function j(a,b){var c=[null,null];if(void 0!==a.range)if("string"==typeof a.range)if(q[a.range])c=[0,b[a.range]];else{if(!H.config.range[a.range])return H.error("Unrecogized range: "+a.range),c;c=H.config.range[a.range]
}else if(H.isArray(a.range))c=a.range;else{if(H.isObject(a.range))return null;c=[0,a.range]}if(void 0!==a.rangeMin&&(c[0]=a.rangeMin),void 0!==a.rangeMax&&(c[c.length-1]=a.rangeMax),void 0!==a.reverse){var d=a.reverse;H.isObject(d)&&(d=H.accessor(d.field)(b.datum)),d&&(c=c.reverse())}return c}var k="linear",l="ordinal",m="log",n="pow",o="time",p="quantile",q={width:1,height:1};return b}(),H.parse.spec=function(b,c,d){function e(a){a=H.duplicate(a);var b=a.width||500,e=a.height||500,f=a.viewport||null,g={width:b,height:e,viewport:f,padding:H.parse.padding(a.padding),marks:H.parse.marks(a,b,e),data:H.parse.data(a.data,function(){c(h)})},h=d(g)}d=d||H.ViewFactory,H.isObject(b)?e(b):a.json(b,function(a,b){a?H.error(a):e(b)})},H.parse.transform=function(a){var b=H.data[a.type]();return H.keys(a).forEach(function(c){"type"!==c&&b[c](a[c])}),b},H.scene={},H.scene.GROUP="group",H.scene.ENTER=0,H.scene.UPDATE=1,H.scene.EXIT=2,H.scene.DEFAULT_DATA={sentinel:1},H.scene.data=function(a,b){var c=H.scene.DEFAULT_DATA;return a=H.values(a||b||[c]),a===c&&(a=[c]),a},H.scene.fontString=function(a){return(a.fontStyle?a.fontStyle+" ":"")+(a.fontVariant?a.fontVariant+" ":"")+(a.fontWeight?a.fontWeight+" ":"")+(null!=a.fontSize?a.fontSize:H.config.render.fontSize)+"px "+(a.font||H.config.render.font)},H.scene.Item=function(){function a(a){this.mark=a}var b=a.prototype;return b.hasPropertySet=function(a){var b=this.mark.def.properties;return b&&null!=b[a]},b.cousin=function(a,b){if(0===a)return this;a=a||-1;var c=this.mark,d=c.group,e=null==b?c.items.indexOf(this):b,f=d.items.indexOf(c)+a;return d.items[f].items[e]},b.sibling=function(a){if(0===a)return this;a=a||-1;var b=this.mark,c=b.items.indexOf(this)+a;return b.items[c]},b.remove=function(){var a=this,b=a.mark.items,c=b.indexOf(a);return c>=0&&(c===b.length-1?b.pop():b.splice(c,1)),a},b.touch=function(){this.pathCache&&(this.pathCache=null),this.mark.pathCache&&(this.mark.pathCache=null)},a}(),H.scene.item=function(a){return new H.scene.Item(a)},H.scene.visit=function(a,b){var c,d,e,f,g;if(b(a))return!0;var h=["items","axisItems","legendItems"];for(e=0,f=h.length;f>e;++e)if(g=a[h[e]])for(c=0,d=g.length;d>c;++c)if(H.scene.visit(g[c],b))return!0},H.scene.build=function(){function b(a,b,g,i,j){var k=H.scene.data(a.from?a.from(b,g,i):null,i);return g=c(a,g),g.items=d(a,k,g),f(a,g),a.type===h&&e(a,b,g,j),g}function c(a,b){return b=b||{},b.def=a,b.marktype=a.type,b.interactive=!(a.interactive===!1),b}function d(a,b,c){var d,e,f,h,l,m,n=g(a.key),o=c.items||[],p=[],q={};for(d=0,f=o.length;f>d;++d)h=o[d],h.status=k,n&&(q[h.key]=h);for(d=0,f=b.length;f>d;++d)l=b[d],e=d,h=n?q[e=n(l)]:o[d],m=h?!1:(h=H.scene.item(c),!0),h.status=m?i:j,h.datum=l,h.key=e,p.push(h);for(d=0,f=o.length;f>d;++d)h=o[d],h.status===k&&(h.key=n?h.key:p.length,p.splice(h.index,0,h));return p}function e(a,c,d,e){var f,g,h,i,j,k,l=d.items,m=a.marks;for(f=0,g=l.length;g>f;++f){if(k=l[f],!e&&k.scales)for(j in k.scales)j.indexOf(":prev")<0&&(k.scales[j+":prev"]=k.scales[j].copy());for(k.items=k.items||[],h=0,i=m.length;i>h;++h)k.items[h]=b(m[h],c,k.items[h],k.datum),k.items[h].group=k}}function f(b,c){if(b.duration&&(c.duration=b.duration),b.ease&&(c.ease=a.ease(b.ease)),b.delay){var d,e=c.items,f=c.group,g=e.length;for(d=0;g>d;++d)b.delay.call(this,e[d],f)}}function g(a){if(null==a)return null;var b=H.array(a).map(H.accessor);return function(a){for(var c="",d=0,e=b.length;e>d;++d)d>0&&(c+="|"),c+=String(b[d](a));return c}}var h=H.scene.GROUP,i=H.scene.ENTER,j=H.scene.UPDATE,k=H.scene.EXIT;return b}(),H.scene.bounds=function(){function b(){return w||(w=(H.config.isNode?new(require("canvas"))(1,1):a.select("body").append("canvas").attr("class","vega_hidden").attr("width",1).attr("height",1).style("display","none").node()).getContext("2d"))}function c(a,b,c){return null==b?c.set(0,0,0,0):(q(b,c),a.stroke&&0!==a.opacity&&a.strokeWidth>0&&c.expand(a.strokeWidth)),c}function d(a,b){var d=a.path?a.pathCache||(a.pathCache=p(a.path)):null;return c(a,d,b)}function e(a,b){var d=a.mark.items,a=d[0],e=a.pathCache||(a.pathCache=p(r(d)));return c(d[0],e,b)}function f(a,b){var d=a.mark.items,a=d[0],e=a.pathCache||(a.pathCache=p(s(d)));return c(d[0],e,b)}function g(a,b){var c=a.x||0,d=a.y||0,e=c+a.width||0,f=d+a.height||0;return b.set(c,d,e,f),a.stroke&&0!==a.opacity&&a.strokeWidth>0&&b.expand(a.strokeWidth),b}function h(a,b){var c=a.width||0,d=a.height||0,e=(a.x||0)-("center"===a.align?c/2:"right"===a.align?c:0),f=(a.y||0)-("middle"===a.baseline?d/2:"bottom"===a.baseline?d:0);return b.set(e,f,e+c,f+d)}function i(a,b){var c,d;return b.set(c=a.x||0,d=a.y||0,null!=a.x2?a.x2:c,null!=a.y2?a.y2:d),a.stroke&&0!==a.opacity&&a.strokeWidth>0&&b.expand(a.strokeWidth),b}function j(a,b){var c,d,e,f,g,h,i,j,k,l=a.x||0,m=a.y||0,n=a.innerRadius||0,o=a.outerRadius||0,p=(a.startAngle||0)-t,q=(a.endAngle||0)-t,r=1/0,s=-1/0,u=1/0,v=-1/0,w=[p,q],x=p-p%t;for(d=0;4>d&&q>x;++d,x+=t)w.push(x);for(d=0,e=w.length;e>d;++d)c=w[d],f=Math.cos(c),h=n*f,j=o*f,g=Math.sin(c),i=n*g,k=o*g,r=Math.min(r,h,j),s=Math.max(s,h,j),u=Math.min(u,i,k),v=Math.max(v,i,k);return b.set(l+r,m+u,l+s,m+v),a.stroke&&0!==a.opacity&&a.strokeWidth>0&&b.expand(a.strokeWidth),b}function k(a,b){var c,d,e,f,g=null!=a.size?a.size:100,h=a.x||0,i=a.y||0;switch(a.shape){case"cross":c=Math.sqrt(g/5)/2,d=3*c,b.set(h-d,i-c,h+d,i+c);break;case"diamond":f=Math.sqrt(g/(2*v)),e=f*v,b.set(h-e,i-f,h+e,i+f);break;case"square":d=Math.sqrt(g),c=d/2,b.set(h-c,i-c,h+c,i+c);break;case"triangle-down":e=Math.sqrt(g/u),f=e*u/2,b.set(h-e,i-f,h+e,i+f);break;case"triangle-up":e=Math.sqrt(g/u),f=e*u/2,b.set(h-e,i-f,h+e,i+f);break;default:c=Math.sqrt(g/Math.PI),b.set(h-c,i-c,h+c,i+c)}return a.stroke&&0!==a.opacity&&a.strokeWidth>0&&b.expand(a.strokeWidth),b}function l(a,c,d){var e,f,g=(a.x||0)+(a.dx||0),h=(a.y||0)+(a.dy||0),i=a.fontSize||H.config.render.fontSize,j=a.align,k=a.baseline,l=a.radius||0,m=b();return m.font=H.scene.fontString(a),m.textAlign=j||"left",m.textBaseline=k||"alphabetic",e=m.measureText(a.text||"").width,l&&(f=(a.theta||0)-Math.PI/2,g+=l*Math.cos(f),h+=l*Math.sin(f)),"center"===j?g-=e/2:"right"===j&&(g-=e),"top"===k?h+=i/5:"bottom"===k?h-=i:"middle"===k?h=h-i/2+i/10:h-=4*i/5,c.set(g,h,g+e,h+i),a.angle&&!d&&c.rotate(a.angle*Math.PI/180,a.x||0,a.y||0),c.expand(d?0:1)}function m(a,b,c){var d,e,f=a.axisItems||[],g=a.legendItems||[];for(d=0,e=f.length;e>d;++d)b.union(f[d].bounds);for(d=0,e=a.items.length;e>d;++d)b.union(a.items[d].bounds);if(c){for(d=0,e=g.length;e>d;++d)b.union(g[d].bounds);null!=a.width&&null!=a.height&&b.add(a.width,a.height),null!=a.x&&null!=a.y&&b.add(0,0)}return b.translate(a.x||0,a.y||0),b}function n(a,b,c){b=b||x[a.mark.marktype],a.bounds_prev||(a["bounds:prev"]=new H.Bounds);var d=a.bounds,e=a["bounds:prev"];return d&&e.clear().union(d),a.bounds=b(a,d?d.clear():new H.Bounds,c),d||e.clear().union(a.bounds),a.bounds}function o(a,b,c){b=b||a.bounds&&a.bounds.clear()||new H.Bounds;var d,e,f=a.marktype,g=x[f],h=a.items;if("area"===f||"line"===f)h.length&&(h[0].bounds=g(h[0],b));else for(d=0,e=h.length;e>d;++d)b.union(n(h[d],g,c));a.bounds=b}var p=H.canvas.path.parse,q=H.canvas.path.bounds,r=H.canvas.path.area,s=H.canvas.path.line,t=Math.PI/2,u=Math.sqrt(3),v=Math.tan(30*Math.PI/180),w=null,x={group:m,symbol:k,image:h,rect:g,rule:i,arc:j,text:l,path:d,area:e,line:f};return{mark:o,item:n,text:l,group:m}}(),H.scene.encode=function(){function a(a,d,e,f,g){return f&&g?b.call(this,a,d,e,f,g):c.call(this,a,a,d,e,f),a}function b(a,b,c,d,e){e=H.array(e);var f,g,h,i,j,k;for(f=0,g=e.length;g>f;++f)h=e[f],i=h.mark.group||null,j=h.mark.def.properties,k=j&&j[d],k&&(k.call(H,h,i,c),H.scene.bounds.item(h))}function c(a,b,c,d,h){f.call(this,a,b.items,c,d,h),b.marktype===g?e.call(this,b,c,a,d,h):H.scene.bounds.mark(b)}function d(a,b,c,d,g){e.call(this,b,c,a,d,g),f.call(this,a,b.items,c,d,g),H.scene.bounds.mark(b,null,!0)}function e(a,b,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s;for(h=0,i=a.items.length;i>h;++h)for(l=a.items[h],m=l.scales||(l.scales=b.scales?H.extend({},e.scales):e.scales),b.scales&&H.parse.scales(b.scales,m,this._data,l),b.axes&&(n=l.axes||(l.axes=[]),o=l.axisItems||(l.axisItems=[]),H.parse.axes(b.axes,n,l.scales),n.forEach(function(a,b){p=a.def(),o[b]=H.scene.build(p,this._data,o[b],null,1),o[b].group=l,c.call(this,l,l.axisItems[b],p,f)})),j=0,k=l.items.length;k>j;++j)c.call(this,l,l.items[j],b.marks[j],f,g);if(H.scene.bounds.mark(a,null,!b.legends),b.legends){for(h=0,i=a.items.length;i>h;++h)l=a.items[h],q=l.legends||(l.legends=[]),r=l.legendItems||(l.legendItems=[]),H.parse.legends(b.legends,q,l.scales),q.forEach(function(a,b){s=a.def(),r[b]=H.scene.build(s,this._data,r[b],null,1),r[b].group=l,d.call(this,l,l.legendItems[b],s,f)});H.scene.bounds.mark(a,null,!0)}}function f(a,b,c,d,e){var f,g,l,m,n=c.properties||k,o=n.enter,p=n.update,q=n.exit;if(e){if(m=n[e])for(f=0,g=b.length;g>f;++f)m.call(H,b[f],a,d)}else for(f=0;f<b.length;++f)l=b[f],l.status===h&&(o&&o.call(H,l,a),l.status=i),l.status!==j&&p&&p.call(H,l,a,d),l.status===j&&(q&&q.call(H,l,a,d),d&&!q?d.interpolate(l,k):d||b[f--].remove())}var g=H.scene.GROUP,h=H.scene.ENTER,i=H.scene.UPDATE,j=H.scene.EXIT,k={};return a}(),H.scene.Transition=function(){function b(b,c){this.duration=b||500,this.ease=c&&a.ease(c)||a.ease("cubic-in-out"),this.updates={next:null}}function c(a){for(var b,c,d,e,f,g,h=this.updates,i=h,j=i.next,k=this.duration,l=!0;null!=j;i=j,j=i.next)if(b=j.item,c=b.delay||0,d=(a-c)/k,0>d)l=!1;else{for(d>1&&(d=1),e=j.ease(d),f=0,g=j.length;g>f;++f)b[j[f].property]=j[f](e);b.touch(),H.scene.bounds.item(b),1===d?(j.remove&&b.remove(),i.next=j.next,j=i):l=!1}return this.callback(),l}var d=b.prototype,e={text:1,url:1};return d.interpolate=function(b,c){var d,f,g,h,i=null;for(d in c)f=b[d],g=c[d],f!==g&&(e[d]||void 0===f?b[d]=g:"number"!=typeof f||isFinite(f)?(h=a.interpolate(f,g),h.property=d,(i||(i=[])).push(h)):b[d]=g);return null===i&&b.status===H.scene.EXIT&&(i=[]),null!=i&&(i.item=b,i.ease=b.mark.ease||this.ease,i.next=this.updates.next,this.updates.next=i),this},d.start=function(b){for(var d=this,e=d.updates,f=e.next;null!=f;e=f,f=e.next)f.item.status===H.scene.EXIT&&(f.remove=!0);d.callback=b,a.timer(function(a){return c.call(d,a)})},b}(),H.scene.transition=function(a,b){return new H.scene.Transition(a,b)},H.scene.axis=function(){function b(){h=null}function c(a){var b,c,d;"ordinal"===a.type?(b={scale:a.scaleName,offset:.5+a.rangeBand()/2},c=b):(b={scale:a.scaleName,offset:.5},c={scale:a.scaleName+":prev",offset:.5}),d=q(a);var f=w(),h=w(),i=w(),j=x(),k=z(),o=y();f.properties.enter.stroke={value:H.config.axis.gridColor},s(e,f,c,b,1/0),s(e,h,c,b,l),s(e,i,c,b,m),r(e,j,c,b,l,p),u(e,k,d,n),t(e,o,d,g),H.extend(f.properties.update,F),H.extend(h.properties.update,I),H.extend(i.properties.update,J),H.extend(j.properties.update,G),H.extend(k.properties.update,L),H.extend(o.properties.update,K);var A=[f,h,i,j,k,o];return{type:"group",interactive:!1,properties:{enter:v,update:v},marks:A.map(H.parse.mark)}}var d,e=H.config.axis.orient,f=0,g=H.config.axis.titleOffset,h=null,i="front",j=!1,k=null,l=H.config.axis.tickSize,m=H.config.axis.tickSize,n=H.config.axis.tickSize,p=H.config.axis.padding,A=null,B=null,C=null,D=0,E=[H.config.axis.ticks],F={},G={},I={},J={},K={},L={},M={};return M.def=function(){var b=h?h:h=c(d);C=B?"time"===d.type?a.time.format(B):a.format(B):null;var g=null==A?d.ticks?d.ticks.apply(d,E):d.domain():A,l=o(d,g,D).map(H.data.ingest);g=g.map(H.data.ingest);var m=null==C?d.tickFormat?d.tickFormat.apply(d,E):String:C;g.forEach(function(a){a.label=m(a.data)});var n=k?[k].map(H.data.ingest):[];return b.marks[0].from=function(){return j?g:[]},b.marks[1].from=function(){return g},b.marks[2].from=function(){return l},b.marks[3].from=b.marks[1].from,b.marks[4].from=function(){return[1]},b.marks[5].from=function(){return n},b.offset=f,b.orient=e,b.layer=i,b},M.scale=function(a){return arguments.length?(d!==a&&(d=a,b()),M):d},M.orient=function(a){return arguments.length?(e!==a&&(e=a in O?a+"":H.config.axis.orient,b()),M):e},M.title=function(a){return arguments.length?(k!==a&&(k=a,b()),M):k},M.ticks=function(){return arguments.length?(E=arguments,M):E},M.tickValues=function(a){return arguments.length?(A=a,M):A},M.tickFormat=function(a){return arguments.length?(B!==a&&(B=a,b()),M):B},M.tickSize=function(a,c){if(!arguments.length)return l;var d=arguments.length-1,e=+a,f=d>1?+c:l,g=d>0?+arguments[d]:l;return(l!==e||m!==f||n!==g)&&b(),l=e,m=f,n=g,M},M.tickSubdivide=function(a){return arguments.length?(D=+a,M):D},M.offset=function(a){return arguments.length?(f=H.isObject(a)?a:+a,M):f},M.tickPadding=function(a){return arguments.length?(p!==+a&&(p=+a,b()),M):p},M.titleOffset=function(a){return arguments.length?(g!==+a&&(g=+a,b()),M):g},M.layer=function(a){return arguments.length?(i!==a&&(i=a,b()),M):i},M.grid=function(a){return arguments.length?(j!==a&&(j=a,b()),M):j},M.gridLineProperties=function(a){return arguments.length?(F!==a&&(F=a),M):F},M.majorTickProperties=function(a){return arguments.length?(I!==a&&(I=a),M):I},M.minorTickProperties=function(a){return arguments.length?(J!==a&&(J=a),M):J},M.tickLabelProperties=function(a){return arguments.length?(G!==a&&(G=a),M):G},M.titleProperties=function(a){return arguments.length?(K!==a&&(K=a),M):K},M.domainProperties=function(a){return arguments.length?(L!==a&&(L=a),M):L},M.reset=function(){b()},M};var O={top:1,right:1,bottom:1,left:1},P={bottom:"center",top:"center",left:"right",right:"left"},Q={bottom:"top",top:"bottom",left:"middle",right:"middle"};H.scene.legend=function(){function b(){h=null}function c(a){return"ordinal"===a||"quantize"===a||"quantile"===a||"threshold"===a}function d(b){var c,d,f,g=e(i,j,k,l),h=(null==n?b.ticks?b.ticks.apply(b,u):b.domain():n).map(H.data.ingest),p=null==o?b.tickFormat?b.tickFormat.apply(b,u):String:o,r=5,s=a.range(h.length);i?(d=h.map(function(a){return Math.sqrt(i(a.data))}),f=a.max(d),d=d.reduce(function(a,b,c,d){return c>0&&(a[c]=a[c-1]+d[c-1]/2+r),a[c]+=b/2,a},[0]).map(Math.round)):(f=Math.round(Math.sqrt(H.config.legend.symbolSize)),d=m||(c=z.fontSize)&&c.value+r||H.config.legend.labelFontSize+r,d=s.map(function(a,b){return Math.round(f/2+b*d)}));var v,w=t;q&&(v=y.fontSize,w+=5+(v&&v.value||H.config.legend.titleFontSize));for(var x=0,A=d.length;A>x;++x)d[x]+=w;var b={name:"legend",type:"ordinal",points:!0,domain:s,range:d},B=(q?[q]:[]).map(H.data.ingest);return h.forEach(function(a){a.label=p(a.data),a.offset=f}),g.scales=[b],g.marks[0].from=function(){return B},g.marks[1].from=function(){return h},g.marks[2].from=g.marks[1].from,g}function e(a,b,c,d){var e=C(),f=D(),g=E();return B(f,a,b,c,d),H.extend(e.properties.update,y),H.extend(f.properties.update,w),H.extend(g.properties.update,z),e.properties.enter.x.value+=t,e.properties.enter.y.value+=t,g.properties.enter.x.offset+=t+1,f.properties.enter.x.offset=t+1,g.properties.update.x.offset+=t+1,f.properties.update.x.offset=t+1,{type:"group",interactive:!1,properties:{enter:H.parse.properties("group",v),update:A},marks:[e,f,g].map(H.parse.mark)}}function f(a){var b=g(a),c=a.domain(),d=c.map(H.data.ingest),e=x.width&&x.width.value||H.config.legend.gradientWidth,f=null==o?a.tickFormat?a.tickFormat.apply(a,u):String:o,h={name:"legend",type:a.type,round:!0,zero:!1,domain:[c[0],c[c.length-1]],range:[t,e+t]};"pow"===a.type&&(h.exponent=a.exponent());var i=(q?[q]:[]).map(H.data.ingest);return d.forEach(function(a,b){a.label=f(a.data),a.align=b==d.length-1?"right":0==b?"left":"center"}),b.scales=[h],b.marks[0].from=function(){return i},b.marks[1].from=function(){return[1]},b.marks[2].from=function(){return d},b}function g(a){var b=C(),c=F(),d=G(),e=new H.Gradient,f=a.domain(),g=f[0],h=f[f.length-1],i=a.copy().domain([g,h]).range([0,1]),j="linear"!==a.type&&a.ticks?a.ticks.call(a,15):f;g!==j[0]&&j.unshift(g),h!==j[j.length-1]&&j.push(h);for(var k=0,l=j.length;l>k;++k)e.stop(i(j[k]),a(j[k]));c.properties.enter.fill={value:e},H.extend(b.properties.update,y),H.extend(c.properties.update,x),H.extend(d.properties.update,z);var m=c.properties,n=x.height,o=n&&n.value||m.enter.height.value;if(d.properties.enter.y.value=o,d.properties.update.y.value=o,q){var p=b.properties,r=y.fontSize,s=4+(r&&r.value||p.enter.fontSize.value);c.properties.enter.y.value+=s,d.properties.enter.y.value+=s,c.properties.update.y.value+=s,d.properties.update.y.value+=s}return b.properties.enter.x.value+=t,b.properties.enter.y.value+=t,c.properties.enter.x.value+=t,c.properties.enter.y.value+=t,d.properties.enter.y.value+=t,c.properties.update.x.value+=t,c.properties.update.y.value+=t,d.properties.update.y.value+=t,{type:"group",interactive:!1,properties:{enter:H.parse.properties("group",v),update:A},marks:[b,c,d].map(H.parse.mark)}}var h,i=null,j=null,k=null,l=null,m=null,n=null,o=null,p=null,q=void 0,r="right",s=H.config.legend.offset,t=H.config.legend.padding,u=[5],v={},w={},x={},y={},z={},I={},h=null;return I.def=function(){var b=i||j||k||l;return o=p?"time"===b.type?a.time.format(p):a.format(p):null,h||(h=b!==k&&b!==l||c(b.type)?d(b):f(b)),h.orient=r,h.offset=s,h.padding=t,h},I.size=function(a){return arguments.length?(i!==a&&(i=a,b()),I):i},I.shape=function(a){return arguments.length?(j!==a&&(j=a,b()),I):j},I.fill=function(a){return arguments.length?(k!==a&&(k=a,b()),I):k},I.stroke=function(a){return arguments.length?(l!==a&&(l=a,b()),I):l},I.title=function(a){return arguments.length?(q!==a&&(q=a,b()),I):q},I.format=function(a){return arguments.length?(p!==a&&(p=a,b()),I):p},I.spacing=function(a){return arguments.length?(m!==+a&&(m=+a,b()),I):m},I.orient=function(a){return arguments.length?(r=a in R?a+"":H.config.legend.orient,I):r},I.offset=function(a){return arguments.length?(s=+a,I):s},I.values=function(a){return arguments.length?(n=a,I):n},I.legendProperties=function(a){return arguments.length?(v=a,I):v},I.symbolProperties=function(a){return arguments.length?(w=a,I):w},I.gradientProperties=function(a){return arguments.length?(x=a,I):x},I.labelProperties=function(a){return arguments.length?(z=a,I):z},I.titleProperties=function(a){return arguments.length?(y=a,I):y},I.reset=function(){b()},I};var R={right:1,left:1};return H.Model=function(){function a(){this._defs=null,this._data={},this._scene=null,this._reset={axes:!1,legends:!1}}var b=a.prototype;return b.defs=function(a){return arguments.length?(this._defs=a,this):this._defs},b.data=function(a){function b(a){(j[a]||[]).forEach(function(c){g[c]=a,b(c)})}if(!arguments.length)return this._data;var c,d,e,g={},i=this._defs,j=i.data.source,k=i.data.flow||{},l=i.data.sorted,m=l.length;for(H.keys(a).forEach(b),c=0;m>c;++c){if(a[d=l[c]])e=a[d];else{if(!g[d])continue;e=h(a[g[d]]),H.isTree(a)&&f(e)}this._data[d]=k[d]?k[d](e,this._data,i.marks):e}return this._reset.legends=!0,this},b.width=function(a){return this._defs&&(this._defs.width=a),this._defs&&this._defs.marks&&(this._defs.marks.width=a),this._scene&&(this._scene.items[0].width=a),this._reset.axes=!0,this},b.height=function(a){return this._defs&&(this._defs.height=a),this._defs&&this._defs.marks&&(this._defs.marks.height=a),this._scene&&(this._scene.items[0].height=a),this._reset.axes=!0,this},b.scene=function(a){return arguments.length?(this._scene=a,this):this._scene},b.build=function(){var a=this,b=a._data,c=a._defs.marks;return a._scene=H.scene.build.call(a,c,b,a._scene),a._scene.items[0].width=c.width,a._scene.items[0].height=c.height,a._scene.interactive=!1,this},b.encode=function(a,b,c){this.reset();var d=this,e=d._scene,f=d._defs;return H.scene.encode.call(d,e,f.marks,a,b,c),this},b.reset=function(){return this._scene&&this._reset.axes&&(H.scene.visit(this._scene,function(a){a.axes&&a.axes.forEach(function(a){a.reset()})}),this._reset.axes=!1),this._scene&&this._reset.legends&&(H.scene.visit(this._scene,function(a){a.legends&&a.legends.forEach(function(a){a.reset()})}),this._reset.legends=!1),this},a}(),H.View=function(){var b=function(a,b,c){this._el=null,this._build=!1,this._model=new H.Model,this._width=this.__width=b||500,this._height=this.__height=c||500,this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._viewport=null,this._renderer=null,this._handler=null,this._io=H.canvas,a&&this.initialize(a)},c=b.prototype;return c.width=function(a){return arguments.length?(this.__width!==a&&(this._width=this.__width=a,this._el&&this.initialize(this._el.parentNode),this._model.width(a),this._strict&&(this._autopad=1)),this):this.__width},c.height=function(a){return arguments.length?(this.__height!==a&&(this._height=this.__height=a,this._el&&this.initialize(this._el.parentNode),this._model.height(this._height),this._strict&&(this._autopad=1)),this):this.__height},c.padding=function(a){return arguments.length?(this._padding!==a&&(H.isString(a)?(this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._strict="strict"===a):(this._autopad=0,this._padding=a,this._strict=!1),this._el&&(this._renderer.resize(this._width,this._height,a),this._handler.padding(a))),this):this._padding},c.autopad=function(a){if(this._autopad<1)return this;this._autopad=0;var b=this._padding,c=this.model().scene().bounds,d=H.config.autopadInset,e=c.x1<0?Math.ceil(-c.x1)+d:0,f=c.y1<0?Math.ceil(-c.y1)+d:0,g=c.x2>this._width?Math.ceil(+c.x2-this._width)+d:0,c=c.y2>this._height?Math.ceil(+c.y2-this._height)+d:0;return b={left:e,top:f,right:g,bottom:c},this._strict?(this._autopad=0,this._padding=b,this._width=Math.max(0,this.__width-(e+g)),this._height=Math.max(0,this.__height-(f+c)),this._model.width(this._width),this._model.height(this._height),this._el&&this.initialize(this._el.parentNode),this.update({props:"enter"}).update({props:"update"})):this.padding(b).update(a),this},c.viewport=function(a){return arguments.length?(this._viewport!==a&&(this._viewport=a,this._el&&this.initialize(this._el.parentNode)),this):this._viewport},c.renderer=function(a){return arguments.length?("canvas"===a&&(a=H.canvas),"svg"===a&&(a=H.svg),this._io!==a&&(this._io=a,this._renderer=null,this._el&&this.initialize(this._el.parentNode),this._build&&this.render()),this):this._io},c.defs=function(a){return arguments.length?(this._model.defs(a),this):this._model.defs()},c.data=function(a){if(!arguments.length)return this._model.data();var b=H.keys(a).reduce(function(b,c){return b[c]=H.data.ingestAll(a[c]),b},{});return this._model.data(b),this._build=!1,this},c.model=function(a){return arguments.length?(this._model!==a&&(this._model=a,this._handler&&this._handler.model(a)),this):this._model},c.initialize=function(b){var c,d=this,e=d._width,f=d._height,g=d._padding;return a.select(b).select("div.vega").remove(),this._el=b=a.select(b).append("div").attr("class","vega").style("position","relative").node(),d._viewport&&a.select(b).style("width",(d._viewport[0]||e)+"px").style("height",(d._viewport[1]||f)+"px").style("overflow","auto"),d._renderer=(d._renderer||new this._io.Renderer).initialize(b,e,f,g),c=d._handler,d._handler=(new this._io.Handler).initialize(b,g,d).model(d._model),c&&c.handlers().forEach(function(a){d._handler.on(a.type,a.handler)}),this},c.render=function(a){return this._renderer.render(this._model.scene(),a),this},c.on=function(){return this._handler.on.apply(this._handler,arguments),this},c.off=function(){return this._handler.off.apply(this._handler,arguments),this},c.update=function(a){a=a||{};var b=this,c=a.duration?H.scene.transition(a.duration,a.ease):null;return b._build=b._build||(b._model.build(),!0),b._model.encode(c,a.props,a.items),c?c.start(function(a){b._renderer.render(b._model.scene(),a)}):b.render(a.items),b.autopad(a)},b}(),H.ViewFactory=function(a){return function(b){b=b||{};var c=(new H.View).width(a.width).height(a.height).padding(a.padding).viewport(a.viewport).renderer(b.renderer||"canvas").defs(a);return a.data.load&&c.data(a.data.load),b.data&&c.data(b.data),b.el&&c.initialize(b.el),b.hover!==!1&&c.on("mouseover",function(a,b){b.hasPropertySet("hover")&&this.update({props:"hover",items:b})}).on("mouseout",function(a,b){b.hasPropertySet("hover")&&this.update({props:"update",items:b})}),c}},H.Spec=function(){var a=function(a){this.spec={width:500,height:500,padding:0,data:[],scales:[],axes:[],marks:[]},a&&H.extend(this.spec,a)},b=a.prototype;return b.width=function(a){return this.spec.width=a,this},b.height=function(a){return this.spec.height=a,this},b.padding=function(a){return this.spec.padding=a,this},b.viewport=function(a){return this.spec.viewport=a,this},b.data=function(a,b){return b?b.name=a:b=H.isString(a)?{name:a}:a,this.spec.data.push(b),this},b.scale=function(a,b){return b?b.name=a:b=H.isString(a)?{name:a}:a,this.spec.scales.push(b),this},b.axis=function(a){return this.spec.axes.push(a),this},b.mark=function(a,b){b?b.type=a:b={type:a},b.properties={},this.spec.marks.push(b);var c=this;return{from:function(a,c){return b.from=c?(c.data=a,c):H.isString(a)?{data:a}:a,this},prop:function(a,c){return b.properties[a]=H.keys(c).reduce(function(a,b){var d=c[b];return a[b]=H.isObject(d)?d:{value:d},a},{}),this},done:function(){return c}}},b.parse=function(a){H.parse.spec(this.spec,a)},b.json=function(){return this.spec},a}(),H.spec=function(a){return new H.Spec(a)},H.headless={},H.headless.View=function(){var b=function(a,b,c,d,e){this._canvas=null,this._type=d,this._el="body",this._build=!1,this._model=new H.Model,this._width=this.__width=a||500,this._height=this.__height=b||500,this._padding=c||{top:0,left:0,bottom:0,right:0},this._autopad=H.isString(this._padding)?1:0,this._renderer=new H[d].Renderer,this._viewport=e||null,this.initialize()},c=b.prototype;return c.el=function(a){return arguments.length?(this._el!==a&&(this._el=a,this.initialize()),this):this._el},c.width=function(a){return arguments.length?(this._width!==a&&(this._width=a,this.initialize(),this._model.width(a)),this):this._width},c.height=function(a){return arguments.length?(this._height!==a&&(this._height=a,this.initialize(),this._model.height(this._height)),this):this._height},c.padding=function(a){return arguments.length?(this._padding!==a&&(H.isString(a)?(this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._strict="strict"===a):(this._autopad=0,this._padding=a,this._strict=!1),this.initialize()),this):this._padding},c.autopad=function(a){if(this._autopad<1)return this;this._autopad=0;var b=this._padding,c=this._model.scene().bounds,d=H.config.autopadInset,e=c.x1<0?Math.ceil(-c.x1)+d:0,f=c.y1<0?Math.ceil(-c.y1)+d:0,g=c.x2>this._width?Math.ceil(+c.x2-this._width)+d:0,c=c.y2>this._height?Math.ceil(+c.y2-this._height)+d:0;return b={left:e,top:f,right:g,bottom:c},this._strict?(this._autopad=0,this._padding=b,this._width=Math.max(0,this.__width-(e+g)),this._height=Math.max(0,this.__height-(f+c)),this._model.width(this._width),this._model.height(this._height),this._el&&this.initialize(),this.update({props:"enter"}).update({props:"update"})):this.padding(b).update(a),this},c.viewport=function(a){return arguments.length?(this._viewport=a,this.initialize(),this):_viewport},c.defs=function(a){return arguments.length?(this._model.defs(a),this):this._model.defs()},c.data=function(a){if(!arguments.length)return this._model.data();var b=H.keys(a).reduce(function(b,c){return b[c]=H.data.ingestAll(a[c]),b},{});return this._model.data(b),this._build=!1,this},c.renderer=function(){return this._renderer},c.canvas=function(){return this._canvas},c.canvasAsync=function(a){function b(){0===c.pendingImages()?(d.render(),a(d._canvas)):setTimeout(b,10)}var c=this._renderer,d=this;c.pendingImages()>0?b():a(this._canvas)},c.svg=function(){if("svg"!==this._type)return null;var b=this._padding,c=this._width+(b?b.left+b.right:0),d=this._height+(b?b.top+b.bottom:0);this._viewport&&(c=this._viewport[0]-(b?b.left+b.right:0),d=this._viewport[1]-(b?b.top+b.bottom:0));var e=a.select(this._el).select("svg").node().innerHTML.replace(/ href=/g," xlink:href=");return'<svg width="'+c+'" height="'+d+'" '+H.config.svgNamespace+">"+e+"</svg>"},c.initialize=function(){var a=this._width,b=this._height,c=this._padding;return this._viewport&&(a=this._viewport[0]-(c?c.left+c.right:0),b=this._viewport[1]-(c?c.top+c.bottom:0)),"svg"===this._type?this.initSVG(a,b,c):this.initCanvas(a,b,c),this},c.initCanvas=function(a,b,c){var d=require("canvas"),e=a+c.left+c.right,f=b+c.top+c.bottom,g=this._canvas=new d(e,f),h=g.getContext("2d");h.setTransform(1,0,0,1,c.left,c.top),this._renderer.context(h),this._renderer.resize(a,b,c)},c.initSVG=function(a,b,c){a+c.left+c.right,b+c.top+c.bottom;this._renderer.initialize(this._el,a,b,c)},c.render=function(a){return this._renderer.render(this._model.scene(),a),this},c.update=function(a){a=a||{};var b=this;return b._build=b._build||(b._model.build(),!0),b._model.encode(null,a.props,a.items),b.render(a.items),b.autopad(a)},b}(),H.headless.View.Factory=function(a){return function(b){b=b||{};var c=a.width,d=a.height,e=a.padding,f=a.viewport,g=b.renderer||"canvas",h=new H.headless.View(c,d,e,g,f).defs(a);return a.data.load&&h.data(a.data.load),b.data&&h.data(b.data),h}},H.headless.render=function(a,b){function c(c){try{var d=c({data:a.data,renderer:a.renderer}).update();"svg"===a.renderer?b(null,{svg:d.svg()}):d.canvasAsync(function(a){b(null,{canvas:a})})}catch(e){b(e,null)}}H.parse.spec(a.spec,c,H.headless.View.Factory)},H}),function(){var a=this,b=a._,c=Array.prototype,d=Object.prototype,e=Function.prototype,f=c.push,g=c.slice,h=c.concat,i=d.toString,j=d.hasOwnProperty,k=Array.isArray,l=Object.keys,m=e.bind,n=function(a){return a instanceof n?a:this instanceof n?void(this._wrapped=a):new n(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=n),exports._=n):a._=n,n.VERSION="1.7.0";var o=function(a,b,c){if(void 0===b)return a;switch(null==c?3:c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return function(){return a.apply(b,arguments)}};n.iteratee=function(a,b,c){return null==a?n.identity:n.isFunction(a)?o(a,b,c):n.isObject(a)?n.matches(a):n.property(a)},n.each=n.forEach=function(a,b,c){if(null==a)return a;b=o(b,c);var d,e=a.length;if(e===+e)for(d=0;e>d;d++)b(a[d],d,a);else{var f=n.keys(a);for(d=0,e=f.length;e>d;d++)b(a[f[d]],f[d],a)}return a},n.map=n.collect=function(a,b,c){if(null==a)return[];b=n.iteratee(b,c);for(var d,e=a.length!==+a.length&&n.keys(a),f=(e||a).length,g=Array(f),h=0;f>h;h++)d=e?e[h]:h,g[h]=b(a[d],d,a);return g};var p="Reduce of empty array with no initial value";n.reduce=n.foldl=n.inject=function(a,b,c,d){null==a&&(a=[]),b=o(b,d,4);var e,f=a.length!==+a.length&&n.keys(a),g=(f||a).length,h=0;if(arguments.length<3){if(!g)throw new TypeError(p);c=a[f?f[h++]:h++]}for(;g>h;h++)e=f?f[h]:h,c=b(c,a[e],e,a);return c},n.reduceRight=n.foldr=function(a,b,c,d){null==a&&(a=[]),b=o(b,d,4);var e,f=a.length!==+a.length&&n.keys(a),g=(f||a).length;if(arguments.length<3){if(!g)throw new TypeError(p);c=a[f?f[--g]:--g]}for(;g--;)e=f?f[g]:g,c=b(c,a[e],e,a);return c},n.find=n.detect=function(a,b,c){var d;return b=n.iteratee(b,c),n.some(a,function(a,c,e){return b(a,c,e)?(d=a,!0):void 0}),d},n.filter=n.select=function(a,b,c){var d=[];return null==a?d:(b=n.iteratee(b,c),n.each(a,function(a,c,e){b(a,c,e)&&d.push(a)}),d)},n.reject=function(a,b,c){return n.filter(a,n.negate(n.iteratee(b)),c)},n.every=n.all=function(a,b,c){if(null==a)return!0;b=n.iteratee(b,c);var d,e,f=a.length!==+a.length&&n.keys(a),g=(f||a).length;for(d=0;g>d;d++)if(e=f?f[d]:d,!b(a[e],e,a))return!1;return!0},n.some=n.any=function(a,b,c){if(null==a)return!1;b=n.iteratee(b,c);var d,e,f=a.length!==+a.length&&n.keys(a),g=(f||a).length;for(d=0;g>d;d++)if(e=f?f[d]:d,b(a[e],e,a))return!0;return!1},n.contains=n.include=function(a,b){return null==a?!1:(a.length!==+a.length&&(a=n.values(a)),n.indexOf(a,b)>=0)},n.invoke=function(a,b){var c=g.call(arguments,2),d=n.isFunction(b);return n.map(a,function(a){return(d?b:a[b]).apply(a,c)})},n.pluck=function(a,b){return n.map(a,n.property(b))
},n.where=function(a,b){return n.filter(a,n.matches(b))},n.findWhere=function(a,b){return n.find(a,n.matches(b))},n.max=function(a,b,c){var d,e,f=-1/0,g=-1/0;if(null==b&&null!=a){a=a.length===+a.length?a:n.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],d>f&&(f=d)}else b=n.iteratee(b,c),n.each(a,function(a,c,d){e=b(a,c,d),(e>g||e===-1/0&&f===-1/0)&&(f=a,g=e)});return f},n.min=function(a,b,c){var d,e,f=1/0,g=1/0;if(null==b&&null!=a){a=a.length===+a.length?a:n.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],f>d&&(f=d)}else b=n.iteratee(b,c),n.each(a,function(a,c,d){e=b(a,c,d),(g>e||1/0===e&&1/0===f)&&(f=a,g=e)});return f},n.shuffle=function(a){for(var b,c=a&&a.length===+a.length?a:n.values(a),d=c.length,e=Array(d),f=0;d>f;f++)b=n.random(0,f),b!==f&&(e[f]=e[b]),e[b]=c[f];return e},n.sample=function(a,b,c){return null==b||c?(a.length!==+a.length&&(a=n.values(a)),a[n.random(a.length-1)]):n.shuffle(a).slice(0,Math.max(0,b))},n.sortBy=function(a,b,c){return b=n.iteratee(b,c),n.pluck(n.map(a,function(a,c,d){return{value:a,index:c,criteria:b(a,c,d)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var q=function(a){return function(b,c,d){var e={};return c=n.iteratee(c,d),n.each(b,function(d,f){var g=c(d,f,b);a(e,d,g)}),e}};n.groupBy=q(function(a,b,c){n.has(a,c)?a[c].push(b):a[c]=[b]}),n.indexBy=q(function(a,b,c){a[c]=b}),n.countBy=q(function(a,b,c){n.has(a,c)?a[c]++:a[c]=1}),n.sortedIndex=function(a,b,c,d){c=n.iteratee(c,d,1);for(var e=c(b),f=0,g=a.length;g>f;){var h=f+g>>>1;c(a[h])<e?f=h+1:g=h}return f},n.toArray=function(a){return a?n.isArray(a)?g.call(a):a.length===+a.length?n.map(a,n.identity):n.values(a):[]},n.size=function(a){return null==a?0:a.length===+a.length?a.length:n.keys(a).length},n.partition=function(a,b,c){b=n.iteratee(b,c);var d=[],e=[];return n.each(a,function(a,c,f){(b(a,c,f)?d:e).push(a)}),[d,e]},n.first=n.head=n.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:0>b?[]:g.call(a,0,b)},n.initial=function(a,b,c){return g.call(a,0,Math.max(0,a.length-(null==b||c?1:b)))},n.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:g.call(a,Math.max(a.length-b,0))},n.rest=n.tail=n.drop=function(a,b,c){return g.call(a,null==b||c?1:b)},n.compact=function(a){return n.filter(a,n.identity)};var r=function(a,b,c,d){if(b&&n.every(a,n.isArray))return h.apply(d,a);for(var e=0,g=a.length;g>e;e++){var i=a[e];n.isArray(i)||n.isArguments(i)?b?f.apply(d,i):r(i,b,c,d):c||d.push(i)}return d};n.flatten=function(a,b){return r(a,b,!1,[])},n.without=function(a){return n.difference(a,g.call(arguments,1))},n.uniq=n.unique=function(a,b,c,d){if(null==a)return[];n.isBoolean(b)||(d=c,c=b,b=!1),null!=c&&(c=n.iteratee(c,d));for(var e=[],f=[],g=0,h=a.length;h>g;g++){var i=a[g];if(b)g&&f===i||e.push(i),f=i;else if(c){var j=c(i,g,a);n.indexOf(f,j)<0&&(f.push(j),e.push(i))}else n.indexOf(e,i)<0&&e.push(i)}return e},n.union=function(){return n.uniq(r(arguments,!0,!0,[]))},n.intersection=function(a){if(null==a)return[];for(var b=[],c=arguments.length,d=0,e=a.length;e>d;d++){var f=a[d];if(!n.contains(b,f)){for(var g=1;c>g&&n.contains(arguments[g],f);g++);g===c&&b.push(f)}}return b},n.difference=function(a){var b=r(g.call(arguments,1),!0,!0,[]);return n.filter(a,function(a){return!n.contains(b,a)})},n.zip=function(a){if(null==a)return[];for(var b=n.max(arguments,"length").length,c=Array(b),d=0;b>d;d++)c[d]=n.pluck(arguments,d);return c},n.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},n.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=n.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}for(;e>d;d++)if(a[d]===b)return d;return-1},n.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=a.length;for("number"==typeof c&&(d=0>c?d+c+1:Math.min(d,c+1));--d>=0;)if(a[d]===b)return d;return-1},n.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=c||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=Array(d),f=0;d>f;f++,a+=c)e[f]=a;return e};var s=function(){};n.bind=function(a,b){var c,d;if(m&&a.bind===m)return m.apply(a,g.call(arguments,1));if(!n.isFunction(a))throw new TypeError("Bind must be called on a function");return c=g.call(arguments,2),d=function(){if(!(this instanceof d))return a.apply(b,c.concat(g.call(arguments)));s.prototype=a.prototype;var e=new s;s.prototype=null;var f=a.apply(e,c.concat(g.call(arguments)));return n.isObject(f)?f:e}},n.partial=function(a){var b=g.call(arguments,1);return function(){for(var c=0,d=b.slice(),e=0,f=d.length;f>e;e++)d[e]===n&&(d[e]=arguments[c++]);for(;c<arguments.length;)d.push(arguments[c++]);return a.apply(this,d)}},n.bindAll=function(a){var b,c,d=arguments.length;if(1>=d)throw new Error("bindAll must be passed function names");for(b=1;d>b;b++)c=arguments[b],a[c]=n.bind(a[c],a);return a},n.memoize=function(a,b){var c=function(d){var e=c.cache,f=b?b.apply(this,arguments):d;return n.has(e,f)||(e[f]=a.apply(this,arguments)),e[f]};return c.cache={},c},n.delay=function(a,b){var c=g.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},n.defer=function(a){return n.delay.apply(n,[a,1].concat(g.call(arguments,1)))},n.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:n.now(),g=null,f=a.apply(d,e),g||(d=e=null)};return function(){var j=n.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k||k>b?(clearTimeout(g),g=null,h=j,f=a.apply(d,e),g||(d=e=null)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},n.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=n.now()-g;b>j&&j>0?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),d||(f=e=null)))};return function(){f=this,e=arguments,g=n.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},n.wrap=function(a,b){return n.partial(b,a)},n.negate=function(a){return function(){return!a.apply(this,arguments)}},n.compose=function(){var a=arguments,b=a.length-1;return function(){for(var c=b,d=a[b].apply(this,arguments);c--;)d=a[c].call(this,d);return d}},n.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},n.before=function(a,b){var c;return function(){return--a>0?c=b.apply(this,arguments):b=null,c}},n.once=n.partial(n.before,2),n.keys=function(a){if(!n.isObject(a))return[];if(l)return l(a);var b=[];for(var c in a)n.has(a,c)&&b.push(c);return b},n.values=function(a){for(var b=n.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},n.pairs=function(a){for(var b=n.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},n.invert=function(a){for(var b={},c=n.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},n.functions=n.methods=function(a){var b=[];for(var c in a)n.isFunction(a[c])&&b.push(c);return b.sort()},n.extend=function(a){if(!n.isObject(a))return a;for(var b,c,d=1,e=arguments.length;e>d;d++){b=arguments[d];for(c in b)j.call(b,c)&&(a[c]=b[c])}return a},n.pick=function(a,b,c){var d,e={};if(null==a)return e;if(n.isFunction(b)){b=o(b,c);for(d in a){var f=a[d];b(f,d,a)&&(e[d]=f)}}else{var i=h.apply([],g.call(arguments,1));a=new Object(a);for(var j=0,k=i.length;k>j;j++)d=i[j],d in a&&(e[d]=a[d])}return e},n.omit=function(a,b,c){if(n.isFunction(b))b=n.negate(b);else{var d=n.map(h.apply([],g.call(arguments,1)),String);b=function(a,b){return!n.contains(d,b)}}return n.pick(a,b,c)},n.defaults=function(a){if(!n.isObject(a))return a;for(var b=1,c=arguments.length;c>b;b++){var d=arguments[b];for(var e in d)void 0===a[e]&&(a[e]=d[e])}return a},n.clone=function(a){return n.isObject(a)?n.isArray(a)?a.slice():n.extend({},a):a},n.tap=function(a,b){return b(a),a};var t=function(a,b,c,d){if(a===b)return 0!==a||1/a===1/b;if(null==a||null==b)return a===b;a instanceof n&&(a=a._wrapped),b instanceof n&&(b=b._wrapped);var e=i.call(a);if(e!==i.call(b))return!1;switch(e){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!==+a?+b!==+b:0===+a?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]===a)return d[f]===b;var g=a.constructor,h=b.constructor;if(g!==h&&"constructor"in a&&"constructor"in b&&!(n.isFunction(g)&&g instanceof g&&n.isFunction(h)&&h instanceof h))return!1;c.push(a),d.push(b);var j,k;if("[object Array]"===e){if(j=a.length,k=j===b.length)for(;j--&&(k=t(a[j],b[j],c,d)););}else{var l,m=n.keys(a);if(j=m.length,k=n.keys(b).length===j)for(;j--&&(l=m[j],k=n.has(b,l)&&t(a[l],b[l],c,d)););}return c.pop(),d.pop(),k};n.isEqual=function(a,b){return t(a,b,[],[])},n.isEmpty=function(a){if(null==a)return!0;if(n.isArray(a)||n.isString(a)||n.isArguments(a))return 0===a.length;for(var b in a)if(n.has(a,b))return!1;return!0},n.isElement=function(a){return!(!a||1!==a.nodeType)},n.isArray=k||function(a){return"[object Array]"===i.call(a)},n.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},n.each(["Arguments","Function","String","Number","Date","RegExp"],function(a){n["is"+a]=function(b){return i.call(b)==="[object "+a+"]"}}),n.isArguments(arguments)||(n.isArguments=function(a){return n.has(a,"callee")}),"function"!=typeof/./&&(n.isFunction=function(a){return"function"==typeof a||!1}),n.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},n.isNaN=function(a){return n.isNumber(a)&&a!==+a},n.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"===i.call(a)},n.isNull=function(a){return null===a},n.isUndefined=function(a){return void 0===a},n.has=function(a,b){return null!=a&&j.call(a,b)},n.noConflict=function(){return a._=b,this},n.identity=function(a){return a},n.constant=function(a){return function(){return a}},n.noop=function(){},n.property=function(a){return function(b){return b[a]}},n.matches=function(a){var b=n.pairs(a),c=b.length;return function(a){if(null==a)return!c;a=new Object(a);for(var d=0;c>d;d++){var e=b[d],f=e[0];if(e[1]!==a[f]||!(f in a))return!1}return!0}},n.times=function(a,b,c){var d=Array(Math.max(0,a));b=o(b,c,1);for(var e=0;a>e;e++)d[e]=b(e);return d},n.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},n.now=Date.now||function(){return(new Date).getTime()};var u={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},v=n.invert(u),w=function(a){var b=function(b){return a[b]},c="(?:"+n.keys(a).join("|")+")",d=RegExp(c),e=RegExp(c,"g");return function(a){return a=null==a?"":""+a,d.test(a)?a.replace(e,b):a}};n.escape=w(u),n.unescape=w(v),n.result=function(a,b){if(null==a)return void 0;var c=a[b];return n.isFunction(c)?a[b]():c};var x=0;n.uniqueId=function(a){var b=++x+"";return a?a+b:b},n.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var y=/(.)^/,z={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},A=/\\|'|\r|\n|\u2028|\u2029/g,B=function(a){return"\\"+z[a]};n.template=function(a,b,c){!b&&c&&(b=c),b=n.defaults({},b,n.templateSettings);var d=RegExp([(b.escape||y).source,(b.interpolate||y).source,(b.evaluate||y).source].join("|")+"|$","g"),e=0,f="__p+='";a.replace(d,function(b,c,d,g,h){return f+=a.slice(e,h).replace(A,B),e=h+b.length,c?f+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'":d?f+="'+\n((__t=("+d+"))==null?'':__t)+\n'":g&&(f+="';\n"+g+"\n__p+='"),b}),f+="';\n",b.variable||(f="with(obj||{}){\n"+f+"}\n"),f="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+f+"return __p;\n";try{var g=new Function(b.variable||"obj","_",f)}catch(h){throw h.source=f,h}var i=function(a){return g.call(this,a,n)},j=b.variable||"obj";return i.source="function("+j+"){\n"+f+"}",i},n.chain=function(a){var b=n(a);return b._chain=!0,b};var C=function(a){return this._chain?n(a).chain():a};n.mixin=function(a){n.each(n.functions(a),function(b){var c=n[b]=a[b];n.prototype[b]=function(){var a=[this._wrapped];return f.apply(a,arguments),C.call(this,c.apply(n,a))}})},n.mixin(n),n.each(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=c[a];n.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!==a&&"splice"!==a||0!==c.length||delete c[0],C.call(this,c)}}),n.each(["concat","join","slice"],function(a){var b=c[a];n.prototype[a]=function(){return C.call(this,b.apply(this._wrapped,arguments))}}),n.prototype.value=function(){return this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return n})}.call(this),function(a){"use strict";var b=function c(a){var b=this,d=a||{};if(this._events=[],this._definition=c._defaultDefinition(),this._view=void 0,this._methodQueue=[],this._pendingXhr=!1,d.definition)if("object"==typeof d.definition)this._definition=d.definition;else{if("string"!=typeof d.definition)throw new Error("parameter definition must be an object or string (url)");this._pendingXhr=!0,c.getJson(d.definition,function(a,c){b._pendingXhr=!1,b._definition=c,b._purgeMethodQueue()})}if(d.override&&(this._definition.override=d.override),d.specification)if("object"==typeof d.specification)this._definition.specification=d.specification;else{if("string"!=typeof d.specification)throw new Error("parameter template must be an object or string (url)");this._pendingXhr=!0,c.getJson(d.specification,function(a,c){b._pendingXhr=!1,b._definition.specification=c,b._purgeMethodQueue()})}d.dataset&&"object"==typeof d.dataset&&(d.dataset.query=c._mixin({},c._defaultQuery(),d.dataset.query),this._definition.dataset=d.dataset),Object.defineProperty(this,"dataset",{get:function(){return this._definition.dataset},set:function(a){this._definition.dataset=a}}),Object.defineProperty(this,"specification",{get:function(){return this._definition.specification},set:function(a){this._definition.specification=a}}),Object.defineProperty(this,"override",{get:function(){return this._definition.override},set:function(a){this._definition.override=a}})};b.prototype.canDraw=function(){return{drawable:!0,errs:[]}},b.prototype.show=function(a){if(this._pendingXhr)this._addToMethodQueue("show",[a]);else{var b;if(a.elementId||(b="Cedar.show requires options.elementId"),null===d3.select(a.elementId)[0][0]&&(b="Element "+a.elementId+" is not present in the DOM"),this._elementId=a.elementId,this._renderer=a.renderer||"canvas",a.token&&(this._token=a.token),b)throw new Error(b);var c=this.canDraw();if(!c.drawable){var d=c.issues.join(",");throw new Error("Chart can not be drawn because: "+d)}this.update()}},b.prototype.update=function(){var a=this;if(this._view&&this.emit("update-start"),this._pendingXhr)this._addToMethodQueue("update");else{this._view&&this._remove(this._view);try{var c=b._applyDefaultsToMappings(this._definition.dataset.mappings,this._definition.specification.inputs),d=b._mixin({},this._definition.specification.query,this._definition.dataset.query);d=JSON.parse(b._supplant(JSON.stringify(d),c)),c.query=d;var e=JSON.parse(b._supplant(JSON.stringify(this._definition.specification.template),c));if(e=b._mergeRecursive(e,this._definition.override),e.data[0].url&&delete e.data[0].url,this._definition.dataset.data)e.data[0].values=this._definition.dataset.data,this._renderSpec(e);else{var f=b._createFeatureServiceRequest(this._definition.dataset,d),g=function(b,c){e.data[0].values=c,console.dir(e),a._renderSpec(e)};b.getJson(f,g)}}catch(h){throw h}}},b.prototype._renderSpec=function(a){var b=this;try{vg.parse.spec(a,function(a){b._view=a({el:b._elementId,renderer:b._renderer}),b._view.update(),b._attach(b._view),b._view&&b.emit("update-end")})}catch(c){throw c}},b.prototype.select=function(a){var b=this,c=this._view,d=c.model().scene().items[0].items[0].items;d.forEach(function(c){c.datum.data.attributes[a.key]===a.value&&c.hasPropertySet("hover")&&b._view.update({props:"hover",items:c})})},b.prototype.clearSelection=function(a){var b=this,c=this._view,d=c.model().scene().items[0].items[0].items;a&&a.key?d.forEach(function(c){c.datum.data.attributes[a.key]===a.value&&b._view.update({props:"update",items:c})}):b._view.update()},b.prototype.emit=function(a){this._view._handler._handlers[a]&&this._view._handler._handlers[a][0].handler()},b.prototype._attach=function(a){a.on("mouseover",this._handler("mouseover")),a.on("mouseout",this._handler("mouseout")),a.on("click",this._handler("click")),a.on("update-start",this._handler("update-start")),a.on("update-end",this._handler("update-end"))},b.prototype._remove=function(a){a.off("mouseover"),a.off("mouseout"),a.off("click"),a.off("update-start"),a.off("update-end")},b._validateMappings=function(a,b){for(var c,d=[],e=0;e<a.length;e++)c=a[e],c.required&&(b[c.name]||d.push(c.name));return d},b._validateData=function(a,c){var d=[];if(!a.features||!Array.isArray(a.features))throw new Error("Data is expected to have features array!");var e=a.features[0].attributes;for(var f in c){var g=b._getMappingFieldName(f,c[f].field);e.hasOwnProperty(g)||d.push(g)}return d},b._getMappingFieldName=function(a,b){var c=b;return c},b._defaultDefinition=function(){var a={dataset:{query:this._defaultQuery()},template:{}};return a.dataset.query=b._defaultQuery(),a},b._defaultQuery=function(){var a={where:"1=1",returnGeometry:!1,returnDistinctValues:!1,returnIdsOnly:!1,returnCountOnly:!1,outFields:"*",f:"json"};return a},b.prototype._handler=function(a){var b=this,c=function(c,d){b._events.forEach(function(b){b.type===a&&(d?b.callback(d.datum.data.attributes):b.callback())})};return c},b.prototype.on=function(a,b){this._events.push({type:a,callback:b})},b.prototype.off=function(a){console.log("Handler for "+a+" removed...")},b.prototype._addToMethodQueue=function(a,b){this._methodQueue.push({method:a,args:b})},b.prototype._purgeMethodQueue=function(){var a=this;if(a._methodQueue.length>0)for(var b=0;b<a._methodQueue.length;b++){var c=a._methodQueue[b];a[c.method].apply(a,c.args)}},b.getJson=function(a,b){d3.json(a,function(c,d){c&&b("Error loading "+a+" "+c.message),b(null,d)})},b._mixin=function(a){for(var b=1;b<arguments.length;b++)d3.entries(arguments[b]).forEach(function(b){a[b.key]=b.value});return a},b._createFeatureServiceRequest=function(a,c){var d=b._mixin({},b._defaultQuery(),c);if(d.bbox){if(d.geometry)throw new Error("Dataset.query can not have both a geometry and a bbox specified");var e=d.bbox.split(",");delete d.bbox,d.geometry=JSON.stringify({xmin:e[0],ymin:e[2],xmax:e[1],ymax:e[3]}),d.inSR="4326"}!d.groupByFieldsForStatistics&&a.mappings.group&&(d.groupByFieldsForStatistics=a.mappings.group.field),!d.outStatistics&&a.mappings.count&&(d.orderByFields=a.mappings.count.field+"_SUM",d.outStatistics=JSON.stringify([{statisticType:"sum",onStatisticField:a.mappings.count.field,outStatisticFieldName:a.mappings.count.field+"_SUM"}])),a.mappings.sort&&(d.orderByFields=a.mappings.sort);var f=a.url+"/query?"+this._serializeQueryParams(d);return a.token&&(f=f+"&token="+a.token),f},b._applyDefaultsToMappings=function(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.required&&!a[e.name]&&c.push(e.name),e.required||a[e.name]||!e.default||(a[e.name]=e.default)}if(c.length>0)throw new Error("Required Mappings Missing: "+c.join(","));return a},b._supplant=function(a,c){return a.replace(/{([^{}]*)}/g,function(a,d){var e=b._getTokenValue(c,d);return"string"==typeof e||"number"==typeof e?e:a})},b._mergeRecursive=function(a,c){for(var d in c)try{a[d]=c[d].constructor===Object||c[d].constructor===Array?b._mergeRecursive(a[d],c[d]):c[d]}catch(e){a[d]=c[d]}return a},b._getTokenValue=function(a,b){for(var c=a,d=b.split("."),e=0;e<d.length;e++){if(!c.hasOwnProperty(d[e]))return null;c=c[d[e]]}return c},b._serializeQueryParams=function(a){var b=[];for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];"string"!=typeof d&&(d=JSON.stringify(d)),b.push(encodeURIComponent(c)+"="+encodeURIComponent(d))}var e=b.join("&");return e},a.Cedar=b}(window);
//# sourceMappingURL=cedar-vega.min.js.map