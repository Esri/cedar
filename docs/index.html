<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>Cedar</title>
    <!-- load the styles for any optional amcharts plugins in use -->
    <link rel="stylesheet" href="https://www.amcharts.com/lib/3/plugins/export/export.css" type="text/css" media="all" />
    <style>
        .container {
              width: 80%;
              margin: auto;
              display: flex;
              height: 600px;
          }
          .panel {
            flex: 1;
            text-align: center;
          }
          .chart {
              flex: 1;
          }
          #editor {
            position: relative !important;
            border: 1px solid lightgray;
            margin: auto;
            height: 600px;
            width: 90%;
          }
        .chart {
          border: 1px solid #444;
        }
        #styleList ul {
          list-style-type: none;
          padding:0;
          margin: 0;
        }
        #styleList ul li {
          cursor: pointer;
          padding: 15px 10px;
          border-bottom: 1px solid #CCC;
        }
        #styleList ul li:hover {
          background-color: #440000;
          color: #FFF;
        }
        button {
          padding: 15px;
          background-color: #000088;
          color: white;
          font-size: 1.1em;
          cursor: pointer;
        }
    </style>    
  </head>
  <body>
    <h1>Cedar</h1>
    <p>Click any chart type to see example JSON and chart output. See <a href="https://github.com/Esri/cedar">the GitHub repo</a> for more details.</p>
    <section class="container">
      <div id="styleList">
        <h3>Chart Types</h3>
      </div>
      <div class="panel">
        <div id="editor" class="text" rows="40" cols="100"/> </div>
        <button id="update" onclick="loadEditor()">Update Chart</buttonc
        <br />
      </div>
      <div id="chart" class="chart"></div>
    </section>

    <!-- code editor -->
    <script src="https://ajaxorg.github.io/ace-builds/src/ace.js" type="text/javascript" charset="utf-8"></script>
    
    <!-- load the amCharts base library -->
    <script src="https://www.amcharts.com/lib/3/amcharts.js"></script>
    <!-- for bar, line, and area charts -->
    <script src="https://www.amcharts.com/lib/3/serial.js"></script>
    <!-- for pie charts -->
    <script src="https://www.amcharts.com/lib/3/pie.js"></script>
    <!-- for scatter and bubble charts -->
    <script src="https://www.amcharts.com/lib/3/xy.js"></script>
    <!-- for radar charts -->
    <script src="https://www.amcharts.com/lib/3/radar.js"></script>
    <!-- optionally load an amcharts theme -->
    <script src="https://www.amcharts.com/lib/3/themes/light.js"></script>
    <!-- optioinally load the amcharts plugin to export the chart as and image or table -->
    <script src="https://www.amcharts.com/lib/3/plugins/export/export.min.js"></script>
    <link rel="stylesheet" href="https://www.amcharts.com/lib/3/plugins/export/export.css" type="text/css" media="all" />
    <!-- load cedar -->
    <script src="./scripts/cedar.js"></script>

    <!-- wire up the chart type buttons to show charts -->
    <script>
      // initialize code editor
      var editor = ace.edit("editor");
      editor.setTheme("ace/theme/xcode");
      editor.getSession().setMode("ace/mode/json");

      // build list of chart types and wire up to fetch JSON and render on click
      var styles = ["bar", "bar-grouped", "bar-stacked", "horizontal", "radar", "bubble", "area", "line", "pie", "scatter"];
      buildMenu(styles);

    function buildMenu(styles) {
      var ul = document.createElement('ul');
      document.getElementById('styleList').appendChild(ul);

      function buildOption(filename) {
        var li = document.createElement('li');
        li.setAttribute('class','style');
        li.setAttribute('onclick','loadExample("' + filename + '")');
        ul.appendChild(li);
        t = document.createTextNode(filename);
        li.innerHTML=li.innerHTML + filename;
      }

      styles.forEach(function(style, index, arr) {
        buildOption(style);
      });

      // Custom option
      buildOption("Custom")

      return ul;
    }

    function loadExample(style) {
      if(style.length == 0 || style == "Custom") {
        editor.setValue();
        return;
      }
      loadFile(style, function(configJson) {
        editor.setValue(configJson); // document.getElementById("editor").value;
        var config = JSON.parse(configJson);
        displayChart(config);
      });
    }

    function loadEditor() {
      var configJson = editor.getValue(); // document.getElementById("editor").value;
      var config = JSON.parse(configJson);
      displayChart(config);
    }

    let chart;
    function displayChart(config) {
        chart = new cedar.Chart(config);
        chart.show("chart")
    }

    function loadFile(style, cb) {
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
          if (this.readyState == 4 && this.status == 200) {
            // Typical action to be performed when the document is ready:
            cb(xhttp.responseText)
          }
      };
      xhttp.open("GET", "./examples/" + style + ".json", true);
      xhttp.send();
    }
  </script>
</body>
</html>
